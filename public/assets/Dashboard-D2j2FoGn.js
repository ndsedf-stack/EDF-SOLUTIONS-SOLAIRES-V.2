import{c as Mt,R as Us,a as qa,i as fn,t as Jo,b as Qo,d as $t,l as el,s as Ga,r as N,e as H,f as tl,g as xn,h as sl,k as Ka,m as nl,n as il,o as al,P as hi,G as ie,_ as pi,j as s,p as $s,q as Ae,L as mi,A as Ct,v as we,w as lt,x as ht,y as ms,B as rl,z as Qt,C as ol,T as jt,S as ze,Z as ll,D as cl,E as dl,F as ul,H as fi,I as hl,J as pt,K as Ya,M as Xa,N as Za,O as pl,Q as ml,U as fl,u as xl}from"./index-tRE_wt3I.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gl=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],xi=Mt("activity",gl);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bl=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],yl=Mt("credit-card",bl);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vl=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]],wl=Mt("file-down",vl);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jl=[["path",{d:"M5 12h14",key:"1ays0h"}]],Nl=Mt("minus",jl);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sl=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],kl=Mt("search",Sl);var _l=["className","innerRef"];function Ws(){return Ws=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ws.apply(this,arguments)}function Cl(e,t){if(e==null)return{};var n={},i=Object.keys(e),a,o;for(o=0;o<i.length;o++)a=i[o],!(t.indexOf(a)>=0)&&(n[a]=e[a]);return n}function gi(e){var t=e.className,n=e.innerRef,i=Cl(e,_l);return Us.createElement("circle",Ws({ref:n,className:qa("visx-circle",t)},i))}class bi extends Map{constructor(t,n=El){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[i,a]of t)this.set(i,a)}get(t){return super.get(yi(this,t))}has(t){return super.has(yi(this,t))}set(t,n){return super.set(Tl(this,t),n)}delete(t){return super.delete(Al(this,t))}}function yi({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):n}function Tl({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):(e.set(i,n),n)}function Al({_intern:e,_key:t},n){const i=t(n);return e.has(i)&&(n=e.get(i),e.delete(i)),n}function El(e){return e!==null&&typeof e=="object"?e.valueOf():e}function Dl(e,t,n){e=+e,t=+t,n=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+n;for(var i=-1,a=Math.max(0,Math.ceil((t-e)/n))|0,o=new Array(a);++i<a;)o[i]=e+i*n;return o}const vi=Symbol("implicit");function Ja(){var e=new bi,t=[],n=[],i=vi;function a(o){let r=e.get(o);if(r===void 0){if(i!==vi)return i;e.set(o,r=t.push(o)-1)}return n[r%n.length]}return a.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new bi;for(const r of o)e.has(r)||e.set(r,t.push(r)-1);return a},a.range=function(o){return arguments.length?(n=Array.from(o),a):n.slice()},a.unknown=function(o){return arguments.length?(i=o,a):i},a.copy=function(){return Ja(t,n).unknown(i)},fn.apply(a,arguments),a}function Qa(){var e=Ja().unknown(void 0),t=e.domain,n=e.range,i=0,a=1,o,r,l=!1,c=0,d=0,u=.5;delete e.unknown;function p(){var h=t().length,m=a<i,f=m?a:i,y=m?i:a;o=(y-f)/Math.max(1,h-c+d*2),l&&(o=Math.floor(o)),f+=(y-f-o*(h-c))*u,r=o*(1-c),l&&(f=Math.round(f),r=Math.round(r));var b=Dl(h).map(function(w){return f+o*w});return n(m?b.reverse():b)}return e.domain=function(h){return arguments.length?(t(h),p()):t()},e.range=function(h){return arguments.length?([i,a]=h,i=+i,a=+a,p()):[i,a]},e.rangeRound=function(h){return[i,a]=h,i=+i,a=+a,l=!0,p()},e.bandwidth=function(){return r},e.step=function(){return o},e.round=function(h){return arguments.length?(l=!!h,p()):l},e.padding=function(h){return arguments.length?(c=Math.min(1,d=+h),p()):c},e.paddingInner=function(h){return arguments.length?(c=Math.min(1,h),p()):c},e.paddingOuter=function(h){return arguments.length?(d=+h,p()):d},e.align=function(h){return arguments.length?(u=Math.max(0,Math.min(1,h)),p()):u},e.copy=function(){return Qa(t(),[i,a]).round(l).paddingInner(c).paddingOuter(d).align(u)},fn.apply(p(),arguments)}function wi(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Rl(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Ml(e){return e<0?-e*e:e*e}function Pl(e){var t=e($t,$t),n=1;function i(){return n===1?e($t,$t):n===.5?e(Rl,Ml):e(wi(n),wi(1/n))}return t.exponent=function(a){return arguments.length?(n=+a,i()):n},el(t)}function er(){var e=Pl(Jo());return e.copy=function(){return Qo(e,er()).exponent(e.exponent())},fn.apply(e,arguments),e}function Il(){return er.apply(null,arguments).exponent(.5)}var Ll=Ga("domain","range","reverse","align","padding","round");function gn(e){return Ll(Qa(),e)}var Ol=Ga("domain","range","reverse","clamp","interpolate","nice","round","zero");function Vl(e){return Ol(Il(),e)}function mt(e){const t=new Date(e),i=new Date().getTime()-t.getTime();return Math.floor(i/(1e3*60*60*24))}function qe(e){const t=e.views||0,n=e.clicks||0,i=e.send_count||0;return t===0&&n===0&&i>=4?"fatigue":t===0&&n===0?"muet":t>10?"cas_limite":t>=3&&n===0?"agite":n>=1?"interesse":"stable"}function Fl(e){let a=0;if(e.signed_at){const p=mt(e.signed_at);a=Math.min(p/14*100,100)}const o=e.total_price||0,r=Math.min(o/3e4*100,100),l=qe(e);let c=0;l==="stable"&&(c=0),l==="interesse"&&(c=20),l==="agite"&&(c=60),l==="muet"&&(c=80),l==="fatigue"&&(c=100),(e.send_count||0)>5&&(c=Math.min(c+20,100));const u=a*.5+r*.3+c*.2;return Math.min(100,Math.round(u))}const tr=[];function Bl(){return tr.filter(e=>e.outcome==="FAILURE")}function Ul(){return tr.filter(e=>e.outcome==="SUCCESS")}function sr(e){const t=Bl(),n=Ul();if(t.length+n.length<5)return Math.min(100,Math.round(e.dangerScore));let i=0;i+=e.dangerScore*.5,i+=e.tensionLevel*.3,e.behavior==="muet"&&(i+=15),e.behavior==="agite"&&(i+=8);const a=t.length/(t.length+n.length);return i=i*(1+a),Math.min(100,Math.round(i))}const $l=14,Wl=2e4,zl=1e4,Hl=5,ql=2;function Gl(e){return e.status!=="signed"||e.has_deposit!==!0||e.deposit_paid===!0||!e.signed_at?!1:mt(e.signed_at)<=$l}function Kl(e){return e.status!=="signed"?!1:e.has_deposit===!0&&e.deposit_paid===!1}function Yl(e){return e.status!=="signed"||e.has_deposit!==!0||e.deposit_paid===!0||!e.signed_at?!1:mt(e.signed_at)>10}function nr(e){const t=qe(e);return t==="fatigue"?"STOP_AUTO_CALL":t==="muet"?"CALL":t==="agite"?"RELANCE":t==="interesse"?"ACCELERER":(e.dangerScore||0)>70?"CALL":"SURVEILLER"}function Xl(e){if(e.length===0)return null;const t=e[0],n=qe(t),i=nr(t);let a="Dossier prioritaire";return n==="muet"?a="Client muet apr√®s signature, risque de d√©crochage":n==="fatigue"?a="Lead br√ªl√© : 0 interaction apr√®s relances multiples":n==="agite"?a="Client agit√©, consulte sans avancer":n==="interesse"&&(a="Client int√©ress√©, moment cl√© pour conclure"),t.dangerScore>70&&(a="Risque critique (temps + argent + comportement)"),{id:t.id,name:t.name,email:t.email,phone:t.phone,dangerScore:t.dangerScore,behavior:n,action:i,reason:a,daysSinceSigned:t.signed_at?mt(t.signed_at):null,total_price:t.total_price||0,requiresDeposit:t.requiresDeposit||!1,status:t.status,signed_at:t.signed_at,created_at:t.created_at,last_view:t.last_view}}function Zl(e){return e.slice(0,3).map((t,n)=>{const i=qe(t),a=nr(t);let o="Suivi standard";return i==="muet"?o="Client muet, risque de d√©crochage":i==="agite"?o="Client agit√©, bloque mentalement":i==="interesse"&&(o="Client int√©ress√©, moment cl√©"),t.dangerScore>70&&(o="Risque critique (temps + argent + comportement)"),{rank:n+1,id:t.id,name:t.name,email:t.email,phone:t.phone,dangerScore:t.dangerScore,behavior:i,action:a,reason:o,total_price:t.total_price||0,requiresDeposit:t.requiresDeposit||!1,status:t.status,signed_at:t.signed_at,created_at:t.created_at,last_view:t.last_view}})}function Jl(e,t){if(e.length===0&&t===0)return 0;let i=e.length>0?e.reduce((a,o)=>a+o.dangerScore,0)/e.length:0;return i+=e.length*5,i+=Math.min(t/5e3,30),Math.min(100,Math.round(i))}function Ql(e){if(e.lateDepositCount>0)return"critical";const{actionNowCount:t,cashAtRisk:n,sentCount:i,signedCount:a}=e;return t>=Hl||n>Wl?"critical":t>=ql||n>zl?"warning":i>=5||a>=3?"active":"stable"}function ec(e){const{tensionLevel:t,systemState:n,priorityActions:i}=e;return n==="critical"?{active:!0,level:"critical",message:"üö® SYST√àME SOUS PRESSION CRITIQUE",focus:i[0]||null}:t>70?{active:!0,level:"high",message:"‚ö†Ô∏è Forte tension d√©tect√©e",focus:i[0]||null}:t>40?{active:!0,level:"medium",message:"‚ö° Syst√®me sous tension",focus:i[0]||null}:{active:!1,level:"normal",message:"Syst√®me stable",focus:null}}function tc(e,t){if(!t||!t.warRoom||!t.finance)return{cashSecured:0,cashAtRisk:0,warRoomCA:0,securedCount:0,riskCount:0,warRoomCount:0,lateCount:0,lateNames:"‚Äî",nextDeadlineDate:"‚Äî",nextDeadlineClient:"‚Äî",caTotal:0,tauxConversion:0,cashWaitingDeposit:0,waitingDepositCount:0,cashCancellable:0,cancellableCount:0,cashAtFatigue:0,securedPotential:0};const n=new Date,i=e.filter(g=>g.status==="signed"),a=i.reduce((g,x)=>g+(x.total_price||0),0),o=i.filter(g=>g.contract_secured),r=o.reduce((g,x)=>g+(x.total_price||0),0),l=i.filter(g=>!g.contract_secured&&!g.deposit_paid&&g.has_deposit),c=l.reduce((g,x)=>g+(x.total_price||0),0),d=i.filter(g=>!g.contract_secured&&!(!g.deposit_paid&&g.has_deposit)),u=d.reduce((g,x)=>g+(x.total_price||0),0),p=t.behavioral.fatigues.reduce((g,x)=>g+(x.total_price||0),0),h=a,m=t.warRoom.studies,f=t.finance.cashAtRisk,y=t.warRoom.ca,b=m.filter(g=>{if(!g.signed_at)return!1;const x=new Date(g.signed_at);return Math.floor((n.getTime()-x.getTime())/864e5)>10&&!g.deposit_paid}),w=b.map(g=>g.name).join(", ")||"Aucun retard",j=d.filter(g=>g.signed_at).map(g=>({name:g.name,signedDate:new Date(g.signed_at),deadlineDate:new Date(new Date(g.signed_at).getTime()+336*60*60*1e3)})).sort((g,x)=>g.deadlineDate.getTime()-x.deadlineDate.getTime())[0],k=j?j.deadlineDate.toLocaleDateString("fr-FR"):"‚Äî",C=j?j.name:"Aucune √©ch√©ance proche",_=e.length>0?i.length/e.length*100:0;return{cashSecured:r,cashAtRisk:f,warRoomCA:y,securedCount:o.length,riskCount:m.length,warRoomCount:t.warRoom.studies.length,lateCount:b.length,lateNames:w,nextDeadlineDate:k,nextDeadlineClient:C,caTotal:a,tauxConversion:_,cashWaitingDeposit:c,waitingDepositCount:l.length,cashCancellable:u,cancellableCount:d.length,cashAtFatigue:p,securedPotential:h}}function sc(e){const t=e.filter(v=>v.status==="signed"),n=e.filter(v=>v.status==="sent"),i=t.filter(Gl).map(v=>{const S=Fl(v),A=qe(v),M=v.signed_at?mt(v.signed_at):0;return{...v,dangerScore:S,behavior:A,daysLate:M,cancellationRisk:0}}).sort((v,S)=>S.dangerScore-v.dangerScore),a=i.map(v=>v.id),o=i.reduce((v,S)=>v+(S.total_price||0),0),r=t.filter(Kl),l=t.filter(Yl),c=r.reduce((v,S)=>v+(S.total_price||0),0),d=Jl(i,c),u=i.map(v=>({...v,cancellationRisk:sr({dangerScore:v.dangerScore,tensionLevel:d,behavior:v.behavior})})),p=Xl(u),h=Zl(u),m=[...u,...r.filter(v=>!a.includes(v.id)),...l.filter(v=>!a.includes(v.id)&&!r.find(S=>S.id===v.id))],f=e.map(v=>{const S=qe(v);return{...v,risk:S}}),y=f.filter(v=>v.risk==="muet"),b=f.filter(v=>v.risk==="agite"),w=f.filter(v=>v.risk==="interesse"),j=f.filter(v=>v.risk==="fatigue"),k=e.filter(v=>!a.includes(v.id)&&!r.find(S=>S.id===v.id)),C=Ql({actionNowCount:m.length,cashAtRisk:c,sentCount:n.length,signedCount:t.length,lateDepositCount:l.length}),_=ec({tensionLevel:d,systemState:C,priorityActions:h}),g={signed:t,sent:n,healthy:k,lateDeposits:l,warRoom:{studies:u,count:u.length,ca:o},finance:{riskyDeposits:r,cashAtRisk:c},actionNow:m,behavioral:{muets:y,agites:b,interesses:w,fatigues:j},systemState:C,priorityCase:p,tensionLevel:d,priorityActions:h,urgencyMode:_},x=tc(e,g);return{...g,financialStats:x}}function ir(e){const t=e.views||0,n=e.clicks||0,i=e.send_count||0;if(t===0&&n===0&&i>=4)return{state:"FATIGUE",icon:"üò¥",label:"FATIGUE"};const a=qe(e);return a==="muet"?{state:"MUET",icon:"üßä",label:"SILENCE"}:a==="cas_limite"?{state:"CAS_LIMITE",icon:"‚ö†Ô∏è",label:"CAS LIMITE"}:a==="agite"?{state:"AGIT√â",icon:"üî•",label:"AGIT√â"}:a==="interesse"?{state:"INT√âRESS√â",icon:"üü¢",label:"INT√âRESS√â"}:{state:"STABLE",icon:"‚ö™",label:"STABLE"}}function nc(e,t,n={},i={}){var x,v,S,A,M,P,I,T,V,te,W,F,Y,pe,me,Ge,Ke,Ye;const a=e.id,o=((x=e.clients)==null?void 0:x.id)||"",r=n[String(a)]||n[String(o)],l=i[String(a)]||i[String(o)],c=(((v=r==null?void 0:r.sent)==null?void 0:v.length)||0)+(((S=l==null?void 0:l.sent)==null?void 0:S.length)||0);t||console.warn("‚ö†Ô∏è Pas de stats trouv√© pour study:",e.id,(A=e.clients)==null?void 0:A.email);const d=mt(e.created_at),u=new Date;let p=(t==null?void 0:t.email_opens)??(t==null?void 0:t.views)??(t==null?void 0:t.total_opens)??0,h=(t==null?void 0:t.interactions)??(t==null?void 0:t.clicks)??(t==null?void 0:t.total_clicks)??0;(P=(M=e.clients)==null?void 0:M.last_name)!=null&&P.toUpperCase().includes("GUYOT")&&console.log(`üìä Study ${(I=e.clients)==null?void 0:I.first_name} ${(T=e.clients)==null?void 0:T.last_name}:`,{id:e.id,views:p,clicks:h,stat_found:!!t,stat_data:t});const m=e.total_price||e.install_cost||((V=e.study_data)==null?void 0:V.installCost)||0,f=e.cash_apport??((te=e.study_data)==null?void 0:te.cashApport)??0;let y,b;f>=m&&m>0?(y="cash",b="cash_payment"):f>0&&f<m?(y="financing",b="partial_financing"):(y="financing",b="full_financing"),e.payment_mode&&(y=e.payment_mode),e.financing_mode&&(b=e.financing_mode);const w=b==="cash_payment"||b==="partial_financing";(F=(W=e.clients)==null?void 0:W.last_name)!=null&&F.toUpperCase().includes("DUCHENE")&&console.log("üîç MAPPERS DEBUG DUCHENE:",{name:`${(Y=e.clients)==null?void 0:Y.first_name} ${(pe=e.clients)==null?void 0:pe.last_name}`,apport:f,totalCost:m,mode:y,financingMode:b,requiresDepositCalc:w,db_has_deposit:e.has_deposit,db_deposit_amount:e.deposit_amount});const j=e.signed_at?Math.floor((u.getTime()-new Date(e.signed_at).getTime())/864e5):null,k=!e.signed_at||e.status!=="signed"||e.deposit_paid||!w?!1:j!==null&&j>0,C={id:e.id,client_id:((me=e.clients)==null?void 0:me.id)||"",name:e.clients?`${e.clients.first_name||""} ${e.clients.last_name||""}`.trim():"Inconnu",email:((Ge=e.clients)==null?void 0:Ge.email)||"Pas d'email",phone:(Ke=e.clients)==null?void 0:Ke.phone,status:e.status,created_at:e.created_at,signed_at:e.signed_at,study_data:e.study_data,deposit_amount:e.deposit_amount||0,deposit_paid:e.deposit_paid||!1,deposit_paid_at:e.deposit_paid_at,payment_mode:y,payment_type:e.payment_type||null,financing_mode:b,has_deposit:w||e.has_deposit,cash_apport:f,total_price:m,install_cost:e.install_cost||0,contract_secured:e.status==="signed"&&(j!==null&&j>=14||e.deposit_paid||!1),cancellation_deadline:e.cancellation_deadline||null,revenue_secured:e.status==="signed"?m:0,revenue_projected:m,revenue_gap:e.status!=="signed"?m:0,views:p,clicks:h,diffDays:Math.floor(d),hasLog:!1,rib_sent:e.rib_sent||!1,rib_sent_at:e.rib_sent_at,email_optout:((Ye=e.clients)==null?void 0:Ye.email_optout)||!1,last_open:(t==null?void 0:t.last_open)||(t==null?void 0:t.last_open_at)||(t==null?void 0:t.last_email_open)||null,last_click:(t==null?void 0:t.last_click)||(t==null?void 0:t.last_click_at)||null,last_view:(t==null?void 0:t.last_view)||null,requiresDeposit:w,daysLate:j||0,daysSinceSigned:j,isDepositLate:k,behavioralState:void 0,behavioralIcon:void 0,behavioralLabel:void 0,send_count:c},_=ir(C);C.behavioralState=_.state;let g=C.dangerScore||0;if(g===0){const Ve=p||0,Xe=h||0,R=Math.max(j||0,d||0);_.state==="MUET"?g=65+Math.min(R,20):_.state==="FATIGUE"?g=85+Math.min(R,15):_.state==="AGIT√â"?g=45+Math.min(Ve*2,20):_.state==="CAS_LIMITE"?g=30+Math.min(R,10):_.state==="INT√âRESS√â"?g=18+Math.min(R,12)-Math.min(Xe*2,10)+Math.min(Ve,5):g=5+Math.min(Ve,7);const L=parseInt(C.id.slice(0,2),16)%5-2;g+=L}return C.cancellationRisk=sr({dangerScore:Math.max(5,Math.min(98,g)),tensionLevel:C.status==="signed"?50:30,behavior:_.state}),C.dangerScore=g,C}function ji(e){return e.status==="signed"?"signed":e.clicks>0?"hot":e.views>=2?"warm":"cold"}const oe=[];for(let e=0;e<256;++e)oe.push((e+256).toString(16).slice(1));function ic(e,t=0){return(oe[e[t+0]]+oe[e[t+1]]+oe[e[t+2]]+oe[e[t+3]]+"-"+oe[e[t+4]]+oe[e[t+5]]+"-"+oe[e[t+6]]+oe[e[t+7]]+"-"+oe[e[t+8]]+oe[e[t+9]]+"-"+oe[e[t+10]]+oe[e[t+11]]+oe[e[t+12]]+oe[e[t+13]]+oe[e[t+14]]+oe[e[t+15]]).toLowerCase()}let ys;const ac=new Uint8Array(16);function rc(){if(!ys){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ys=crypto.getRandomValues.bind(crypto)}return ys(ac)}const oc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ni={randomUUID:oc};function lc(e,t,n){var a;e=e||{};const i=e.random??((a=e.rng)==null?void 0:a.call(e))??rc();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,ic(i)}function cc(e,t,n){return Ni.randomUUID&&!e?Ni.randomUUID():lc(e)}const dc=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():cc(),uc=e=>new Promise((t,n)=>setTimeout(()=>n(new Error(`Timeout Supabase after ${e}ms`)),e));async function vs(e,t=15e3){return Promise.race([e,uc(t)])}function hc(){const[e,t]=N.useState([]),[n,i]=N.useState([]),[a,o]=N.useState([]),[r,l]=N.useState(null),[c,d]=N.useState(!0),[u,p]=N.useState(null),[h,m]=N.useState(!1),[f,y]=N.useState(null),[b,w]=N.useState({}),[j,k]=N.useState({}),[C,_]=N.useState({}),[g,x]=N.useState([]),[v,S]=N.useState(0),[A,M]=N.useState(""),P=N.useCallback(async()=>{if(h)return;const R=[{progress:15,text:"Connexion Supabase...",duration:600},{progress:35,text:"Chargement dossiers...",duration:800},{progress:60,text:"Analyse m√©triques...",duration:700},{progress:85,text:"Calcul risques...",duration:600},{progress:100,text:"Syst√®me pr√™t !",duration:500}];for(let L=0;L<R.length;L++){const U=R[L];await new Promise(z=>setTimeout(z,U.duration)),S(U.progress),M(U.text)}await new Promise(L=>setTimeout(L,200)),m(!0)},[h]),I=async(R,L,U,z="*",O)=>{const ae=[];for(let se=0;se<U.length;se+=800){const je=U.slice(se,se+800);let Ce=H.from(R).select(z).in(L,je);O&&(Ce=Ce.order(O.col,{ascending:O.ascending}));const{data:X,error:Ze}=await vs(Ce);if(Ze)throw Ze;X&&ae.push(...X)}return{data:ae,error:null}},T=N.useCallback(async(R=!1)=>{try{R||d(!0),y(null);const L=H.from("decision_logs").select("*").order("created_at",{ascending:!1}).limit(50),U=vs(H.from("studies").select(`
            id, client_id, status, created_at, signed_at, study_data,
            deposit_amount, deposit_paid, deposit_paid_at, has_deposit,
            payment_type, payment_mode, cash_apport,
            total_price: install_cost, financing_mode, contract_secured, cancellation_deadline,
            clients (id, first_name, last_name, email, phone, email_optout)
        `)),[z,O]=await Promise.all([L,U]),{data:$,error:ae}=O,se=z.data||[];if(z.error&&console.error("Logs fetch failed",z.error),o(se),ae)throw ae;const je=($||[]).map(E=>E.id),Ce=($||[]).map(E=>E.client_id).filter(Boolean),X=je.length>0?I("tracking_events","study_id",je,"study_id, event_type, created_at"):Promise.resolve({data:[]}),Ze=Ce.length>0?I("email_queue","client_id",Ce,"study_id, client_id, email_type, status, sent_at, scheduled_for, created_at",{col:"created_at",ascending:!1}):Promise.resolve({data:[]}),[fe,Vt]=await Promise.allSettled([X,Ze]),Jn=fe.status==="fulfilled"?fe.value.data||[]:[];fe.status==="rejected"&&console.error("Tracking fetch failed",fe.reason);const Qn=Vt.status==="fulfilled"?Vt.value.data||[]:[];Vt.status==="rejected"&&console.error("Queue fetch failed",Vt.reason);const Ft=new Map,bt={},ei=new Map;Jn.forEach(E=>{if(!E.study_id)return;Ft.has(E.study_id)||(Ft.set(E.study_id,{id:E.study_id,email_opens:0,interactions:0,last_open_at:null,last_click_at:null}),bt[E.study_id]={total_opens:0},ei.set(E.study_id,new Set));const B=Ft.get(E.study_id),J=bt[E.study_id],K=ei.get(E.study_id),q=new Date(E.created_at).toISOString().substring(0,16);if(E.event_type==="email_open"||E.event_type==="view")K.has(q)||(B.email_opens++,J.total_opens++,K.add(q)),(!B.last_open_at||E.created_at>B.last_open_at)&&(B.last_open_at=E.created_at,J.last_open=E.created_at);else if(E.event_type==="email_click"||E.event_type==="click"){const be=`click-${q}`;K.has(be)||(B.interactions++,K.add(be)),(!B.last_click_at||E.created_at>B.last_click_at)&&(B.last_click_at=E.created_at,J.last_click=E.created_at)}});const Ko=Array.from(Ft.values()),ti={};($||[]).forEach(E=>{E.client_id&&(ti[E.client_id]=E.id)});const Bt={},Ut={};Qn.forEach(E=>{var Qe,ai,ri,oi,li,ci,di;const B=E.study_id||(E.client_id?ti[E.client_id]:null);if(!B)return;const J={...E,opened_at:((Qe=bt[B])==null?void 0:Qe.last_open)||null,clicked_at:((ai=bt[B])==null?void 0:ai.last_click)||null},q=((ri=E.email_type)==null?void 0:ri.startsWith("post_refus"))||((oi=E.email_type)==null?void 0:oi.includes("relance"))||((li=E.email_type)==null?void 0:li.includes("prospecting"))?Ut:Bt;q[B]||(q[B]={sent:[],next:null,total_opens:((ci=bt[B])==null?void 0:ci.total_opens)||0});const be=["sent","SUCCESS","success","delivered","processed"].includes(((di=E.status)==null?void 0:di.toLowerCase())||""),Je=["pending","scheduled","PENDING"].includes(E.status||"");if(be)q[B].sent.push(J);else if(Je){const ui=q[B].next;(!ui||new Date(E.scheduled_for)<new Date(ui.scheduled_for))&&(q[B].next=J)}E.client_id&&(q[String(E.client_id)]=q[B])}),[Bt,Ut].forEach(E=>{Object.keys(E).forEach(B=>{E[B].sent.sort((J,K)=>new Date(J.sent_at).getTime()-new Date(K.sent_at).getTime())})}),k(Bt),_(Ut);const si=($||[]).map(E=>{var Je;const J=(Je=(Array.isArray(E.clients)?E.clients:E.clients?[E.clients]:[])[0])==null?void 0:Je.id,K=J?n.find(Qe=>Qe.client_id===J):null,q=Ko.find(Qe=>Qe.id===E.id)||{id:E.id,email_opens:0,interactions:0},be={...q,email_opens:q.email_opens>0?q.email_opens:(K==null?void 0:K.total_opens)||0,interactions:q.interactions>0?q.interactions:(K==null?void 0:K.total_clicks)||0,last_open:q.last_open_at||(K==null?void 0:K.last_opened_at),last_click:q.last_click_at||(K==null?void 0:K.last_clicked_at)};return nc(E,be,Bt,Ut)});t(si);const De=sc(si);if(l(De),p(De.financialStats),De.priorityCase){const E=dc();try{await H.from("decision_logs").insert({id:E,study_id:De.priorityCase.id,created_at:new Date().toISOString(),action_performed:`PRIORITY_FLAG_${De.priorityCase.action.toUpperCase().replace(/\s+/g,"_")}`,justification:JSON.stringify({danger:De.priorityCase.dangerScore,behavior:De.priorityCase.behavior,state:De.systemState})})}catch(B){console.warn("Log failed:",B)}}const Yo=14,Fe=new Map,Xo=new Date;for(let E=Yo-1;E>=0;E--){const B=new Date;B.setDate(Xo.getDate()-E);const J=B.toISOString().split("T")[0];Fe.set(J,{date:J,count:0,opened:0,clicked:0})}const yt=new Map;Qn.forEach(E=>{var J;if(["sent","SUCCESS","success","delivered","processed"].includes(((J=E.status)==null?void 0:J.toLowerCase())||"")&&E.sent_at&&E.study_id){const K=new Date(E.sent_at).getTime();yt.has(E.study_id)||yt.set(E.study_id,[]),yt.get(E.study_id).push(K);const q=new Date(E.sent_at).toISOString().split("T")[0];Fe.has(q)&&Fe.get(q).count++}}),yt.forEach(E=>E.sort((B,J)=>B-J));const ni=new Set,ii=new Set;Jn.forEach(E=>{if(!E.study_id||!E.created_at)return;const B=new Date(E.created_at).getTime(),J=yt.get(E.study_id);if(!J)return;const K=[...J].reverse().find(Je=>Je<=B);if(!K)return;const q=new Date(K).toISOString().split("T")[0];if(!Fe.has(q))return;const be=`${E.study_id}-${q}`;(E.event_type==="email_open"||E.event_type==="view")&&(ni.has(be)||(ni.add(be),Fe.get(q).opened++)),(E.event_type==="email_click"||E.event_type==="click")&&(ii.has(be)||(ii.add(be),Fe.get(q).clicked++))});const Zo=Array.from(Fe.values()).sort((E,B)=>E.date.localeCompare(B.date));x(Zo)}catch(L){console.error("‚ùå System Brain Error:",L),y(L.message)}finally{d(!1)}},[n]),V=N.useCallback(async()=>{try{const{data:R,error:L}=await vs(H.from("email_leads").select(`
          id, client_id, created_at, last_email_sent_at, next_email_scheduled_at,
          email_step, total_opens, total_clicks, last_opened_at, last_clicked_at,
          clients!inner(id, first_name, last_name, email, email_optout)
        `).order("next_email_scheduled_at",{ascending:!0}));if(L)throw L;const U=R.map(X=>X.client_id).filter(Boolean),{data:z}=await H.from("studies").select("id, client_id").in("client_id",U),O={};(z||[]).forEach(X=>{X.client_id&&(O[X.client_id]=X.id)});const $=Object.values(O).filter(Boolean);let ae={},se={};if($.length>0){const{data:X}=await H.from("tracking_events").select("study_id, created_at").in("study_id",$).in("event_type",["email_open","view"]);(X||[]).forEach(fe=>{ae[fe.study_id]||(ae[fe.study_id]=fe.created_at)});const{data:Ze}=await H.from("tracking_events").select("study_id, created_at").in("study_id",$).in("event_type",["email_click","click"]);(Ze||[]).forEach(fe=>{se[fe.study_id]||(se[fe.study_id]=fe.created_at)})}const je=(R||[]).map(X=>te(X,O,ae,se));i(je);const Ce={};je.forEach(X=>{Ce[X.client_id]={step:X.email_sequence_step,last:X.last_email_sent,next:X.next_email_date,opens:X.total_opens,clicks:X.total_clicks,opted_out:X.opted_out,last_opened:X.last_opened_at,last_clicked:X.last_clicked_at}}),w(Ce)}catch(R){console.error(R)}},[]);function te(R,L,U,z){var $,ae,se,je;const O=L[R.client_id]||null;return{id:R.id,client_id:R.client_id,study_id:O,client_name:`${(($=R.clients)==null?void 0:$.first_name)||""} ${((ae=R.clients)==null?void 0:ae.last_name)||""}`.trim(),client_email:((se=R.clients)==null?void 0:se.email)||"",opted_out:((je=R.clients)==null?void 0:je.email_optout)||!1,email_sequence_step:R.email_step||0,last_email_sent:R.last_email_sent_at,next_email_date:R.next_email_scheduled_at,total_opens:R.total_opens||0,total_clicks:R.total_clicks||0,last_opened_at:O?U[O]:R.last_opened_at,last_clicked_at:O?z[O]:R.last_clicked_at,created_at:R.created_at}}const W=N.useCallback(async(R,L,U,z="Manuel")=>{const{error:O}=await H.from("studies").update({status:L,signed_at:L==="signed"?new Date().toISOString():null}).eq("id",R);O||(await H.from("decision_logs").insert({study_id:R,client_name:U,action_performed:`STATUS_CHANGE_${L.toUpperCase()}`,justification:z}),T())},[T]),F=N.useCallback(async(R,L)=>{const{error:U}=await H.from("studies").update({status:"signed",signed_at:new Date().toISOString()}).eq("id",R);return U?(console.error("Erreur signature",U),!1):(await T(!0),!0)},[T]),Y=N.useCallback(async(R,L)=>{const{error:U}=await H.from("studies").update({status:"cancelled"}).eq("id",R);return U?(console.error("Erreur annulation",U),!1):(await T(!0),!0)},[T]),pe=N.useCallback(async(R,L,U="virement")=>{let z;try{z=(await H.from("studies").update({deposit_paid:!0,deposit_paid_at:new Date().toISOString(),deposit_payment_mode:U.toLowerCase().trim()}).eq("id",R)).error}catch{z=(await H.from("studies").update({deposit_paid:!0,deposit_paid_at:new Date().toISOString()}).eq("id",R)).error}if(z)return console.error("Erreur paiement",z),!1;try{await H.from("decision_logs").insert({study_id:R,client_name:L,action_performed:"DEPOSIT_PAID_CONFIRMED",justification:`Mode: ${U}`})}catch(O){console.warn("Log failed",O)}return await T(!0),!0},[T]),me=N.useCallback(async(R,L)=>{const{error:U}=await H.from("studies").update({rib_sent:!0,rib_sent_at:new Date().toISOString()}).eq("id",R);U?alert("‚ùå Erreur : "+U.message):(await H.from("decision_logs").insert({study_id:R,client_name:L,action_performed:"RIB_SENT_CONFIRMED",justification:"RIB marqu√© comme envoy√©"}),alert("‚úÖ RIB marqu√© comme envoy√© !"),T())},[T]),Ge=N.useCallback(async R=>{const{data:L}=await H.from("clients").update({email_optout:!0}).eq("email",R).select();if(!L||L.length===0){alert("‚ùå ERREUR : Aucun client trouv√© avec cet email");return}await H.from("email_queue").update({status:"cancelled"}).eq("client_id",L[0].id).in("status",["pending","scheduled"]),await H.from("decision_logs").insert({client_name:`${L[0].first_name} ${L[0].last_name}`,action_performed:"EMAIL_OPTOUT",justification:"D√©sabonnement depuis dashboard"}),alert("‚úÖ Client d√©sabonn√© avec succ√®s !"),V(),T()},[T,V]),Ke=N.useCallback(async(R,L,U)=>{await H.from("studies").delete().eq("client_id",R),await H.from("email_queue").delete().eq("client_id",R),await H.from("email_leads").delete().eq("client_id",R),await H.from("clients").delete().eq("id",R),await H.from("decision_logs").insert({action_performed:"LEAD_DELETED_PERMANENTLY",client_name:U,justification:`Suppression d√©finitive ${L}`}),alert("‚úÖ Lead supprim√© d√©finitivement"),T(),V()},[T,V]),Ye=N.useCallback(async(R,L)=>{await H.from("studies").delete().eq("id",R),await H.from("decision_logs").insert({client_name:L,action_performed:"DELETE_STUDY",justification:"Suppression d√©finitive"}),T()},[T]),Ve=N.useCallback(async(R,L,U,z)=>{await H.from("decision_logs").insert({study_id:R,client_name:L,action_performed:U,justification:z})},[]),Xe=N.useCallback((R=!1)=>{T(R),V()},[T,V]);return N.useEffect(()=>{P(),T(),V();const R=setInterval(()=>{Xe(!0)},6e4);return()=>clearInterval(R)},[]),N.useEffect(()=>{n.length>0&&T(!0)},[n]),{studies:e,emailLeads:n,logs:a,metrics:r,financialStats:u,loading:c,systemInitialized:h,loadingProgress:v,loadingStep:A,error:f,emailFlowByClient:b,antiAnnulationByStudy:j,postRefusByStudy:C,trafficData:g,actions:{updateStudyStatus:W,signStudy:F,cancelStudy:Y,markDepositPaid:pe,markRibSent:me,setOptOut:Ge,deleteLeadPermanently:Ke,deleteStudy:Ye,logForceAction:Ve,refresh:Xe}}}function pc(e,t,n){var f,y,b;const i=e.length,a=e.filter(w=>w.status!=="cancelled").length,o=e.filter(w=>w.status==="signed").length,r=(f=n==null?void 0:n.finance)!=null&&f.riskyDeposits?o-n.finance.riskyDeposits.length:e.filter(w=>w.status==="signed"&&(w.deposit_paid||w.contract_secured)).length,l=((b=(y=n==null?void 0:n.finance)==null?void 0:y.riskyDeposits)==null?void 0:b.length)||0,c=t.length,d=t.filter(w=>!w.opted_out).length,u=t.reduce((w,j)=>w+(j.email_sequence_step||0),0),p=t.filter(w=>w.next_email_date).length,h=t.filter(w=>w.opted_out).length,m=c>0?h/c*100:0;return{totalStudies:i,activeStudies:a,signedStudies:o,securedStudies:r,waitingStudies:l,totalLeads:c,activeLeads:d,totalEmailsSent:u,pendingEmails:p,unsubscribedCount:h,unsubscribeRate:m}}var Wt={},zt={},Si;function mc(){if(Si)return zt;Si=1,zt.__esModule=!0,zt.default=r;var e=n(tl()),t=xn();function n(l){return l&&l.__esModule?l:{default:l}}function i(){return i=Object.assign?Object.assign.bind():function(l){for(var c=1;c<arguments.length;c++){var d=arguments[c];for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])}return l},i.apply(this,arguments)}var a=[],o={width:0,height:0,top:0,left:0};function r(l){var c=l===void 0?{}:l,d=c.initialSize,u=d===void 0?o:d,p=c.debounceTime,h=p===void 0?300:p,m=c.ignoreDimensions,f=m===void 0?a:m,y=c.enableDebounceLeadingCall,b=y===void 0?!0:y,w=c.resizeObserverPolyfill,j=(0,t.useRef)(null),k=(0,t.useRef)(0),C=(0,t.useState)(i({},o,u)),_=C[0],g=C[1],x=(0,t.useMemo)(function(){var v=Array.isArray(f)?f:[f];return(0,e.default)(function(S){g(function(A){var M=Object.keys(A),P=M.filter(function(T){return A[T]!==S[T]}),I=P.every(function(T){return v.includes(T)});return I?A:S})},h,{leading:b})},[h,b,f]);return(0,t.useEffect)(function(){var v=w||window.ResizeObserver,S=new v(function(A){A.forEach(function(M){var P,I=(P=M==null?void 0:M.contentRect)!=null?P:{},T=I.left,V=I.top,te=I.width,W=I.height;k.current=window.requestAnimationFrame(function(){x({width:te,height:W,top:V,left:T})})})});return j.current&&S.observe(j.current),function(){window.cancelAnimationFrame(k.current),S.disconnect(),x.cancel()}},[x,w]),i({parentRef:j,resize:x},_)}return zt}var ki;function fc(){if(ki)return Wt;ki=1,Wt.__esModule=!0,Wt.default=d;var e=o(sl()),t=o(xn()),n=o(mc()),i=["className","children","debounceTime","ignoreDimensions","initialSize","parentSizeStyles","enableDebounceLeadingCall","resizeObserverPolyfill"],a=["parentRef","resize"];function o(u){return u&&u.__esModule?u:{default:u}}function r(){return r=Object.assign?Object.assign.bind():function(u){for(var p=1;p<arguments.length;p++){var h=arguments[p];for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&(u[m]=h[m])}return u},r.apply(this,arguments)}function l(u,p){if(u==null)return{};var h={},m=Object.keys(u),f,y;for(y=0;y<m.length;y++)f=m[y],!(p.indexOf(f)>=0)&&(h[f]=u[f]);return h}var c={width:"100%",height:"100%"};function d(u){var p=u.className,h=u.children,m=u.debounceTime,f=u.ignoreDimensions,y=u.initialSize,b=u.parentSizeStyles,w=b===void 0?c:b,j=u.enableDebounceLeadingCall,k=j===void 0?!0:j,C=u.resizeObserverPolyfill,_=l(u,i),g=(0,n.default)({initialSize:y,debounceTime:m,ignoreDimensions:f,enableDebounceLeadingCall:k,resizeObserverPolyfill:C}),x=g.parentRef,v=g.resize,S=l(g,a);return t.default.createElement("div",r({style:w,ref:x,className:p},_),h(r({},S,{ref:x.current,resize:v})))}return d.propTypes={className:e.default.string,children:e.default.func.isRequired},Wt}var xc=fc();const gc=Ka(xc);var Ht={},_i;function bc(){if(_i)return Ht;_i=1,Ht.__esModule=!0,Ht.default=r;var e=i(xn()),t=i(nl()),n=["from","to","fill","className","innerRef"];function i(l){return l&&l.__esModule?l:{default:l}}function a(){return a=Object.assign?Object.assign.bind():function(l){for(var c=1;c<arguments.length;c++){var d=arguments[c];for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])}return l},a.apply(this,arguments)}function o(l,c){if(l==null)return{};var d={},u=Object.keys(l),p,h;for(h=0;h<u.length;h++)p=u[h],!(c.indexOf(p)>=0)&&(d[p]=l[p]);return d}function r(l){var c=l.from,d=c===void 0?{x:0,y:0}:c,u=l.to,p=u===void 0?{x:1,y:1}:u,h=l.fill,m=h===void 0?"transparent":h,f=l.className,y=l.innerRef,b=o(l,n),w=d.x===p.x||d.y===p.y;return e.default.createElement("line",a({ref:y,className:(0,t.default)("visx-line",f),x1:d.x,y1:d.y,x2:p.x,y2:p.y,fill:m,shapeRendering:w?"crispEdges":"auto"},b))}return Ht}var yc=bc();const vc=Ka(yc);function wc(e){return"bandwidth"in e?e.bandwidth():0}var jc=["top","left","scale","width","stroke","strokeWidth","strokeDasharray","className","children","numTicks","lineStyle","offset","tickValues"];function zs(){return zs=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},zs.apply(this,arguments)}function Nc(e,t){if(e==null)return{};var n={},i=Object.keys(e),a,o;for(o=0;o<i.length;o++)a=i[o],!(t.indexOf(a)>=0)&&(n[a]=e[a]);return n}function bn(e){var t=e.top,n=t===void 0?0:t,i=e.left,a=i===void 0?0:i,o=e.scale,r=e.width,l=e.stroke,c=l===void 0?"#eaf0f6":l,d=e.strokeWidth,u=d===void 0?1:d,p=e.strokeDasharray,h=e.className,m=e.children,f=e.numTicks,y=f===void 0?10:f,b=e.lineStyle,w=e.offset,j=e.tickValues,k=Nc(e,jc),C=j??il(o,y),_=(w??0)+wc(o)/2,g=C.map(function(x,v){var S,A=((S=al(o(x)))!=null?S:0)+_;return{index:v,from:new hi({x:0,y:A}),to:new hi({x:r,y:A})}});return Us.createElement(ie,{className:qa("visx-rows",h),top:n,left:a},m?m({lines:g}):g.map(function(x){var v=x.from,S=x.to,A=x.index;return Us.createElement(vc,zs({key:"row-line-"+A,from:v,to:S,stroke:c,strokeWidth:u,strokeDasharray:p,style:b},k))}))}bn.propTypes={tickValues:pi.array,width:pi.number.isRequired};const yn=N.createContext({});function vn(e){const t=N.useRef(null);return t.current===null&&(t.current=e()),t.current}const ar=typeof window<"u",rr=ar?N.useLayoutEffect:N.useEffect,fs=N.createContext(null);function wn(e,t){e.indexOf(t)===-1&&e.push(t)}function jn(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const _e=(e,t,n)=>n>t?t:n<e?e:n;let Nn=()=>{};const Ee={},or=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function lr(e){return typeof e=="object"&&e!==null}const cr=e=>/^0[^.\s]+$/u.test(e);function Sn(e){let t;return()=>(t===void 0&&(t=e()),t)}const ge=e=>e,Sc=(e,t)=>n=>t(e(n)),Pt=(...e)=>e.reduce(Sc),Tt=(e,t,n)=>{const i=t-e;return i===0?1:(n-e)/i};class kn{constructor(){this.subscriptions=[]}add(t){return wn(this.subscriptions,t),()=>jn(this.subscriptions,t)}notify(t,n,i){const a=this.subscriptions.length;if(a)if(a===1)this.subscriptions[0](t,n,i);else for(let o=0;o<a;o++){const r=this.subscriptions[o];r&&r(t,n,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Se=e=>e*1e3,xe=e=>e/1e3;function dr(e,t){return t?e*(1e3/t):0}const ur=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,kc=1e-7,_c=12;function Cc(e,t,n,i,a){let o,r,l=0;do r=t+(n-t)/2,o=ur(r,i,a)-e,o>0?n=r:t=r;while(Math.abs(o)>kc&&++l<_c);return r}function It(e,t,n,i){if(e===t&&n===i)return ge;const a=o=>Cc(o,0,1,e,n);return o=>o===0||o===1?o:ur(a(o),t,i)}const hr=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,pr=e=>t=>1-e(1-t),mr=It(.33,1.53,.69,.99),_n=pr(mr),fr=hr(_n),xr=e=>(e*=2)<1?.5*_n(e):.5*(2-Math.pow(2,-10*(e-1))),Cn=e=>1-Math.sin(Math.acos(e)),gr=pr(Cn),br=hr(Cn),Tc=It(.42,0,1,1),Ac=It(0,0,.58,1),yr=It(.42,0,.58,1),Ec=e=>Array.isArray(e)&&typeof e[0]!="number",vr=e=>Array.isArray(e)&&typeof e[0]=="number",Dc={linear:ge,easeIn:Tc,easeInOut:yr,easeOut:Ac,circIn:Cn,circInOut:br,circOut:gr,backIn:_n,backInOut:fr,backOut:mr,anticipate:xr},Rc=e=>typeof e=="string",Ci=e=>{if(vr(e)){Nn(e.length===4);const[t,n,i,a]=e;return It(t,n,i,a)}else if(Rc(e))return Dc[e];return e},qt=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Mc(e,t){let n=new Set,i=new Set,a=!1,o=!1;const r=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(u){r.has(u)&&(d.schedule(u),e()),u(l)}const d={schedule:(u,p=!1,h=!1)=>{const f=h&&a?n:i;return p&&r.add(u),f.has(u)||f.add(u),u},cancel:u=>{i.delete(u),r.delete(u)},process:u=>{if(l=u,a){o=!0;return}a=!0,[n,i]=[i,n],n.forEach(c),n.clear(),a=!1,o&&(o=!1,d.process(u))}};return d}const Pc=40;function wr(e,t){let n=!1,i=!0;const a={delta:0,timestamp:0,isProcessing:!1},o=()=>n=!0,r=qt.reduce((k,C)=>(k[C]=Mc(o),k),{}),{setup:l,read:c,resolveKeyframes:d,preUpdate:u,update:p,preRender:h,render:m,postRender:f}=r,y=()=>{const k=Ee.useManualTiming?a.timestamp:performance.now();n=!1,Ee.useManualTiming||(a.delta=i?1e3/60:Math.max(Math.min(k-a.timestamp,Pc),1)),a.timestamp=k,a.isProcessing=!0,l.process(a),c.process(a),d.process(a),u.process(a),p.process(a),h.process(a),m.process(a),f.process(a),a.isProcessing=!1,n&&t&&(i=!1,e(y))},b=()=>{n=!0,i=!0,a.isProcessing||e(y)};return{schedule:qt.reduce((k,C)=>{const _=r[C];return k[C]=(g,x=!1,v=!1)=>(n||b(),_.schedule(g,x,v)),k},{}),cancel:k=>{for(let C=0;C<qt.length;C++)r[qt[C]].cancel(k)},state:a,steps:r}}const{schedule:G,cancel:Ie,state:le,steps:ws}=wr(typeof requestAnimationFrame<"u"?requestAnimationFrame:ge,!0);let es;function Ic(){es=void 0}const ue={now:()=>(es===void 0&&ue.set(le.isProcessing||Ee.useManualTiming?le.timestamp:performance.now()),es),set:e=>{es=e,queueMicrotask(Ic)}},jr=e=>t=>typeof t=="string"&&t.startsWith(e),Nr=jr("--"),Lc=jr("var(--"),Tn=e=>Lc(e)?Oc.test(e.split("/*")[0].trim()):!1,Oc=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function Ti(e){return typeof e!="string"?!1:e.split("/*")[0].includes("var(--")}const ft={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},At={...ft,transform:e=>_e(0,1,e)},Gt={...ft,default:1},Nt=e=>Math.round(e*1e5)/1e5,An=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Vc(e){return e==null}const Fc=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,En=(e,t)=>n=>!!(typeof n=="string"&&Fc.test(n)&&n.startsWith(e)||t&&!Vc(n)&&Object.prototype.hasOwnProperty.call(n,t)),Sr=(e,t,n)=>i=>{if(typeof i!="string")return i;const[a,o,r,l]=i.match(An);return{[e]:parseFloat(a),[t]:parseFloat(o),[n]:parseFloat(r),alpha:l!==void 0?parseFloat(l):1}},Bc=e=>_e(0,255,e),js={...ft,transform:e=>Math.round(Bc(e))},$e={test:En("rgb","red"),parse:Sr("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:i=1})=>"rgba("+js.transform(e)+", "+js.transform(t)+", "+js.transform(n)+", "+Nt(At.transform(i))+")"};function Uc(e){let t="",n="",i="",a="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),i=e.substring(5,7),a=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),i=e.substring(3,4),a=e.substring(4,5),t+=t,n+=n,i+=i,a+=a),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:a?parseInt(a,16)/255:1}}const Hs={test:En("#"),parse:Uc,transform:$e.transform},Lt=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Re=Lt("deg"),ke=Lt("%"),D=Lt("px"),$c=Lt("vh"),Wc=Lt("vw"),Ai={...ke,parse:e=>ke.parse(e)/100,transform:e=>ke.transform(e*100)},nt={test:En("hsl","hue"),parse:Sr("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:i=1})=>"hsla("+Math.round(e)+", "+ke.transform(Nt(t))+", "+ke.transform(Nt(n))+", "+Nt(At.transform(i))+")"},ee={test:e=>$e.test(e)||Hs.test(e)||nt.test(e),parse:e=>$e.test(e)?$e.parse(e):nt.test(e)?nt.parse(e):Hs.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?$e.transform(e):nt.transform(e),getAnimatableNone:e=>{const t=ee.parse(e);return t.alpha=0,ee.transform(t)}},zc=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Hc(e){var t,n;return isNaN(e)&&typeof e=="string"&&(((t=e.match(An))==null?void 0:t.length)||0)+(((n=e.match(zc))==null?void 0:n.length)||0)>0}const kr="number",_r="color",qc="var",Gc="var(",Ei="${}",Kc=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Et(e){const t=e.toString(),n=[],i={color:[],number:[],var:[]},a=[];let o=0;const l=t.replace(Kc,c=>(ee.test(c)?(i.color.push(o),a.push(_r),n.push(ee.parse(c))):c.startsWith(Gc)?(i.var.push(o),a.push(qc),n.push(c)):(i.number.push(o),a.push(kr),n.push(parseFloat(c))),++o,Ei)).split(Ei);return{values:n,split:l,indexes:i,types:a}}function Cr(e){return Et(e).values}function Tr(e){const{split:t,types:n}=Et(e),i=t.length;return a=>{let o="";for(let r=0;r<i;r++)if(o+=t[r],a[r]!==void 0){const l=n[r];l===kr?o+=Nt(a[r]):l===_r?o+=ee.transform(a[r]):o+=a[r]}return o}}const Yc=e=>typeof e=="number"?0:ee.test(e)?ee.getAnimatableNone(e):e;function Xc(e){const t=Cr(e);return Tr(e)(t.map(Yc))}const Le={test:Hc,parse:Cr,createTransformer:Tr,getAnimatableNone:Xc};function Ns(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Zc({hue:e,saturation:t,lightness:n,alpha:i}){e/=360,t/=100,n/=100;let a=0,o=0,r=0;if(!t)a=o=r=n;else{const l=n<.5?n*(1+t):n+t-n*t,c=2*n-l;a=Ns(c,l,e+1/3),o=Ns(c,l,e),r=Ns(c,l,e-1/3)}return{red:Math.round(a*255),green:Math.round(o*255),blue:Math.round(r*255),alpha:i}}function rs(e,t){return n=>n>0?t:e}const Z=(e,t,n)=>e+(t-e)*n,Ss=(e,t,n)=>{const i=e*e,a=n*(t*t-i)+i;return a<0?0:Math.sqrt(a)},Jc=[Hs,$e,nt],Qc=e=>Jc.find(t=>t.test(e));function Di(e){const t=Qc(e);if(!t)return!1;let n=t.parse(e);return t===nt&&(n=Zc(n)),n}const Ri=(e,t)=>{const n=Di(e),i=Di(t);if(!n||!i)return rs(e,t);const a={...n};return o=>(a.red=Ss(n.red,i.red,o),a.green=Ss(n.green,i.green,o),a.blue=Ss(n.blue,i.blue,o),a.alpha=Z(n.alpha,i.alpha,o),$e.transform(a))},qs=new Set(["none","hidden"]);function ed(e,t){return qs.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}function td(e,t){return n=>Z(e,t,n)}function Dn(e){return typeof e=="number"?td:typeof e=="string"?Tn(e)?rs:ee.test(e)?Ri:id:Array.isArray(e)?Ar:typeof e=="object"?ee.test(e)?Ri:sd:rs}function Ar(e,t){const n=[...e],i=n.length,a=e.map((o,r)=>Dn(o)(o,t[r]));return o=>{for(let r=0;r<i;r++)n[r]=a[r](o);return n}}function sd(e,t){const n={...e,...t},i={};for(const a in n)e[a]!==void 0&&t[a]!==void 0&&(i[a]=Dn(e[a])(e[a],t[a]));return a=>{for(const o in i)n[o]=i[o](a);return n}}function nd(e,t){const n=[],i={color:0,var:0,number:0};for(let a=0;a<t.values.length;a++){const o=t.types[a],r=e.indexes[o][i[o]],l=e.values[r]??0;n[a]=l,i[o]++}return n}const id=(e,t)=>{const n=Le.createTransformer(t),i=Et(e),a=Et(t);return i.indexes.var.length===a.indexes.var.length&&i.indexes.color.length===a.indexes.color.length&&i.indexes.number.length>=a.indexes.number.length?qs.has(e)&&!a.values.length||qs.has(t)&&!i.values.length?ed(e,t):Pt(Ar(nd(i,a),a.values),n):rs(e,t)};function Er(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?Z(e,t,n):Dn(e)(e,t)}const ad=e=>{const t=({timestamp:n})=>e(n);return{start:(n=!0)=>G.update(t,n),stop:()=>Ie(t),now:()=>le.isProcessing?le.timestamp:ue.now()}},Dr=(e,t,n=10)=>{let i="";const a=Math.max(Math.round(t/n),2);for(let o=0;o<a;o++)i+=Math.round(e(o/(a-1))*1e4)/1e4+", ";return`linear(${i.substring(0,i.length-2)})`},os=2e4;function Rn(e){let t=0;const n=50;let i=e.next(t);for(;!i.done&&t<os;)t+=n,i=e.next(t);return t>=os?1/0:t}function rd(e,t=100,n){const i=n({...e,keyframes:[0,t]}),a=Math.min(Rn(i),os);return{type:"keyframes",ease:o=>i.next(a*o).value/t,duration:xe(a)}}const od=5;function Rr(e,t,n){const i=Math.max(t-od,0);return dr(n-e(i),t-i)}const Q={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},ks=.001;function ld({duration:e=Q.duration,bounce:t=Q.bounce,velocity:n=Q.velocity,mass:i=Q.mass}){let a,o,r=1-t;r=_e(Q.minDamping,Q.maxDamping,r),e=_e(Q.minDuration,Q.maxDuration,xe(e)),r<1?(a=d=>{const u=d*r,p=u*e,h=u-n,m=Gs(d,r),f=Math.exp(-p);return ks-h/m*f},o=d=>{const p=d*r*e,h=p*n+n,m=Math.pow(r,2)*Math.pow(d,2)*e,f=Math.exp(-p),y=Gs(Math.pow(d,2),r);return(-a(d)+ks>0?-1:1)*((h-m)*f)/y}):(a=d=>{const u=Math.exp(-d*e),p=(d-n)*e+1;return-ks+u*p},o=d=>{const u=Math.exp(-d*e),p=(n-d)*(e*e);return u*p});const l=5/e,c=dd(a,o,l);if(e=Se(e),isNaN(c))return{stiffness:Q.stiffness,damping:Q.damping,duration:e};{const d=Math.pow(c,2)*i;return{stiffness:d,damping:r*2*Math.sqrt(i*d),duration:e}}}const cd=12;function dd(e,t,n){let i=n;for(let a=1;a<cd;a++)i=i-e(i)/t(i);return i}function Gs(e,t){return e*Math.sqrt(1-t*t)}const ud=["duration","bounce"],hd=["stiffness","damping","mass"];function Mi(e,t){return t.some(n=>e[n]!==void 0)}function pd(e){let t={velocity:Q.velocity,stiffness:Q.stiffness,damping:Q.damping,mass:Q.mass,isResolvedFromDuration:!1,...e};if(!Mi(e,hd)&&Mi(e,ud))if(e.visualDuration){const n=e.visualDuration,i=2*Math.PI/(n*1.2),a=i*i,o=2*_e(.05,1,1-(e.bounce||0))*Math.sqrt(a);t={...t,mass:Q.mass,stiffness:a,damping:o}}else{const n=ld(e);t={...t,...n,mass:Q.mass},t.isResolvedFromDuration=!0}return t}function ls(e=Q.visualDuration,t=Q.bounce){const n=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:i,restDelta:a}=n;const o=n.keyframes[0],r=n.keyframes[n.keyframes.length-1],l={done:!1,value:o},{stiffness:c,damping:d,mass:u,duration:p,velocity:h,isResolvedFromDuration:m}=pd({...n,velocity:-xe(n.velocity||0)}),f=h||0,y=d/(2*Math.sqrt(c*u)),b=r-o,w=xe(Math.sqrt(c/u)),j=Math.abs(b)<5;i||(i=j?Q.restSpeed.granular:Q.restSpeed.default),a||(a=j?Q.restDelta.granular:Q.restDelta.default);let k;if(y<1){const _=Gs(w,y);k=g=>{const x=Math.exp(-y*w*g);return r-x*((f+y*w*b)/_*Math.sin(_*g)+b*Math.cos(_*g))}}else if(y===1)k=_=>r-Math.exp(-w*_)*(b+(f+w*b)*_);else{const _=w*Math.sqrt(y*y-1);k=g=>{const x=Math.exp(-y*w*g),v=Math.min(_*g,300);return r-x*((f+y*w*b)*Math.sinh(v)+_*b*Math.cosh(v))/_}}const C={calculatedDuration:m&&p||null,next:_=>{const g=k(_);if(m)l.done=_>=p;else{let x=_===0?f:0;y<1&&(x=_===0?Se(f):Rr(k,_,g));const v=Math.abs(x)<=i,S=Math.abs(r-g)<=a;l.done=v&&S}return l.value=l.done?r:g,l},toString:()=>{const _=Math.min(Rn(C),os),g=Dr(x=>C.next(_*x).value,_,30);return _+"ms "+g},toTransition:()=>{}};return C}ls.applyToOptions=e=>{const t=rd(e,100,ls);return e.ease=t.ease,e.duration=Se(t.duration),e.type="keyframes",e};function Ks({keyframes:e,velocity:t=0,power:n=.8,timeConstant:i=325,bounceDamping:a=10,bounceStiffness:o=500,modifyTarget:r,min:l,max:c,restDelta:d=.5,restSpeed:u}){const p=e[0],h={done:!1,value:p},m=v=>l!==void 0&&v<l||c!==void 0&&v>c,f=v=>l===void 0?c:c===void 0||Math.abs(l-v)<Math.abs(c-v)?l:c;let y=n*t;const b=p+y,w=r===void 0?b:r(b);w!==b&&(y=w-p);const j=v=>-y*Math.exp(-v/i),k=v=>w+j(v),C=v=>{const S=j(v),A=k(v);h.done=Math.abs(S)<=d,h.value=h.done?w:A};let _,g;const x=v=>{m(h.value)&&(_=v,g=ls({keyframes:[h.value,f(h.value)],velocity:Rr(k,v,h.value),damping:a,stiffness:o,restDelta:d,restSpeed:u}))};return x(0),{calculatedDuration:null,next:v=>{let S=!1;return!g&&_===void 0&&(S=!0,C(v),x(v)),_!==void 0&&v>=_?g.next(v-_):(!S&&C(v),h)}}}function md(e,t,n){const i=[],a=n||Ee.mix||Er,o=e.length-1;for(let r=0;r<o;r++){let l=a(e[r],e[r+1]);if(t){const c=Array.isArray(t)?t[r]||ge:t;l=Pt(c,l)}i.push(l)}return i}function fd(e,t,{clamp:n=!0,ease:i,mixer:a}={}){const o=e.length;if(Nn(o===t.length),o===1)return()=>t[0];if(o===2&&t[0]===t[1])return()=>t[1];const r=e[0]===e[1];e[0]>e[o-1]&&(e=[...e].reverse(),t=[...t].reverse());const l=md(t,i,a),c=l.length,d=u=>{if(r&&u<e[0])return t[0];let p=0;if(c>1)for(;p<e.length-2&&!(u<e[p+1]);p++);const h=Tt(e[p],e[p+1],u);return l[p](h)};return n?u=>d(_e(e[0],e[o-1],u)):d}function xd(e,t){const n=e[e.length-1];for(let i=1;i<=t;i++){const a=Tt(0,t,i);e.push(Z(n,1,a))}}function gd(e){const t=[0];return xd(t,e.length-1),t}function bd(e,t){return e.map(n=>n*t)}function yd(e,t){return e.map(()=>t||yr).splice(0,e.length-1)}function St({duration:e=300,keyframes:t,times:n,ease:i="easeInOut"}){const a=Ec(i)?i.map(Ci):Ci(i),o={done:!1,value:t[0]},r=bd(n&&n.length===t.length?n:gd(t),e),l=fd(r,t,{ease:Array.isArray(a)?a:yd(t,a)});return{calculatedDuration:e,next:c=>(o.value=l(c),o.done=c>=e,o)}}const vd=e=>e!==null;function Mn(e,{repeat:t,repeatType:n="loop"},i,a=1){const o=e.filter(vd),l=a<0||t&&n!=="loop"&&t%2===1?0:o.length-1;return!l||i===void 0?o[l]:i}const wd={decay:Ks,inertia:Ks,tween:St,keyframes:St,spring:ls};function Mr(e){typeof e.type=="string"&&(e.type=wd[e.type])}class Pn{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,n){return this.finished.then(t,n)}}const jd=e=>e/100;class In extends Pn{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var i,a;const{motionValue:n}=this.options;n&&n.updatedAt!==ue.now()&&this.tick(ue.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(a=(i=this.options).onStop)==null||a.call(i))},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;Mr(t);const{type:n=St,repeat:i=0,repeatDelay:a=0,repeatType:o,velocity:r=0}=t;let{keyframes:l}=t;const c=n||St;c!==St&&typeof l[0]!="number"&&(this.mixKeyframes=Pt(jd,Er(l[0],l[1])),l=[0,100]);const d=c({...t,keyframes:l});o==="mirror"&&(this.mirroredGenerator=c({...t,keyframes:[...l].reverse(),velocity:-r})),d.calculatedDuration===null&&(d.calculatedDuration=Rn(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+a,this.totalDuration=this.resolvedDuration*(i+1)-a,this.generator=d}updateTime(t){const n=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(t,n=!1){const{generator:i,totalDuration:a,mixKeyframes:o,mirroredGenerator:r,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return i.next(0);const{delay:d=0,keyframes:u,repeat:p,repeatType:h,repeatDelay:m,type:f,onUpdate:y,finalKeyframe:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-a/this.speed,this.startTime)),n?this.currentTime=t:this.updateTime(t);const w=this.currentTime-d*(this.playbackSpeed>=0?1:-1),j=this.playbackSpeed>=0?w<0:w>a;this.currentTime=Math.max(w,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=a);let k=this.currentTime,C=i;if(p){const v=Math.min(this.currentTime,a)/l;let S=Math.floor(v),A=v%1;!A&&v>=1&&(A=1),A===1&&S--,S=Math.min(S,p+1),!!(S%2)&&(h==="reverse"?(A=1-A,m&&(A-=m/l)):h==="mirror"&&(C=r)),k=_e(0,1,A)*l}const _=j?{done:!1,value:u[0]}:C.next(k);o&&(_.value=o(_.value));let{done:g}=_;!j&&c!==null&&(g=this.playbackSpeed>=0?this.currentTime>=a:this.currentTime<=0);const x=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&g);return x&&f!==Ks&&(_.value=Mn(u,this.options,b,this.speed)),y&&y(_.value),x&&this.finish(),_}then(t,n){return this.finished.then(t,n)}get duration(){return xe(this.calculatedDuration)}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+xe(t)}get time(){return xe(this.currentTime)}set time(t){var n;t=Se(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),(n=this.driver)==null||n.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(ue.now());const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=xe(this.currentTime))}play(){var a,o;if(this.isStopped)return;const{driver:t=ad,startTime:n}=this.options;this.driver||(this.driver=t(r=>this.tick(r))),(o=(a=this.options).onPlay)==null||o.call(a);const i=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=i):this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime||(this.startTime=n??i),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(ue.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var t,n;this.notifyFinished(),this.teardown(),this.state="finished",(n=(t=this.options).onComplete)==null||n.call(t)}cancel(){var t,n;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(n=(t=this.options).onCancel)==null||n.call(t)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){var n;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(n=this.driver)==null||n.stop(),t.observe(this)}}function Nd(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const We=e=>e*180/Math.PI,Ys=e=>{const t=We(Math.atan2(e[1],e[0]));return Xs(t)},Sd={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:Ys,rotateZ:Ys,skewX:e=>We(Math.atan(e[1])),skewY:e=>We(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},Xs=e=>(e=e%360,e<0&&(e+=360),e),Pi=Ys,Ii=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),Li=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),kd={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Ii,scaleY:Li,scale:e=>(Ii(e)+Li(e))/2,rotateX:e=>Xs(We(Math.atan2(e[6],e[5]))),rotateY:e=>Xs(We(Math.atan2(-e[2],e[0]))),rotateZ:Pi,rotate:Pi,skewX:e=>We(Math.atan(e[4])),skewY:e=>We(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function Zs(e){return e.includes("scale")?1:0}function Js(e,t){if(!e||e==="none")return Zs(t);const n=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let i,a;if(n)i=kd,a=n;else{const l=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);i=Sd,a=l}if(!a)return Zs(t);const o=i[t],r=a[1].split(",").map(Cd);return typeof o=="function"?o(r):r[o]}const _d=(e,t)=>{const{transform:n="none"}=getComputedStyle(e);return Js(n,t)};function Cd(e){return parseFloat(e.trim())}const xt=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],gt=new Set(xt),Oi=e=>e===ft||e===D,Td=new Set(["x","y","z"]),Ad=xt.filter(e=>!Td.has(e));function Ed(e){const t=[];return Ad.forEach(n=>{const i=e.getValue(n);i!==void 0&&(t.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),t}const Pe={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>Js(t,"x"),y:(e,{transform:t})=>Js(t,"y")};Pe.translateX=Pe.x;Pe.translateY=Pe.y;const He=new Set;let Qs=!1,en=!1,tn=!1;function Pr(){if(en){const e=Array.from(He).filter(i=>i.needsMeasurement),t=new Set(e.map(i=>i.element)),n=new Map;t.forEach(i=>{const a=Ed(i);a.length&&(n.set(i,a),i.render())}),e.forEach(i=>i.measureInitialState()),t.forEach(i=>{i.render();const a=n.get(i);a&&a.forEach(([o,r])=>{var l;(l=i.getValue(o))==null||l.set(r)})}),e.forEach(i=>i.measureEndState()),e.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}en=!1,Qs=!1,He.forEach(e=>e.complete(tn)),He.clear()}function Ir(){He.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(en=!0)})}function Dd(){tn=!0,Ir(),Pr(),tn=!1}class Ln{constructor(t,n,i,a,o,r=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=i,this.motionValue=a,this.element=o,this.isAsync=r}scheduleResolve(){this.state="scheduled",this.isAsync?(He.add(this),Qs||(Qs=!0,G.read(Ir),G.resolveKeyframes(Pr))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:i,motionValue:a}=this;if(t[0]===null){const o=a==null?void 0:a.get(),r=t[t.length-1];if(o!==void 0)t[0]=o;else if(i&&n){const l=i.readValue(n,r);l!=null&&(t[0]=l)}t[0]===void 0&&(t[0]=r),a&&o===void 0&&a.set(t[0])}Nd(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),He.delete(this)}cancel(){this.state==="scheduled"&&(He.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Rd=e=>e.startsWith("--");function Md(e,t,n){Rd(t)?e.style.setProperty(t,n):e.style[t]=n}const Pd=Sn(()=>window.ScrollTimeline!==void 0),Id={};function Ld(e,t){const n=Sn(e);return()=>Id[t]??n()}const Lr=Ld(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),wt=([e,t,n,i])=>`cubic-bezier(${e}, ${t}, ${n}, ${i})`,Vi={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:wt([0,.65,.55,1]),circOut:wt([.55,0,1,.45]),backIn:wt([.31,.01,.66,-.59]),backOut:wt([.33,1.53,.69,.99])};function Or(e,t){if(e)return typeof e=="function"?Lr()?Dr(e,t):"ease-out":vr(e)?wt(e):Array.isArray(e)?e.map(n=>Or(n,t)||Vi.easeOut):Vi[e]}function Od(e,t,n,{delay:i=0,duration:a=300,repeat:o=0,repeatType:r="loop",ease:l="easeOut",times:c}={},d=void 0){const u={[t]:n};c&&(u.offset=c);const p=Or(l,a);Array.isArray(p)&&(u.easing=p);const h={delay:i,duration:a,easing:Array.isArray(p)?"linear":p,fill:"both",iterations:o+1,direction:r==="reverse"?"alternate":"normal"};return d&&(h.pseudoElement=d),e.animate(u,h)}function Vr(e){return typeof e=="function"&&"applyToOptions"in e}function Vd({type:e,...t}){return Vr(e)&&Lr()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class Fd extends Pn{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!t)return;const{element:n,name:i,keyframes:a,pseudoElement:o,allowFlatten:r=!1,finalKeyframe:l,onComplete:c}=t;this.isPseudoElement=!!o,this.allowFlatten=r,this.options=t,Nn(typeof t.type!="string");const d=Vd(t);this.animation=Od(n,i,a,d,o),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!o){const u=Mn(a,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(u):Md(n,i,u),this.animation.cancel()}c==null||c(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var t,n;(n=(t=this.animation).finish)==null||n.call(t)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var n,i,a;const t=(n=this.options)==null?void 0:n.element;!this.isPseudoElement&&(t!=null&&t.isConnected)&&((a=(i=this.animation).commitStyles)==null||a.call(i))}get duration(){var n,i;const t=((i=(n=this.animation.effect)==null?void 0:n.getComputedTiming)==null?void 0:i.call(n).duration)||0;return xe(Number(t))}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+xe(t)}get time(){return xe(Number(this.animation.currentTime)||0)}set time(t){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=Se(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(t){this.manualStartTime=this.animation.startTime=t}attachTimeline({timeline:t,observe:n}){var i;return this.allowFlatten&&((i=this.animation.effect)==null||i.updateTiming({easing:"linear"})),this.animation.onfinish=null,t&&Pd()?(this.animation.timeline=t,ge):n(this)}}const Fr={anticipate:xr,backInOut:fr,circInOut:br};function Bd(e){return e in Fr}function Ud(e){typeof e.ease=="string"&&Bd(e.ease)&&(e.ease=Fr[e.ease])}const _s=10;class $d extends Fd{constructor(t){Ud(t),Mr(t),super(t),t.startTime!==void 0&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:n,onUpdate:i,onComplete:a,element:o,...r}=this.options;if(!n)return;if(t!==void 0){n.set(t);return}const l=new In({...r,autoplay:!1}),c=Math.max(_s,ue.now()-this.startTime),d=_e(0,_s,c-_s);n.setWithVelocity(l.sample(Math.max(0,c-d)).value,l.sample(c).value,d),l.stop()}}const Fi=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Le.test(e)||e==="0")&&!e.startsWith("url("));function Wd(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function zd(e,t,n,i){const a=e[0];if(a===null)return!1;if(t==="display"||t==="visibility")return!0;const o=e[e.length-1],r=Fi(a,t),l=Fi(o,t);return!r||!l?!1:Wd(e)||(n==="spring"||Vr(n))&&i}function sn(e){e.duration=0,e.type="keyframes"}const Hd=new Set(["opacity","clipPath","filter","transform"]),qd=Sn(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Gd(e){var u;const{motionValue:t,name:n,repeatDelay:i,repeatType:a,damping:o,type:r}=e;if(!(((u=t==null?void 0:t.owner)==null?void 0:u.current)instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=t.owner.getProps();return qd()&&n&&Hd.has(n)&&(n!=="transform"||!d)&&!c&&!i&&a!=="mirror"&&o!==0&&r!=="inertia"}const Kd=40;class Yd extends Pn{constructor({autoplay:t=!0,delay:n=0,type:i="keyframes",repeat:a=0,repeatDelay:o=0,repeatType:r="loop",keyframes:l,name:c,motionValue:d,element:u,...p}){var f;super(),this.stop=()=>{var y,b;this._animation&&(this._animation.stop(),(y=this.stopTimeline)==null||y.call(this)),(b=this.keyframeResolver)==null||b.cancel()},this.createdAt=ue.now();const h={autoplay:t,delay:n,type:i,repeat:a,repeatDelay:o,repeatType:r,name:c,motionValue:d,element:u,...p},m=(u==null?void 0:u.KeyframeResolver)||Ln;this.keyframeResolver=new m(l,(y,b,w)=>this.onKeyframesResolved(y,b,h,!w),c,d,u),(f=this.keyframeResolver)==null||f.scheduleResolve()}onKeyframesResolved(t,n,i,a){var b,w;this.keyframeResolver=void 0;const{name:o,type:r,velocity:l,delay:c,isHandoff:d,onUpdate:u}=i;this.resolvedAt=ue.now(),zd(t,o,r,l)||((Ee.instantAnimations||!c)&&(u==null||u(Mn(t,i,n))),t[0]=t[t.length-1],sn(i),i.repeat=0);const h={startTime:a?this.resolvedAt?this.resolvedAt-this.createdAt>Kd?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...i,keyframes:t},m=!d&&Gd(h),f=(w=(b=h.motionValue)==null?void 0:b.owner)==null?void 0:w.current,y=m?new $d({...h,element:f}):new In(h);y.finished.then(()=>{this.notifyFinished()}).catch(ge),this.pendingTimeline&&(this.stopTimeline=y.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=y}get finished(){return this._animation?this.animation.finished:this._finished}then(t,n){return this.finished.finally(t).then(()=>{})}get animation(){var t;return this._animation||((t=this.keyframeResolver)==null||t.resume(),Dd()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var t;this._animation&&this.animation.cancel(),(t=this.keyframeResolver)==null||t.cancel()}}function Br(e,t,n,i=0,a=1){const o=Array.from(e).sort((d,u)=>d.sortNodePosition(u)).indexOf(t),r=e.size,l=(r-1)*i;return typeof n=="function"?n(o,r):a===1?o*i:l-o*i}const Xd=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Zd(e){const t=Xd.exec(e);if(!t)return[,];const[,n,i,a]=t;return[`--${n??i}`,a]}function Ur(e,t,n=1){const[i,a]=Zd(e);if(!i)return;const o=window.getComputedStyle(t).getPropertyValue(i);if(o){const r=o.trim();return or(r)?parseFloat(r):r}return Tn(a)?Ur(a,t,n+1):a}const Jd={type:"spring",stiffness:500,damping:25,restSpeed:10},Qd=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),eu={type:"keyframes",duration:.8},tu={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},su=(e,{keyframes:t})=>t.length>2?eu:gt.has(e)?e.startsWith("scale")?Qd(t[1]):Jd:tu,nu=e=>e!==null;function iu(e,{repeat:t,repeatType:n="loop"},i){const a=e.filter(nu),o=t&&n!=="loop"&&t%2===1?0:a.length-1;return a[o]}function $r(e,t){if(e!=null&&e.inherit&&t){const{inherit:n,...i}=e;return{...t,...i}}return e}function On(e,t){const n=(e==null?void 0:e[t])??(e==null?void 0:e.default)??e;return n!==e?$r(n,e):n}function au({when:e,delay:t,delayChildren:n,staggerChildren:i,staggerDirection:a,repeat:o,repeatType:r,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}const Vn=(e,t,n,i={},a,o)=>r=>{const l=On(i,e)||{},c=l.delay||i.delay||0;let{elapsed:d=0}=i;d=d-Se(c);const u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...l,delay:-d,onUpdate:h=>{t.set(h),l.onUpdate&&l.onUpdate(h)},onComplete:()=>{r(),l.onComplete&&l.onComplete()},name:e,motionValue:t,element:o?void 0:a};au(l)||Object.assign(u,su(e,u)),u.duration&&(u.duration=Se(u.duration)),u.repeatDelay&&(u.repeatDelay=Se(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let p=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(sn(u),u.delay===0&&(p=!0)),(Ee.instantAnimations||Ee.skipAnimations||a!=null&&a.shouldSkipAnimations)&&(p=!0,sn(u),u.delay=0),u.allowFlatten=!l.type&&!l.ease,p&&!o&&t.get()!==void 0){const h=iu(u.keyframes,l);if(h!==void 0){G.update(()=>{u.onUpdate(h),u.onComplete()});return}}return l.isSync?new In(u):new Yd(u)};function Bi(e){const t=[{},{}];return e==null||e.values.forEach((n,i)=>{t[0][i]=n.get(),t[1][i]=n.getVelocity()}),t}function Fn(e,t,n,i){if(typeof t=="function"){const[a,o]=Bi(i);t=t(n!==void 0?n:e.custom,a,o)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[a,o]=Bi(i);t=t(n!==void 0?n:e.custom,a,o)}return t}function ct(e,t,n){const i=e.getProps();return Fn(i,t,n!==void 0?n:i.custom,e)}const Wr=new Set(["width","height","top","left","right","bottom",...xt]),Ui=30,ru=e=>!isNaN(parseFloat(e));class ou{constructor(t,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=i=>{var o;const a=ue.now();if(this.updatedAt!==a&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&((o=this.events.change)==null||o.notify(this.current),this.dependents))for(const r of this.dependents)r.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=ue.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=ru(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new kn);const i=this.events[t].add(n);return t==="change"?()=>{i(),G.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,n,i){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-i}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var t;(t=this.events.change)==null||t.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=ue.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>Ui)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,Ui);return dr(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var t,n;(t=this.dependents)==null||t.clear(),(n=this.events.destroy)==null||n.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ut(e,t){return new ou(e,t)}const nn=e=>Array.isArray(e);function lu(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,ut(n))}function cu(e){return nn(e)?e[e.length-1]||0:e}function du(e,t){const n=ct(e,t);let{transitionEnd:i={},transition:a={},...o}=n||{};o={...o,...i};for(const r in o){const l=cu(o[r]);lu(e,r,l)}}const de=e=>!!(e&&e.getVelocity);function uu(e){return!!(de(e)&&e.add)}function an(e,t){const n=e.getValue("willChange");if(uu(n))return n.add(t);if(!n&&Ee.WillChange){const i=new Ee.WillChange("auto");e.addValue("willChange",i),i.add(t)}}function Bn(e){return e.replace(/([A-Z])/g,t=>`-${t.toLowerCase()}`)}const hu="framerAppearId",zr="data-"+Bn(hu);function Hr(e){return e.props[zr]}function pu({protectedKeys:e,needsAnimating:t},n){const i=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,i}function qr(e,t,{delay:n=0,transitionOverride:i,type:a}={}){let{transition:o,transitionEnd:r,...l}=t;const c=e.getDefaultTransition();o=o?$r(o,c):c;const d=o==null?void 0:o.reduceMotion;i&&(o=i);const u=[],p=a&&e.animationState&&e.animationState.getState()[a];for(const h in l){const m=e.getValue(h,e.latestValues[h]??null),f=l[h];if(f===void 0||p&&pu(p,h))continue;const y={delay:n,...On(o||{},h)},b=m.get();if(b!==void 0&&!m.isAnimating&&!Array.isArray(f)&&f===b&&!y.velocity)continue;let w=!1;if(window.MotionHandoffAnimation){const C=Hr(e);if(C){const _=window.MotionHandoffAnimation(C,h,G);_!==null&&(y.startTime=_,w=!0)}}an(e,h);const j=d??e.shouldReduceMotion;m.start(Vn(h,m,f,j&&Wr.has(h)?{type:!1}:y,e,w));const k=m.animation;k&&u.push(k)}if(r){const h=()=>G.update(()=>{r&&du(e,r)});u.length?Promise.all(u).then(h):h()}return u}function rn(e,t,n={}){var c;const i=ct(e,t,n.type==="exit"?(c=e.presenceContext)==null?void 0:c.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(a=n.transitionOverride);const o=i?()=>Promise.all(qr(e,i,n)):()=>Promise.resolve(),r=e.variantChildren&&e.variantChildren.size?(d=0)=>{const{delayChildren:u=0,staggerChildren:p,staggerDirection:h}=a;return mu(e,t,d,u,p,h,n)}:()=>Promise.resolve(),{when:l}=a;if(l){const[d,u]=l==="beforeChildren"?[o,r]:[r,o];return d().then(()=>u())}else return Promise.all([o(),r(n.delay)])}function mu(e,t,n=0,i=0,a=0,o=1,r){const l=[];for(const c of e.variantChildren)c.notify("AnimationStart",t),l.push(rn(c,t,{...r,delay:n+(typeof i=="function"?0:i)+Br(e.variantChildren,c,i,a,o)}).then(()=>c.notify("AnimationComplete",t)));return Promise.all(l)}function fu(e,t,n={}){e.notify("AnimationStart",t);let i;if(Array.isArray(t)){const a=t.map(o=>rn(e,o,n));i=Promise.all(a)}else if(typeof t=="string")i=rn(e,t,n);else{const a=typeof t=="function"?ct(e,t,n.custom):t;i=Promise.all(qr(e,a,n))}return i.then(()=>{e.notify("AnimationComplete",t)})}const xu={test:e=>e==="auto",parse:e=>e},Gr=e=>t=>t.test(e),Kr=[ft,D,ke,Re,Wc,$c,xu],$i=e=>Kr.find(Gr(e));function gu(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||cr(e):!0}const bu=new Set(["brightness","contrast","saturate","opacity"]);function yu(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[i]=n.match(An)||[];if(!i)return e;const a=n.replace(i,"");let o=bu.has(t)?1:0;return i!==n&&(o*=100),t+"("+o+a+")"}const vu=/\b([a-z-]*)\(.*?\)/gu,on={...Le,getAnimatableNone:e=>{const t=e.match(vu);return t?t.map(yu).join(" "):e}},Wi={...ft,transform:Math.round},wu={rotate:Re,rotateX:Re,rotateY:Re,rotateZ:Re,scale:Gt,scaleX:Gt,scaleY:Gt,scaleZ:Gt,skew:Re,skewX:Re,skewY:Re,distance:D,translateX:D,translateY:D,translateZ:D,x:D,y:D,z:D,perspective:D,transformPerspective:D,opacity:At,originX:Ai,originY:Ai,originZ:D},Un={borderWidth:D,borderTopWidth:D,borderRightWidth:D,borderBottomWidth:D,borderLeftWidth:D,borderRadius:D,borderTopLeftRadius:D,borderTopRightRadius:D,borderBottomRightRadius:D,borderBottomLeftRadius:D,width:D,maxWidth:D,height:D,maxHeight:D,top:D,right:D,bottom:D,left:D,inset:D,insetBlock:D,insetBlockStart:D,insetBlockEnd:D,insetInline:D,insetInlineStart:D,insetInlineEnd:D,padding:D,paddingTop:D,paddingRight:D,paddingBottom:D,paddingLeft:D,paddingBlock:D,paddingBlockStart:D,paddingBlockEnd:D,paddingInline:D,paddingInlineStart:D,paddingInlineEnd:D,margin:D,marginTop:D,marginRight:D,marginBottom:D,marginLeft:D,marginBlock:D,marginBlockStart:D,marginBlockEnd:D,marginInline:D,marginInlineStart:D,marginInlineEnd:D,fontSize:D,backgroundPositionX:D,backgroundPositionY:D,...wu,zIndex:Wi,fillOpacity:At,strokeOpacity:At,numOctaves:Wi},ju={...Un,color:ee,backgroundColor:ee,outlineColor:ee,fill:ee,stroke:ee,borderColor:ee,borderTopColor:ee,borderRightColor:ee,borderBottomColor:ee,borderLeftColor:ee,filter:on,WebkitFilter:on},Yr=e=>ju[e];function Xr(e,t){let n=Yr(e);return n!==on&&(n=Le),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const Nu=new Set(["auto","none","0"]);function Su(e,t,n){let i=0,a;for(;i<e.length&&!a;){const o=e[i];typeof o=="string"&&!Nu.has(o)&&Et(o).values.length&&(a=e[i]),i++}if(a&&n)for(const o of t)e[o]=Xr(n,a)}class ku extends Ln{constructor(t,n,i,a,o){super(t,n,i,a,o,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:i}=this;if(!n||!n.current)return;super.readKeyframes();for(let u=0;u<t.length;u++){let p=t[u];if(typeof p=="string"&&(p=p.trim(),Tn(p))){const h=Ur(p,n.current);h!==void 0&&(t[u]=h),u===t.length-1&&(this.finalKeyframe=p)}}if(this.resolveNoneKeyframes(),!Wr.has(i)||t.length!==2)return;const[a,o]=t,r=$i(a),l=$i(o),c=Ti(a),d=Ti(o);if(c!==d&&Pe[i]){this.needsMeasurement=!0;return}if(r!==l)if(Oi(r)&&Oi(l))for(let u=0;u<t.length;u++){const p=t[u];typeof p=="string"&&(t[u]=parseFloat(p))}else Pe[i]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,i=[];for(let a=0;a<t.length;a++)(t[a]===null||gu(t[a]))&&i.push(a);i.length&&Su(t,i,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:i}=this;if(!t||!t.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Pe[i](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const a=n[n.length-1];a!==void 0&&t.getValue(i,a).jump(a,!1)}measureEndState(){var l;const{element:t,name:n,unresolvedKeyframes:i}=this;if(!t||!t.current)return;const a=t.getValue(n);a&&a.jump(this.measuredOrigin,!1);const o=i.length-1,r=i[o];i[o]=Pe[n](t.measureViewportBox(),window.getComputedStyle(t.current)),r!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=r),(l=this.removedTransforms)!=null&&l.length&&this.removedTransforms.forEach(([c,d])=>{t.getValue(c).set(d)}),this.resolveNoneKeyframes()}}function Zr(e,t,n){if(e==null)return[];if(e instanceof EventTarget)return[e];if(typeof e=="string"){let i=document;const a=(n==null?void 0:n[e])??i.querySelectorAll(e);return a?Array.from(a):[]}return Array.from(e).filter(i=>i!=null)}const Jr=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function ln(e){return lr(e)&&"offsetHeight"in e}const{schedule:$n}=wr(queueMicrotask,!1),ve={x:!1,y:!1};function Qr(){return ve.x||ve.y}function _u(e){return e==="x"||e==="y"?ve[e]?null:(ve[e]=!0,()=>{ve[e]=!1}):ve.x||ve.y?null:(ve.x=ve.y=!0,()=>{ve.x=ve.y=!1})}function eo(e,t){const n=Zr(e),i=new AbortController,a={passive:!0,...t,signal:i.signal};return[n,a,()=>i.abort()]}function Cu(e){return!(e.pointerType==="touch"||Qr())}function Tu(e,t,n={}){const[i,a,o]=eo(e,n);return i.forEach(r=>{let l=!1,c=!1,d;const u=()=>{r.removeEventListener("pointerleave",f)},p=b=>{d&&(d(b),d=void 0),u()},h=b=>{l=!1,window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",h),c&&(c=!1,p(b))},m=()=>{l=!0,window.addEventListener("pointerup",h,a),window.addEventListener("pointercancel",h,a)},f=b=>{if(b.pointerType!=="touch"){if(l){c=!0;return}p(b)}},y=b=>{if(!Cu(b))return;c=!1;const w=t(r,b);typeof w=="function"&&(d=w,r.addEventListener("pointerleave",f,a))};r.addEventListener("pointerenter",y,a),r.addEventListener("pointerdown",m,a)}),o}const to=(e,t)=>t?e===t?!0:to(e,t.parentElement):!1,Wn=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,Au=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Eu(e){return Au.has(e.tagName)||e.isContentEditable===!0}const Du=new Set(["INPUT","SELECT","TEXTAREA"]);function Ru(e){return Du.has(e.tagName)||e.isContentEditable===!0}const ts=new WeakSet;function zi(e){return t=>{t.key==="Enter"&&e(t)}}function Cs(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const Mu=(e,t)=>{const n=e.currentTarget;if(!n)return;const i=zi(()=>{if(ts.has(n))return;Cs(n,"down");const a=zi(()=>{Cs(n,"up")}),o=()=>Cs(n,"cancel");n.addEventListener("keyup",a,t),n.addEventListener("blur",o,t)});n.addEventListener("keydown",i,t),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),t)};function Hi(e){return Wn(e)&&!Qr()}const qi=new WeakSet;function Pu(e,t,n={}){const[i,a,o]=eo(e,n),r=l=>{const c=l.currentTarget;if(!Hi(l)||qi.has(l))return;ts.add(c),n.stopPropagation&&qi.add(l);const d=t(c,l),u=(m,f)=>{window.removeEventListener("pointerup",p),window.removeEventListener("pointercancel",h),ts.has(c)&&ts.delete(c),Hi(m)&&typeof d=="function"&&d(m,{success:f})},p=m=>{u(m,c===window||c===document||n.useGlobalTarget||to(c,m.target))},h=m=>{u(m,!1)};window.addEventListener("pointerup",p,a),window.addEventListener("pointercancel",h,a)};return i.forEach(l=>{(n.useGlobalTarget?window:l).addEventListener("pointerdown",r,a),ln(l)&&(l.addEventListener("focus",d=>Mu(d,a)),!Eu(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),o}function zn(e){return lr(e)&&"ownerSVGElement"in e}const ss=new WeakMap;let Me;const so=(e,t,n)=>(i,a)=>a&&a[0]?a[0][e+"Size"]:zn(i)&&"getBBox"in i?i.getBBox()[t]:i[n],Iu=so("inline","width","offsetWidth"),Lu=so("block","height","offsetHeight");function Ou({target:e,borderBoxSize:t}){var n;(n=ss.get(e))==null||n.forEach(i=>{i(e,{get width(){return Iu(e,t)},get height(){return Lu(e,t)}})})}function Vu(e){e.forEach(Ou)}function Fu(){typeof ResizeObserver>"u"||(Me=new ResizeObserver(Vu))}function Bu(e,t){Me||Fu();const n=Zr(e);return n.forEach(i=>{let a=ss.get(i);a||(a=new Set,ss.set(i,a)),a.add(t),Me==null||Me.observe(i)}),()=>{n.forEach(i=>{const a=ss.get(i);a==null||a.delete(t),a!=null&&a.size||Me==null||Me.unobserve(i)})}}const ns=new Set;let it;function Uu(){it=()=>{const e={get width(){return window.innerWidth},get height(){return window.innerHeight}};ns.forEach(t=>t(e))},window.addEventListener("resize",it)}function $u(e){return ns.add(e),it||Uu(),()=>{ns.delete(e),!ns.size&&typeof it=="function"&&(window.removeEventListener("resize",it),it=void 0)}}function Gi(e,t){return typeof e=="function"?$u(e):Bu(e,t)}function Wu(e){return zn(e)&&e.tagName==="svg"}const zu=[...Kr,ee,Le],Hu=e=>zu.find(Gr(e)),Ki=()=>({translate:0,scale:1,origin:0,originPoint:0}),at=()=>({x:Ki(),y:Ki()}),Yi=()=>({min:0,max:0}),ne=()=>({x:Yi(),y:Yi()}),cn={current:null},no={current:!1},qu=typeof window<"u";function Gu(){if(no.current=!0,!!qu)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>cn.current=e.matches;e.addEventListener("change",t),t()}else cn.current=!1}const Ku=new WeakMap;function xs(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function Dt(e){return typeof e=="string"||Array.isArray(e)}const Hn=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],qn=["initial",...Hn];function gs(e){return xs(e.animate)||qn.some(t=>Dt(e[t]))}function io(e){return!!(gs(e)||e.variants)}function Yu(e,t,n){for(const i in t){const a=t[i],o=n[i];if(de(a))e.addValue(i,a);else if(de(o))e.addValue(i,ut(a,{owner:e}));else if(o!==a)if(e.hasValue(i)){const r=e.getValue(i);r.liveStyle===!0?r.jump(a):r.hasAnimated||r.set(a)}else{const r=e.getStaticValue(i);e.addValue(i,ut(r!==void 0?r:a,{owner:e}))}}for(const i in n)t[i]===void 0&&e.removeValue(i);return t}const Xi=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let cs={};function ao(e){cs=e}function Xu(){return cs}class Zu{scrapeMotionValuesFromProps(t,n,i){return{}}constructor({parent:t,props:n,presenceContext:i,reducedMotionConfig:a,skipAnimations:o,blockInitialAnimation:r,visualState:l},c={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.shouldSkipAnimations=!1,this.values=new Map,this.KeyframeResolver=Ln,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.hasBeenMounted=!1,this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const m=ue.now();this.renderScheduledAt<m&&(this.renderScheduledAt=m,G.render(this.render,!1,!0))};const{latestValues:d,renderState:u}=l;this.latestValues=d,this.baseTarget={...d},this.initialValues=n.initial?{...d}:{},this.renderState=u,this.parent=t,this.props=n,this.presenceContext=i,this.depth=t?t.depth+1:0,this.reducedMotionConfig=a,this.skipAnimationsConfig=o,this.options=c,this.blockInitialAnimation=!!r,this.isControllingVariants=gs(n),this.isVariantNode=io(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:p,...h}=this.scrapeMotionValuesFromProps(n,{},this);for(const m in h){const f=h[m];d[m]!==void 0&&de(f)&&f.set(d[m])}}mount(t){var n,i;if(this.hasBeenMounted)for(const a in this.initialValues)(n=this.values.get(a))==null||n.jump(this.initialValues[a]),this.latestValues[a]=this.initialValues[a];this.current=t,Ku.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((a,o)=>this.bindToMotionValue(o,a)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(no.current||Gu(),this.shouldReduceMotion=cn.current),this.shouldSkipAnimations=this.skipAnimationsConfig??!1,(i=this.parent)==null||i.addChild(this),this.update(this.props,this.presenceContext),this.hasBeenMounted=!0}unmount(){var t;this.projection&&this.projection.unmount(),Ie(this.notifyUpdate),Ie(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(t=this.parent)==null||t.removeChild(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const i=this.features[n];i&&(i.unmount(),i.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,n){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const i=gt.has(t);i&&this.onBindTransform&&this.onBindTransform();const a=n.on("change",r=>{this.latestValues[t]=r,this.props.onUpdate&&G.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let o;typeof window<"u"&&window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,t,n)),this.valueSubscriptions.set(t,()=>{a(),o&&o(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in cs){const n=cs[t];if(!n)continue;const{isEnabled:i,Feature:a}=n;if(!this.features[t]&&a&&i(this.props)&&(this.features[t]=new a(this)),this.features[t]){const o=this.features[t];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ne()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let i=0;i<Xi.length;i++){const a=Xi[i];this.propEventSubscriptions[a]&&(this.propEventSubscriptions[a](),delete this.propEventSubscriptions[a]);const o="on"+a,r=t[o];r&&(this.propEventSubscriptions[a]=this.on(a,r))}this.prevMotionValues=Yu(this,this.scrapeMotionValuesFromProps(t,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const i=this.values.get(t);n!==i&&(i&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let i=this.values.get(t);return i===void 0&&n!==void 0&&(i=ut(n===null?void 0:n,{owner:this}),this.addValue(t,i)),i}readValue(t,n){let i=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return i!=null&&(typeof i=="string"&&(or(i)||cr(i))?i=parseFloat(i):!Hu(i)&&Le.test(n)&&(i=Xr(t,n)),this.setBaseTarget(t,de(i)?i.get():i)),de(i)?i.get():i}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){var o;const{initial:n}=this.props;let i;if(typeof n=="string"||typeof n=="object"){const r=Fn(this.props,n,(o=this.presenceContext)==null?void 0:o.custom);r&&(i=r[t])}if(n&&i!==void 0)return i;const a=this.getBaseTargetFromProps(this.props,t);return a!==void 0&&!de(a)?a:this.initialValues[t]!==void 0&&i===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new kn),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}scheduleRenderMicrotask(){$n.render(this.render)}}class ro extends Zu{constructor(){super(...arguments),this.KeyframeResolver=ku}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){const i=t.style;return i?i[n]:void 0}removeValueFromRenderState(t,{vars:n,style:i}){delete n[t],delete i[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;de(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}class Oe{constructor(t){this.isMounted=!1,this.node=t}update(){}}function oo({top:e,left:t,right:n,bottom:i}){return{x:{min:t,max:n},y:{min:e,max:i}}}function Ju({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Qu(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),i=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}function Ts(e){return e===void 0||e===1}function dn({scale:e,scaleX:t,scaleY:n}){return!Ts(e)||!Ts(t)||!Ts(n)}function Ue(e){return dn(e)||lo(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function lo(e){return Zi(e.x)||Zi(e.y)}function Zi(e){return e&&e!=="0%"}function ds(e,t,n){const i=e-n,a=t*i;return n+a}function Ji(e,t,n,i,a){return a!==void 0&&(e=ds(e,a,i)),ds(e,n,i)+t}function un(e,t=0,n=1,i,a){e.min=Ji(e.min,t,n,i,a),e.max=Ji(e.max,t,n,i,a)}function co(e,{x:t,y:n}){un(e.x,t.translate,t.scale,t.originPoint),un(e.y,n.translate,n.scale,n.originPoint)}const Qi=.999999999999,ea=1.0000000000001;function eh(e,t,n,i=!1){const a=n.length;if(!a)return;t.x=t.y=1;let o,r;for(let l=0;l<a;l++){o=n[l],r=o.projectionDelta;const{visualElement:c}=o.options;c&&c.props.style&&c.props.style.display==="contents"||(i&&o.options.layoutScroll&&o.scroll&&o!==o.root&&ot(e,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),r&&(t.x*=r.x.scale,t.y*=r.y.scale,co(e,r)),i&&Ue(o.latestValues)&&ot(e,o.latestValues))}t.x<ea&&t.x>Qi&&(t.x=1),t.y<ea&&t.y>Qi&&(t.y=1)}function rt(e,t){e.min=e.min+t,e.max=e.max+t}function ta(e,t,n,i,a=.5){const o=Z(e.min,e.max,a);un(e,t,n,o,i)}function ot(e,t){ta(e.x,t.x,t.scaleX,t.scale,t.originX),ta(e.y,t.y,t.scaleY,t.scale,t.originY)}function uo(e,t){return oo(Qu(e.getBoundingClientRect(),t))}function th(e,t,n){const i=uo(e,n),{scroll:a}=t;return a&&(rt(i.x,a.offset.x),rt(i.y,a.offset.y)),i}const sh={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},nh=xt.length;function ih(e,t,n){let i="",a=!0;for(let o=0;o<nh;o++){const r=xt[o],l=e[r];if(l===void 0)continue;let c=!0;if(typeof l=="number")c=l===(r.startsWith("scale")?1:0);else{const d=parseFloat(l);c=r.startsWith("scale")?d===1:d===0}if(!c||n){const d=Jr(l,Un[r]);if(!c){a=!1;const u=sh[r]||r;i+=`${u}(${d}) `}n&&(t[r]=d)}}return i=i.trim(),n?i=n(t,a?"":i):a&&(i="none"),i}function Gn(e,t,n){const{style:i,vars:a,transformOrigin:o}=e;let r=!1,l=!1;for(const c in t){const d=t[c];if(gt.has(c)){r=!0;continue}else if(Nr(c)){a[c]=d;continue}else{const u=Jr(d,Un[c]);c.startsWith("origin")?(l=!0,o[c]=u):i[c]=u}}if(t.transform||(r||n?i.transform=ih(t,e.transform,n):i.transform&&(i.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:u=0}=o;i.transformOrigin=`${c} ${d} ${u}`}}function ho(e,{style:t,vars:n},i,a){const o=e.style;let r;for(r in t)o[r]=t[r];a==null||a.applyProjectionStyles(o,i);for(r in n)o.setProperty(r,n[r])}function sa(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const vt={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(D.test(e))e=parseFloat(e);else return e;const n=sa(e,t.target.x),i=sa(e,t.target.y);return`${n}% ${i}%`}},ah={correct:(e,{treeScale:t,projectionDelta:n})=>{const i=e,a=Le.parse(e);if(a.length>5)return i;const o=Le.createTransformer(e),r=typeof a[0]!="number"?1:0,l=n.x.scale*t.x,c=n.y.scale*t.y;a[0+r]/=l,a[1+r]/=c;const d=Z(l,c,.5);return typeof a[2+r]=="number"&&(a[2+r]/=d),typeof a[3+r]=="number"&&(a[3+r]/=d),o(a)}},hn={borderRadius:{...vt,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:vt,borderTopRightRadius:vt,borderBottomLeftRadius:vt,borderBottomRightRadius:vt,boxShadow:ah};function po(e,{layout:t,layoutId:n}){return gt.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!hn[e]||e==="opacity")}function Kn(e,t,n){var r;const i=e.style,a=t==null?void 0:t.style,o={};if(!i)return o;for(const l in i)(de(i[l])||a&&de(a[l])||po(l,e)||((r=n==null?void 0:n.getValue(l))==null?void 0:r.liveStyle)!==void 0)&&(o[l]=i[l]);return o}function rh(e){return window.getComputedStyle(e)}class oh extends ro{constructor(){super(...arguments),this.type="html",this.renderInstance=ho}readValueFromInstance(t,n){var i;if(gt.has(n))return(i=this.projection)!=null&&i.isProjecting?Zs(n):_d(t,n);{const a=rh(t),o=(Nr(n)?a.getPropertyValue(n):a[n])||0;return typeof o=="string"?o.trim():o}}measureInstanceViewportBox(t,{transformPagePoint:n}){return uo(t,n)}build(t,n,i){Gn(t,n,i.transformTemplate)}scrapeMotionValuesFromProps(t,n,i){return Kn(t,n,i)}}const lh={offset:"stroke-dashoffset",array:"stroke-dasharray"},ch={offset:"strokeDashoffset",array:"strokeDasharray"};function dh(e,t,n=1,i=0,a=!0){e.pathLength=1;const o=a?lh:ch;e[o.offset]=`${-i}`,e[o.array]=`${t} ${n}`}const uh=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function mo(e,{attrX:t,attrY:n,attrScale:i,pathLength:a,pathSpacing:o=1,pathOffset:r=0,...l},c,d,u){if(Gn(e,l,d),c){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:p,style:h}=e;p.transform&&(h.transform=p.transform,delete p.transform),(h.transform||p.transformOrigin)&&(h.transformOrigin=p.transformOrigin??"50% 50%",delete p.transformOrigin),h.transform&&(h.transformBox=(u==null?void 0:u.transformBox)??"fill-box",delete p.transformBox);for(const m of uh)p[m]!==void 0&&(h[m]=p[m],delete p[m]);t!==void 0&&(p.x=t),n!==void 0&&(p.y=n),i!==void 0&&(p.scale=i),a!==void 0&&dh(p,a,o,r,!1)}const fo=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),xo=e=>typeof e=="string"&&e.toLowerCase()==="svg";function hh(e,t,n,i){ho(e,t,void 0,i);for(const a in t.attrs)e.setAttribute(fo.has(a)?a:Bn(a),t.attrs[a])}function go(e,t,n){const i=Kn(e,t,n);for(const a in e)if(de(e[a])||de(t[a])){const o=xt.indexOf(a)!==-1?"attr"+a.charAt(0).toUpperCase()+a.substring(1):a;i[o]=e[a]}return i}class ph extends ro{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ne}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(gt.has(n)){const i=Yr(n);return i&&i.default||0}return n=fo.has(n)?n:Bn(n),t.getAttribute(n)}scrapeMotionValuesFromProps(t,n,i){return go(t,n,i)}build(t,n,i){mo(t,n,this.isSVGTag,i.transformTemplate,i.style)}renderInstance(t,n,i,a){hh(t,n,i,a)}mount(t){this.isSVGTag=xo(t.tagName),super.mount(t)}}const mh=qn.length;function bo(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent?bo(e.parent)||{}:{};return e.props.initial!==void 0&&(n.initial=e.props.initial),n}const t={};for(let n=0;n<mh;n++){const i=qn[n],a=e.props[i];(Dt(a)||a===!1)&&(t[i]=a)}return t}function yo(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}const fh=[...Hn].reverse(),xh=Hn.length;function gh(e){return t=>Promise.all(t.map(({animation:n,options:i})=>fu(e,n,i)))}function bh(e){let t=gh(e),n=na(),i=!0;const a=c=>(d,u)=>{var h;const p=ct(e,u,c==="exit"?(h=e.presenceContext)==null?void 0:h.custom:void 0);if(p){const{transition:m,transitionEnd:f,...y}=p;d={...d,...y,...f}}return d};function o(c){t=c(e)}function r(c){const{props:d}=e,u=bo(e.parent)||{},p=[],h=new Set;let m={},f=1/0;for(let b=0;b<xh;b++){const w=fh[b],j=n[w],k=d[w]!==void 0?d[w]:u[w],C=Dt(k),_=w===c?j.isActive:null;_===!1&&(f=b);let g=k===u[w]&&k!==d[w]&&C;if(g&&i&&e.manuallyAnimateOnMount&&(g=!1),j.protectedKeys={...m},!j.isActive&&_===null||!k&&!j.prevProp||xs(k)||typeof k=="boolean")continue;const x=yh(j.prevProp,k);let v=x||w===c&&j.isActive&&!g&&C||b>f&&C,S=!1;const A=Array.isArray(k)?k:[k];let M=A.reduce(a(w),{});_===!1&&(M={});const{prevResolvedValues:P={}}=j,I={...P,...M},T=W=>{v=!0,h.has(W)&&(S=!0,h.delete(W)),j.needsAnimating[W]=!0;const F=e.getValue(W);F&&(F.liveStyle=!1)};for(const W in I){const F=M[W],Y=P[W];if(m.hasOwnProperty(W))continue;let pe=!1;nn(F)&&nn(Y)?pe=!yo(F,Y):pe=F!==Y,pe?F!=null?T(W):h.add(W):F!==void 0&&h.has(W)?T(W):j.protectedKeys[W]=!0}j.prevProp=k,j.prevResolvedValues=M,j.isActive&&(m={...m,...M}),i&&e.blockInitialAnimation&&(v=!1);const V=g&&x;v&&(!V||S)&&p.push(...A.map(W=>{const F={type:w};if(typeof W=="string"&&i&&!V&&e.manuallyAnimateOnMount&&e.parent){const{parent:Y}=e,pe=ct(Y,W);if(Y.enteringChildren&&pe){const{delayChildren:me}=pe.transition||{};F.delay=Br(Y.enteringChildren,e,me)}}return{animation:W,options:F}}))}if(h.size){const b={};if(typeof d.initial!="boolean"){const w=ct(e,Array.isArray(d.initial)?d.initial[0]:d.initial);w&&w.transition&&(b.transition=w.transition)}h.forEach(w=>{const j=e.getBaseTarget(w),k=e.getValue(w);k&&(k.liveStyle=!0),b[w]=j??null}),p.push({animation:b})}let y=!!p.length;return i&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(y=!1),i=!1,y?t(p):Promise.resolve()}function l(c,d){var p;if(n[c].isActive===d)return Promise.resolve();(p=e.variantChildren)==null||p.forEach(h=>{var m;return(m=h.animationState)==null?void 0:m.setActive(c,d)}),n[c].isActive=d;const u=r(c);for(const h in n)n[h].protectedKeys={};return u}return{animateChanges:r,setActive:l,setAnimateFunction:o,getState:()=>n,reset:()=>{n=na()}}}function yh(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!yo(t,e):!1}function Be(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function na(){return{animate:Be(!0),whileInView:Be(),whileHover:Be(),whileTap:Be(),whileDrag:Be(),whileFocus:Be(),exit:Be()}}function ia(e,t){e.min=t.min,e.max=t.max}function ye(e,t){ia(e.x,t.x),ia(e.y,t.y)}function aa(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}const vo=1e-4,vh=1-vo,wh=1+vo,wo=.01,jh=0-wo,Nh=0+wo;function he(e){return e.max-e.min}function Sh(e,t,n){return Math.abs(e-t)<=n}function ra(e,t,n,i=.5){e.origin=i,e.originPoint=Z(t.min,t.max,e.origin),e.scale=he(n)/he(t),e.translate=Z(n.min,n.max,e.origin)-e.originPoint,(e.scale>=vh&&e.scale<=wh||isNaN(e.scale))&&(e.scale=1),(e.translate>=jh&&e.translate<=Nh||isNaN(e.translate))&&(e.translate=0)}function kt(e,t,n,i){ra(e.x,t.x,n.x,i?i.originX:void 0),ra(e.y,t.y,n.y,i?i.originY:void 0)}function oa(e,t,n){e.min=n.min+t.min,e.max=e.min+he(t)}function kh(e,t,n){oa(e.x,t.x,n.x),oa(e.y,t.y,n.y)}function la(e,t,n){e.min=t.min-n.min,e.max=e.min+he(t)}function us(e,t,n){la(e.x,t.x,n.x),la(e.y,t.y,n.y)}function ca(e,t,n,i,a){return e-=t,e=ds(e,1/n,i),a!==void 0&&(e=ds(e,1/a,i)),e}function _h(e,t=0,n=1,i=.5,a,o=e,r=e){if(ke.test(t)&&(t=parseFloat(t),t=Z(r.min,r.max,t/100)-r.min),typeof t!="number")return;let l=Z(o.min,o.max,i);e===o&&(l-=t),e.min=ca(e.min,t,n,l,a),e.max=ca(e.max,t,n,l,a)}function da(e,t,[n,i,a],o,r){_h(e,t[n],t[i],t[a],t.scale,o,r)}const Ch=["x","scaleX","originX"],Th=["y","scaleY","originY"];function ua(e,t,n,i){da(e.x,t,Ch,n?n.x:void 0,i?i.x:void 0),da(e.y,t,Th,n?n.y:void 0,i?i.y:void 0)}function ha(e){return e.translate===0&&e.scale===1}function jo(e){return ha(e.x)&&ha(e.y)}function pa(e,t){return e.min===t.min&&e.max===t.max}function Ah(e,t){return pa(e.x,t.x)&&pa(e.y,t.y)}function ma(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function No(e,t){return ma(e.x,t.x)&&ma(e.y,t.y)}function fa(e){return he(e.x)/he(e.y)}function xa(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}function Ne(e){return[e("x"),e("y")]}function Eh(e,t,n){let i="";const a=e.x.translate/t.x,o=e.y.translate/t.y,r=(n==null?void 0:n.z)||0;if((a||o||r)&&(i=`translate3d(${a}px, ${o}px, ${r}px) `),(t.x!==1||t.y!==1)&&(i+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:d,rotate:u,rotateX:p,rotateY:h,skewX:m,skewY:f}=n;d&&(i=`perspective(${d}px) ${i}`),u&&(i+=`rotate(${u}deg) `),p&&(i+=`rotateX(${p}deg) `),h&&(i+=`rotateY(${h}deg) `),m&&(i+=`skewX(${m}deg) `),f&&(i+=`skewY(${f}deg) `)}const l=e.x.scale*t.x,c=e.y.scale*t.y;return(l!==1||c!==1)&&(i+=`scale(${l}, ${c})`),i||"none"}const So=["TopLeft","TopRight","BottomLeft","BottomRight"],Dh=So.length,ga=e=>typeof e=="string"?parseFloat(e):e,ba=e=>typeof e=="number"||D.test(e);function Rh(e,t,n,i,a,o){a?(e.opacity=Z(0,n.opacity??1,Mh(i)),e.opacityExit=Z(t.opacity??1,0,Ph(i))):o&&(e.opacity=Z(t.opacity??1,n.opacity??1,i));for(let r=0;r<Dh;r++){const l=`border${So[r]}Radius`;let c=ya(t,l),d=ya(n,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||ba(c)===ba(d)?(e[l]=Math.max(Z(ga(c),ga(d),i),0),(ke.test(d)||ke.test(c))&&(e[l]+="%")):e[l]=d}(t.rotate||n.rotate)&&(e.rotate=Z(t.rotate||0,n.rotate||0,i))}function ya(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const Mh=ko(0,.5,gr),Ph=ko(.5,.95,ge);function ko(e,t,n){return i=>i<e?0:i>t?1:n(Tt(e,t,i))}function Ih(e,t,n){const i=de(e)?e:ut(e);return i.start(Vn("",i,t,n)),i.animation}function Rt(e,t,n,i={passive:!0}){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n)}const Lh=(e,t)=>e.depth-t.depth;class Oh{constructor(){this.children=[],this.isDirty=!1}add(t){wn(this.children,t),this.isDirty=!0}remove(t){jn(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Lh),this.isDirty=!1,this.children.forEach(t)}}function Vh(e,t){const n=ue.now(),i=({timestamp:a})=>{const o=a-n;o>=t&&(Ie(i),e(o-t))};return G.setup(i,!0),()=>Ie(i)}function is(e){return de(e)?e.get():e}class Fh{constructor(){this.members=[]}add(t){wn(this.members,t),t.scheduleRender()}remove(t){if(jn(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(a=>t===a);if(n===0)return!1;let i;for(let a=n;a>=0;a--){const o=this.members[a];if(o.isPresent!==!1){i=o;break}}return i?(this.promote(i),!0):!1}promote(t,n){const i=this.lead;if(t!==i&&(this.prevLead=i,this.lead=t,t.show(),i)){i.instance&&i.scheduleRender(),t.scheduleRender();const a=i.options.layoutDependency,o=t.options.layoutDependency;a!==void 0&&o!==void 0&&a===o||(t.resumeFrom=i,n&&(t.resumeFrom.preserveOpacity=!0),i.snapshot&&(t.snapshot=i.snapshot,t.snapshot.latestValues=i.animationValues||i.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0));const{crossfade:l}=t.options;l===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:i}=t;n.onExitComplete&&n.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const as={hasAnimatedSinceResize:!0,hasEverUpdated:!1},As=["","X","Y","Z"],Bh=1e3;let Uh=0;function Es(e,t,n,i){const{latestValues:a}=t;a[e]&&(n[e]=a[e],t.setStaticValue(e,0),i&&(i[e]=0))}function _o(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=Hr(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:a,layoutId:o}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",G,!(a||o))}const{parent:i}=e;i&&!i.hasCheckedOptimisedAppear&&_o(i)}function Co({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:i,resetTransform:a}){return class{constructor(r={},l=t==null?void 0:t()){this.id=Uh++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(zh),this.nodes.forEach(Kh),this.nodes.forEach(Yh),this.nodes.forEach(Hh)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=r,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new Oh)}addEventListener(r,l){return this.eventHandlers.has(r)||this.eventHandlers.set(r,new kn),this.eventHandlers.get(r).add(l)}notifyListeners(r,...l){const c=this.eventHandlers.get(r);c&&c.notify(...l)}hasListeners(r){return this.eventHandlers.has(r)}mount(r){if(this.instance)return;this.isSVG=zn(r)&&!Wu(r),this.instance=r;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(r),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),e){let u,p=0;const h=()=>this.root.updateBlockedByResize=!1;G.read(()=>{p=window.innerWidth}),e(r,()=>{const m=window.innerWidth;m!==p&&(p=m,this.root.updateBlockedByResize=!0,u&&u(),u=Vh(h,250),as.hasAnimatedSinceResize&&(as.hasAnimatedSinceResize=!1,this.nodes.forEach(ja)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:p,hasRelativeLayoutChanged:h,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const f=this.options.transition||d.getDefaultTransition()||ep,{onLayoutAnimationStart:y,onLayoutAnimationComplete:b}=d.getProps(),w=!this.targetLayout||!No(this.targetLayout,m),j=!p&&h;if(this.options.layoutRoot||this.resumeFrom||j||p&&(w||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const k={...On(f,"layout"),onPlay:y,onComplete:b};(d.shouldReduceMotion||this.options.layoutRoot)&&(k.delay=0,k.type=!1),this.startAnimation(k),this.setAnimationOrigin(u,j)}else p||ja(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const r=this.getStack();r&&r.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Ie(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Xh),this.animationId++)}getTransformTemplate(){const{visualElement:r}=this.options;return r&&r.getProps().transformTemplate}willUpdate(r=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&_o(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const p=this.path[u];p.shouldResetTransform=!0,p.updateScroll("snapshot"),p.options.layoutRoot&&p.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),r&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(va);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(wa);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Gh),this.nodes.forEach($h),this.nodes.forEach(Wh)):this.nodes.forEach(wa),this.clearAllSnapshots();const l=ue.now();le.delta=_e(0,1e3/60,l-le.timestamp),le.timestamp=l,le.isProcessing=!0,ws.update.process(le),ws.preRender.process(le),ws.render.process(le),le.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,$n.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(qh),this.sharedNodes.forEach(Zh)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,G.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){G.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!he(this.snapshot.measuredBox.x)&&!he(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const r=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=ne(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,r?r.layoutBox:void 0)}updateScroll(r="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===r&&(l=!1),l&&this.instance){const c=i(this.instance);this.scroll={animationId:this.root.animationId,phase:r,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!a)return;const r=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!jo(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;r&&this.instance&&(l||Ue(this.latestValues)||u)&&(a(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(r=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return r&&(c=this.removeTransform(c)),tp(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var d;const{visualElement:r}=this.options;if(!r)return ne();const l=r.measureViewportBox();if(!(((d=this.scroll)==null?void 0:d.wasRoot)||this.path.some(sp))){const{scroll:u}=this.root;u&&(rt(l.x,u.offset.x),rt(l.y,u.offset.y))}return l}removeElementScroll(r){var c;const l=ne();if(ye(l,r),(c=this.scroll)!=null&&c.wasRoot)return l;for(let d=0;d<this.path.length;d++){const u=this.path[d],{scroll:p,options:h}=u;u!==this.root&&p&&h.layoutScroll&&(p.wasRoot&&ye(l,r),rt(l.x,p.offset.x),rt(l.y,p.offset.y))}return l}applyTransform(r,l=!1){const c=ne();ye(c,r);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&ot(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Ue(u.latestValues)&&ot(c,u.latestValues)}return Ue(this.latestValues)&&ot(c,this.latestValues),c}removeTransform(r){const l=ne();ye(l,r);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!Ue(d.latestValues))continue;dn(d.latestValues)&&d.updateSnapshot();const u=ne(),p=d.measurePageBox();ye(u,p),ua(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return Ue(this.latestValues)&&ua(l,this.latestValues),l}setTargetDelta(r){this.targetDelta=r,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(r){this.options={...this.options,...r,crossfade:r.crossfade!==void 0?r.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==le.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(r=!1){var m;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(r||c&&this.isSharedProjectionDirty||this.isProjectionDirty||(m=this.parent)!=null&&m.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:p}=this.options;if(!this.layout||!(u||p))return;this.resolvedRelativeTargetAt=le.timestamp;const h=this.getClosestProjectingParent();h&&this.linkedParentVersion!==h.layoutVersion&&!h.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(h&&h.layout?this.createRelativeTarget(h,this.layout.layoutBox,h.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ne(),this.targetWithTransforms=ne()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),kh(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):ye(this.target,this.layout.layoutBox),co(this.target,this.targetDelta)):ye(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?this.createRelativeTarget(h,this.target,h.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||dn(this.parent.latestValues)||lo(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(r,l,c){this.relativeParent=r,this.linkedParentVersion=r.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ne(),this.relativeTargetOrigin=ne(),us(this.relativeTargetOrigin,l,c),ye(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var f;const r=this.getLead(),l=!!this.resumingFrom||this!==r;let c=!0;if((this.isProjectionDirty||(f=this.parent)!=null&&f.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===le.timestamp&&(c=!1),c)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;ye(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,h=this.treeScale.y;eh(this.layoutCorrected,this.treeScale,this.path,l),r.layout&&!r.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(r.target=r.layout.layoutBox,r.targetWithTransforms=ne());const{target:m}=r;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(aa(this.prevProjectionDelta.x,this.projectionDelta.x),aa(this.prevProjectionDelta.y,this.projectionDelta.y)),kt(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==p||this.treeScale.y!==h||!xa(this.projectionDelta.x,this.prevProjectionDelta.x)||!xa(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(r=!0){var l;if((l=this.options.visualElement)==null||l.scheduleRender(),r){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=at(),this.projectionDelta=at(),this.projectionDeltaWithTransform=at()}setAnimationOrigin(r,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},p=at();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const h=ne(),m=c?c.source:void 0,f=this.layout?this.layout.source:void 0,y=m!==f,b=this.getStack(),w=!b||b.members.length<=1,j=!!(y&&!w&&this.options.crossfade===!0&&!this.path.some(Qh));this.animationProgress=0;let k;this.mixTargetDelta=C=>{const _=C/1e3;Na(p.x,r.x,_),Na(p.y,r.y,_),this.setTargetDelta(p),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(us(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Jh(this.relativeTarget,this.relativeTargetOrigin,h,_),k&&Ah(this.relativeTarget,k)&&(this.isProjectionDirty=!1),k||(k=ne()),ye(k,this.relativeTarget)),y&&(this.animationValues=u,Rh(u,d,this.latestValues,_,j,w)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=_},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(r){var l,c,d;this.notifyListeners("animationStart"),(l=this.currentAnimation)==null||l.stop(),(d=(c=this.resumingFrom)==null?void 0:c.currentAnimation)==null||d.stop(),this.pendingAnimation&&(Ie(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=G.update(()=>{as.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=ut(0)),this.currentAnimation=Ih(this.motionValue,[0,1e3],{...r,velocity:0,isSync:!0,onUpdate:u=>{this.mixTargetDelta(u),r.onUpdate&&r.onUpdate(u)},onStop:()=>{},onComplete:()=>{r.onComplete&&r.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const r=this.getStack();r&&r.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Bh),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const r=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=r;if(!(!l||!c||!d)){if(this!==r&&this.layout&&d&&To(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||ne();const p=he(this.layout.layoutBox.x);c.x.min=r.target.x.min,c.x.max=c.x.min+p;const h=he(this.layout.layoutBox.y);c.y.min=r.target.y.min,c.y.max=c.y.min+h}ye(l,c),ot(l,u),kt(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(r,l){this.sharedNodes.has(r)||this.sharedNodes.set(r,new Fh),this.sharedNodes.get(r).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const r=this.getStack();return r?r.lead===this:!0}getLead(){var l;const{layoutId:r}=this.options;return r?((l=this.getStack())==null?void 0:l.lead)||this:this}getPrevLead(){var l;const{layoutId:r}=this.options;return r?(l=this.getStack())==null?void 0:l.prevLead:void 0}getStack(){const{layoutId:r}=this.options;if(r)return this.root.sharedNodes.get(r)}promote({needsReset:r,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),r&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const r=this.getStack();return r?r.relegate(this):!1}resetSkewAndRotation(){const{visualElement:r}=this.options;if(!r)return;let l=!1;const{latestValues:c}=r;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&Es("z",r,d,this.animationValues);for(let u=0;u<As.length;u++)Es(`rotate${As[u]}`,r,d,this.animationValues),Es(`skew${As[u]}`,r,d,this.animationValues);r.render();for(const u in d)r.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);r.scheduleRender()}applyProjectionStyles(r,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){r.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,r.visibility="",r.opacity="",r.pointerEvents=is(l==null?void 0:l.pointerEvents)||"",r.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(r.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,r.pointerEvents=is(l==null?void 0:l.pointerEvents)||""),this.hasProjected&&!Ue(this.latestValues)&&(r.transform=c?c({},""):"none",this.hasProjected=!1);return}r.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let p=Eh(this.projectionDeltaWithTransform,this.treeScale,u);c&&(p=c(u,p)),r.transform=p;const{x:h,y:m}=this.projectionDelta;r.transformOrigin=`${h.origin*100}% ${m.origin*100}% 0`,d.animationValues?r.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:r.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const f in hn){if(u[f]===void 0)continue;const{correct:y,applyTo:b,isCSSVariable:w}=hn[f],j=p==="none"?u[f]:y(u[f],d);if(b){const k=b.length;for(let C=0;C<k;C++)r[b[C]]=j}else w?this.options.visualElement.renderState.vars[f]=j:r[f]=j}this.options.layoutId&&(r.pointerEvents=d===this?is(l==null?void 0:l.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(r=>{var l;return(l=r.currentAnimation)==null?void 0:l.stop()}),this.root.nodes.forEach(va),this.root.sharedNodes.clear()}}}function $h(e){e.updateLayout()}function Wh(e){var n;const t=((n=e.resumeFrom)==null?void 0:n.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:a}=e.layout,{animationType:o}=e.options,r=t.source!==e.layout.source;o==="size"?Ne(p=>{const h=r?t.measuredBox[p]:t.layoutBox[p],m=he(h);h.min=i[p].min,h.max=h.min+m}):To(o,t.layoutBox,i)&&Ne(p=>{const h=r?t.measuredBox[p]:t.layoutBox[p],m=he(i[p]);h.max=h.min+m,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[p].max=e.relativeTarget[p].min+m)});const l=at();kt(l,i,t.layoutBox);const c=at();r?kt(c,e.applyTransform(a,!0),t.measuredBox):kt(c,i,t.layoutBox);const d=!jo(l);let u=!1;if(!e.resumeFrom){const p=e.getClosestProjectingParent();if(p&&!p.resumeFrom){const{snapshot:h,layout:m}=p;if(h&&m){const f=ne();us(f,t.layoutBox,h.layoutBox);const y=ne();us(y,i,m.layoutBox),No(f,y)||(u=!0),p.options.layoutRoot&&(e.relativeTarget=y,e.relativeTargetOrigin=f,e.relativeParent=p)}}}e.notifyListeners("didUpdate",{layout:i,snapshot:t,delta:c,layoutDelta:l,hasLayoutChanged:d,hasRelativeLayoutChanged:u})}else if(e.isLead()){const{onExitComplete:i}=e.options;i&&i()}e.options.transition=void 0}function zh(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Hh(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function qh(e){e.clearSnapshot()}function va(e){e.clearMeasurements()}function wa(e){e.isLayoutDirty=!1}function Gh(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function ja(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Kh(e){e.resolveTargetDelta()}function Yh(e){e.calcProjection()}function Xh(e){e.resetSkewAndRotation()}function Zh(e){e.removeLeadSnapshot()}function Na(e,t,n){e.translate=Z(t.translate,0,n),e.scale=Z(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function Sa(e,t,n,i){e.min=Z(t.min,n.min,i),e.max=Z(t.max,n.max,i)}function Jh(e,t,n,i){Sa(e.x,t.x,n.x,i),Sa(e.y,t.y,n.y,i)}function Qh(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const ep={duration:.45,ease:[.4,0,.1,1]},ka=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),_a=ka("applewebkit/")&&!ka("chrome/")?Math.round:ge;function Ca(e){e.min=_a(e.min),e.max=_a(e.max)}function tp(e){Ca(e.x),Ca(e.y)}function To(e,t,n){return e==="position"||e==="preserve-aspect"&&!Sh(fa(t),fa(n),.2)}function sp(e){var t;return e!==e.root&&((t=e.scroll)==null?void 0:t.wasRoot)}const np=Co({attachResizeListener:(e,t)=>Rt(e,"resize",t),measureScroll:()=>{var e,t;return{x:document.documentElement.scrollLeft||((e=document.body)==null?void 0:e.scrollLeft)||0,y:document.documentElement.scrollTop||((t=document.body)==null?void 0:t.scrollTop)||0}},checkIsScrollRoot:()=>!0}),Ds={current:void 0},Ao=Co({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Ds.current){const e=new np({});e.mount(window),e.setOptions({layoutScroll:!0}),Ds.current=e}return Ds.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Yn=N.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function Ta(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function ip(...e){return t=>{let n=!1;const i=e.map(a=>{const o=Ta(a,t);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let a=0;a<i.length;a++){const o=i[a];typeof o=="function"?o():Ta(e[a],null)}}}}function ap(...e){return N.useCallback(ip(...e),e)}class rp extends N.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent&&this.props.pop!==!1){const i=n.offsetParent,a=ln(i)&&i.offsetWidth||0,o=ln(i)&&i.offsetHeight||0,r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft,r.right=a-r.width-r.left,r.bottom=o-r.height-r.top}return null}componentDidUpdate(){}render(){return this.props.children}}function op({children:e,isPresent:t,anchorX:n,anchorY:i,root:a,pop:o}){var h;const r=N.useId(),l=N.useRef(null),c=N.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:d}=N.useContext(Yn),u=((h=e.props)==null?void 0:h.ref)??(e==null?void 0:e.ref),p=ap(l,u);return N.useInsertionEffect(()=>{const{width:m,height:f,top:y,left:b,right:w,bottom:j}=c.current;if(t||o===!1||!l.current||!m||!f)return;const k=n==="left"?`left: ${b}`:`right: ${w}`,C=i==="bottom"?`bottom: ${j}`:`top: ${y}`;l.current.dataset.motionPopId=r;const _=document.createElement("style");d&&(_.nonce=d);const g=a??document.head;return g.appendChild(_),_.sheet&&_.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${m}px !important;
            height: ${f}px !important;
            ${k}px !important;
            ${C}px !important;
          }
        `),()=>{g.contains(_)&&g.removeChild(_)}},[t]),s.jsx(rp,{isPresent:t,childRef:l,sizeRef:c,pop:o,children:o===!1?e:N.cloneElement(e,{ref:p})})}const lp=({children:e,initial:t,isPresent:n,onExitComplete:i,custom:a,presenceAffectsLayout:o,mode:r,anchorX:l,anchorY:c,root:d})=>{const u=vn(cp),p=N.useId();let h=!0,m=N.useMemo(()=>(h=!1,{id:p,initial:t,isPresent:n,custom:a,onExitComplete:f=>{u.set(f,!0);for(const y of u.values())if(!y)return;i&&i()},register:f=>(u.set(f,!1),()=>u.delete(f))}),[n,u,i]);return o&&h&&(m={...m}),N.useMemo(()=>{u.forEach((f,y)=>u.set(y,!1))},[n]),N.useEffect(()=>{!n&&!u.size&&i&&i()},[n]),e=s.jsx(op,{pop:r==="popLayout",isPresent:n,anchorX:l,anchorY:c,root:d,children:e}),s.jsx(fs.Provider,{value:m,children:e})};function cp(){return new Map}function Eo(e=!0){const t=N.useContext(fs);if(t===null)return[!0,null];const{isPresent:n,onExitComplete:i,register:a}=t,o=N.useId();N.useEffect(()=>{if(e)return a(o)},[e]);const r=N.useCallback(()=>e&&i&&i(o),[o,i,e]);return!n&&i?[!1,r]:[!0]}const Kt=e=>e.key||"";function Aa(e){const t=[];return N.Children.forEach(e,n=>{N.isValidElement(n)&&t.push(n)}),t}const Do=({children:e,custom:t,initial:n=!0,onExitComplete:i,presenceAffectsLayout:a=!0,mode:o="sync",propagate:r=!1,anchorX:l="left",anchorY:c="top",root:d})=>{const[u,p]=Eo(r),h=N.useMemo(()=>Aa(e),[e]),m=r&&!u?[]:h.map(Kt),f=N.useRef(!0),y=N.useRef(h),b=vn(()=>new Map),w=N.useRef(new Set),[j,k]=N.useState(h),[C,_]=N.useState(h);rr(()=>{f.current=!1,y.current=h;for(let v=0;v<C.length;v++){const S=Kt(C[v]);m.includes(S)?(b.delete(S),w.current.delete(S)):b.get(S)!==!0&&b.set(S,!1)}},[C,m.length,m.join("-")]);const g=[];if(h!==j){let v=[...h];for(let S=0;S<C.length;S++){const A=C[S],M=Kt(A);m.includes(M)||(v.splice(S,0,A),g.push(A))}return o==="wait"&&g.length&&(v=g),_(Aa(v)),k(h),null}const{forceRender:x}=N.useContext(yn);return s.jsx(s.Fragment,{children:C.map(v=>{const S=Kt(v),A=r&&!u?!1:h===C||m.includes(S),M=()=>{if(w.current.has(S))return;if(w.current.add(S),b.has(S))b.set(S,!0);else return;let P=!0;b.forEach(I=>{I||(P=!1)}),P&&(x==null||x(),_(y.current),r&&(p==null||p()),i&&i())};return s.jsx(lp,{isPresent:A,initial:!f.current||n?void 0:!1,custom:t,presenceAffectsLayout:a,mode:o,root:d,onExitComplete:A?void 0:M,anchorX:l,anchorY:c,children:v},S)})})},Ro=N.createContext({strict:!1}),Ea={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let Da=!1;function dp(){if(Da)return;const e={};for(const t in Ea)e[t]={isEnabled:n=>Ea[t].some(i=>!!n[i])};ao(e),Da=!0}function Mo(){return dp(),Xu()}function up(e){const t=Mo();for(const n in e)t[n]={...t[n],...e[n]};ao(t)}const hp=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","propagate","ignoreStrict","viewport"]);function hs(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||hp.has(e)}let Po=e=>!hs(e);function pp(e){typeof e=="function"&&(Po=t=>t.startsWith("on")?!hs(t):e(t))}try{pp(require("@emotion/is-prop-valid").default)}catch{}function mp(e,t,n){const i={};for(const a in e)a==="values"&&typeof e.values=="object"||(Po(a)||n===!0&&hs(a)||!t&&!hs(a)||e.draggable&&a.startsWith("onDrag"))&&(i[a]=e[a]);return i}const bs=N.createContext({});function fp(e,t){if(gs(e)){const{initial:n,animate:i}=e;return{initial:n===!1||Dt(n)?n:void 0,animate:Dt(i)?i:void 0}}return e.inherit!==!1?t:{}}function xp(e){const{initial:t,animate:n}=fp(e,N.useContext(bs));return N.useMemo(()=>({initial:t,animate:n}),[Ra(t),Ra(n)])}function Ra(e){return Array.isArray(e)?e.join(" "):e}const Xn=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Io(e,t,n){for(const i in t)!de(t[i])&&!po(i,n)&&(e[i]=t[i])}function gp({transformTemplate:e},t){return N.useMemo(()=>{const n=Xn();return Gn(n,t,e),Object.assign({},n.vars,n.style)},[t])}function bp(e,t){const n=e.style||{},i={};return Io(i,n,e),Object.assign(i,gp(e,t)),i}function yp(e,t){const n={},i=bp(e,t);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=i,n}const Lo=()=>({...Xn(),attrs:{}});function vp(e,t,n,i){const a=N.useMemo(()=>{const o=Lo();return mo(o,t,xo(i),e.transformTemplate,e.style),{...o.attrs,style:{...o.style}}},[t]);if(e.style){const o={};Io(o,e.style,e),a.style={...o,...a.style}}return a}const wp=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Zn(e){return typeof e!="string"||e.includes("-")?!1:!!(wp.indexOf(e)>-1||/[A-Z]/u.test(e))}function jp(e,t,n,{latestValues:i},a,o=!1,r){const c=(r??Zn(e)?vp:yp)(t,i,a,e),d=mp(t,typeof e=="string",o),u=e!==N.Fragment?{...d,...c,ref:n}:{},{children:p}=t,h=N.useMemo(()=>de(p)?p.get():p,[p]);return N.createElement(e,{...u,children:h})}function Np({scrapeMotionValuesFromProps:e,createRenderState:t},n,i,a){return{latestValues:Sp(n,i,a,e),renderState:t()}}function Sp(e,t,n,i){const a={},o=i(e,{});for(const h in o)a[h]=is(o[h]);let{initial:r,animate:l}=e;const c=gs(e),d=io(e);t&&d&&!c&&e.inherit!==!1&&(r===void 0&&(r=t.initial),l===void 0&&(l=t.animate));let u=n?n.initial===!1:!1;u=u||r===!1;const p=u?l:r;if(p&&typeof p!="boolean"&&!xs(p)){const h=Array.isArray(p)?p:[p];for(let m=0;m<h.length;m++){const f=Fn(e,h[m]);if(f){const{transitionEnd:y,transition:b,...w}=f;for(const j in w){let k=w[j];if(Array.isArray(k)){const C=u?k.length-1:0;k=k[C]}k!==null&&(a[j]=k)}for(const j in y)a[j]=y[j]}}}return a}const Oo=e=>(t,n)=>{const i=N.useContext(bs),a=N.useContext(fs),o=()=>Np(e,t,i,a);return n?o():vn(o)},kp=Oo({scrapeMotionValuesFromProps:Kn,createRenderState:Xn}),_p=Oo({scrapeMotionValuesFromProps:go,createRenderState:Lo}),Cp=Symbol.for("motionComponentSymbol");function Tp(e,t,n){const i=N.useRef(n);N.useInsertionEffect(()=>{i.current=n});const a=N.useRef(null);return N.useCallback(o=>{var l;o&&((l=e.onMount)==null||l.call(e,o)),t&&(o?t.mount(o):t.unmount());const r=i.current;if(typeof r=="function")if(o){const c=r(o);typeof c=="function"&&(a.current=c)}else a.current?(a.current(),a.current=null):r(o);else r&&(r.current=o)},[t])}const Vo=N.createContext({});function st(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function Ap(e,t,n,i,a,o){var k,C;const{visualElement:r}=N.useContext(bs),l=N.useContext(Ro),c=N.useContext(fs),d=N.useContext(Yn),u=d.reducedMotion,p=d.skipAnimations,h=N.useRef(null),m=N.useRef(!1);i=i||l.renderer,!h.current&&i&&(h.current=i(e,{visualState:t,parent:r,props:n,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:u,skipAnimations:p,isSVG:o}),m.current&&h.current&&(h.current.manuallyAnimateOnMount=!0));const f=h.current,y=N.useContext(Vo);f&&!f.projection&&a&&(f.type==="html"||f.type==="svg")&&Ep(h.current,n,a,y);const b=N.useRef(!1);N.useInsertionEffect(()=>{f&&b.current&&f.update(n,c)});const w=n[zr],j=N.useRef(!!w&&!((k=window.MotionHandoffIsComplete)!=null&&k.call(window,w))&&((C=window.MotionHasOptimisedAnimation)==null?void 0:C.call(window,w)));return rr(()=>{m.current=!0,f&&(b.current=!0,window.MotionIsMounted=!0,f.updateFeatures(),f.scheduleRenderMicrotask(),j.current&&f.animationState&&f.animationState.animateChanges())}),N.useEffect(()=>{f&&(!j.current&&f.animationState&&f.animationState.animateChanges(),j.current&&(queueMicrotask(()=>{var _;(_=window.MotionHandoffMarkAsComplete)==null||_.call(window,w)}),j.current=!1),f.enteringChildren=void 0)}),f}function Ep(e,t,n,i){const{layoutId:a,layout:o,drag:r,dragConstraints:l,layoutScroll:c,layoutRoot:d,layoutCrossfade:u}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:Fo(e.parent)),e.projection.setOptions({layoutId:a,layout:o,alwaysMeasureLayout:!!r||l&&st(l),visualElement:e,animationType:typeof o=="string"?o:"both",initialPromotionConfig:i,crossfade:u,layoutScroll:c,layoutRoot:d})}function Fo(e){if(e)return e.options.allowProjection!==!1?e.projection:Fo(e.parent)}function Rs(e,{forwardMotionProps:t=!1,type:n}={},i,a){i&&up(i);const o=n?n==="svg":Zn(e),r=o?_p:kp;function l(d,u){let p;const h={...N.useContext(Yn),...d,layoutId:Dp(d)},{isStatic:m}=h,f=xp(d),y=r(d,m);if(!m&&ar){Rp();const b=Mp(h);p=b.MeasureLayout,f.visualElement=Ap(e,y,h,a,b.ProjectionNode,o)}return s.jsxs(bs.Provider,{value:f,children:[p&&f.visualElement?s.jsx(p,{visualElement:f.visualElement,...h}):null,jp(e,d,Tp(y,f.visualElement,u),y,m,t,o)]})}l.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const c=N.forwardRef(l);return c[Cp]=e,c}function Dp({layoutId:e}){const t=N.useContext(yn).id;return t&&e!==void 0?t+"-"+e:e}function Rp(e,t){N.useContext(Ro).strict}function Mp(e){const t=Mo(),{drag:n,layout:i}=t;if(!n&&!i)return{};const a={...n,...i};return{MeasureLayout:n!=null&&n.isEnabled(e)||i!=null&&i.isEnabled(e)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}function Pp(e,t){if(typeof Proxy>"u")return Rs;const n=new Map,i=(o,r)=>Rs(o,r,e,t),a=(o,r)=>i(o,r);return new Proxy(a,{get:(o,r)=>r==="create"?i:(n.has(r)||n.set(r,Rs(r,void 0,e,t)),n.get(r))})}const Ip=(e,t)=>t.isSVG??Zn(e)?new ph(t):new oh(t,{allowProjection:e!==N.Fragment});class Lp extends Oe{constructor(t){super(t),t.animationState||(t.animationState=bh(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();xs(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)==null||t.call(this)}}let Op=0;class Vp extends Oe{constructor(){super(...arguments),this.id=Op++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===i)return;const a=this.node.animationState.setActive("exit",!t);n&&!t&&a.then(()=>{n(this.id)})}mount(){const{register:t,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const Fp={animation:{Feature:Lp},exit:{Feature:Vp}};function Ot(e){return{point:{x:e.pageX,y:e.pageY}}}const Bp=e=>t=>Wn(t)&&e(t,Ot(t));function _t(e,t,n,i){return Rt(e,t,Bp(n),i)}const Bo=({current:e})=>e?e.ownerDocument.defaultView:null,Ma=(e,t)=>Math.abs(e-t);function Up(e,t){const n=Ma(e.x,t.x),i=Ma(e.y,t.y);return Math.sqrt(n**2+i**2)}const Pa=new Set(["auto","scroll"]);class Uo{constructor(t,n,{transformPagePoint:i,contextWindow:a=window,dragSnapToOrigin:o=!1,distanceThreshold:r=3,element:l}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=m=>{this.handleScroll(m.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const m=Ps(this.lastMoveEventInfo,this.history),f=this.startEvent!==null,y=Up(m.offset,{x:0,y:0})>=this.distanceThreshold;if(!f&&!y)return;const{point:b}=m,{timestamp:w}=le;this.history.push({...b,timestamp:w});const{onStart:j,onMove:k}=this.handlers;f||(j&&j(this.lastMoveEvent,m),this.startEvent=this.lastMoveEvent),k&&k(this.lastMoveEvent,m)},this.handlePointerMove=(m,f)=>{this.lastMoveEvent=m,this.lastMoveEventInfo=Ms(f,this.transformPagePoint),G.update(this.updatePoint,!0)},this.handlePointerUp=(m,f)=>{this.end();const{onEnd:y,onSessionEnd:b,resumeAnimation:w}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&w&&w(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const j=Ps(m.type==="pointercancel"?this.lastMoveEventInfo:Ms(f,this.transformPagePoint),this.history);this.startEvent&&y&&y(m,j),b&&b(m,j)},!Wn(t))return;this.dragSnapToOrigin=o,this.handlers=n,this.transformPagePoint=i,this.distanceThreshold=r,this.contextWindow=a||window;const c=Ot(t),d=Ms(c,this.transformPagePoint),{point:u}=d,{timestamp:p}=le;this.history=[{...u,timestamp:p}];const{onSessionStart:h}=n;h&&h(t,Ps(d,this.history)),this.removeListeners=Pt(_t(this.contextWindow,"pointermove",this.handlePointerMove),_t(this.contextWindow,"pointerup",this.handlePointerUp),_t(this.contextWindow,"pointercancel",this.handlePointerUp)),l&&this.startScrollTracking(l)}startScrollTracking(t){let n=t.parentElement;for(;n;){const i=getComputedStyle(n);(Pa.has(i.overflowX)||Pa.has(i.overflowY))&&this.scrollPositions.set(n,{x:n.scrollLeft,y:n.scrollTop}),n=n.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(t){const n=this.scrollPositions.get(t);if(!n)return;const i=t===window,a=i?{x:window.scrollX,y:window.scrollY}:{x:t.scrollLeft,y:t.scrollTop},o={x:a.x-n.x,y:a.y-n.y};o.x===0&&o.y===0||(i?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=o.x,this.lastMoveEventInfo.point.y+=o.y):this.history.length>0&&(this.history[0].x-=o.x,this.history[0].y-=o.y),this.scrollPositions.set(t,a),G.update(this.updatePoint,!0))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),Ie(this.updatePoint)}}function Ms(e,t){return t?{point:t(e.point)}:e}function Ia(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Ps({point:e},t){return{point:e,delta:Ia(e,$o(t)),offset:Ia(e,$p(t)),velocity:Wp(t,.1)}}function $p(e){return e[0]}function $o(e){return e[e.length-1]}function Wp(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,i=null;const a=$o(e);for(;n>=0&&(i=e[n],!(a.timestamp-i.timestamp>Se(t)));)n--;if(!i)return{x:0,y:0};i===e[0]&&e.length>2&&a.timestamp-i.timestamp>Se(t)*2&&(i=e[1]);const o=xe(a.timestamp-i.timestamp);if(o===0)return{x:0,y:0};const r={x:(a.x-i.x)/o,y:(a.y-i.y)/o};return r.x===1/0&&(r.x=0),r.y===1/0&&(r.y=0),r}function zp(e,{min:t,max:n},i){return t!==void 0&&e<t?e=i?Z(t,e,i.min):Math.max(e,t):n!==void 0&&e>n&&(e=i?Z(n,e,i.max):Math.min(e,n)),e}function La(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function Hp(e,{top:t,left:n,bottom:i,right:a}){return{x:La(e.x,n,a),y:La(e.y,t,i)}}function Oa(e,t){let n=t.min-e.min,i=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,i]=[i,n]),{min:n,max:i}}function qp(e,t){return{x:Oa(e.x,t.x),y:Oa(e.y,t.y)}}function Gp(e,t){let n=.5;const i=he(e),a=he(t);return a>i?n=Tt(t.min,t.max-i,e.min):i>a&&(n=Tt(e.min,e.max-a,t.min)),_e(0,1,n)}function Kp(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const pn=.35;function Yp(e=pn){return e===!1?e=0:e===!0&&(e=pn),{x:Va(e,"left","right"),y:Va(e,"top","bottom")}}function Va(e,t,n){return{min:Fa(e,t),max:Fa(e,n)}}function Fa(e,t){return typeof e=="number"?e:e[t]||0}const Xp=new WeakMap;class Zp{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ne(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:n=!1,distanceThreshold:i}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const o=p=>{n&&this.snapToCursor(Ot(p).point),this.stopAnimation()},r=(p,h)=>{const{drag:m,dragPropagation:f,onDragStart:y}=this.getProps();if(m&&!f&&(this.openDragLock&&this.openDragLock(),this.openDragLock=_u(m),!this.openDragLock))return;this.latestPointerEvent=p,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ne(w=>{let j=this.getAxisMotionValue(w).get()||0;if(ke.test(j)){const{projection:k}=this.visualElement;if(k&&k.layout){const C=k.layout.layoutBox[w];C&&(j=he(C)*(parseFloat(j)/100))}}this.originPoint[w]=j}),y&&G.update(()=>y(p,h),!1,!0),an(this.visualElement,"transform");const{animationState:b}=this.visualElement;b&&b.setActive("whileDrag",!0)},l=(p,h)=>{this.latestPointerEvent=p,this.latestPanInfo=h;const{dragPropagation:m,dragDirectionLock:f,onDirectionLock:y,onDrag:b}=this.getProps();if(!m&&!this.openDragLock)return;const{offset:w}=h;if(f&&this.currentDirection===null){this.currentDirection=Qp(w),this.currentDirection!==null&&y&&y(this.currentDirection);return}this.updateAxis("x",h.point,w),this.updateAxis("y",h.point,w),this.visualElement.render(),b&&G.update(()=>b(p,h),!1,!0)},c=(p,h)=>{this.latestPointerEvent=p,this.latestPanInfo=h,this.stop(p,h),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>{const{dragSnapToOrigin:p}=this.getProps();(p||this.constraints)&&this.startAnimation({x:0,y:0})},{dragSnapToOrigin:u}=this.getProps();this.panSession=new Uo(t,{onSessionStart:o,onStart:r,onMove:l,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:i,contextWindow:Bo(this.visualElement),element:this.visualElement.current})}stop(t,n){const i=t||this.latestPointerEvent,a=n||this.latestPanInfo,o=this.isDragging;if(this.cancel(),!o||!a||!i)return;const{velocity:r}=a;this.startAnimation(r);const{onDragEnd:l}=this.getProps();l&&G.postRender(()=>l(i,a))}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.endPanSession();const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(t,n,i){const{drag:a}=this.getProps();if(!i||!Yt(t,a,this.currentDirection))return;const o=this.getAxisMotionValue(t);let r=this.originPoint[t]+i[t];this.constraints&&this.constraints[t]&&(r=zp(r,this.constraints[t],this.elastic[t])),o.set(r)}resolveConstraints(){var o;const{dragConstraints:t,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(o=this.visualElement.projection)==null?void 0:o.layout,a=this.constraints;t&&st(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&i?this.constraints=Hp(i.layoutBox,t):this.constraints=!1,this.elastic=Yp(n),a!==this.constraints&&!st(t)&&i&&this.constraints&&!this.hasMutatedConstraints&&Ne(r=>{this.constraints!==!1&&this.getAxisMotionValue(r)&&(this.constraints[r]=Kp(i.layoutBox[r],this.constraints[r]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!st(t))return!1;const i=t.current,{projection:a}=this.visualElement;if(!a||!a.layout)return!1;const o=th(i,a.root,this.visualElement.getTransformPagePoint());let r=qp(a.layout.layoutBox,o);if(n){const l=n(Ju(r));this.hasMutatedConstraints=!!l,l&&(r=oo(l))}return r}startAnimation(t){const{drag:n,dragMomentum:i,dragElastic:a,dragTransition:o,dragSnapToOrigin:r,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=Ne(u=>{if(!Yt(u,n,this.currentDirection))return;let p=c&&c[u]||{};r&&(p={min:0,max:0});const h=a?200:1e6,m=a?40:1e7,f={type:"inertia",velocity:i?t[u]:0,bounceStiffness:h,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...o,...p};return this.startAxisValueAnimation(u,f)});return Promise.all(d).then(l)}startAxisValueAnimation(t,n){const i=this.getAxisMotionValue(t);return an(this.visualElement,t),i.start(Vn(t,i,0,n,this.visualElement,!1))}stopAnimation(){Ne(t=>this.getAxisMotionValue(t).stop())}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,i=this.visualElement.getProps(),a=i[n];return a||this.visualElement.getValue(t,(i.initial?i.initial[t]:void 0)||0)}snapToCursor(t){Ne(n=>{const{drag:i}=this.getProps();if(!Yt(n,i,this.currentDirection))return;const{projection:a}=this.visualElement,o=this.getAxisMotionValue(n);if(a&&a.layout){const{min:r,max:l}=a.layout.layoutBox[n],c=o.get()||0;o.set(t[n]-Z(r,l,.5)+c)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:i}=this.visualElement;if(!st(n)||!i||!this.constraints)return;this.stopAnimation();const a={x:0,y:0};Ne(r=>{const l=this.getAxisMotionValue(r);if(l&&this.constraints!==!1){const c=l.get();a[r]=Gp({min:c,max:c},this.constraints[r])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.constraints=!1,this.resolveConstraints(),Ne(r=>{if(!Yt(r,t,null))return;const l=this.getAxisMotionValue(r),{min:c,max:d}=this.constraints[r];l.set(Z(c,d,a[r]))}),this.visualElement.render()}addListeners(){if(!this.visualElement.current)return;Xp.set(this.visualElement,this);const t=this.visualElement.current,n=_t(t,"pointerdown",d=>{const{drag:u,dragListener:p=!0}=this.getProps(),h=d.target,m=h!==t&&Ru(h);u&&p&&!m&&this.start(d)});let i;const a=()=>{const{dragConstraints:d}=this.getProps();st(d)&&d.current&&(this.constraints=this.resolveRefConstraints(),i||(i=Jp(t,d.current,()=>this.scalePositionWithinConstraints())))},{projection:o}=this.visualElement,r=o.addEventListener("measure",a);o&&!o.layout&&(o.root&&o.root.updateScroll(),o.updateLayout()),G.read(a);const l=Rt(window,"resize",()=>this.scalePositionWithinConstraints()),c=o.addEventListener("didUpdate",(({delta:d,hasLayoutChanged:u})=>{this.isDragging&&u&&(Ne(p=>{const h=this.getAxisMotionValue(p);h&&(this.originPoint[p]+=d[p].translate,h.set(h.get()+d[p].translate))}),this.visualElement.render())}));return()=>{l(),n(),r(),c&&c(),i&&i()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:i=!1,dragPropagation:a=!1,dragConstraints:o=!1,dragElastic:r=pn,dragMomentum:l=!0}=t;return{...t,drag:n,dragDirectionLock:i,dragPropagation:a,dragConstraints:o,dragElastic:r,dragMomentum:l}}}function Ba(e){let t=!0;return()=>{if(t){t=!1;return}e()}}function Jp(e,t,n){const i=Gi(e,Ba(n)),a=Gi(t,Ba(n));return()=>{i(),a()}}function Yt(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function Qp(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class em extends Oe{constructor(t){super(t),this.removeGroupControls=ge,this.removeListeners=ge,this.controls=new Zp(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||ge}update(){const{dragControls:t}=this.node.getProps(),{dragControls:n}=this.node.prevProps||{};t!==n&&(this.removeGroupControls(),t&&(this.removeGroupControls=t.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}}const Is=e=>(t,n)=>{e&&G.update(()=>e(t,n),!1,!0)};class tm extends Oe{constructor(){super(...arguments),this.removePointerDownListener=ge}onPointerDown(t){this.session=new Uo(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Bo(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:i,onPanEnd:a}=this.node.getProps();return{onSessionStart:Is(t),onStart:Is(n),onMove:Is(i),onEnd:(o,r)=>{delete this.session,a&&G.postRender(()=>a(o,r))}}}mount(){this.removePointerDownListener=_t(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let Ls=!1;class sm extends N.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:i,layoutId:a}=this.props,{projection:o}=t;o&&(n.group&&n.group.add(o),i&&i.register&&a&&i.register(o),Ls&&o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),as.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:i,drag:a,isPresent:o}=this.props,{projection:r}=i;return r&&(r.isPresent=o,t.layoutDependency!==n&&r.setOptions({...r.options,layoutDependency:n}),Ls=!0,a||t.layoutDependency!==n||n===void 0||t.isPresent!==o?r.willUpdate():this.safeToRemove(),t.isPresent!==o&&(o?r.promote():r.relegate()||G.postRender(()=>{const l=r.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),$n.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:i}=this.props,{projection:a}=t;Ls=!0,a&&(a.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(a),i&&i.deregister&&i.deregister(a))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function Wo(e){const[t,n]=Eo(),i=N.useContext(yn);return s.jsx(sm,{...e,layoutGroup:i,switchLayoutGroup:N.useContext(Vo),isPresent:t,safeToRemove:n})}const nm={pan:{Feature:tm},drag:{Feature:em,ProjectionNode:Ao,MeasureLayout:Wo}};function Ua(e,t,n){const{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover",n==="Start");const a="onHover"+n,o=i[a];o&&G.postRender(()=>o(t,Ot(t)))}class im extends Oe{mount(){const{current:t}=this.node;t&&(this.unmount=Tu(t,(n,i)=>(Ua(this.node,i,"Start"),a=>Ua(this.node,a,"End"))))}unmount(){}}class am extends Oe{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Pt(Rt(this.node.current,"focus",()=>this.onFocus()),Rt(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function $a(e,t,n){const{props:i}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap",n==="Start");const a="onTap"+(n==="End"?"":n),o=i[a];o&&G.postRender(()=>o(t,Ot(t)))}class rm extends Oe{mount(){const{current:t}=this.node;if(!t)return;const{globalTapTarget:n,propagate:i}=this.node.props;this.unmount=Pu(t,(a,o)=>($a(this.node,o,"Start"),(r,{success:l})=>$a(this.node,r,l?"End":"Cancel")),{useGlobalTarget:n,stopPropagation:(i==null?void 0:i.tap)===!1})}unmount(){}}const mn=new WeakMap,Os=new WeakMap,om=e=>{const t=mn.get(e.target);t&&t(e)},lm=e=>{e.forEach(om)};function cm({root:e,...t}){const n=e||document;Os.has(n)||Os.set(n,{});const i=Os.get(n),a=JSON.stringify(t);return i[a]||(i[a]=new IntersectionObserver(lm,{root:e,...t})),i[a]}function dm(e,t,n){const i=cm(t);return mn.set(e,n),i.observe(e),()=>{mn.delete(e),i.unobserve(e)}}const um={some:0,all:1};class hm extends Oe{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:i,amount:a="some",once:o}=t,r={root:n?n.current:void 0,rootMargin:i,threshold:typeof a=="number"?a:um[a]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,o&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:p}=this.node.getProps(),h=d?u:p;h&&h(c)};return dm(this.node.current,r,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(pm(t,n))&&this.startObserver()}unmount(){}}function pm({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const mm={inView:{Feature:hm},tap:{Feature:rm},focus:{Feature:am},hover:{Feature:im}},fm={layout:{ProjectionNode:Ao,MeasureLayout:Wo}},xm={...Fp,...mm,...nm,...fm},ps=Pp(xm,Ip),ce={gradients:{exposed:{from:"#ff0844",to:"rgba(255, 8, 68, 0)"},secured:{from:"#00d9ff",to:"rgba(16, 185, 129, 0)"}},glow:{exposed:"0 0 40px rgba(255, 8, 68, 0.6), 0 0 80px rgba(255, 8, 68, 0.3)",secured:"0 0 40px rgba(0, 217, 255, 0.6), 0 0 80px rgba(0, 217, 255, 0.3)"},spacing:{top:30,right:50,bottom:80,left:100}};function gm({data:e,x:t,y:n}){const i=l=>l>=1e6?`${(l/1e6).toFixed(1)}M‚Ç¨`:l>=1e3?`${Math.round(l/1e3)}k‚Ç¨`:`${Math.round(l)}‚Ç¨`,a=l=>new Date(l).toLocaleDateString("fr-FR",{weekday:"short",day:"2-digit",month:"short",year:"numeric"}).toUpperCase(),o=e.securedCA+e.exposedCA,r=o>0?(e.exposedCA/o*100).toFixed(1):"0.0";return ol.createPortal(s.jsxs(ps.div,{initial:{opacity:0,scale:.8,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:10},transition:{duration:.2,ease:"easeOut"},className:"pointer-events-none fixed z-[9999]",style:{left:t,top:n-20,transform:"translate(-50%, -100%)"},children:[s.jsxs("div",{className:"relative backdrop-blur-2xl bg-slate-900 rounded-2xl border border-white/30 overflow-hidden",style:{boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.9), 0 0 100px rgba(0, 217, 255, 0.3)"},children:[s.jsx("div",{className:"absolute top-0 left-0 right-0 h-[2px] bg-gradient-to-r from-transparent via-cyan-400 to-transparent"}),s.jsxs("div",{className:"p-5 space-y-4 min-w-[280px]",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-white/10",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-400 animate-pulse",style:{boxShadow:ce.glow.secured}}),s.jsx("span",{className:"text-[11px] font-black text-blue-300 uppercase tracking-[0.15em]",children:a(e.date)})]}),s.jsx("div",{className:"bg-gradient-to-br from-white/10 to-transparent p-4 rounded-xl border border-white/20",children:s.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[s.jsx("span",{className:"text-xs text-white/60 uppercase tracking-wider font-bold",children:"CA Total"}),s.jsx("span",{className:"text-3xl font-black text-white",style:{textShadow:"0 0 20px rgba(255,255,255,0.5)"},children:i(o)})]})}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-cyan-500/30 to-emerald-500/20 p-3 rounded-xl border border-cyan-400/40",style:{boxShadow:"0 0 20px rgba(0, 217, 255, 0.3)"},children:[s.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-cyan-400/20 rounded-full blur-2xl"}),s.jsxs("div",{className:"relative z-10",children:[s.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-cyan-400",style:{boxShadow:ce.glow.secured}}),s.jsx("span",{className:"text-[9px] text-cyan-300 font-black uppercase tracking-wider",children:"S√©curis√©"})]}),s.jsx("span",{className:"text-lg font-black text-cyan-100",children:i(e.securedCA)})]})]}),s.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-red-500/30 to-pink-500/20 p-3 rounded-xl border border-red-400/40",style:{boxShadow:"0 0 20px rgba(255, 8, 68, 0.3)"},children:[s.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-red-400/20 rounded-full blur-2xl"}),s.jsxs("div",{className:"relative z-10",children:[s.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-red-400",style:{boxShadow:ce.glow.exposed}}),s.jsx("span",{className:"text-[9px] text-red-300 font-black uppercase tracking-wider",children:"√Ä Risque"})]}),s.jsx("span",{className:"text-lg font-black text-red-100",children:i(e.exposedCA)})]})]})]}),s.jsxs("div",{className:"pt-3 border-t border-white/10",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-[9px] text-white/50 uppercase tracking-wider font-bold",children:"Exposition"}),s.jsxs("span",{className:"text-sm text-white/80 font-black",children:[r,"%"]})]}),s.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:s.jsx(ps.div,{initial:{width:0},animate:{width:`${r}%`},transition:{duration:.5,ease:"easeOut"},className:"h-full bg-gradient-to-r from-red-500 to-pink-500 rounded-full",style:{boxShadow:"0 0 10px rgba(255, 8, 68, 0.5)"}})})]})]})]}),s.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -bottom-2",children:s.jsx("div",{className:"w-4 h-4 bg-slate-900 border-l border-b border-white/30 rotate-45"})})]}),document.body)}function bm({data:e,width:t=1200,height:n=550}){const[i,a]=N.useState(null),o=t-ce.spacing.left-ce.spacing.right,r=n-ce.spacing.top-ce.spacing.bottom,l=N.useMemo(()=>e.length===0?$s({domain:[0,1],range:[0,o]}):$s({domain:[new Date(e[0].date),new Date(e[e.length-1].date)],range:[0,o]}),[e,o]),c=N.useMemo(()=>e.length===0?1:Math.max(...e.map(b=>b.securedCA+b.exposedCA)),[e]),d=N.useMemo(()=>Ae({domain:[0,c*1.1],range:[r,0],nice:!0}),[c,r]),u=b=>new Date(b.date),p=b=>l(u(b)),h=b=>d(b.securedCA),m=b=>d(b.securedCA+b.exposedCA),f=b=>{const w=Qt(b);if(!w)return;const j=w.x-ce.spacing.left,k=l.invert(j),C=e.reduce((g,x,v)=>{const S=u(x).getTime(),A=u(e[g]).getTime(),M=k.getTime();return Math.abs(S-M)<Math.abs(A-M)?v:g},0),_=e[C];a({data:_,x:p(_)+ce.spacing.left,y:m(_)+ce.spacing.top})},y=N.useMemo(()=>{if(e.length===0)return[];const b=Math.max(1,Math.ceil(e.length/7));return e.filter((w,j)=>j%b===0||j===e.length-1).map(w=>u(w))},[e]);return e.length===0||t<10||n<10||o<=0||r<=0?null:s.jsxs("div",{className:"relative w-full overflow-visible",children:[s.jsxs("svg",{width:t,height:n,children:[s.jsxs("defs",{children:[s.jsx(mi,{id:"gradient-exposed-tesla",from:ce.gradients.exposed.from,to:ce.gradients.exposed.to,vertical:!0}),s.jsx(mi,{id:"gradient-secured-tesla",from:ce.gradients.secured.from,to:ce.gradients.secured.to,vertical:!0}),s.jsxs("filter",{id:"glow-intense",children:[s.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),s.jsxs("feMerge",{children:[s.jsx("feMergeNode",{in:"coloredBlur"}),s.jsx("feMergeNode",{in:"coloredBlur"}),s.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),s.jsxs("g",{transform:`translate(${ce.spacing.left}, ${ce.spacing.top})`,children:[s.jsx(bn,{scale:d,width:o,stroke:"rgba(255, 255, 255, 0.05)",strokeWidth:1,numTicks:6}),s.jsx(Ct,{data:e,x:p,y:h,yScale:d,fill:"url(#gradient-secured-tesla)",curve:we,style:{filter:"url(#glow-intense)"}}),s.jsx(Ct,{data:e,x:p,y0:h,y1:m,yScale:d,fill:"url(#gradient-exposed-tesla)",curve:we,style:{filter:"url(#glow-intense)"}}),s.jsx(lt,{data:e,x:p,y:h,stroke:"#00d9ff",strokeWidth:3,curve:we,strokeLinecap:"round",style:{filter:"drop-shadow(0 0 6px #00d9ff)"}}),s.jsx(lt,{data:e,x:p,y:m,stroke:"#ff0844",strokeWidth:3,curve:we,strokeLinecap:"round",style:{filter:"drop-shadow(0 0 6px #ff0844)"}}),e.map((b,w)=>s.jsxs("g",{children:[s.jsx(gi,{cx:p(b),cy:m(b),r:(i==null?void 0:i.data)===b?6:3,fill:"#ff0844",stroke:"white",strokeWidth:(i==null?void 0:i.data)===b?2:1,style:{filter:(i==null?void 0:i.data)===b?"drop-shadow(0 0 8px #ff0844)":"none",cursor:"pointer",transition:"all 0.2s ease"}}),s.jsx(gi,{cx:p(b),cy:h(b),r:(i==null?void 0:i.data)===b?6:3,fill:"#00d9ff",stroke:"white",strokeWidth:(i==null?void 0:i.data)===b?2:1,style:{filter:(i==null?void 0:i.data)===b?"drop-shadow(0 0 8px #00d9ff)":"none",cursor:"pointer",transition:"all 0.2s ease"}})]},w)),i&&s.jsx("line",{x1:p(i.data),x2:p(i.data),y1:0,y2:r,stroke:"rgba(255, 255, 255, 0.2)",strokeWidth:2,strokeDasharray:"6,6",pointerEvents:"none"}),s.jsx(ht,{top:r,scale:l,stroke:"rgba(255, 255, 255, 0.2)",tickStroke:"rgba(255, 255, 255, 0.2)",tickValues:y,tickLabelProps:()=>({fill:"rgba(255, 255, 255, 0.6)",fontSize:12,fontFamily:"ui-monospace, monospace",textAnchor:"middle",fontWeight:700,dy:10}),tickFormat:b=>b.toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}).replace(".","")}),s.jsx(ms,{scale:d,stroke:"rgba(255, 255, 255, 0.2)",tickStroke:"rgba(255, 255, 255, 0.2)",numTicks:6,tickLabelProps:()=>({fill:"rgba(255, 255, 255, 0.6)",fontSize:13,fontFamily:"ui-monospace, monospace",textAnchor:"end",fontWeight:700,dx:-12}),tickFormat:b=>{const w=b;return w>=1e6?`${(w/1e6).toFixed(1)}M‚Ç¨`:w>=1e3?`${Math.round(w/1e3)}k‚Ç¨`:`${Math.round(w)}‚Ç¨`}}),s.jsx(rl,{width:o,height:r,fill:"transparent",onMouseMove:f,onMouseLeave:()=>a(null),style:{cursor:"crosshair"}})]})]}),s.jsx(Do,{children:i&&s.jsx(gm,{data:i.data,x:i.x,y:i.y})})]})}const ym={risk:{bg:"bg-gradient-to-br from-red-950/40 to-red-900/10",border:"border-red-500/30",glow:"shadow-[0_0_30px_rgba(239,68,68,0.15)]",dot:"bg-red-500",text:"text-red-400",textMuted:"text-red-300/60"},revenue:{bg:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/10",border:"border-emerald-500/30",glow:"shadow-[0_0_30px_rgba(16,185,129,0.15)]",dot:"bg-emerald-500",text:"text-emerald-400",textMuted:"text-emerald-300/60"},velocity:{bg:"bg-gradient-to-br from-blue-950/40 to-blue-900/10",border:"border-blue-500/30",glow:"shadow-[0_0_30px_rgba(59,130,246,0.15)]",dot:"bg-blue-500",text:"text-blue-400",textMuted:"text-blue-300/60"}},vm={emerald:"text-emerald-400",blue:"text-blue-400",orange:"text-orange-400",red:"text-red-400",slate:"text-slate-400"};function wm({data:e}){if(!e||e.length===0)return null;const t=Math.max(...e),n=Math.min(...e),i=t-n||1,a=e.map((o,r)=>{const l=r/(e.length-1)*100,c=100-(o-n)/i*100;return`${l},${c}`}).join(" ");return s.jsx("svg",{viewBox:"0 0 100 100",className:"w-full h-8 opacity-30",preserveAspectRatio:"none",children:s.jsx("polyline",{points:a,fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}function jm({trend:e}){const t=e.direction==="up"?cl:e.direction==="down"?dl:Nl,n=e.direction==="up"?"text-emerald-400 bg-emerald-500/10":e.direction==="down"?"text-red-400 bg-red-500/10":"text-slate-400 bg-slate-500/10";return s.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-lg ${n} text-[10px] font-bold uppercase tracking-wider`,children:[s.jsx(t,{size:12}),s.jsxs("span",{children:[Math.abs(e.percentage),"%"]})]})}function Vs({type:e,title:t,icon:n,heroValue:i,heroLabel:a,trend:o,metrics:r,sparklineData:l}){const c=ym[e];return s.jsxs("div",{className:`
        ${c.bg} ${c.border} ${c.glow}
        border rounded-3xl p-8
        transition-all duration-500 ease-out
        hover:scale-[1.02] hover:${c.glow.replace("0.15","0.25")}
        group relative overflow-hidden
      `,children:[s.jsx("div",{className:`absolute inset-0 ${c.dot} opacity-0 group-hover:opacity-5 blur-3xl transition-opacity duration-500`}),s.jsxs("header",{className:"flex items-center justify-between mb-6 relative z-10",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${c.dot} animate-pulse`}),s.jsx("h3",{className:`text-[10px] font-black ${c.text} uppercase tracking-widest`,children:t})]}),s.jsx("div",{className:`${c.textMuted} opacity-50`,children:n})]}),s.jsxs("div",{className:"mb-6 relative z-10",children:[s.jsxs("div",{className:"flex items-baseline gap-3 mb-2",children:[s.jsx("span",{className:"text-5xl font-black text-white tracking-tighter font-mono",children:i}),o&&s.jsx(jm,{trend:o})]}),s.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:a})]}),l&&l.length>0&&s.jsx("div",{className:`mb-6 ${c.text} relative z-10`,children:s.jsx(wm,{data:l})}),s.jsx("div",{className:"grid grid-cols-2 gap-4 relative z-10",children:r.map((d,u)=>s.jsxs("div",{className:"bg-white/[0.03] backdrop-blur-sm px-4 py-3 rounded-xl border border-white/5 hover:bg-white/[0.06] transition-colors",children:[s.jsx("span",{className:"block text-[9px] uppercase text-slate-500 mb-1 font-bold tracking-widest",children:d.label}),s.jsx("span",{className:`text-xl font-black font-mono ${d.color?vm[d.color]:"text-white"}`,children:d.value})]},u))})]})}function Nm({risk:e,revenue:t,velocity:n,history:i}){var a,o,r;return s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx(Vs,{type:"risk",title:"Risque Imm√©diat",icon:s.jsx(jt,{size:20}),heroValue:`${Math.round(e.exposedCA/1e3)}k‚Ç¨`,heroLabel:"CA √† Risque",trend:{value:0,percentage:12,direction:"down"},metrics:[{label:"War Room",value:e.warRoomCount,color:"red"},{label:"Retards Ops",value:e.delayCount,color:"orange"}],sparklineData:(a=i==null?void 0:i.risk)!=null&&a.length?i.risk:[120,100,80,60,40,e.exposedCA/1e3]}),s.jsx(Vs,{type:"revenue",title:"Sant√© Revenu",icon:s.jsx(ze,{size:20}),heroValue:`${Math.round(t.securedCA/1e3)}k‚Ç¨`,heroLabel:"CA S√©curis√©",trend:{value:t.securedCA,percentage:18,direction:"up"},metrics:[{label:"Pipeline",value:t.pipelineCount,color:"emerald"},{label:"Avg Ticket",value:`${Math.round(t.avgTicket/1e3)}k‚Ç¨`,color:"blue"}],sparklineData:(o=i==null?void 0:i.revenue)!=null&&o.length?i.revenue:[150,170,180,200,220,230,t.securedCA/1e3]}),s.jsx(Vs,{type:"velocity",title:"V√©locit√© Ops",icon:s.jsx(ll,{size:20}),heroValue:`${n.avgDelayDays.toFixed(1)}j`,heroLabel:"D√©lai Moyen (Depuis Sign√©)",trend:{value:14,percentage:0,direction:"stable"},metrics:[{label:"Actifs",value:n.activeCount,color:"blue"},{label:"Silencieux",value:n.silentCount,color:"orange"}],sparklineData:(r=i==null?void 0:i.velocity)!=null&&r.length?i.velocity:[12,13,14,14,15,14,14]})]})}function Sm({events:e}){return s.jsxs("div",{className:"space-y-4 max-h-[400px] overflow-y-auto pr-4 scrollbar-thin scrollbar-thumb-white/10",children:[e.map(t=>s.jsxs("div",{className:"flex gap-4 p-4 bg-black/40 border border-white/10 rounded-xl hover:border-white/20 transition-all group",children:[s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("div",{className:`w-2 h-2 rounded-full mt-1.5 ${t.type==="email_sent"?"bg-sky-400":t.type==="war_room_entry"?"bg-red-500":t.type==="decision"?"bg-indigo-400":"bg-white/20"}`}),s.jsx("div",{className:"w-[1px] flex-1 bg-white/5 group-last:hidden"})]}),s.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsx("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest font-mono",children:t.time}),s.jsx("span",{className:"text-[9px] font-black text-white/20 uppercase tracking-widest",children:t.type.replace("_"," ")})]}),s.jsx("p",{className:"text-sm font-black text-white uppercase tracking-tight",children:t.label}),s.jsx("p",{className:"text-[11px] text-slate-400 italic font-medium",children:t.detail})]})]},t.id)),e.length===0&&s.jsx("div",{className:"py-12 text-center",children:s.jsx("p",{className:"text-[10px] font-black text-white/20 uppercase tracking-[0.4em] italic",children:"En attente de nouveaux signaux..."})})]})}function zo(e){let t=0;const n=e.days_since_signature??0,i=e.days_since_last_event??0;return e.status==="signed"&&n>14&&!e.deposit_paid&&(t+=60),e.status==="signed"&&n>=8&&n<=14&&!e.deposit_paid&&(t+=40),i>10?t+=25:i>=6&&(t+=15),e.email_optout&&(t+=100),e.deposit_paid&&(t-=40),i<=2&&(t-=15),Math.max(0,Math.min(100,t))}function Ho(e){let t=0;if(e.days_since_last_event==null)return 60;const n=e.days_since_last_event;return n>14?t+=50:n>=7?t+=35:n>=4&&(t+=20),n<=2&&(t-=25),Math.max(0,Math.min(100,t))}function km(e){const t=zo(e),n=Ho(e),a=100-(t*.6+n*.4);return Math.max(0,Math.round(a))}function _m(e){return{study_id:e.study_id,risk_score_ops:zo(e),inertia_score:Ho(e),ops_health_score:km(e)}}function Cm(e){return N.useMemo(()=>e.map(_m),[e])}const Tm=14,Am=7;function Em(e){if(e.status!=="signed")return null;const t=[],n=e.days_since_signature??0,i=e.days_since_last_event??null,a=e.deposit_paid===!0,r=(e.install_cost??0)>0;return n>Tm&&!a&&r?(t.push("D√©lai SRU d√©pass√© sans s√©curisation financi√®re"),{studyId:e.study_id,status:"WAR_ROOM",reasons:t,recommendation:"INTERVENTION IMM√âDIATE ‚Äî s√©curiser ou stopper"}):(n>=Am&&!a&&r&&t.push("Signature ancienne sans acompte"),i!==null&&i>=5&&t.push("Aucune interaction r√©cente apr√®s signature"),t.length>=2?{studyId:e.study_id,status:"WAR_ROOM",reasons:t,recommendation:"S√âCURISER EN URGENCE"}:t.length===1?{studyId:e.study_id,status:"A_SECURISER",reasons:t,recommendation:"Relance cibl√©e pour s√©curisation"}:{studyId:e.study_id,status:"SOUS_CONTROLE",reasons:[],recommendation:"RAS ‚Äî dossier sain"})}function Dm(e){return e.status==="sent"&&!e.signed_at&&!e.deposit_paid}function Rm(e){if(!Dm(e))return null;const t=[],n=e.days_since_last_event??null,i=n!==null&&n>7;let a="NEUTRE";const o=e.interaction_score??0;return o>=60?a="INTERESSE":o>=30?a="AGITE":i&&(a="MUET"),a==="INTERESSE"&&i?(t.push("Client int√©ress√© mais silencieux"),{studyId:e.study_id,status:"A_RELANCER",reasons:t,recommendation:"APPELER_EN_PRIORITE"}):a==="MUET"?(t.push("Client silencieux, risque fatigue"),{studyId:e.study_id,status:"A_SURVEILLER",reasons:t,recommendation:"NE_PAS_RELANCER"}):(t.push("Situation normale"),{studyId:e.study_id,status:"A_SURVEILLER",reasons:t,recommendation:"AUCUNE_ACTION"})}const Mm=30,Pm=7;function Im(e){if(e.status==="signed")return null;if(e.email_optout===!0)return{studyId:e.study_id,status:"A_ABANDONNER",reasons:["Client opt-out (RGPD)"],recommendation:"STOP ‚Äî aucun contact autoris√©"};const n=[],i=e.days_since_last_event??null;return i!==null&&i>=Mm?(n.push("Aucune interaction depuis plus de 30 jours"),{studyId:e.study_id,status:"A_ABANDONNER",reasons:n,recommendation:"STOP ‚Äî lead froid, d√©sengager"}):i!==null&&i<=Pm?(n.push("Interaction r√©cente d√©tect√©e"),{studyId:e.study_id,status:"A_APPELER",reasons:n,recommendation:"APPEL HUMAIN PRIORITAIRE"}):(n.push("Lead passif sans signal fort"),{studyId:e.study_id,status:"A_OBSERVER",reasons:n,recommendation:"Surveiller sans relance agressive"})}function Lm(e){const t=Em(e);if(t){if(t.status==="WAR_ROOM")return{studyId:e.study_id,priority:"WAR_ROOM",sourceAxis:"A",reasons:t.reasons,recommendation:t.recommendation};if(t.status==="A_SECURISER")return{studyId:e.study_id,priority:"PRIORITY_ACTION",sourceAxis:"A",reasons:t.reasons,recommendation:t.recommendation}}const n=Rm(e);if(n){if(n.status==="A_RELANCER")return{studyId:e.study_id,priority:"PRIORITY_ACTION",sourceAxis:"B",reasons:n.reasons,recommendation:n.recommendation};if(n.status==="A_SURVEILLER")return{studyId:e.study_id,priority:"WATCH",sourceAxis:"B",reasons:n.reasons,recommendation:n.recommendation}}const i=Im(e);if(i){if(i.status==="A_APPELER")return{studyId:e.study_id,priority:"PRIORITY_ACTION",sourceAxis:"C",reasons:i.reasons,recommendation:i.recommendation};if(i.status==="A_ABANDONNER")return{studyId:e.study_id,priority:"STOP",sourceAxis:"C",reasons:i.reasons,recommendation:i.recommendation}}const a={studyId:e.study_id,priority:"NONE",sourceAxis:null,reasons:["Aucune action requise"],recommendation:"Aucune"};return a.audit_payload={study_id:e.study_id,action_performed:"NONE",justification:"Situation normale, aucune action",source_axis:null,risk_score:0,health_score:0,created_at:new Date().toISOString()},a}function Om(e){return N.useMemo(()=>e.map(t=>Lm(t)),[e])}function Vm(e,t){return t<e?{severity:"CRITICAL",message:"Rendered value is lower than raw data",recommendation:"Fix scale or clipping in chart renderer",code:"DATA_MISMATCH"}:null}const Fm=["FinancialRiskProofVisx","ProjectionCAVISX","RiskMapVisx","ClientDriftVisx","BehaviorDriftTimelineVisx","KpiCardsLayout"];function Bm(){return{component:"RISQUE FINANCIER",score:100,severity:"OK",issues:[]}}function Um(){return{component:"PROJECTION C.A.",score:100,severity:"OK",issues:[]}}function $m(){return{component:"CARTOGRAPHIE DES RISQUES",score:100,severity:"OK",issues:[]}}function Wm(){return{component:"D√âRIVE CLIENT (DRIFT)",score:100,severity:"OK",issues:[]}}function zm(){return{component:"TIMELINE COMPORTEMENTALE",score:100,severity:"OK",issues:[]}}function Hm(){return{component:"AGENCEMENT CARTES KPI",score:100,severity:"OK",issues:[]}}const qm={FinancialRiskProofVisx:Bm,ProjectionCAVISX:Um,RiskMapVisx:$m,ClientDriftVisx:Wm,BehaviorDriftTimelineVisx:zm,KpiCardsLayout:Hm};function qo(e){const t=[],n=[];for(const o of Fm){const r=qm[o];if(!r)throw new Error(`GOVERNANCE BREACH: Component "${o}" is visible in Cockpit but has NO UX auditor.`);let l;try{l=r()}catch(d){throw new Error(`AUDIT CRASHED for ${o}: ${d}`)}if(!l)throw new Error(`AUDIT FAILURE: Auditor for "${o}" returned no result.`);const c={component:o,...l};o.includes("Cards")||o.includes("KPI")?n.push(c):t.push(c)}const i=[...t.map(o=>o.score),...n.map(o=>o.score),e.dataIntegrityIssues.length?40:100],a=i.length>0?i.reduce((o,r)=>o+r,0)/i.length:100;return{globalScore:Math.round(a),charts:t,cards:n,dataIntegrityIssues:e.dataIntegrityIssues}}const Gm="ux_audit_history";function Km(){return typeof window>"u"?[]:JSON.parse(localStorage.getItem(Gm)||"[]")}const Wa=14,Ym=7,Xm=.6,Zm=3e4,za={DEPOSIT_RECEIVED:-.15,HIGH_INTERACTION:-.1},et={NO_DEPOSIT_EARLY:.1,NO_DEPOSIT_LATE:.25,SILENCE_LOW:.1,SILENCE_CRITICAL:.2,HIGH_AMOUNT:.08,SRU_DANGER_ZONE:.35};function Jm(e){let t=0;const n=[];e.daysSinceSignature>=Wa-2&&(t+=et.SRU_DANGER_ZONE,n.push("SRU danger zone")),e.depositReceived?t+=za.DEPOSIT_RECEIVED:(t+=e.daysSinceSignature>Ym?et.NO_DEPOSIT_LATE:et.NO_DEPOSIT_EARLY,n.push("Deposit not received")),e.interactionScore<20?(t+=et.SILENCE_CRITICAL,n.push("Client silent")):e.interactionScore<40?t+=et.SILENCE_LOW:e.interactionScore>60&&(t+=za.HIGH_INTERACTION),e.amount>Zm&&(t+=et.HIGH_AMOUNT,n.push("High amount"));const i=t>=Xm;return{riskScore:t,warRoom:i,status:e.depositReceived||e.daysSinceSignature>Wa?"LOCKED":i?"DANGER":"EXPOSED",reasons:n}}function Qm(e){return Jm(e)}const ef=({system:e,chartsToAudit:t=[]})=>{const[n,i]=N.useState("IDLE"),[a,o]=N.useState(null),r=async()=>{i("RUNNING"),await new Promise(f=>setTimeout(f,1500));const h=qo({dataIntegrityIssues:[]}),m={decisions:[],uxScore:h.globalScore,dataBreaches:0,uxDetails:h};try{const f=await fetch("/api/ops/audit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)});if(f.ok){const y=await f.json();o(y)}else o(fi(m))}catch(f){console.error("Audit History Save Failed",f),o(fi(m))}i("RESULT")},l=()=>{if(a){console.log("üìÑ Generating PDF with result:",a);try{const h=hl(a),m=document.createElement("a");m.href=h,m.download=`EDF_OPS_AUDIT_REPORT_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(m),m.click(),document.body.removeChild(m)}catch(h){console.error("‚ùå PDF Generation Failed:",h),alert(`Erreur g√©n√©ration PDF: ${h.message}
Voir console pour d√©tails.`)}}};if(n==="IDLE")return s.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-lg transition-colors group",children:[s.jsx(kl,{size:16,className:"text-slate-400 group-hover:text-white"}),s.jsx("span",{className:"text-xs font-bold text-slate-300 group-hover:text-white uppercase tracking-wider",children:"Run Ops & UX Audit"})]});if(n==="RUNNING")return s.jsxs("button",{disabled:!0,className:"flex items-center gap-2 px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg cursor-wait",children:[s.jsx(ul,{size:16,className:"text-blue-500 animate-spin"}),s.jsx("span",{className:"text-xs font-bold text-blue-400 uppercase tracking-wider",children:"Auditing System..."})]});if(!a)return null;const c=a.comparison,d=(c==null?void 0:c.status)==="REGRESSED"||(c==null?void 0:c.uxDelta)<0,u=a.globalScore<60||a.dataIntegrityBreaches>0||d,p=!u&&a.globalScore>=80&&a.dataIntegrityBreaches===0;return s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:()=>i("IDLE"),className:`flex items-center gap-3 px-4 py-2 rounded-lg border ${u?"bg-red-900/20 border-red-500/50":"bg-emerald-900/20 border-emerald-500/50"}`,children:[u?s.jsx(jt,{size:16,className:"text-red-500"}):s.jsx(ze,{size:16,className:"text-emerald-500"}),s.jsxs("div",{className:"flex flex-col items-start text-left",children:[s.jsx("span",{className:`text-[10px] font-black uppercase tracking-wider ${u?"text-red-400":"text-emerald-400"}`,children:u?"AUDIT FAILED":"SYSTEM CERTIFIED"}),s.jsxs("span",{className:"text-xs font-bold text-white",children:["Score: ",a.globalScore,"/100"]})]})]}),s.jsxs("div",{className:"absolute top-full right-0 mt-4 w-[400px] bg-[#0F1629] border border-slate-700 rounded-xl shadow-2xl p-6 z-50 animate-in fade-in slide-in-from-top-2",children:[d&&s.jsxs("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-500 rounded flex items-start gap-3",children:[s.jsx(jt,{className:"text-red-500 shrink-0",size:20}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-red-400 font-bold text-xs uppercase tracking-wider",children:"üö´ REGRESSION DETECTED"}),s.jsxs("p",{className:"text-red-300 text-[10px] mt-1",children:["UX Score dropped by ",Math.abs(c==null?void 0:c.uxDelta)," points.",s.jsx("br",{}),"Deployment is blocked until resolved."]})]})]}),s.jsxs("div",{className:"flex justify-between items-start mb-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-black text-white uppercase tracking-widest",children:"OPS SYSTEM RESULT"}),s.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Generated ",new Date().toLocaleTimeString()]})]}),s.jsx("div",{className:`text-2xl font-black ${u?"text-red-500":"text-emerald-500"}`,children:a.globalScore})]}),s.jsxs("div",{className:"space-y-4 mb-8",children:[s.jsxs("div",{className:"flex justify-between items-center text-sm border-b border-white/5 pb-2",children:[s.jsx("span",{className:"text-slate-400",children:"Data Integrity"}),a.dataIntegrityBreaches>0?s.jsxs("span",{className:"text-red-400 font-bold flex items-center gap-2",children:[s.jsx(jt,{size:12})," ",a.dataIntegrityBreaches," Breach(es)"]}):s.jsxs("span",{className:"text-emerald-400 font-bold flex items-center gap-2",children:[s.jsx(ze,{size:12})," Secure"]})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm border-b border-white/5 pb-2",children:[s.jsx("span",{className:"text-slate-400",children:"UX Readability"}),a.uxScore>=80?s.jsx("span",{className:"text-emerald-400 font-bold",children:"Excellent"}):s.jsx("span",{className:"text-orange-400 font-bold",children:"Needs Work"})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm border-b border-white/5 pb-2",children:[s.jsx("span",{className:"text-slate-400",children:"War Room Exposure"}),a.warRoomCount>0?s.jsxs("span",{className:"text-red-400 font-bold",children:[a.warRoomCount," Critical"]}):s.jsx("span",{className:"text-slate-500 font-bold",children:"None"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("button",{onClick:l,className:"w-full py-3 bg-white text-black font-bold uppercase text-xs rounded hover:bg-slate-200 transition-colors flex items-center justify-center gap-2",children:[s.jsx(wl,{size:14})," Download Official Report"]}),p&&s.jsx("div",{className:"mt-4 pt-4 border-t border-white/10 text-center",children:s.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 bg-emerald-500/10 text-emerald-400 rounded-full border border-emerald-500/30",children:[s.jsx(ze,{size:12}),s.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Dashboard Certified"})]})})]})]})]})},tf=({study:e})=>{const t=N.useMemo(()=>({daysSinceSignature:Math.floor((Date.now()-new Date(e.signed_at||e.created_at).getTime())/864e5),depositReceived:e.deposit_paid||!1,interactionScore:(e.views||0)*10+(e.clicks||0)*20,amount:e.total_price||0}),[e]);return Qm(t),null};function sf({system:e}){var k,C,_,g;const{studies:t,metrics:n,financialStats:i,logs:a}=e,o=N.useMemo(()=>t.filter(x=>{const v=new Date(x.created_at),S=new Date,A=v.getMonth()===S.getMonth()&&v.getFullYear()===S.getFullYear();return A||console.log(`[Cockpit] Cleaning old study: ${x.id} (${x.created_at})`),x.status==="archived"||x.archived?(console.log(`[Cockpit] Cleaning archived study: ${x.id}`),!1):A}).map(x=>{const v=x.signed_at?Math.floor((new Date().getTime()-new Date(x.signed_at).getTime())/864e5):null;let S="ACTIVE";return x.status==="signed"?x.deposit_paid?S="SECURED":v!==null&&v>14?S="SRU_EXPIRED":S="UNSECURED_DELAY":x.behavioralState==="MUET"||x.views===0&&x.clicks===0?S="SILENT":S="ACTIVE",{study_id:x.id,ops_state:S,days_since_signature:v,days_since_last_event:x.diffDays||0,deposit_paid:x.deposit_paid||!1,signed_at:x.signed_at,last_interaction_at:x.last_view||x.last_click||null,install_cost:x.total_price||0,status:x.status,interaction_score:(x.views||0)*10+(x.clicks||0)*20,email_optout:x.email_optout||!1}}),[t]),r=N.useMemo(()=>o.reduce((x,v)=>{const S=v.ops_state||"UNKNOWN";return x[S]=(x[S]||0)+1,x},{ACTIVE:0,SILENT:0,UNSECURED_DELAY:0,SRU_EXPIRED:0,SECURED:0}),[o]);i.totalCA||t.reduce((x,v)=>x+(v.total_price||0),0);const l=i.cashAtRisk||0,c=N.useMemo(()=>Array.from({length:30}).map((v,S)=>{const A=new Date;return A.setDate(A.getDate()-(29-S)),A.toISOString().split("T")[0]}).map(v=>{const S=t.filter(I=>I.created_at<=v),A=new Date(v);A.setHours(23,59,59,999);let M=0,P=0;return S.forEach(I=>{if(!(I.status==="signed"))return;const V=I.deposit_paid_at?new Date(I.deposit_paid_at):null;I.deposit_paid&&V&&V<=A?M+=I.total_price||0:P+=I.total_price||0}),{date:v,securedCA:M,exposedCA:P}}),[t]),d=N.useMemo(()=>(a||[]).slice(0,10).map(v=>({id:v.id,type:v.event_type==="email_sent"?"email_sent":"decision",label:v.title||"Action Syst√®me",time:new Date(v.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),detail:v.description||""})),[a]),u=Cm(o),p=Om(o),h=N.useMemo(()=>qo({dataIntegrityIssues:[]}),[]),m=N.useMemo(()=>Vm(5e5,5e5),[]),[f,y]=N.useState([]);[...h.charts,...h.cards].flatMap(x=>x.issues),h.globalScore;const b=N.useMemo(()=>{const x=h.globalScore,v=(m==null?void 0:m.severity)==="CRITICAL";return x<60||v?{blocked:!0,reason:v?"DATA INTEGRITY BREACH":"UX SCORE TOO LOW (<60)"}:{blocked:!1,reason:null}},[h,m]),[w,j]=N.useState([]);return N.useEffect(()=>{j(Km())},[h.globalScore]),s.jsxs("div",{className:"flex flex-col gap-12 py-8 px-4 max-w-[1200px] mx-auto pb-40",children:[b.blocked&&s.jsxs("div",{className:"bg-red-600 text-white p-6 rounded-2xl border-4 border-red-800 shadow-2xl animate-bounce",children:[s.jsx("h2",{className:"text-2xl font-bold uppercase tracking-widest flex items-center gap-4",children:s.jsx("span",{children:"üö´ DEPLACEMENT BLOQU√â"})}),s.jsxs("p",{className:"font-mono mt-2 text-sm opacity-90",children:["Reason: ",b.reason,s.jsx("br",{}),"Safe decision-making is not guaranteed."]})]}),s.jsxs("header",{className:"p-10 rounded-3xl border border-white/10 bg-black/40 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-8",children:[s.jsx("div",{className:`w-4 h-4 rounded-full shadow-[0_0_15px_rgba(239,68,68,0.5)] animate-pulse ${r.UNSECURED_DELAY>0?"bg-red-500":"bg-emerald-500"}`}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"√âTAT OPS (DB MIRROR)"}),s.jsx("h1",{className:"text-4xl font-black text-white uppercase tracking-tight",children:r.UNSECURED_DELAY>0?"ATTENTION REQUISE":"SYST√àME NOMINAL"})]})]}),s.jsxs("div",{className:"flex gap-8 text-center items-center",children:[s.jsx(ef,{system:e}),s.jsx("div",{className:"h-8 w-px bg-white/10 mx-2"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-black text-white font-mono",children:r.ACTIVE}),s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Actifs"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-black text-orange-400 font-mono",children:r.SILENT}),s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Silencieux"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-black text-red-500 font-mono",children:r.UNSECURED_DELAY}),s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Retard"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-black text-emerald-400 font-mono",children:r.SECURED}),s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"S√©curis√©s"})]})]})]}),s.jsxs("div",{className:"relative overflow-visible rounded-3xl border border-white/10 shadow-2xl",children:[s.jsx("div",{className:"absolute inset-0 bg-[#0F1629]/80 backdrop-blur-xl z-0"}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-900/20 via-transparent to-purple-900/20 pointer-events-none z-0"}),s.jsxs("div",{className:"relative z-10 p-8 space-y-8",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6 border-b border-white/5 pb-8",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white uppercase tracking-tight flex items-center gap-3",children:s.jsx("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-indigo-400",children:"Protection du Chiffre d‚ÄôAffaires"})}),s.jsx("p",{className:"text-slate-500 text-xs font-medium italic mt-2",children:'"V√©rit√© absolue sur la d√©rive entre CA s√©curis√© et CA √† risque (30j)."'})]}),s.jsxs("div",{className:"flex items-center gap-4 bg-white/[0.03] p-2 pr-6 rounded-2xl border border-white/5 shadow-inner backdrop-blur-md",children:[s.jsxs("div",{className:"flex flex-col px-6 py-2 border-r border-white/5",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-400 shadow-[0_0_8px_rgba(52,211,153,0.6)] animate-pulse"}),s.jsx("span",{className:"text-[9px] font-bold text-emerald-400/80 uppercase tracking-widest",children:new Date().toLocaleString("fr-FR",{month:"long"}).toUpperCase()})]}),s.jsxs("span",{className:"text-2xl font-black text-white tracking-tighter font-mono",children:[Math.round(t.filter(x=>x.total_price&&!["cancelled","refused"].includes(x.status)&&x.signed_at&&new Date(x.signed_at).getMonth()===new Date().getMonth()&&new Date(x.signed_at).getFullYear()===new Date().getFullYear()).reduce((x,v)=>x+(v.total_price||0),0)/1e3).toLocaleString("fr-FR")," K‚Ç¨"]})]}),s.jsxs("div",{className:"flex flex-col px-4 py-2 opacity-60",children:[s.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-widest mb-1",children:"Mois Dernier"}),s.jsxs("span",{className:"text-xl font-black text-white/60 tracking-tighter font-mono",children:[Math.round(t.filter(x=>{if(!x.signed_at||["cancelled","refused"].includes(x.status)||!x.total_price)return!1;const v=new Date(x.signed_at),S=new Date,A=S.getMonth()===0?11:S.getMonth()-1,M=S.getMonth()===0?S.getFullYear()-1:S.getFullYear();return v.getMonth()===A&&v.getFullYear()===M}).reduce((x,v)=>x+(v.total_price||0),0)/1e3).toLocaleString("fr-FR")," K‚Ç¨"]})]})]})]}),s.jsx("div",{className:"pt-4 h-[500px] w-full",children:s.jsx(gc,{children:({width:x,height:v})=>s.jsx(bm,{data:c,width:x,height:v})})})]})]}),s.jsx(Nm,{risk:{exposedCA:l,warRoomCount:((k=n==null?void 0:n.warRoom)==null?void 0:k.count)||0,delayCount:r.UNSECURED_DELAY},revenue:{securedCA:(i==null?void 0:i.cashSecured)||0,pipelineCount:(((C=n==null?void 0:n.sent)==null?void 0:C.length)||0)+(((_=n==null?void 0:n.healthy)==null?void 0:_.length)||0),avgTicket:(((g=n==null?void 0:n.signed)==null?void 0:g.length)||0)>0?((i==null?void 0:i.cashSecured)||0)/n.signed.length:0},velocity:{avgDelayDays:(()=>{const x=t.filter(S=>S.status==="signed"&&!S.deposit_paid);return x.length?x.reduce((S,A)=>{const M=A.signed_at?new Date(A.signed_at):new Date(A.created_at),P=Math.floor((new Date().getTime()-M.getTime())/(1e3*3600*24));return S+P},0)/x.length:0})(),activeCount:r.ACTIVE,silentCount:r.SILENT},history:{risk:c.map(x=>x.exposedCA/1e3),revenue:c.map(x=>x.securedCA/1e3),velocity:(e.trafficData||[]).slice(-14).map(x=>x.count+x.opened+x.clicked)}}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 space-y-8",children:[s.jsx("h3",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Preuve d'activit√© (Moteur Brain)"}),s.jsx(Sm,{events:d})]}),n.warRoom.count>0&&s.jsx("div",{className:"fixed bottom-12 left-1/2 -translate-x-1/2 z-50",children:s.jsxs("button",{onClick:()=>e.setActiveSection("war_room"),className:"px-12 py-5 bg-red-600 hover:bg-red-500 text-white font-black uppercase tracking-widest text-xs rounded-2xl shadow-[0_20px_50px_rgba(220,38,38,0.4)] transition-all active:scale-95",children:["Entrer en War Room (",n.warRoom.count,")"]})}),s.jsxs("div",{className:"border-t border-white/10 pt-10 mt-10",children:[s.jsx("h4",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-6",children:"Ops Intelligence (Pure Scoring)"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:u.slice(0,12).map(x=>{const v=t.find(A=>A.id===x.study_id),S=((v==null?void 0:v.client_name)||(v==null?void 0:v.name)||x.study_id.substring(0,8)).toUpperCase();return s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-4 rounded-xl border border-white/5 text-xs flex justify-between items-center group hover:border-white/20 transition-all",children:[s.jsx("span",{className:"text-slate-200 font-mono font-black group-hover:text-white transition-colors",children:S}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("span",{className:"text-[8px] uppercase text-slate-500 font-bold",children:"RISK"}),s.jsx("span",{className:`font-black font-mono ${x.risk_score_ops>50?"text-red-400":"text-emerald-400"}`,children:x.risk_score_ops})]}),s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("span",{className:"text-[8px] uppercase text-slate-500 font-bold",children:"HEALTH"}),s.jsx("span",{className:"font-black font-mono text-blue-400",children:x.ops_health_score})]})]})]},x.study_id)})})]}),s.jsxs("div",{className:"mt-12 pt-12 border-t border-white/5",children:[s.jsx("div",{className:"flex items-center justify-between mb-8",children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute -left-4 top-1 w-1 h-full bg-gradient-to-b from-red-500 to-transparent opacity-50"}),s.jsxs("h3",{className:"text-2xl font-black uppercase text-white tracking-tight flex items-center gap-4 pl-4",children:[s.jsx("div",{className:"p-2 bg-red-500/10 rounded-full border border-red-500/20 shadow-[0_0_20px_rgba(220,38,38,0.2)]",children:s.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"})}),"OPS INTELLIGENCE CENTRE"]}),s.jsx("p",{className:"text-white/30 text-xs font-mono mt-1 pl-16 tracking-widest uppercase",children:"Live Priority Matrix ‚Ä¢ Automated Strategy"})]})}),s.jsxs("div",{className:"overflow-hidden rounded-3xl border border-white/10 bg-black/20 backdrop-blur-2xl shadow-2xl ring-1 ring-white/5",children:[s.jsxs("table",{className:"w-full text-left border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-white/10 bg-white/[0.02]",children:[s.jsx("th",{className:"py-6 px-8 text-[9px] uppercase font-bold text-slate-500 tracking-widest w-1/3",children:"Client Identity"}),s.jsx("th",{className:"py-6 px-8 text-[9px] uppercase font-bold text-slate-500 tracking-widest",children:"Operational Status"}),s.jsx("th",{className:"py-6 px-8 text-[9px] uppercase font-bold text-slate-500 tracking-widest",children:"Strategy Axis"}),s.jsx("th",{className:"py-6 px-8 text-[9px] uppercase font-bold text-slate-500 tracking-widest text-right",children:"Recommended Protocol"})]})}),s.jsx("tbody",{className:"divide-y divide-white/[0.03]",children:p.slice(0,12).map(x=>{const v=t.find(P=>P.id===x.studyId),S=((v==null?void 0:v.client_name)||(v==null?void 0:v.name)||x.studyId.slice(0,12)).toUpperCase(),A=((v==null?void 0:v.city)||"N/A").toUpperCase(),M=x.recommendation.replace(/_/g," ").toUpperCase();return s.jsxs("tr",{className:"group hover:bg-white/[0.04] transition-all duration-300 ease-out",children:[s.jsx("td",{className:"py-5 px-8",children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-slate-700 group-hover:bg-blue-400 transition-colors"}),s.jsx("span",{className:"text-sm font-bold text-slate-200 group-hover:text-white transition-colors tracking-wide",children:S})]}),s.jsxs("div",{className:"flex items-center gap-2 pl-4",children:[s.jsx("span",{className:"text-[9px] font-mono text-white/20 px-1.5 rounded border border-white/5",children:x.studyId.slice(0,4)}),s.jsx("span",{className:"text-[9px] font-bold text-white/30 tracking-wider",children:A})]})]})}),s.jsx("td",{className:"py-5 px-8",children:s.jsxs("div",{className:`
                             inline-flex items-center gap-2 px-4 py-2 rounded-lg border text-[10px] font-black uppercase tracking-widest transition-transform group-hover:scale-105
                             ${x.priority==="WAR_ROOM"?"bg-red-500/20 border-red-500/50 text-red-100 shadow-[0_0_20px_rgba(220,38,38,0.3)]":x.priority==="PRIORITY_ACTION"?"bg-orange-500/10 border-orange-500/30 text-orange-200":x.priority==="WATCH"?"bg-blue-500/10 border-blue-500/30 text-blue-200":"bg-slate-500/5 border-slate-500/20 text-slate-500 opacity-50"}
                          `,children:[x.priority==="WAR_ROOM"&&s.jsx("div",{className:"w-1.5 h-1.5 bg-red-400 rounded-full animate-ping"}),x.priority.replace(/_/g," ")]})}),s.jsx("td",{className:"py-5 px-8",children:x.sourceAxis?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-[9px] font-mono text-white/30",children:"AXIS"}),s.jsx("span",{className:"font-bold text-xs text-white/70 bg-white/5 px-2 py-1 rounded border border-white/10 group-hover:border-white/30 transition-colors",children:x.sourceAxis})]}):s.jsx("span",{className:"text-white/10 text-[10px]",children:"‚Äî"})}),s.jsx("td",{className:"py-5 px-8 text-right",children:s.jsx("span",{className:`
                             text-[10px] font-black uppercase tracking-widest py-1 px-3 rounded
                             ${x.recommendation.includes("RELANCER")?"bg-emerald-500/10 text-emerald-300":"text-slate-500 bg-white/[0.02]"}
                          `,children:M})})]},x.studyId)})})]}),p.length===0&&s.jsxs("div",{className:"p-20 text-center flex flex-col items-center gap-4",children:[s.jsx("div",{className:"w-12 h-12 rounded-full bg-white/5 flex items-center justify-center",children:s.jsx("div",{className:"w-4 h-4 bg-emerald-500 rounded-full"})}),s.jsx("div",{className:"text-white/20 text-xs uppercase tracking-widest font-mono",children:"No active priorities detected"})]})]})]}),s.jsxs("section",{className:"bg-slate-900/50 p-8 rounded-xl border border-dashed border-slate-700 mt-12",children:[s.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-[0.2em] mb-6",children:"UX / DATA INTEGRITY AUDIT (PHASE 3)"}),s.jsxs("div",{className:"grid grid-cols-1 gap-8",children:[m&&s.jsxs("div",{className:`p-4 rounded-lg flex items-start gap-4 border ${m.severity==="CRITICAL"?"bg-red-900/20 border-red-500/50":"bg-green-900/10 border-green-500/30"}`,children:[m.severity==="CRITICAL"?s.jsx(jt,{className:"text-red-500 shrink-0"}):s.jsx(ze,{className:"text-green-500 shrink-0"}),s.jsxs("div",{children:[s.jsxs("h4",{className:`text-xs font-bold uppercase mb-1 ${m.severity==="CRITICAL"?"text-red-400":"text-green-400"}`,children:["DATA INTEGRITY: ",m.severity]}),s.jsx("p",{className:"text-sm text-slate-300",children:m.message}),m.recommendation&&s.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["‚Üí ",m.recommendation]})]})]}),s.jsx("div",{className:"space-y-4",children:[...h.charts,...h.cards].map((x,v)=>s.jsxs("div",{className:"bg-white/5 p-4 rounded border border-white/10",children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("span",{className:"font-mono text-sm text-white font-bold",children:x.component}),s.jsxs("span",{className:`text-xs px-2 py-1 rounded font-bold ${x.score>=80?"bg-green-500/20 text-green-400":x.score>=60?"bg-orange-500/20 text-orange-400":"bg-red-500/20 text-red-400"}`,children:["SCORE: ",x.score,"/100"]})]}),x.issues.length===0?s.jsxs("div",{className:"text-xs text-slate-500 italic flex items-center gap-2",children:[s.jsx(ze,{size:12})," Compliant"]}):s.jsx("ul",{className:"space-y-2",children:x.issues.map((S,A)=>s.jsxs("li",{className:"text-xs bg-black/20 p-2 rounded",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsxs("span",{className:S.severity==="CRITICAL"?"text-red-400":"text-orange-400",children:[S.severity==="CRITICAL"?"üö®":"‚ö†Ô∏è"," [",S.severity,"]"]}),s.jsx("span",{className:"text-slate-300",children:S.description})]}),s.jsxs("div",{className:"pl-6 text-slate-500 italic",children:["‚Üí ",S.remediation]})]},A))})]},v))})]})]}),s.jsxs("section",{className:"mt-8 border-t border-white/5 pt-8",children:[s.jsx("h4",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest mb-4",children:"AUDIT HISTORY (LOCAL STORAGE)"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:w.slice(-5).reverse().map((x,v)=>s.jsxs("div",{className:"text-[9px] font-mono text-slate-500 bg-black/20 px-2 py-1 rounded",children:[s.jsxs("span",{className:x.score<60?"text-red-500":"text-emerald-500",children:[x.score,"/100"]}),s.jsx("span",{className:"opacity-50 mx-1",children:"‚Äî"}),x.chartId,s.jsx("span",{className:"opacity-30 ml-2",children:new Date(x.timestamp).toLocaleTimeString()})]},v))})]}),t.map(x=>s.jsx(tf,{study:x},`ops-probe-${x.id}`))]})}const re={colors:{grid:"rgba(255, 255, 255, 0.05)",axis:"rgba(255, 255, 255, 0.15)",text:"rgba(255, 255, 255, 0.3)",textLight:"rgba(255, 255, 255, 0.5)",bubbles:{safe:"rgba(74, 222, 128, 0.6)",warning:"rgba(251, 191, 36, 0.6)",danger:"rgba(248, 113, 113, 0.7)",critical:"rgba(239, 68, 68, 0.8)"}},fonts:{axis:'"Inter", "SF Pro Display", -apple-system, sans-serif'}},nf=({studies:e,width:t,height:n,onPointClick:i,highlightedStudyId:a})=>{const o={top:40,right:60,bottom:60,left:60},r=t-o.left-o.right,l=n-o.top-o.bottom;if(t<10||n<10)return null;const{showTooltip:c,hideTooltip:d,tooltipData:u,tooltipLeft:p=0,tooltipTop:h=0}=Ya(),m=N.useMemo(()=>e.length===0?null:e.reduce((g,x)=>g.dangerScore>x.dangerScore?g:x),[e]),f=N.useMemo(()=>e.length===0?null:e.reduce((g,x)=>g.totalPrice>x.totalPrice?g:x),[e]),y=N.useMemo(()=>Ae({domain:[14,0],range:[0,r],nice:!0}),[r]),b=Math.max(...e.map(g=>g.totalPrice),2e4),w=N.useMemo(()=>Ae({domain:[0,b*1.1],range:[l,0],nice:!0}),[b,l]),j=N.useMemo(()=>{const g=[...e].sort((v,S)=>S.engagementScore-v.engagementScore),x=new Map;return g.map(v=>{const S=Math.round(v.totalPrice/2e3),M=`${Math.round(v.daysBeforeDeadline)}-${S}`,P=x.get(M)||0;x.set(M,P+1);let I=0,T=0;if(P>0){const V=P*(Math.PI*.82),te=25+(P-1)*10;I=Math.cos(V)*te,T=Math.sin(V)*te}return{...v,dx:I,dy:T}})},[e]),k=N.useMemo(()=>Vl({domain:[0,100],range:[6,24]}),[]),C=g=>g<40?re.colors.bubbles.safe:g<60?re.colors.bubbles.warning:g<80?re.colors.bubbles.danger:re.colors.bubbles.critical,_=(g,x,v,S)=>{c({tooltipData:x,tooltipLeft:v+o.left,tooltipTop:S+o.top})};return s.jsxs(s.Fragment,{children:[s.jsx("svg",{width:t,height:n,className:"overflow-visible",children:s.jsxs(ie,{left:o.left,top:o.top,children:[s.jsx("text",{x:15,y:l-15,fill:re.colors.bubbles.safe,fontSize:9,fontWeight:700,letterSpacing:"0.1em",opacity:.3,children:"ZONE S√âCURIS√âE"}),s.jsx("text",{x:r/2,y:l-15,fill:re.colors.bubbles.warning,fontSize:9,fontWeight:700,letterSpacing:"0.1em",textAnchor:"middle",opacity:.3,children:"ZONE DE VIGILANCE"}),s.jsx("text",{x:r-15,y:25,fill:re.colors.bubbles.critical,fontSize:9,fontWeight:700,letterSpacing:"0.1em",textAnchor:"end",opacity:.5,children:"URGENCE CRITIQUE"}),s.jsx("text",{x:r,y:l+40,fill:re.colors.bubbles.critical,fontSize:10,fontWeight:900,textAnchor:"end",letterSpacing:"0.05em",children:"URGENCE ACCRUE ‚Üí"}),s.jsx(bn,{scale:w,width:r,stroke:re.colors.grid,strokeDasharray:"4,4"}),s.jsx(ht,{top:l,scale:y,numTicks:5,stroke:re.colors.axis,tickStroke:re.colors.axis,tickLabelProps:()=>({fill:re.colors.text,fontSize:10,fontFamily:re.fonts.axis,textAnchor:"middle",fontWeight:600})}),s.jsx(ms,{scale:w,numTicks:4,stroke:"transparent",tickStroke:"transparent",tickLabelProps:()=>({fill:re.colors.text,fontSize:10,fontFamily:re.fonts.axis,textAnchor:"end",verticalAnchor:"middle",fontWeight:600,dx:-10}),tickFormat:g=>`${Math.round(g/1e3)}k‚Ç¨`}),s.jsx(Do,{children:j.map(g=>{const x=a===g.studyId,v=(m==null?void 0:m.studyId)===g.studyId,S=(f==null?void 0:f.studyId)===g.studyId,A=y(g.daysBeforeDeadline),M=w(g.totalPrice),P=A+g.dx,I=M+g.dy;return s.jsxs(ie,{children:[S&&s.jsxs(ps.g,{initial:{opacity:0},animate:{opacity:.6},transition:{delay:1},children:[s.jsx("line",{x1:P,y1:I-k(g.engagementScore)-4,x2:P,y2:I-k(g.engagementScore)-20,stroke:re.colors.textLight,strokeWidth:.5}),s.jsx("text",{x:P,y:I-k(g.engagementScore)-25,fill:re.colors.textLight,fontSize:8,fontWeight:800,textAnchor:"middle",letterSpacing:"0.05em",children:"PLUS GROS ENJEU"})]}),s.jsx(ps.circle,{cx:P,cy:I,r:k(g.engagementScore),initial:{opacity:0,scale:0},animate:{opacity:1,scale:x?1.4:v?1.2:1,strokeOpacity:x||v?1:.2},exit:{opacity:0,scale:0},transition:{duration:.6,ease:[.16,1,.3,1]},fill:C(g.dangerScore),stroke:"white",strokeWidth:x?3:v?2:1,style:{cursor:"pointer",zIndex:x?100:1},whileHover:{scale:1.5,strokeOpacity:1},onMouseEnter:T=>_(T,g,P,I),onMouseLeave:()=>d(),onClick:()=>i&&i(g.studyId)})]},g.studyId)})})]})}),u&&s.jsx(Xa,{top:h-8,left:p,style:{...Za,backgroundColor:"#0F1629",color:"white",border:"none",borderRadius:"4px",padding:"10px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.5)",zIndex:100},children:s.jsxs("div",{className:"flex flex-col gap-0.5",children:[s.jsx("span",{className:"text-[8px] font-bold text-white/30 uppercase tracking-[0.15em] mb-0.5",children:"Focus Dossier"}),s.jsx("p",{className:"text-[11px] font-bold text-white tracking-tight leading-tight",children:u.name}),s.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[7px] text-white/20 uppercase font-black",children:"Potentiel"}),s.jsxs("span",{className:"text-[10px] text-emerald-400 font-mono",children:[Math.round(u.totalPrice).toLocaleString(),"‚Ç¨"]})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[7px] text-white/20 uppercase font-black",children:"Score"}),s.jsxs("span",{className:"text-[10px] text-red-400 font-mono",children:[u.dangerScore,"/100"]})]})]})]})},"tooltip")]})};function af({studies:e,onPointClick:t,highlightedStudyId:n}){return s.jsx("div",{style:{width:"100%",height:"65vh",minHeight:"500px"},children:s.jsx(pt,{children:({width:i,height:a})=>s.jsx(nf,{studies:e,width:i,height:a,onPointClick:t,highlightedStudyId:n})})})}function rf({events:e}){return s.jsxs("div",{className:"flex flex-col gap-6",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute left-[3px] top-4 bottom-4 w-px bg-white/10"}),s.jsx("div",{className:"space-y-8",children:e.map((t,n)=>s.jsxs("div",{className:"flex gap-6 items-start relative",children:[s.jsx("div",{className:`w-2 h-2 rounded-full mt-2 z-10 ${t.type==="signature"?"bg-emerald-400":t.type==="opening"?"bg-sky-400":t.type==="click"?"bg-indigo-400":t.type==="email_sent"?"bg-slate-400":"bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.5)]"}`}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[s.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${t.type==="silence"?"text-red-400":"text-slate-500"}`,children:t.type.replace("_"," ")}),s.jsx("span",{className:"text-[10px] font-mono text-slate-500",children:t.date})]}),s.jsx("p",{className:`text-sm font-black uppercase tracking-tight ${t.type==="silence"?"text-red-200":"text-white"}`,children:t.label})]})]},`${t.type}-${n}`))})]}),e.length===0&&s.jsx("div",{className:"py-8 text-center text-[10px] font-black text-white/10 uppercase tracking-widest",children:"Aucun historique comportemental d√©tect√©"})]})}function of({study:e,recommendation:t,onAction:n}){const i=e.dangerScore>70;return s.jsxs("div",{className:"h-full bg-[#0B0F14] rounded-xl border border-white/5 flex flex-col overflow-hidden backdrop-blur-sm shadow-2xl",children:[s.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-slate-100 tracking-tight mb-1 font-sans",children:e.name}),s.jsxs("div",{className:"flex items-center gap-3 text-sm font-medium font-mono text-slate-500",children:[s.jsxs("span",{className:"text-emerald-400/80",children:[Math.round(e.totalPrice).toLocaleString()," ‚Ç¨"]}),s.jsx("span",{className:"w-1 h-1 rounded-full bg-slate-700"}),s.jsxs("span",{className:i?"text-red-400":"text-amber-400",children:["J-",e.daysBeforeDeadline]})]})]}),s.jsx("div",{className:`
          flex flex-col items-center justify-center w-12 h-12 rounded-lg border 
          ${i?"bg-red-500/5 border-red-500/20 text-red-500":"bg-amber-500/5 border-amber-500/20 text-amber-500"}
        `,children:s.jsx("span",{className:"text-lg font-bold leading-none",children:e.dangerScore})})]}),s.jsxs("div",{className:"flex-1 p-6 space-y-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Analyse Comportementale"}),s.jsxs("p",{className:"text-sm text-slate-300 leading-relaxed border-l-2 border-white/10 pl-3 italic",children:['"',t.reason,'"']})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-white/[0.02] p-3 rounded-lg border border-white/5",children:[s.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase block mb-1",children:"Strat√©gie"}),s.jsx("span",{className:"text-xs font-semibold text-slate-200",children:t.type})]}),s.jsxs("div",{className:"bg-white/[0.02] p-3 rounded-lg border border-white/5",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Urgence"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${i?"bg-red-500 animate-pulse":"bg-amber-500"}`}),s.jsx("span",{className:"text-xs font-semibold text-slate-200 uppercase",children:t.urgency})]})]})]})]}),s.jsx("div",{className:"p-6 border-t border-white/5 bg-white/[0.01]",children:s.jsxs("button",{onClick:()=>n(e.id),className:`
            w-full py-3 px-4 rounded-lg flex items-center justify-center gap-3 transition-all duration-200
            ${i?"bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/20":"bg-white/5 hover:bg-white/10 text-slate-300 border border-white/10"}
          `,children:[s.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:i?"D√©clencher Intervention":"Actions de Relance"}),s.jsx("svg",{className:"w-4 h-4 opacity-70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]})})]})}function lf({system:e}){const{metrics:t,studies:n,logs:i}=e,a=N.useMemo(()=>t.warRoom.studies.map(g=>({studyId:g.id,name:g.name,daysBeforeDeadline:g.daysLate?14-g.daysLate:14,totalPrice:g.total_price||0,dangerScore:g.dangerScore||50,engagementScore:(g.views||0)*10+(g.clicks||0)*20})),[t.warRoom.studies]),[o,r]=N.useState(a.length>0?a[0].studyId:null),[l,c]=N.useState(null),d=a.length,u=a.reduce((g,x)=>g+x.totalPrice,0),p=N.useMemo(()=>(n||[]).find(g=>{var x;return g.id===(o||((x=a[0])==null?void 0:x.studyId))}),[n,o,a]),h=N.useMemo(()=>{if(!p)return[];const g=[];return p.signed_at&&g.push({type:"signature",date:new Date(p.signed_at).toLocaleDateString(),label:"Signature du contrat"}),p.views>0&&g.push({type:"opening",date:"J+1",label:`${p.views} ouvertures d√©tect√©es`}),p.clicks>0&&g.push({type:"click",date:"J+2",label:`${p.clicks} interactions avec l'√©tude`}),p.send_count>0&&g.push({type:"email_sent",date:"J+3",label:"Relance automatique de r√©assurance"}),p.behavioralState==="MUET"&&g.push({type:"silence",date:"Aujourd'hui",label:"Silence prolong√© - Risque d'annulation √©lev√©"}),g},[p]),m=N.useMemo(()=>(n||[]).filter(g=>g.status==="sent"),[n]),f=N.useMemo(()=>m.filter(g=>g.behavioralState==="INT√âRESS√â"),[m]),y=N.useMemo(()=>m.filter(g=>g.behavioralState==="AGIT√â"),[m]),b=N.useMemo(()=>m.filter(g=>g.behavioralState==="MUET"&&g.diffDays<7),[m]),w=N.useMemo(()=>m.filter(g=>g.behavioralState==="FATIGUE"),[m]),j=N.useMemo(()=>(e.emailLeads||[]).filter(g=>!g.study_id),[e.emailLeads]),k=N.useMemo(()=>j.filter(g=>g.total_clicks>=1),[j]),C=N.useMemo(()=>j.filter(g=>g.total_clicks===0&&g.total_opens>=1),[j]),_=N.useMemo(()=>j.filter(g=>g.total_clicks===0&&g.total_opens===0),[j]);return s.jsxs("div",{className:"flex flex-col gap-12 py-8 px-4 max-w-[1400px] mx-auto pb-40",children:[s.jsxs("header",{className:"flex flex-col gap-1",children:[s.jsx("h1",{className:"text-3xl font-black text-slate-100 tracking-tight uppercase",children:"War Room Operations"}),s.jsx("p",{className:"text-slate-500 text-[10px] font-bold uppercase tracking-widest",children:"Concentration humaine sur le CA r√©cup√©rable"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8 items-start",children:[s.jsxs("div",{className:"lg:col-span-8 xl:col-span-9 space-y-6",children:[s.jsxs("div",{className:"bg-black/40 backdrop-blur-md rounded-2xl border border-white/10 overflow-hidden shadow-2xl relative",children:[s.jsxs("div",{className:"absolute top-6 left-6 z-10 pointer-events-none",children:[s.jsxs("h2",{className:"text-lg font-black text-white tracking-tight uppercase",children:["Focus D√©cisionnel ‚Äî ",d," Dossiers en Zone de Danger"]}),s.jsxs("p",{className:"text-slate-500 text-[10px] font-bold uppercase tracking-widest mt-1",children:["EXPOSITION TOTALE : ",s.jsxs("span",{className:"font-mono",children:[Math.round(u).toLocaleString("fr-FR")," ‚Ç¨"]})]})]}),s.jsxs("div",{className:"pt-10",children:[" ",s.jsx(af,{studies:a,onPointClick:r,highlightedStudyId:l})]})]}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm rounded-xl border border-white/10 overflow-hidden",children:[s.jsxs("div",{className:"px-6 py-4 border-b border-white/10 flex justify-between items-center bg-white/[0.01]",children:[s.jsxs("h3",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:["Dossiers en Alerte (",a.length,")"]}),s.jsx("span",{className:"text-[9px] text-slate-600 font-mono uppercase tracking-widest",children:"Sync: Active"})]}),s.jsxs("div",{className:"divide-y divide-white/[0.03]",children:[a.slice(0,5).map(g=>s.jsxs("button",{onClick:()=>r(g.studyId),onMouseEnter:()=>c(g.studyId),onMouseLeave:()=>c(null),className:`w-full px-6 py-3 flex justify-between items-center hover:bg-white/[0.02] transition-colors group ${o===g.studyId?"bg-white/[0.04]":""}`,children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${g.dangerScore>70?"bg-red-500":"bg-amber-500"}`}),s.jsx("span",{className:`text-sm font-black uppercase tracking-tight ${o===g.studyId?"text-white":"text-slate-400 group-hover:text-slate-200"}`,children:g.name})]}),s.jsxs("div",{className:"flex items-center gap-1 text-[11px] font-mono text-slate-500",children:[s.jsxs("span",{className:"w-14 text-right inline-block font-black",children:[Math.round(g.totalPrice/1e3),"k‚Ç¨"]}),s.jsxs("span",{className:`w-12 text-right inline-block font-black ${g.daysBeforeDeadline<5?"text-red-400":"text-blue-400"}`,children:["J-",g.daysBeforeDeadline]}),s.jsxs("span",{className:"text-slate-600 w-10 text-right inline-block font-black",children:[g.dangerScore,"%"]})]})]},g.studyId)),a.length>5&&s.jsx("div",{className:"px-6 py-2 text-center border-t border-white/5",children:s.jsxs("span",{className:"text-[10px] text-slate-600 uppercase tracking-widest",children:["+ ",a.length-5," autres dossiers"]})})]})]})]}),s.jsx("div",{className:"lg:col-span-4 xl:col-span-3 space-y-6",children:p?s.jsxs(s.Fragment,{children:[s.jsx(of,{study:{id:p.id,name:p.name,totalPrice:p.total_price||0,dangerScore:p.dangerScore||50,daysBeforeDeadline:p.daysLate?14-p.daysLate:14},recommendation:{type:"Appel T√©l√©phonique",reason:p.behavioralState==="MUET"?"Silence prolong√© post-signature. Suspicion de doute.":"Baisse d'engagement suspecte sur l'√©tude.",urgency:(p.dangerScore||0)>70?"high":"medium"},onAction:g=>console.log("Action human intervention launched for",g)}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-10 rounded-xl border border-white/10 space-y-8",children:[s.jsx("h3",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:"D√©rive Comportementale"}),s.jsx(rf,{events:h})]})]}):s.jsx("div",{className:"h-full flex items-center justify-center p-20 text-center",children:s.jsx("p",{className:"text-[10px] font-black text-white/20 uppercase tracking-[0.4em] italic",children:"S√©lectionnez un dossier pour lancer l'analyse"})})})]}),s.jsxs("div",{className:"border-t border-white/10 pt-12 mt-8",children:[s.jsx("h2",{className:"text-xl font-black text-white uppercase tracking-tight mb-8",children:"AXE A ‚Äî DOSSIERS SIGN√âS (ANTI-ANNULATION)"}),(()=>{const x=(e.studies||[]).filter(T=>T.status==="signed"),v=T=>{const V=T.signed_at?Math.floor((new Date().getTime()-new Date(T.signed_at).getTime())/864e5):0,te=T.dangerScore||0;return T.contract_secured?V>30?"HORS_PERIMETRE":"SOUS_CONTROLE":te>=70||!T.deposit_paid&&V>7?"WAR_ROOM":!T.deposit_paid||T.behavioralState==="AGIT√â"?"A_SECURISER":"SOUS_CONTROLE"},S=T=>T.deposit_paid?"PAY√â ‚úÖ":T.has_deposit&&!T.deposit_paid?"EN ATTENTE ‚ö†Ô∏è":"NON REQUIS ‚ûñ",A=x.filter(T=>v(T)==="WAR_ROOM"),M=x.filter(T=>v(T)==="A_SECURISER"),P=x.filter(T=>v(T)==="SOUS_CONTROLE"),I=x.filter(T=>v(T)==="HORS_PERIMETRE");return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8 mb-12",children:[s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-red-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"War Room"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:A.length})]}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-amber-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"√Ä S√©curiser"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:M.length})]}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-emerald-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Sous Contr√¥le"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:P.length})]}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-8 rounded-xl border border-white/10 opacity-30",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest",children:"Hors P√©rim√®tre"}),s.jsx("p",{className:"text-3xl font-black text-slate-600 mt-1 font-mono",children:I.length})]})]}),s.jsxs("div",{className:"bg-[#0B0F14] rounded-2xl border border-white/5 overflow-hidden",children:[s.jsx("div",{className:"px-8 py-4 border-b border-white/5 bg-white/[0.01]",children:s.jsxs("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:["Dossiers √† S√©curiser (",A.length+M.length,")"]})}),s.jsxs("div",{className:"divide-y divide-white/[0.03]",children:[[...A,...M].length===0&&s.jsx("div",{className:"p-8 text-center text-white/20 text-xs uppercase tracking-widest",children:"Aucun dossier critique"}),[...A,...M].map(T=>{const V=v(T)==="WAR_ROOM",te=T.last_click||T.last_open||T.signed_at,W=T.signed_at?Math.floor((new Date().getTime()-new Date(T.signed_at).getTime())/(1e3*60*60*24)):0;return s.jsxs("div",{className:`p-6 flex items-center justify-between hover:bg-white/[0.02] transition-colors ${V?"bg-red-500/5":""}`,children:[s.jsx("div",{className:"w-[35%]",children:s.jsxs("div",{className:"flex items-center gap-2",children:[V&&s.jsx("span",{className:"text-lg",children:"üö®"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-white font-black text-sm truncate pr-2 uppercase tracking-tight",children:T.name}),s.jsxs("p",{className:"text-slate-500 text-[10px] font-bold uppercase",children:["Sign√© il y a ",s.jsx("span",{className:"font-mono",children:W})," jours"]})]})]})}),s.jsxs("div",{className:"w-[15%]",children:[s.jsx("p",{className:"text-white/40 text-[10px] uppercase tracking-wider mb-1",children:"Acompte"}),(()=>{const F=S(T);return s.jsx("span",{className:`text-xs font-bold uppercase ${F.includes("PAY√â")?"text-emerald-400":F.includes("EN COURS")?"text-blue-400":"text-orange-400"}`,children:F})})()]}),s.jsxs("div",{className:"w-[20%] flex flex-col items-end",children:[s.jsxs("p",{className:"text-white font-bold text-sm",children:[Math.round(T.total_price).toLocaleString("fr-FR")," ‚Ç¨"]}),s.jsx("p",{className:"text-white/40 text-[10px] uppercase tracking-wider mt-1 text-right",children:te?s.jsxs(s.Fragment,{children:["Interaction il y a ",Math.floor((new Date().getTime()-new Date(te).getTime())/(1e3*60*60*24))," j"]}):"Aucune interaction"})]}),s.jsx("div",{className:"w-[30%] flex justify-end pl-4",children:s.jsx("div",{className:`px-4 py-2 rounded-lg border ${V?"bg-red-500/5 border-red-500/10":"bg-amber-500/5 border-white/5"} whitespace-nowrap`,children:s.jsx("p",{className:`${V?"text-red-400":"text-slate-400"} text-[10px] font-bold uppercase tracking-widest`,children:V?"URGENCE : S√âCURISER":"ACTION : S√âCURISER"})})})]},T.id)})]})]})]})})()]}),s.jsxs("div",{className:"border-t border-white/5 pt-16 mt-16",children:[s.jsxs("header",{className:"mb-10",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Retention Strategy"}),s.jsx("h2",{className:"text-2xl font-black text-slate-100 tracking-tight mt-1 uppercase",children:"AXE B ‚Äî Post-Pr√©sentation sans Signature"}),s.jsxs("p",{className:"text-amber-500/60 text-[10px] font-bold uppercase tracking-widest mt-2",children:["Impact : ",s.jsx("span",{className:"font-mono",children:f.length})," Relances Prioritaires en attente"]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8 mb-12",children:[s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-red-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Priorit√© Relance"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:f.length})]}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-amber-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"√Ä Surveiller"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:y.length})]}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-blue-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"R√©veil N√©cessaire"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:b.length})]}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-8 rounded-xl border border-white/10 opacity-30",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest",children:"Interruption (Stop)"}),s.jsx("p",{className:"text-3xl font-black text-slate-600 mt-1 font-mono",children:w.length})]})]}),s.jsxs("div",{className:"overflow-hidden rounded-xl border border-white/10 bg-black/20 backdrop-blur-sm shadow-2xl",children:[s.jsx("div",{className:"px-6 py-4 border-b border-white/10 bg-white/[0.01]",children:s.jsxs("h3",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-3",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full animate-pulse shadow-[0_0_8px_rgba(245,158,11,0.5)]"}),"Priorit√© Relance (",f.length,")"]})}),s.jsxs("table",{className:"w-full text-left border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-white/10 bg-white/[0.02]",children:[s.jsx("th",{className:"py-4 px-6 text-[9px] uppercase font-bold text-slate-500 tracking-widest",children:"Client Identity"}),s.jsx("th",{className:"py-4 px-6 text-[9px] uppercase font-bold text-slate-500 tracking-widest",children:"Potentiel"}),s.jsx("th",{className:"py-4 px-6 text-[9px] uppercase font-bold text-slate-500 tracking-widest text-right",children:"Last Interaction"}),s.jsx("th",{className:"py-4 px-6 text-[9px] uppercase font-bold text-slate-500 tracking-widest text-right",children:"Action"})]})}),s.jsx("tbody",{className:"divide-y divide-white/[0.03]",children:f.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:4,className:"p-8 text-center text-white/20 text-xs uppercase tracking-widest font-mono",children:"Aucun dossier √† relancer"})}):f.map(g=>{var A;const x=g.last_click||g.last_open||g.created_at,v=((A=g.clients)==null?void 0:A.phone)||g.phone||"N/A",S=(g.client_name||g.name||"CLIENT INCONNU").toUpperCase();return s.jsxs("tr",{className:"group hover:bg-white/[0.04] transition-all duration-300 ease-out",children:[s.jsx("td",{className:"py-4 px-6",children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("span",{className:"text-sm font-black text-slate-200 group-hover:text-white transition-colors tracking-wide uppercase",children:S}),s.jsx("span",{className:"text-[10px] font-mono text-white/30",children:v})]})}),s.jsx("td",{className:"py-4 px-6",children:s.jsxs("span",{className:"text-emerald-400 font-bold font-mono text-xs bg-emerald-500/10 px-2 py-1 rounded border border-emerald-500/20",children:[Math.round(g.total_price).toLocaleString("fr-FR")," ‚Ç¨"]})}),s.jsx("td",{className:"py-4 px-6 text-right",children:s.jsx("span",{className:"text-white/40 text-[10px] font-mono uppercase",children:(()=>{if(!x)return"N/A";const M=Math.floor((new Date().getTime()-new Date(x).getTime())/(1e3*60*60*24));return M===0?"Aujourd'hui":`il y a ${M}j`})()})}),s.jsx("td",{className:"py-4 px-6 text-right",children:s.jsx("button",{className:"bg-white/5 hover:bg-white/10 text-slate-300 text-[10px] font-bold uppercase tracking-widest px-4 py-2 rounded-lg border border-white/10 transition-all",children:"Lancer Appel"})})]},g.id)})})]})]})]}),s.jsxs("div",{className:"border-t border-white/5 pt-16 mt-16",children:[s.jsxs("header",{className:"mb-10",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Acquisition Control"}),s.jsx("h2",{className:"text-2xl font-black text-slate-100 tracking-tight mt-1 uppercase",children:"AXE C ‚Äî Leads Qualifi√©s jamais joints"}),s.jsxs("p",{className:"text-red-500/60 text-[10px] font-bold uppercase tracking-widest mt-2",children:["Priorit√© : ",s.jsx("span",{className:"font-mono",children:k.length})," Appels Recommand√©s"]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12",children:[s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-red-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Priorit√© Appel"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:k.length})]}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-amber-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Observation Active"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:C.length})]}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-8 rounded-xl border border-white/10 opacity-30",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest",children:"Interruption (Abandon)"}),s.jsx("p",{className:"text-3xl font-black text-slate-600 mt-1 font-mono",children:_.length})]})]}),s.jsxs("div",{className:"bg-[#0B0F14] rounded-xl border border-white/5 overflow-hidden shadow-2xl",children:[s.jsx("div",{className:"px-6 py-4 border-b border-white/5 bg-white/[0.01]",children:s.jsxs("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:["Priorit√© Appel (",k.length,")"]})}),s.jsx("div",{className:"divide-y divide-white/[0.03]",children:k.length===0?s.jsx("div",{className:"p-8 text-center text-slate-500 text-xs uppercase tracking-widest",children:"Aucun lead √† rappeler"}):k.map(g=>s.jsxs("div",{className:"p-6 flex items-center justify-between hover:bg-white/[0.02] transition-colors",children:[s.jsxs("div",{className:"w-[40%]",children:[s.jsx("p",{className:"text-white font-bold text-sm tracking-tight",children:g.client_name.toUpperCase()}),s.jsx("p",{className:"text-slate-500 text-xs mt-0.5",children:g.client_email})]}),s.jsxs("div",{className:"w-[30%] text-right",children:[s.jsx("p",{className:"text-slate-500 text-[9px] uppercase tracking-wider mb-1",children:"Derni√®re interaction"}),s.jsx("p",{className:"text-slate-300 font-mono text-xs",children:(()=>{if(!g.last_clicked_at)return"N/A";const x=Math.floor((new Date().getTime()-new Date(g.last_clicked_at).getTime())/(1e3*60*60*24));return x===0?"Aujourd'hui":`il y a ${x}j`})()})]}),s.jsx("div",{className:"w-[30%] flex justify-end",children:s.jsx("div",{className:"px-4 py-2 bg-red-500/5 rounded-lg border border-red-500/20",children:s.jsx("p",{className:"text-red-400 text-[10px] font-bold uppercase tracking-widest italic",children:"Intervention Recommand√©e"})})})]},g.id))})]})]})]})}function cf({data:e}){const t=e.securedCA+e.exposedCA+e.cancelledCA,n=t>0?e.securedCA/t*100:0,i=t>0?e.exposedCA/t*100:0,a=t>0?e.cancelledCA/t*100:0;return s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{className:"w-full h-10 bg-white/5 rounded-lg overflow-hidden flex border border-white/10 shadow-lg",children:[s.jsx("div",{style:{width:`${n}%`},className:"h-full bg-[#4ADE80] opacity-80 shadow-[inset_0_1px_2px_rgba(255,255,255,0.1)] transition-all duration-700",title:`S√©curis√©: ${e.securedCA.toLocaleString()}‚Ç¨`}),s.jsx("div",{style:{width:`${i}%`},className:"h-full bg-[#F59E0B] opacity-70 shadow-[inset_0_1px_2px_rgba(255,255,255,0.1)] transition-all duration-700",title:`Expos√©: ${e.exposedCA.toLocaleString()}‚Ç¨`}),s.jsx("div",{style:{width:`${a}%`},className:"h-full bg-[#F87171] opacity-60 shadow-[inset_0_1px_2px_rgba(255,255,255,0.1)] transition-all duration-700",title:`Annul√©: ${e.cancelledCA.toLocaleString()}‚Ç¨`})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-8 px-2",children:[s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-[#4ADE80]"}),s.jsx("span",{className:"text-xs font-bold text-white/40 uppercase tracking-[0.2em]",children:"S√©curis√©"})]}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsxs("span",{className:"text-2xl font-bold text-white/90 tabular-nums",children:[Math.round(n),"%"]}),s.jsxs("span",{className:"text-sm font-bold text-white/20 tracking-tight",children:["(",Math.round(e.securedCA/1e3),"k‚Ç¨)"]})]})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-[#F59E0B]"}),s.jsx("span",{className:"text-xs font-bold text-white/40 uppercase tracking-[0.2em]",children:"Expos√©"})]}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsxs("span",{className:"text-2xl font-bold text-white/90 tabular-nums",children:[Math.round(i),"%"]}),s.jsxs("span",{className:"text-sm font-bold text-white/20 tracking-tight",children:["(",Math.round(e.exposedCA/1e3),"k‚Ç¨)"]})]})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-[#F87171]"}),s.jsx("span",{className:"text-xs font-bold text-white/40 uppercase tracking-[0.2em]",children:"Annul√©"})]}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsxs("span",{className:"text-2xl font-bold text-white/90 tabular-nums",children:[Math.round(a),"%"]}),s.jsxs("span",{className:"text-sm font-bold text-white/20 tracking-tight",children:["(",Math.round(e.cancelledCA/1e3),"k‚Ç¨)"]})]})]})]})]})}const Xt={line:"#38BDF8",area:"#38BDF8",axis:"#ffffff20"},df=({data:e,width:t,height:n})=>{if(t<10||n<10)return null;const i={top:20,right:30,bottom:50,left:60},a=Math.max(0,t-i.left-i.right),o=Math.max(0,n-i.top-i.bottom),r=N.useMemo(()=>Ae({domain:[0,14],range:[0,a]}),[a]),l=N.useMemo(()=>Ae({domain:[0,100],range:[o,0],nice:!0}),[o]),c=N.useMemo(()=>!e||!e.length?null:e.reduce((d,u)=>d.activeRate>u.activeRate?d:u),[e]);return s.jsx("svg",{width:t,height:n,children:s.jsxs(ie,{left:i.left,top:i.top,children:[s.jsx("rect",{x:r(7),y:0,width:Math.max(0,r(14)-r(7)),height:o,fill:"#F59E0B",fillOpacity:.04}),s.jsx("line",{x1:r(7),y1:0,x2:r(7),y2:o,stroke:"#F59E0B",strokeWidth:1,strokeDasharray:"4,4",opacity:.3}),s.jsx("line",{x1:r(14),y1:0,x2:r(14),y2:o,stroke:"#F87171",strokeWidth:1,strokeDasharray:"4,4",opacity:.3}),s.jsx("text",{x:r(10.5),y:20,fill:"#F59E0B",fontSize:10,fontWeight:"700",textAnchor:"middle",className:"uppercase tracking-[0.2em] opacity-40 hover:opacity-100 transition-opacity",children:"Zone critique churn"}),s.jsx(Ct,{data:e,x:d=>r(d.day),y:d=>l(d.activeRate),yScale:l,fill:Xt.area,fillOpacity:.05,curve:we}),s.jsx(lt,{data:e,x:d=>r(d.day),y:d=>l(d.activeRate),stroke:Xt.line,strokeWidth:4,strokeOpacity:.9,curve:we}),c&&s.jsxs(ie,{children:[s.jsx("circle",{cx:r(c.day),cy:l(c.activeRate),r:5,fill:"#F87171",className:"animate-pulse"}),s.jsx("text",{x:r(c.day),y:l(c.activeRate)-15,fill:"#F87171",fontSize:10,fontWeight:"bold",textAnchor:"middle",className:"font-sans uppercase tracking-widest",children:"Pic d√©crochage"})]}),s.jsx(ht,{top:o,scale:r,stroke:"transparent",tickStroke:Xt.axis,tickLabelProps:()=>({fill:"#ffffff20",fontSize:10,fontWeight:"bold",className:"font-sans",textAnchor:"middle"}),tickValues:[0,2,4,6,8,10,12,14],tickFormat:d=>`J+${d}`}),s.jsx(ms,{scale:l,stroke:"transparent",tickStroke:Xt.axis,tickLabelProps:()=>({fill:"#ffffff20",fontSize:10,fontWeight:"bold",className:"font-sans",textAnchor:"end",verticalAnchor:"middle",dx:-4}),tickValues:[0,25,50,75,100],tickFormat:d=>`${d}%`})]})})};function uf({data:e}){return s.jsx("div",{style:{width:"100%",height:"350px"},children:s.jsx(pt,{children:({width:t,height:n})=>s.jsx(df,{data:e,width:t,height:n})})})}const hf=({leads:e,visited:t,signed:n,waitingSignatureStudies:i=[],waitingDepositStudies:a=[],secured:o,securedAmount:r=0})=>{const l=Math.max(e,1),c=t?Math.round(n/t*100):0,d=e?Math.round(t/e*100):0,u=e?Math.round(n/e*100):0,p=Math.max(0,e-t),h=i.length,m=a.length,f=o,y=e>0,b=e?t/e*100:0,w=t?n/t*100:0,j=n?o/n*100:0,k=Math.min(b,w,j)===b?"Qualification":Math.min(b,w,j)===w?"Closing":"Administratif";return s.jsxs("div",{className:"w-full space-y-12",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-end gap-6 border-l-4 border-emerald-500 pl-8 py-2",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-[9px] tracking-[0.4em] text-emerald-400 font-black uppercase",children:"S03 ‚Äî Pipeline Momentum"}),s.jsx("h1",{className:"text-4xl font-black text-white tracking-tight uppercase",children:"Trajectoire Dossiers"}),s.jsx("p",{className:"text-white/40 text-[10px] uppercase font-bold tracking-widest",children:"Donn√©es d√©doublonn√©es par email ¬∑ 1 Email = 1 Dossier"})]}),s.jsxs("div",{className:"flex gap-12",children:[s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-4xl font-black text-white font-mono tracking-tighter tabular-nums",children:e}),s.jsx("div",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-widest",children:"Leads Entrants"})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-4xl font-black text-emerald-400 font-mono tracking-tighter tabular-nums",children:r>0?`${Math.round(r/1e3)}k‚Ç¨`:o}),s.jsx("div",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-widest",children:"Valeur Encaiss√©e"})]})]})]}),s.jsx("div",{className:"relative bg-black/60 rounded-[2.5rem] p-12 border border-white/5 shadow-2xl backdrop-blur-xl overflow-hidden",children:y?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"relative h-6 mb-2 flex",children:[s.jsx("div",{style:{width:`${f/l*100}%`},className:"relative",children:s.jsx("span",{className:"absolute right-0 bottom-0 text-[10px] font-black text-emerald-400 uppercase translate-x-1/2",children:f})}),s.jsx("div",{style:{width:`${m/l*100}%`},className:"relative",children:s.jsx("span",{className:"absolute right-0 bottom-0 text-[10px] font-black text-white/40 uppercase translate-x-1/2",children:n})}),s.jsx("div",{style:{width:`${h/l*100}%`},className:"relative",children:s.jsx("span",{className:"absolute right-0 bottom-0 text-[10px] font-black text-white/30 uppercase translate-x-1/2",children:t})}),s.jsx("div",{style:{width:`${p/l*100}%`},className:"relative",children:s.jsx("span",{className:"absolute right-0 bottom-0 text-[10px] font-black text-white/20 uppercase",children:e})})]}),s.jsxs("div",{className:"relative h-20 mb-12 flex gap-1 items-center",children:[s.jsxs("div",{className:"h-full bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-l-2xl relative group transition-all duration-700",style:{width:`${Math.max(f/l*100,2)}%`},children:[s.jsx("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"}),s.jsx("div",{className:"absolute -top-8 left-0 text-[8px] font-black text-emerald-400 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all",children:"S√âCURIS√â"})]}),s.jsxs("div",{className:"h-2/3 bg-white/10 border border-white/10 relative group transition-all duration-700",style:{width:`${m/l*100}%`},children:[s.jsx("div",{className:"absolute inset-0 bg-orange-500/10 opacity-0 group-hover:opacity-100 transition-opacity"}),m>0&&s.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-black text-white/20",children:["-",m]}),s.jsx("div",{className:"absolute -top-8 left-0 text-[8px] font-black text-white/40 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all whitespace-nowrap",children:"ATTENTE ACOMPTE"})]}),s.jsxs("div",{className:"h-1/2 bg-white/5 border border-white/5 relative group transition-all duration-700",style:{width:`${h/l*100}%`},children:[s.jsx("div",{className:"absolute inset-0 bg-blue-500/5 opacity-0 group-hover:opacity-100 transition-opacity"}),h>0&&s.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-black text-white/10",children:["-",h]}),s.jsx("div",{className:"absolute -top-8 left-0 text-[8px] font-black text-white/30 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all whitespace-nowrap",children:"VISIT√â ¬∑ SANS CONTRAT"})]}),s.jsxs("div",{className:"h-1/4 bg-white/[0.02] border border-white/[0.02] rounded-r-2xl relative group transition-all duration-700",style:{width:`${p/l*100}%`},children:[s.jsx("div",{className:"absolute inset-0 bg-slate-500/[0.02] opacity-0 group-hover:opacity-100 transition-opacity"}),p>0&&s.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-black text-white/[0.05]",children:["-",p]}),s.jsx("div",{className:"absolute -top-8 right-0 text-[8px] font-black text-white/20 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all whitespace-nowrap",children:"LEADS BRUTS"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-12",children:[s.jsx(Fs,{label:"Qualit√© Commerciale",rate:c,lostLabel:"Visites sans contrat",loss:h,color:"text-emerald-400",subLabel:"Sign√©s / Total Visites"}),s.jsx(Fs,{label:"P√©n√©tration Prospect",rate:d,lostLabel:"Leads sans Dossier",loss:p,color:"text-cyan-400",subLabel:"Dossiers / Total Leads"}),s.jsx(Fs,{label:"Conversion Totale",rate:u,lostLabel:"Dossiers non sign√©s",loss:p+h,color:"text-white",subLabel:"Sign√©s / Total Leads"})]})]}):s.jsx("div",{className:"h-32 flex items-center justify-center text-white/20 uppercase font-black tracking-widest italic",children:"Aucune donn√©e de pipeline disponible"})}),s.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsx(Zt,{label:"Conversion Vente",value:`${c}%`,color:"text-emerald-400",sub:"Sign√©s vs Visit√©s"}),s.jsx(Zt,{label:"Taux P√©n√©tration",value:`${d}%`,color:"text-sky-400",sub:"Visit√©s vs Leads"}),s.jsx(Zt,{label:"Bottleneck",value:k,color:"text-orange-400",sub:"Point critique",isTextValue:!0}),s.jsx(Zt,{label:"En Attente",value:h+m,color:"text-white",sub:"Dossiers √† d√©bloquer",hoverList:[...i,...a]})]})]})},Fs=({label:e,rate:t,loss:n,lostLabel:i,color:a,subLabel:o})=>s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-baseline",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[10px] font-black text-white uppercase tracking-[0.2em]",children:e}),s.jsx("span",{className:"text-[9px] font-bold text-white/40 uppercase",children:o})]}),s.jsxs("span",{className:`text-3xl font-black font-mono tracking-tighter ${a}`,children:[t,"%"]})]}),s.jsx("div",{className:"h-1 bg-white/5 rounded-full overflow-hidden",children:s.jsx("div",{className:`h-full ${a.replace("text-","bg-")} opacity-60 transition-all duration-1000`,style:{width:`${t}%`}})}),s.jsx("div",{className:"flex flex-col gap-1",children:s.jsxs("span",{className:"text-[10px] font-mono text-red-500/60 font-bold uppercase tracking-wider tabular-nums",children:["-",n," ",i]})})]}),Zt=({label:e,value:t,color:n,sub:i,isTextValue:a=!1,hoverList:o})=>s.jsxs("div",{className:"bg-black/40 rounded-3xl p-6 border border-white/5 hover:border-white/20 transition-all duration-300 shadow-lg group relative",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("div",{className:"text-[10px] text-white/30 uppercase font-black tracking-widest mb-1",children:e}),s.jsx("div",{className:"text-[9px] text-white/20 uppercase font-bold tracking-widest mb-4",children:i})]}),s.jsx("div",{className:`${a?"text-xl":"text-3xl"} font-black font-mono tracking-tighter ${n} truncate transition-transform duration-300 group-hover:scale-105 origin-left`,children:t}),o&&o.length>0&&s.jsxs("div",{className:"absolute bottom-full left-0 mb-4 w-64 bg-[#0a0e27] border border-white/10 rounded-2xl p-4 shadow-2xl opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity z-50",children:[s.jsx("div",{className:"text-[8px] font-black text-white/30 uppercase tracking-[0.2em] mb-4 border-b border-white/5 pb-2",children:"D√©tail des dossiers"}),s.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2 pr-2 custom-scrollbar",children:o.map((r,l)=>s.jsxs("div",{className:"flex justify-between items-center gap-4",children:[s.jsx("span",{className:"text-[10px] font-black text-white truncate uppercase",children:r.name||"Inconnu"}),s.jsx("span",{className:"text-[8px] font-bold text-white/20 uppercase px-2 py-0.5 bg-white/5 rounded-full",children:r.status==="signed"?"Attente ‚Ç¨":"Attente Signature"})]},l))})]})]}),Te={secured:"#4ADE80",projected:"#38BDF8",target:"#ffffff",axis:"#ffffff10"},pf=({data:e,width:t,height:n})=>{if(t<10||n<10)return null;const i={top:40,right:30,bottom:50,left:70},a=Math.max(0,t-i.left-i.right),o=Math.max(0,n-i.top-i.bottom),r=N.useMemo(()=>$s({domain:pl(e,d=>d.date),range:[0,a]}),[e,a]),l=N.useMemo(()=>Ae({domain:[0,ml(e,d=>Math.max(d.projected,d.target))||1e6],nice:!0,range:[o,0]}),[e,o]),c=e[e.length-1];return s.jsx("svg",{width:t,height:n,children:s.jsxs(ie,{left:i.left,top:i.top,children:[s.jsx(Ct,{data:e,x:d=>r(d.date),y:d=>l(d.secured),yScale:l,fill:Te.secured,fillOpacity:.05,curve:we}),s.jsx(Ct,{data:e,x:d=>r(d.date),y0:d=>l(d.secured),y1:d=>l(d.projected),yScale:l,fill:Te.projected,fillOpacity:.03,curve:we}),s.jsx(lt,{data:e,x:d=>r(d.date),y:d=>l(d.projected),stroke:Te.projected,strokeWidth:1,strokeDasharray:"4 4",strokeOpacity:.2,curve:we}),s.jsx(lt,{data:e,x:d=>r(d.date),y:d=>l(d.target),stroke:Te.target,strokeWidth:2,strokeDasharray:"6,4",strokeOpacity:.6,curve:we}),s.jsx(lt,{data:e,x:d=>r(d.date),y:d=>l((d.secured+d.projected)/2),stroke:Te.projected,strokeWidth:4,strokeOpacity:.9,curve:we}),c&&s.jsxs(ie,{children:[s.jsx("circle",{cx:r(c.date),cy:l((c.secured+c.projected)/2),r:6,fill:Te.projected,className:"animate-pulse"}),s.jsx("text",{x:r(c.date),y:l((c.secured+c.projected)/2)-15,fill:Te.projected,fontSize:10,fontWeight:"black",textAnchor:"end",className:"font-mono uppercase tracking-widest",children:"Atterrissage projet√©"})]}),c&&s.jsx("text",{x:a,y:l(c.target)-12,fill:"white",fontSize:10,fontWeight:"black",textAnchor:"end",className:"uppercase tracking-widest opacity-40 font-sans",children:"Objectif Board Q2"}),s.jsx(ht,{top:o,scale:r,stroke:"transparent",tickStroke:Te.axis,tickLabelProps:()=>({fill:"#64748b",fontSize:10,fontWeight:"bold",className:"font-mono",textAnchor:"middle"})}),s.jsx(ms,{scale:l,stroke:"transparent",tickStroke:Te.axis,tickLabelProps:()=>({fill:"#64748b",fontSize:10,fontWeight:"bold",className:"font-mono",textAnchor:"end",verticalAnchor:"middle",dx:-5}),tickFormat:d=>`${Math.round(d/1e3)}k`,tickValues:[0,25e4,5e5,75e4,1e6]})]})})};function mf({data:e}){return!e||e.length===0?null:s.jsx("div",{style:{width:"100%",height:"350px"},children:s.jsx(pt,{children:({width:t,height:n})=>s.jsx(pf,{data:e,width:t,height:n})})})}function ff({system:e}){const{studies:t,financialStats:n,emailLeads:i,metrics:a}=e,o=N.useMemo(()=>({securedCA:n.cashSecured||0,exposedCA:n.cashAtRisk||0,cancelledCA:n.cashLost||n.totalPotentialCA*.1||5e4}),[n]),r=N.useMemo(()=>{if(!i||i.length===0)return Array.from({length:15}).map((h,m)=>({day:m,activeRate:0}));const d=new Date,u=new Array(15).fill(0);i.forEach(h=>{const m=[h.last_opened_at,h.last_clicked_at,h.created_at].filter(Boolean).map(f=>new Date(f)).sort((f,y)=>y.getTime()-f.getTime())[0];if(m){const f=Math.floor((d.getTime()-m.getTime())/864e5);f<15&&u[f]++}});const p=i.length;return u.map((h,m)=>({day:m,activeRate:Math.round(h/p*100)}))},[i]),l=N.useMemo(()=>{const d=new Map;t.forEach(j=>{if(!d.has(j.email))d.set(j.email,j);else{const k=d.get(j.email);(j.status==="signed"||j.deposit_paid)&&!(k.status==="signed"||k.deposit_paid)&&d.set(j.email,j)}});const p=Array.from(d.values()).filter(j=>j.status!=="cancelled"),h=p.length,m=p.filter(j=>j.status==="signed"||j.deposit_paid),f=m.length,y=p.filter(j=>j.status!=="signed"&&!j.deposit_paid),b=m.filter(j=>!j.deposit_paid&&(j.payment_mode==="cash"||j.financing_mode==="with_deposit"||j.financing_mode==="partial_financing")),w=m.filter(j=>j.deposit_paid||j.financing_mode==="full_financing").length;return{leads:(i==null?void 0:i.length)||0,visited:h,signed:f,waitingSignatureStudies:y,waitingDepositStudies:b,secured:w,securedAmount:(n==null?void 0:n.cashSecured)||0}},[i,t,n]),c=N.useMemo(()=>{const d=[],u=new Date,p=n.cashSecured||0,h=(n.cashAtRisk||0)*.5+(n.totalPotentialCA||0)*.2,m=p+h*1.2;for(let f=0;f<=90;f+=10){const y=new Date(u);y.setDate(y.getDate()+f);const b=f/90;d.push({date:y,secured:p,projected:p+h*b,target:m})}return d},[n]);return s.jsxs("div",{className:"flex flex-col gap-12 py-8 px-4 max-w-[1200px] mx-auto pb-40",children:[s.jsxs("header",{className:"flex flex-col gap-2",children:[s.jsx("h1",{className:"text-4xl font-black text-white tracking-tight uppercase",children:"Salle de Navigation"}),s.jsx("p",{className:"text-slate-500 text-[10px] font-bold uppercase tracking-widest",children:"Vision Dirigeant & Trajectoire Strat√©gique"})]}),s.jsxs("section",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 space-y-12 shadow-2xl",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-12",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"S01 ‚Äî ANALYSE DE TR√âSORERIE"}),s.jsx("h2",{className:"text-4xl font-black text-white uppercase tracking-tight",children:"Niveau de s√©curisation du CA"}),s.jsxs("div",{className:"flex items-center gap-6 mt-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.3)] animate-pulse"}),s.jsx("span",{className:"text-lg font-bold text-white/70",children:"60% S√©curis√©"}),s.jsx("span",{className:"text-sm font-bold text-emerald-400",children:"(+3.2 pts)"})]}),s.jsx("div",{className:"h-6 w-[2px] bg-white/5"}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("span",{className:"text-lg font-bold text-slate-500",children:"Objectif : 70%"})})]})]}),s.jsxs("div",{className:"text-left md:text-right",children:[s.jsxs("div",{className:"flex items-baseline md:justify-end gap-3",children:[s.jsx("span",{className:"text-6xl font-black text-white tracking-tighter tabular-nums font-mono drop-shadow-2xl",children:(n.cashSecured||0).toLocaleString()}),s.jsx("span",{className:"text-2xl font-bold text-white/10",children:"‚Ç¨"})]}),s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest block mt-2",children:"CASH NET S√âCURIS√â"})]})]}),s.jsx("div",{className:"pt-6",children:s.jsx(cf,{data:o})}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-xl border border-white/10 p-8 rounded-2xl flex items-start gap-6 transition-all hover:border-white/20",children:[s.jsx("div",{className:"w-1.5 h-full bg-blue-500 rounded-full shadow-[0_0_15px_rgba(59,130,246,0.3)] min-h-[50px]"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[10px] font-bold text-blue-400 uppercase tracking-widest",children:"Insight Strat√©gique"}),s.jsxs("p",{className:"text-sm text-slate-300 font-medium leading-relaxed max-w-3xl",children:[s.jsx("span",{className:"text-white font-bold text-base",children:"ALERTE SEGMENT :"})," 28% de l'exposition r√©side dans le segment ",s.jsx("span",{className:"text-orange-400 font-bold",children:"√âtudes Complexes"}),". Une s√©curisation des acomptes sur ce p√©rim√®tre permettrait d'atteindre l'objectif de 70% d'ici 14 jours."]})]})]})]}),s.jsxs("div",{className:"flex flex-col gap-12",children:[s.jsxs("section",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 space-y-10 shadow-xl",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start gap-8",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"S02 ‚Äî MOMENT CRITIQUE CHURN"}),s.jsx("h2",{className:"text-3xl font-black text-white uppercase tracking-tight",children:"Moment critique de d√©crochage"}),s.jsx("p",{className:"text-[10px] font-bold text-orange-400 uppercase tracking-widest",children:"70% des annulations se pr√©parent apr√®s J+7"})]}),s.jsxs("div",{className:"flex flex-col md:items-end gap-1",children:[s.jsx("span",{className:"text-3xl font-black text-white font-mono tabular-nums tracking-tighter uppercase",children:"8.2 JOURS"}),s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"D√âLAI MOYEN AVANT D√âCROCHAGE"})]})]}),s.jsx("div",{className:"py-4",children:s.jsx(uf,{data:r})}),s.jsxs("div",{className:"bg-black/40 border border-orange-500/20 p-6 rounded-2xl flex items-start gap-4",children:[s.jsx("div",{className:"w-1 h-full bg-orange-500 rounded-full opacity-40 min-h-[40px]"}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-[10px] font-bold text-orange-400 uppercase tracking-widest",children:"Action Recommand√©e"}),s.jsxs("p",{className:"text-sm text-slate-300 leading-relaxed",children:[s.jsx("span",{className:"text-white font-bold",children:"INTERVENTION PROACTIVE :"})," Le pic de d√©crochage se situe √† ",s.jsx("span",{className:"text-white font-bold font-mono",children:"J+8"}),". D√©clenchement automatique d'un call de courtoisie √† ",s.jsx("span",{className:"text-white font-bold font-mono",children:"J+4"})," pour valider l'onboarding."]})]})]})]}),s.jsx("section",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 shadow-xl",children:s.jsx(hf,{leads:l.leads,visited:l.visited,signed:l.signed,waitingSignatureStudies:l.waitingSignatureStudies,waitingDepositStudies:l.waitingDepositStudies,secured:l.secured,securedAmount:l.securedAmount})})]}),s.jsxs("section",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 space-y-12 shadow-2xl",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-12",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"S04 ‚Äî TRAJECTOIRE FINANCI√àRE"}),s.jsx("h2",{className:"text-4xl font-black text-white uppercase tracking-tight",children:"Atterrissage √† 90 Jours"}),s.jsxs("div",{className:"flex flex-wrap items-center gap-6 mt-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.3)] animate-pulse"}),s.jsx("span",{className:"text-lg font-bold text-white/70",children:"Probabilit√© d'atteinte"}),s.jsx("span",{className:"text-lg font-black text-red-500 font-mono tracking-tighter",children:"38%"})]}),s.jsx("div",{className:"h-6 w-[2px] bg-white/5"}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("span",{className:"text-lg font-bold text-slate-500 italic",children:'"Objectif manqu√© fin avril"'})})]})]}),s.jsxs("div",{className:"text-left md:text-right",children:[s.jsx("div",{className:"flex items-baseline md:justify-end gap-3",children:s.jsx("span",{className:"text-7xl font-black text-red-500 font-mono tracking-tighter tabular-nums drop-shadow-2xl font-mono",children:"-122k‚Ç¨"})}),s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest block mt-2",children:"D√âFICIT PROJET√â vs BOARD"})]})]}),s.jsx("div",{className:"py-2",children:s.jsx(mf,{data:c})}),s.jsxs("div",{className:"bg-black/40 border border-red-500/20 p-8 rounded-2xl flex items-start gap-6 transition-all hover:border-red-500/30",children:[s.jsx("div",{className:"w-1.5 h-full bg-red-500 rounded-full opacity-40 min-h-[50px]"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[10px] font-bold text-red-400 uppercase tracking-widest",children:"Alerte Gouvernance"}),s.jsxs("p",{className:"text-sm text-slate-300 leading-relaxed max-w-3xl",children:[s.jsx("span",{className:"text-white font-bold text-base uppercase tracking-tight",children:"Action Corrective :"})," L'objectif Board est atteignable avec ",s.jsx("span",{className:"text-white font-bold font-mono",children:"+12 signatures"})," ou une am√©lioration de ",s.jsx("span",{className:"text-emerald-400 font-bold font-mono",children:"+6%"})," de la conversion du pipeline. Priorit√© absolue sur les dossiers √† ",">","50k‚Ç¨."]})]})]})]})]})}const xf=({data:e,width:t,height:n,benchmarkPercentage:i=42})=>{const[a,o]=N.useState(null),r={top:60,right:30,bottom:80,left:30},l=Math.max(0,t-r.left-r.right),c=Math.max(0,n-r.top-r.bottom),d=N.useMemo(()=>gn({domain:e.map(h=>h.label),range:[0,l],padding:.25}),[e,l]),u=Math.max(...e.map(h=>h.value),1),p=N.useMemo(()=>Ae({domain:[0,u],range:[c,10]}),[u,c]);return s.jsxs("div",{className:"relative group/funnel",children:[s.jsx("svg",{width:t,height:n,className:"overflow-visible",children:s.jsxs(ie,{left:r.left,top:r.top,children:[i&&s.jsxs(ie,{top:c*(1-i/100),children:[s.jsx("line",{x1:0,x2:l,stroke:"#4ECDC4",strokeWidth:1,strokeDasharray:"4,4",opacity:.15}),s.jsxs("text",{x:l,y:-5,fill:"#4ECDC4",fontSize:9,fontWeight:"black",textAnchor:"end",className:"uppercase tracking-widest opacity-40",children:["Target ",i,"%"]})]}),e.map((h,m)=>{const f=d.bandwidth(),y=d(h.label)||0,b=Math.max(50,c-p(h.value)),w=c-b,j=h.isFriction,k=m>0?e[m-1].value:null,C=k?Math.round(h.value/k*100):null;return s.jsxs(ie,{onMouseEnter:()=>o(m),onMouseLeave:()=>o(null),className:"cursor-pointer",children:[C!==null&&s.jsxs(ie,{left:y-d.step()*d.padding()/2,children:[s.jsxs("text",{y:c-20,textAnchor:"middle",fill:j?"#FF6B6B":"white",opacity:j?1:.6,fontSize:14,fontWeight:"900",fontFamily:"IBM Plex Mono",children:[C,"%"]}),s.jsx("path",{d:"M -5 10 L 0 15 L 5 10",fill:"none",stroke:j?"#FF6B6B":"white",strokeWidth:2,opacity:j?1:.3,transform:`translate(0, ${c-45})`})]}),s.jsx("rect",{x:y,y:w,width:f,height:b,fill:j?"url(#frictionGradient)":h.color,fillOpacity:a===m?.9:.7,stroke:j?"#FF6B6B":"white",strokeOpacity:a===m?1:.4,strokeWidth:j?3:1,rx:6,className:"transition-all duration-300"}),s.jsx("text",{x:y+f/2,y:w-8,fill:"white",fontSize:11,fontWeight:"bold",fontFamily:"IBM Plex Mono",textAnchor:"middle",opacity:.4,children:h.value}),s.jsxs("text",{x:y+f/2,y:w+b/2+6,fill:"white",opacity:.95,fontSize:b>80?18:16,fontWeight:"black",fontFamily:"IBM Plex Mono",textAnchor:"middle",style:{filter:"drop-shadow(0px 2px 8px rgba(0,0,0,0.95))"},children:[Math.round(h.revenue/1e3),"k‚Ç¨"]}),h.avgDelay!==void 0&&h.avgDelay>0&&s.jsx(ie,{top:c+16,left:y+f/2,children:s.jsxs("text",{fill:h.avgDelay>7?"#FF6B6B":"white",opacity:.6,fontSize:11,fontWeight:"black",textAnchor:"middle",children:[h.avgDelay,"j"]})}),s.jsx("text",{x:y+f/2,y:c+48,fill:"white",opacity:a===m?1:.3,fontSize:12,fontWeight:"900",className:"uppercase tracking-[0.2em]",textAnchor:"middle",children:h.label})]},`step-${m}`)}),s.jsx("defs",{children:s.jsxs("linearGradient",{id:"frictionGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[s.jsx("stop",{offset:"0%",stopColor:"#FF6B6B",stopOpacity:.8}),s.jsx("stop",{offset:"100%",stopColor:"#E63946",stopOpacity:.3})]})})]})}),a!==null&&s.jsx("div",{className:"absolute z-50 pointer-events-none bg-[#1a1c23] border border-white/20 p-4 rounded-xl shadow-2xl backdrop-blur-xl animate-in fade-in zoom-in duration-200",style:{left:d(e[a].label)+r.left+d.bandwidth()/2,top:r.top+(c-Math.max(25,c-p(e[a].value)))-100,transform:"translateX(-50%)"},children:s.jsxs("div",{className:"flex flex-col gap-1 min-w-[140px]",children:[s.jsx("div",{className:"text-[10px] font-black text-white/30 uppercase tracking-widest",children:e[a].label}),s.jsxs("div",{className:"flex justify-between items-baseline gap-4 mt-2",children:[s.jsx("span",{className:"text-2xl font-black text-white font-mono",children:e[a].value}),s.jsx("span",{className:"text-xs font-bold text-white/40 uppercase",children:"Dossiers"})]}),s.jsxs("div",{className:"text-lg font-black text-emerald-400 font-mono",children:[Math.round(e[a].revenue/1e3),"k‚Ç¨ ",s.jsx("span",{className:"text-[10px] text-white/20 uppercase tracking-tighter",children:"Volume"})]}),a>0&&s.jsxs("div",{className:"mt-2 pt-2 border-t border-white/5 flex justify-between items-center",children:[s.jsx("span",{className:"text-[9px] font-bold text-white/30 uppercase",children:"Efficience"}),s.jsxs("span",{className:"text-sm font-black text-white",children:[Math.round(e[a].value/e[a-1].value*100),"%"]})]})]})})]})};function gf({data:e,benchmarkPercentage:t}){return!e||e.length===0?null:s.jsx("div",{style:{width:"100%",height:"320px"},className:"relative",children:s.jsx(pt,{children:({width:n,height:i})=>s.jsx(xf,{data:e,width:n,height:i,benchmarkPercentage:t})})})}const bf=({data:e,autopilotIndex:t,width:n,height:i})=>{const a={top:40,right:30,bottom:40,left:30},o=Math.max(0,n-a.left-a.right),r=Math.max(0,i-a.top-a.bottom),l=N.useMemo(()=>gn({domain:e.map(u=>u.label),range:[0,o],padding:.3}),[e,o]),c=Math.max(...e.map(u=>Math.max(u.value,u.target||0)),1),d=N.useMemo(()=>Ae({domain:[0,c*1.1],range:[r,0]}),[c,r]);return s.jsxs("svg",{width:n,height:i,className:"overflow-visible",children:[s.jsx("defs",{children:s.jsxs("linearGradient",{id:"emeraldGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[s.jsx("stop",{offset:"0%",stopColor:"#10B981",stopOpacity:.8}),s.jsx("stop",{offset:"100%",stopColor:"#059669",stopOpacity:.3})]})}),s.jsxs(ie,{left:a.left,top:a.top,children:[s.jsx(ie,{children:e.map((u,p)=>{if(p===0||!u.target)return null;const h=e[p-1];return h.target?s.jsx("line",{x1:(l(h.label)||0)+l.bandwidth()/2,y1:d(h.target),x2:(l(u.label)||0)+l.bandwidth()/2,y2:d(u.target),stroke:"white",strokeOpacity:.15,strokeWidth:1,strokeDasharray:"4,4"},`target-line-${p}`):null})}),t<e.length&&s.jsxs(ie,{left:l(e[t].label)||0,children:[s.jsx("line",{y1:-20,y2:r,stroke:"white",strokeOpacity:.2,strokeWidth:1,strokeDasharray:"4,2"}),s.jsx("text",{y:-25,fill:"white",opacity:.3,fontSize:8,fontWeight:"black",className:"uppercase tracking-widest text-[7px]",children:"D√©marrage Autopilote"})]}),e.map((u,p)=>{const h=l.bandwidth(),m=l(u.label)||0,f=d(u.value),y=Math.max(2,r-f),b=p>=t;return s.jsxs(ie,{children:[s.jsx("rect",{x:m,y:f,width:h,height:y,fill:b?"url(#emeraldGradient)":"white",fillOpacity:b?.9:.15,rx:4,className:"transition-all duration-500"}),s.jsxs("text",{x:m+h/2,y:f-8,fill:"white",opacity:b?1:.3,fontSize:9,fontWeight:"black",fontFamily:"IBM Plex Mono",textAnchor:"middle",children:[Math.round(u.value/1e3),"k"]})]},`revenue-bar-${p}`)}),s.jsx(ht,{top:r,scale:l,stroke:"transparent",tickStroke:"transparent",tickLabelProps:()=>({fill:"#ffffff20",fontSize:9,fontFamily:"IBM Plex Mono",textAnchor:"middle",fontWeight:"bold",className:"uppercase tracking-[0.2em]"})})]})]})};function yf({data:e,autopilotIndex:t}){return!e||e.length===0?null:s.jsx("div",{style:{width:"100%",height:"280px"},children:s.jsx(pt,{children:({width:n,height:i})=>s.jsx(bf,{data:e,autopilotIndex:t,width:n,height:i})})})}function vf({system:e}){const{studies:t,metrics:n,financialStats:i,emailLeads:a}=e,o=N.useMemo(()=>{const h=new Map;return t.forEach(m=>{if(!h.has(m.email))h.set(m.email,m);else{const f=h.get(m.email);(m.status==="signed"||m.deposit_paid)&&!(f.status==="signed"||f.deposit_paid)&&h.set(m.email,m)}}),Array.from(h.values()).filter(m=>m.status!=="cancelled")},[t]),r=N.useMemo(()=>o.filter(h=>h.status==="signed"||h.deposit_paid).length,[o]),l=N.useMemo(()=>{const h=(a==null?void 0:a.length)||1,m=o.length,f=o.filter(F=>F.views>0).length,y=o.filter(F=>(F.clicks||0)>0).length,b=r,w=h>0?m/h*100:0,j=m>0?f/m*100:0,k=f>0?y/f*100:0,C=y>0?b/y*100:0,_=m>0?b/m*100:0,g=42,x=-6,v=[{label:"QUALIF",rate:w,actual:w,from:"Leads",to:"Dossiers",target:90,input:h},{label:"OUVERTURE",rate:j,actual:j,from:"Dossiers",to:"Ouvertures",target:85,input:m},{label:"CLIC",rate:k,actual:k,from:"Ouvertures",to:"Clics",target:50,input:f},{label:"CLOSING",rate:C,actual:C,from:"Clics",to:"Sign√©s",target:50,input:y}],S=v.reduce((F,Y)=>Y.rate/Y.target<F.rate/F.target?Y:F,v[0]),A=S.rate<S.target*.7,M=r>0?i.caTotal/r:28e3,P=S.target-S.actual,I=Math.round(S.input*(P/100));let T=1;S.label==="QUALIF"?T=(f/m||0)*(y/f||0)*(b/y||0):S.label==="OUVERTURE"?T=(y/f||0)*(b/y||0):S.label==="CLIC"&&(T=b/y||0);const V=Math.round(I*T*M),te=V>15e3?`Potentiel de ${Math.round(V/1e3)}k‚Ç¨/mois en optimisant ${S.from} ‚Üí ${S.to}.`:"Pipeline performant. Focus sur l'optimisation continue.",W=()=>S.label==="QUALIF"?"Augmenter la qualification des leads entrants.":S.label==="OUVERTURE"?"Optimiser l'objet des emails et les horaires d'envoi.":S.label==="CLIC"?"Simplifier le CTA et r√©duire la longueur de l'√©tude.":S.label==="CLOSING"?"Renforcer le social proof et automatiser la relance post-clic.":"Augmenter la qualification des leads entrants.";return{globalConversion:_,benchmark:g,diff:_-g,evolution:x,executiveLine:te,monthlyRecoveryPotential:V,recommendation:W(),worst:S,isCritical:A,avgBasket:M,metrics:{qualificationRate:w,openRate:j,clickRate:k,closeRate:C,totalLeads:h,totalDossiers:m,totalOpens:f,totalClicks:y,totalSigned:b}}},[a,o,r,i]),c=N.useMemo(()=>[{label:"LEADS",value:l.metrics.totalLeads,revenue:l.metrics.totalLeads*l.avgBasket,color:"#475569"},{label:"DOSSIERS",value:l.metrics.totalDossiers,revenue:l.metrics.totalDossiers*l.avgBasket,color:"#334155"},{label:"OUVERTS",value:l.metrics.totalOpens,revenue:l.metrics.totalOpens*l.avgBasket,color:"#1e293b",isFriction:l.worst.label==="OUVERTURE",avgDelay:2},{label:"CLIQU√âS",value:l.metrics.totalClicks,revenue:l.metrics.totalClicks*l.avgBasket,color:"#0f172a",isFriction:l.worst.label==="CLIC",avgDelay:9},{label:"SIGN√âS",value:l.metrics.totalSigned,revenue:l.metrics.totalSigned*l.avgBasket,color:"#10B981",isFriction:l.worst.label==="CLOSING"}],[l]),d=N.useMemo(()=>{var h;return o.filter(m=>m.was_war_room&&(m.status==="signed"||m.deposit_paid)).reduce((m,f)=>m+(f.total_price||0),0)||((h=n.warRoom)==null?void 0:h.ca)||0},[o,n]),u=l.metrics.totalLeads*.25,p=N.useMemo(()=>{const h=[],m=new Date;for(let f=5;f>=0;f--){const y=new Date(m.getFullYear(),m.getMonth()-f,1),b=y.toLocaleDateString("fr-FR",{month:"short"});h.push({label:b.charAt(0).toUpperCase()+b.slice(1).replace(".",""),m:y.getMonth(),y:y.getFullYear(),value:0,target:1e5+(5-f)*25e3})}return o.forEach(f=>{if(!(f.status==="signed"||f.deposit_paid))return;const b=f.signed_at||f.created_at;if(!b)return;const w=new Date(b),j=w.getMonth(),k=w.getFullYear(),C=h.find(_=>_.m===j&&_.y===k);C&&(C.value+=f.total_price||0)}),h.map(({label:f,value:y,target:b})=>({label:f,value:y,target:b}))},[o]);return s.jsxs("div",{className:"flex flex-col gap-12 py-12 px-8 max-w-[1400px] mx-auto pb-40",children:[s.jsx("section",{className:"bg-[#0F1115] p-10 rounded-3xl border border-white/[0.08] shadow-[0_20px_50px_rgba(0,0,0,0.5)]",children:s.jsxs("div",{className:"flex flex-col gap-8",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"text-[10px] font-black text-white/20 uppercase tracking-[0.4em]",children:"Executive Summary"}),s.jsx("h1",{className:"text-3xl md:text-4xl font-black text-white leading-tight uppercase tracking-tighter",children:l.executiveLine}),s.jsxs("div",{className:"flex items-baseline gap-4",children:[s.jsx("span",{className:"text-sm font-bold text-white/30 uppercase tracking-widest",children:"Impact:"}),s.jsxs("span",{className:"text-5xl font-black text-[#FF6B6B] font-mono tracking-tighter",children:[Math.round(l.monthlyRecoveryPotential/1e3),"k‚Ç¨"]}),s.jsx("span",{className:"text-xs font-bold text-white/20 uppercase tracking-widest",children:"/ mois non capt√©s"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsxs("div",{className:`p-6 rounded-2xl border-2 backdrop-blur-md ${l.isCritical?"bg-red-500/10 border-red-500/30":"bg-white/5 border-white/10"}`,children:[s.jsx("div",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"Status Audit"}),s.jsx("div",{className:`text-sm font-black uppercase ${l.isCritical?"text-red-500":"text-emerald-500"}`,children:l.isCritical?"Friction Critique":"Friction D√©tect√©e"})]}),s.jsxs("div",{className:"p-6 rounded-2xl bg-white/5 border border-white/10 backdrop-blur-md",children:[s.jsx("div",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"Conversion R√©elle"}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsxs("div",{className:"text-2xl font-black text-white font-mono",children:[Math.round(l.globalConversion),"%"]}),s.jsxs("div",{className:`text-[10px] font-black ${l.evolution<0?"text-red-500":"text-emerald-500"}`,children:[l.evolution<0?"‚Üò":"‚Üó"," ",Math.abs(l.evolution),"pts"]})]})]}),s.jsxs("div",{className:`p-6 rounded-2xl border-2 backdrop-blur-md ${l.diff<0?"bg-orange-500/10 border-orange-500/30":"bg-emerald-500/10 border-emerald-500/30"}`,children:[s.jsx("div",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"vs Benchmark"}),s.jsxs("div",{className:`text-2xl font-black font-mono ${l.diff<0?"text-orange-500":"text-emerald-400"}`,children:[l.diff>0?"+":"",Math.round(l.diff),"pts"]})]}),s.jsxs("div",{className:"p-6 rounded-2xl bg-indigo-500/10 border border-indigo-500/20 backdrop-blur-md",children:[s.jsx("div",{className:"text-[9px] font-black text-indigo-400/60 uppercase tracking-widest mb-1",children:"Panier Moyen"}),s.jsxs("div",{className:"text-2xl font-black text-white font-mono",children:[Math.round(l.avgBasket/1e3),"k‚Ç¨"]})]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[s.jsxs("section",{className:"lg:col-span-12 bg-black/40 backdrop-blur-xl p-10 rounded-[2.5rem] border border-white/5 space-y-10 shadow-2xl relative overflow-hidden",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-8 relative z-10",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsxs("h2",{className:"text-xl font-black text-white uppercase tracking-tight",children:["Flux Commercial ¬∑ ",c[0].label," ‚Üí ",c[c.length-1].label]}),s.jsx("p",{className:"text-xs text-white/20 font-bold uppercase tracking-widest",children:"Analyse d√©doublon√©e 1:1 avec tension visuelle sur frictions."})]}),s.jsxs("div",{className:"bg-emerald-500/10 border-l-4 border-emerald-500 p-4 rounded-r-xl max-w-sm",children:[s.jsx("div",{className:"text-[9px] font-black text-emerald-400 uppercase tracking-widest mb-1",children:"Priorit√© Imm√©diate"}),s.jsxs("div",{className:"text-sm font-bold text-white uppercase leading-tight",children:[l.worst.from," ‚Üí ",l.worst.to," : ",l.recommendation]})]})]}),s.jsx("div",{className:"pt-6",children:s.jsx(gf,{data:c,benchmarkPercentage:l.benchmark})}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pt-10 border-t border-white/5",children:[s.jsx(Jt,{label:"CA G√©n√©r√©",value:`${Math.round(i.caTotal/1e3)}k‚Ç¨`}),s.jsx(Jt,{label:"Potentiel R√©cup√©rable",value:`+${Math.round(l.monthlyRecoveryPotential/1e3)}k‚Ç¨`,color:"text-emerald-400"}),s.jsx(Jt,{label:"D√©lai Moyen",value:"11.2 j"}),s.jsx(Jt,{label:"Unit√©s Perdues",value:Math.max(0,Math.round(o.length*.42-r)),color:"text-red-500"})]})]}),s.jsxs("section",{className:"lg:col-span-8 bg-[#0b0f17] p-10 rounded-[2.5rem] border border-white/5 space-y-10 shadow-2xl",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-[9px] tracking-[0.35em] text-white/30 uppercase",children:"Trajectoire Business"}),s.jsx("h2",{className:"text-2xl font-black text-white uppercase tracking-tight",children:"Acc√©l√©ration du Chiffre d‚ÄôAffaires"})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("div",{className:"text-3xl font-black text-emerald-400 font-mono tracking-tighter",children:[Math.round(d/1e3),"k‚Ç¨"]}),s.jsx("p",{className:"text-[9px] text-white/20 font-black uppercase tracking-widest",children:"CA S√©curis√©"})]})]}),s.jsx(yf,{data:p,autopilotIndex:3}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-10",children:[s.jsxs("div",{className:"bg-white/5 rounded-2xl p-6 border border-white/10 backdrop-blur-md",children:[s.jsx("p",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"Temps Lib√©r√© Cumulativement"}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsx("span",{className:"text-3xl font-black text-white font-mono",children:Math.round(u)}),s.jsx("span",{className:"text-sm font-bold text-white/30 uppercase tracking-widest",children:"heures"})]})]}),s.jsxs("div",{className:"bg-emerald-500/10 rounded-2xl p-6 border border-emerald-500/20 backdrop-blur-md",children:[s.jsx("p",{className:"text-[9px] font-black text-emerald-400/60 uppercase tracking-widest mb-1",children:"Impact Business Direct"}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsxs("span",{className:"text-3xl font-black text-emerald-400 font-mono",children:["+",Math.round(d/1e3)]}),s.jsx("span",{className:"text-sm font-bold text-emerald-400/40 uppercase tracking-widest",children:"k‚Ç¨ s√©curis√©s"})]})]})]})]}),s.jsx("section",{className:"lg:col-span-4 flex flex-col gap-6",children:s.jsxs("div",{className:"bg-gradient-to-br from-indigo-950/40 via-black to-black p-12 rounded-[3.5rem] border border-indigo-500/10 flex-1 flex flex-col justify-between shadow-2xl relative overflow-hidden group",children:[s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-indigo-500/5 blur-[80px] rounded-full group-hover:scale-150 transition-transform duration-1000"}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[10px] font-black text-indigo-400/60 uppercase tracking-[0.4em]",children:"Brain Autopilote"}),s.jsx("div",{className:"h-1 w-12 bg-indigo-500 rounded-full"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[9px] font-black text-white/20 uppercase tracking-widest",children:"Efficience Flux"}),s.jsxs("div",{className:"text-5xl font-black text-white font-mono tracking-tighter",children:["98.4",s.jsx("span",{className:"text-sm text-white/20",children:"%"})]})]})]}),s.jsxs("div",{className:"space-y-4 pt-12 border-t border-white/5",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-[9px] font-black text-white/30 uppercase tracking-[0.2em]",children:"Protection CA"}),s.jsx("span",{className:"text-xs font-black text-emerald-500",children:"ACTIF"})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-[9px] font-black text-white/30 uppercase tracking-[0.2em]",children:"Relance √âtudes"}),s.jsx("span",{className:"text-xs font-black text-emerald-500",children:"ACTIF"})]}),s.jsxs("div",{className:"flex justify-between items-center opacity-30",children:[s.jsx("span",{className:"text-[9px] font-black text-white/30 uppercase tracking-[0.2em]",children:"Smart Closing"}),s.jsx("span",{className:"text-xs font-black text-white/40",children:"BETA"})]})]})]})})]})]})}const Jt=({label:e,value:t,color:n="text-white"})=>s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"text-[9px] font-black text-white/20 uppercase tracking-[0.2em]",children:e}),s.jsx("div",{className:`text-xl font-black font-mono tracking-tighter ${n}`,children:t})]});function wf({data:e,securedRevenue:t,cycleBefore:n,cycleNow:i,savedHours:a}){const[o,r]=N.useState(null),l=N.useMemo(()=>Math.max(...e.map(x=>x.creation),1),[e]),c=N.useMemo(()=>Math.max(...e.map(x=>x.protection),1),[e]),d=n&&i?Math.round((i-n)/n*100):null,u={top:40,right:80,bottom:60,left:80},p=800,h=300,m=p-u.left-u.right,f=h-u.top-u.bottom,y=x=>f-x/l*f,b=x=>f-x/c*f,w=x=>{const v=x==="creation"?y:b;return e.map((S,A)=>{const M=A/(e.length-1)*m,P=v(S[x]);return`${A===0?"M":"L"}${M},${P}`}).join(" ")},j=w("creation"),k=w("protection"),C=N.useMemo(()=>{const x=e[e.length-1];return x?x.protection>x.creation?"Le syst√®me prot√®ge d√©sormais plus de chiffre d'affaires qu'il n'en g√©n√®re : effet d√©fensif confirm√©.":x.protection>x.creation*.7?"La protection du CA devient un levier strat√©gique majeur.":"Le syst√®me agit surtout en acquisition : potentiel d√©fensif encore sous‚Äëexploit√©.":""},[e]),_=N.useMemo(()=>{const v=[];for(let S=0;S<=5;S++){const A=l/5*S;v.push(A)}return v},[l]),g=N.useMemo(()=>{const v=[];for(let S=0;S<=5;S++){const A=c/5*S;v.push(A)}return v},[c]);return s.jsxs("section",{className:"w-full rounded-2xl bg-[#0b0e14] border border-white/10 p-8 text-white shadow-[0_20px_60px_rgba(0,0,0,0.45)]",children:[s.jsxs("header",{className:"mb-10",children:[s.jsx("div",{className:"text-xs uppercase tracking-[0.35em] text-white/30 mb-3",children:"Performance commerciale autonome"}),s.jsxs("div",{className:"flex items-end gap-6 flex-wrap",children:[s.jsxs("h1",{className:"text-7xl font-bold leading-none",children:[(t/1e3).toFixed(0),"k‚Ç¨"]}),s.jsx("p",{className:"text-white/50 max-w-sm pb-2",children:"Chiffre d'affaires s√©curis√© automatiquement"})]})]}),s.jsxs("div",{className:"mb-10 bg-[#0f141f] rounded-xl p-6 border border-white/5 relative",children:[s.jsxs("div",{className:"flex gap-6 mb-4 text-xs",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-3 h-0.5 bg-[#3ecfff]"}),s.jsx("span",{className:"text-white/60",children:"Cr√©ation (Clients uniques)"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-3 h-0.5 bg-[#7cffb2]"}),s.jsx("span",{className:"text-white/60",children:"Protection (CA S√©curis√©)"})]})]}),s.jsx("svg",{viewBox:`0 0 ${p} ${h}`,className:"w-full",children:s.jsxs("g",{transform:`translate(${u.left},${u.top})`,children:[g.map((x,v)=>s.jsx("line",{x1:0,y1:b(x),x2:m,y2:b(x),stroke:"rgba(255,255,255,0.05)",strokeDasharray:"2,4"},v)),s.jsx("line",{x1:0,y1:0,x2:0,y2:f,stroke:"rgba(62,207,255,0.3)",strokeWidth:1}),_.map((x,v)=>s.jsx("g",{children:s.jsx("text",{x:-10,y:y(x),fill:"rgba(62,207,255,0.6)",fontSize:10,textAnchor:"end",dominantBaseline:"middle",fontFamily:"IBM Plex Mono",children:Math.round(x)})},v)),s.jsx("text",{x:-60,y:f/2,fill:"rgba(62,207,255,0.6)",fontSize:11,textAnchor:"middle",transform:`rotate(-90, -60, ${f/2})`,fontFamily:"IBM Plex Mono",children:"CLIENTS"}),s.jsx("line",{x1:m,y1:0,x2:m,y2:f,stroke:"rgba(124,255,178,0.3)",strokeWidth:1}),g.map((x,v)=>s.jsxs("text",{x:m+10,y:b(x),fill:"rgba(124,255,178,0.6)",fontSize:10,textAnchor:"start",dominantBaseline:"middle",fontFamily:"IBM Plex Mono",children:[Math.round(x/1e3),"k‚Ç¨"]},v)),s.jsx("text",{x:m+60,y:f/2,fill:"rgba(124,255,178,0.6)",fontSize:11,textAnchor:"middle",transform:`rotate(90, ${m+60}, ${f/2})`,fontFamily:"IBM Plex Mono",children:"CA PROT√âG√â"}),s.jsx("line",{x1:0,y1:f,x2:m,y2:f,stroke:"rgba(255,255,255,0.2)",strokeWidth:1}),e.map((x,v)=>{const S=v/(e.length-1)*m;return s.jsx("text",{x:S,y:f+20,fill:"rgba(255,255,255,0.4)",fontSize:10,textAnchor:"middle",fontFamily:"IBM Plex Mono",children:x.label},v)}),s.jsx("path",{d:j,fill:"none",stroke:"#3ecfff",strokeWidth:"3",opacity:"0.85"}),s.jsx("path",{d:k,fill:"none",stroke:"#7cffb2",strokeWidth:"3",opacity:"0.9"}),e.map((x,v)=>{const S=v/(e.length-1)*m,A=b(x.protection),M=y(x.creation);return s.jsxs("g",{children:[s.jsx("circle",{cx:S,cy:M,r:o===v?5:3,fill:"#3ecfff",onMouseEnter:()=>r(v),onMouseLeave:()=>r(null),style:{cursor:"pointer"}}),s.jsx("circle",{cx:S,cy:A,r:o===v?6:4,fill:"#7cffb2",onMouseEnter:()=>r(v),onMouseLeave:()=>r(null),style:{cursor:"pointer"}})]},v)})]})}),o!==null&&s.jsxs("div",{className:"absolute bottom-4 left-6 text-xs bg-black/90 px-4 py-3 rounded-lg border border-white/20",children:[s.jsx("div",{className:"font-bold mb-1",children:e[o].label}),s.jsxs("div",{className:"text-[#3ecfff]",children:["Leads: ",e[o].creation]}),s.jsxs("div",{className:"text-[#7cffb2]",children:["CA Prot√©g√©: ",(e[o].protection/1e3).toFixed(0),"k‚Ç¨"]})]})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-10",children:[i!==void 0&&s.jsxs("div",{className:"bg-white/[0.04] p-6 rounded-xl border border-white/10",children:[s.jsx("div",{className:"text-xs text-white/40 uppercase mb-1",children:"Cycle commercial"}),s.jsxs("div",{className:"text-4xl font-bold",children:[i," jours"]}),d!==null&&d!==0&&s.jsxs("div",{className:`text-sm mt-1 ${d<0?"text-emerald-400":"text-red-400"}`,children:[d>0?"+":"",d,"% vs avant"]})]}),a!==void 0&&a>0&&s.jsxs("div",{className:"bg-white/[0.04] p-6 rounded-xl border border-white/10",children:[s.jsx("div",{className:"text-xs text-white/40 uppercase mb-1",children:"Temps lib√©r√©"}),s.jsxs("div",{className:"text-4xl font-bold",children:[a,"h"]}),s.jsx("div",{className:"text-white/40 text-sm",children:"Capacit√© commerciale r√©cup√©r√©e"})]}),s.jsxs("div",{className:"bg-white/[0.04] p-6 rounded-xl border border-white/10",children:[s.jsx("div",{className:"text-xs text-white/40 uppercase mb-1",children:"Lecture strat√©gique"}),s.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:C})]})]}),s.jsx("footer",{className:"border-t border-white/10 pt-6",children:s.jsx("p",{className:"text-sm text-white/70",children:"üëâ Priorit√© : renforcer la protection du CA existant avant d'augmenter l'acquisition."})})]})}function jf({system:e}){var u;const{studies:t,metrics:n,emailLeads:i}=e,a=N.useMemo(()=>{const p=new Date,h=new Date(p.getFullYear(),p.getMonth(),1);return t.filter(m=>{if(!m.signed_at||m.status!=="signed"&&!m.deposit_paid)return!1;const f=new Date(m.signed_at);return f>=h&&f<=p}).reduce((m,f)=>m+(f.total_price||0),0)},[t]),o=14.5,r=11.2,l=((u=n.stats)==null?void 0:u.totalEmailsSent)||0,c=Math.max(10,Math.round(l*.25)),d=N.useMemo(()=>{const p=new Date,h=new Date(p.getFullYear(),p.getMonth(),1),m=[];for(let f=0;f<=6;f++){const y=f/6,b=h.getTime()+(p.getTime()-h.getTime())*y,w=new Date(b),j=t.filter(_=>{if(!_.created_at)return!1;const g=new Date(_.created_at);return g>=h&&g<=w}),k=new Set(j.map(_=>_.email).filter(_=>_)),C=t.filter(_=>{if(!_.signed_at||_.status!=="signed"&&!_.deposit_paid)return!1;const g=new Date(_.signed_at);return g>=h&&g<=w}).reduce((_,g)=>_+(g.total_price||0),0);m.push({label:w.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}),creation:k.size,protection:C})}return m},[t]);return s.jsx("div",{className:"flex flex-col gap-8 py-12 px-6 max-w-[1400px] mx-auto pb-40",children:s.jsx(wf,{data:d,securedRevenue:a,cycleBefore:o,cycleNow:r,savedHours:c})})}const Nf=({filters:e,onFilterChange:t})=>s.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-6",children:[s.jsx("input",{type:"text",placeholder:"üîç Rechercher un client...",value:e.search,onChange:n=>t({...e,search:n.target.value}),className:"flex-1 min-w-[200px] px-4 py-2 bg-slate-800/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:outline-none"}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx("button",{onClick:()=>t({...e,views:e.views==="5+"?null:"5+"}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${e.views==="5+"?"bg-orange-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üëÅÔ∏è Vues 5+"}),s.jsx("button",{onClick:()=>t({...e,clicks:e.clicks==="1+"?null:"1+"}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${e.clicks==="1+"?"bg-green-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üñ±Ô∏è Clics 1+"}),s.jsx("button",{onClick:()=>t({...e,status:e.status==="sent"?null:"sent"}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${e.status==="sent"?"bg-blue-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üìß Envoy√©s"}),s.jsx("button",{onClick:()=>t({...e,optout:!e.optout}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${e.optout?"bg-red-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üö´ Opt-out"})]}),(e.search||e.views||e.clicks||e.status||e.optout)&&s.jsx("button",{onClick:()=>t({search:"",views:null,clicks:null,status:null,optout:!1}),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-bold text-sm transition-colors",children:"üîÑ Reset"})]});function Sf(e){const t=Math.floor((new Date().getTime()-new Date(e).getTime())/1e3);return t<60?"√Ä l'instant":t<3600?`Il y a ${Math.floor(t/60)}min`:t<86400?`Il y a ${Math.floor(t/3600)}h`:t<604800?`Il y a ${Math.floor(t/86400)}j`:new Date(e).toLocaleDateString("fr-FR")}function Bs(e){return e.toLocaleString("fr-FR")+" ‚Ç¨"}function kf(e){if(!e.last_email_sent)return"Imm√©diat";const t=new Date(e.created_at),n=new Date(e.last_email_sent),a=Math.floor((new Date().getTime()-t.getTime())/864e5);if(a>120)return"Termin√©";const o=a<=60?3:7,r=new Date(n);return r.setDate(r.getDate()+o),r.toLocaleDateString("fr-FR")}const Ha={MUET:{label:"SILENCE",class:"bg-zinc-800/50 text-zinc-400 border border-zinc-700/50",description:"Client inactif"},CAS_LIMITE:{label:"CONTACT EXCESSIF",class:"bg-amber-900/20 text-amber-200/80 border border-amber-800/30",description:"Sur-engagement"},AGIT√â:{label:"AGIT√â",class:"bg-orange-900/20 text-orange-200/80 border border-orange-800/30",description:"Risque annulation"},INT√âRESS√â:{label:"INT√âRESS√â",class:"bg-emerald-900/20 text-emerald-200/80 border border-emerald-800/30",description:"Opportunit√©"},STABLE:{label:"STABLE",class:"bg-zinc-900 text-zinc-500 border border-zinc-800",description:"Sous surveillance"},FATIGUE:{label:"INACTIF",class:"bg-red-900/10 text-red-300 border border-red-900/20",description:"Lead dormant"}},Go=({study:e,antiAnnulationByStudy:t,postRefusByStudy:n,onSignStudy:i,onCancelStudy:a,onDeleteStudy:o,onMarkDepositPaid:r,onMarkRibSent:l,showActions:c=!0,leads:d=[]})=>{var M,P,I;const u=ir(e),p=Ha[u.state]||Ha.STABLE,h=T=>T&&T.sent&&T.sent.length>0,m=t?t[String(e.id)]||t[String(e.client_id)]:null,f=n?n[String(e.id)]||n[String(e.client_id)]:null,y=(d||[]).find(T=>!!(T.study_id&&T.study_id===e.id||T.client_id&&T.client_id===e.client_id||T.client_email&&e.email&&T.client_email.toLowerCase().trim()===e.email.toLowerCase().trim()&&T.client_email!=="Pas d'email")),b=y?{total_opens:y.total_opens||0,sent:y.last_email_sent?[{sent_at:y.last_email_sent,opened_at:y.last_opened_at}]:[],next:y.next_email_date?{scheduled_for:y.next_email_date}:null}:null;let w=null,j=null;e.status==="signed"?h(m)?(w="anti-annulation",j=m):h(f)&&(w="post-refus",j=f):h(f)?(w="post-refus",j=f):h(m)?(w="anti-annulation",j=m):h(b)&&(w="prospection",j=b),w||(e.status==="signed"?m!=null&&m.next?(w="anti-annulation",j=m):f!=null&&f.next?(w="post-refus",j=f):(w="anti-annulation",j=m):f!=null&&f.next?(w="post-refus",j=f):m!=null&&m.next?(w="anti-annulation",j=m):b!=null&&b.next?(w="prospection",j=b):(w="post-refus",j=f));let k=Math.max(((M=j==null?void 0:j.sent)==null?void 0:M.length)||0,(y==null?void 0:y.email_sequence_step)||0,e.send_count||0);e.views>0&&k===0&&(k=1),(P=e.name)!=null&&P.toUpperCase().includes("GUYOT")&&console.log("üéØ GUYOT SELECTED FLOW:",{flowType:w,sentLength:(I=j==null?void 0:j.sent)==null?void 0:I.length,leadStep:y==null?void 0:y.email_sequence_step,studySendCount:e.send_count,finalStep:k});const C=5,_=j!=null&&j.sent&&j.sent.length>0?j.sent[j.sent.length-1]:null,g=(j==null?void 0:j.next)||null;!w&&(e.views>0||e.last_view)&&(w=e.status==="signed"?"anti-annulation":"post-refus",j={total_opens:e.views||0,sent:e.last_view?[{sent_at:e.last_view,opened_at:e.last_view}]:[],next:null,is_fallback:!0},k=Math.min(5,Math.max(1,Math.floor((e.views||0)/2))));const x=Math.min(100,Math.max(0,e.cancellationRisk||e.dangerScore||0)),v=x>80,S=e.payment_mode==="cash"||e.financing_mode==="cash_payment"||e.financing_mode==="cash",A=w==="anti-annulation"||w==="post-refus"?S?"cash":"financement":"prospection";return s.jsxs("div",{className:"group relative mb-4",children:[s.jsx("div",{className:`absolute -inset-0.5 rounded-2xl bg-gradient-to-r from-blue-500/50 to-indigo-600/50 opacity-0 blur-sm group-hover:opacity-30 transition duration-500 ${v?"from-orange-600/50 to-red-600/50 group-hover:opacity-40":""}`}),s.jsxs("div",{className:"relative backdrop-blur-xl rounded-2xl bg-slate-950/40 border border-white/5 p-6 flex flex-col lg:grid lg:grid-cols-[220px_1fr_200px_120px_auto] lg:items-center gap-6 transition-all hover:bg-slate-900/40 hover:border-white/10 shadow-lg",children:[s.jsxs("div",{className:"flex flex-col gap-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("div",{className:"w-1.5 h-1.5 flex-shrink-0 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.8)]"}),s.jsx(fl,{status:e.status}),e.status==="signed"&&s.jsx(ze,{className:"w-3.5 h-3.5 text-emerald-400"})]}),s.jsxs("h3",{className:"text-white font-black tracking-tight text-base lg:text-lg uppercase leading-none mb-1",children:[e.name.split(" ")[0],s.jsx("br",{}),s.jsx("span",{className:"text-blue-400",children:e.name.split(" ").slice(1).join(" ")})]}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 font-mono truncate",children:[s.jsx("span",{className:"opacity-60 text-[10px] flex-shrink-0",children:"üìß"}),s.jsx("span",{className:"truncate",children:e.email})]}),S&&s.jsx("div",{className:"flex items-center gap-2 mt-1",children:s.jsxs("span",{className:"px-2 py-0.5 rounded text-[10px] bg-amber-500/10 border-amber-500/20 text-amber-400 font-black uppercase tracking-tighter shadow-[0_0_8px_rgba(251,191,36,0.2)]",children:["CASH ",e.has_deposit?"+ ACOMPTE":""]})}),s.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[s.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-black uppercase border ${p.class}`,children:p.label.replace(/^[^\s]+\s/,"")}),e.contract_secured&&s.jsx("span",{className:"px-2 py-0.5 bg-emerald-500/20 text-emerald-400 border border-emerald-500/30 rounded text-[10px] font-black uppercase flex items-center gap-1",children:"üõ°Ô∏è S√âCURIS√â"}),e.rib_sent&&s.jsx("span",{className:"px-2 py-0.5 bg-blue-500/20 text-blue-400 border border-blue-500/30 rounded text-[10px] font-black uppercase",children:"üìÑ RIB OK"}),s.jsxs("span",{className:"px-2 py-0.5 rounded bg-slate-800/50 border border-white/5 text-[10px] font-bold text-slate-400 font-mono flex items-center gap-1",children:["üóìÔ∏è J+",e.daysSinceSigned||e.diffDays||0]})]})]}),s.jsx("div",{className:"hidden lg:flex flex-col gap-3 px-8 border-x border-white/5 min-h-[100px] justify-center",children:w?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between items-center text-[10px] text-slate-500 font-black uppercase tracking-[0.2em]",children:[s.jsxs("span",{className:"flex items-center gap-1.5",children:[s.jsx(xi,{className:"w-3 h-3 text-blue-400"}),"Engagement Flow"]}),s.jsxs("span",{className:"bg-blue-500/10 text-blue-400 px-2 py-0.5 rounded-full border border-blue-500/20",children:[e.views||0," VUES"]})]}),s.jsx("div",{className:"h-2 w-full bg-slate-800/50 rounded-full overflow-hidden flex gap-1.5 p-[2px] border border-white/5",children:[1,2,3,4,5].map(T=>s.jsx("div",{className:`h-full flex-1 rounded-sm transition-all duration-700 ${T<=k?"bg-gradient-to-r from-blue-600 to-indigo-500 shadow-[0_0_12px_rgba(59,130,246,0.4)]":"bg-slate-700/50"}`},T))}),s.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-slate-600 tracking-widest uppercase",children:[s.jsx("span",{children:"S√©quence Auto"}),s.jsxs("span",{children:[k,"/",C," Envoy√©s"]})]}),s.jsxs("div",{className:`flex flex-col gap-2 p-3 rounded-lg border mt-1 ${w==="anti-annulation"?"bg-emerald-500/5 border-emerald-500/20 shadow-[0_4px_12px_rgba(16,185,129,0.1)]":w==="post-refus"?"bg-red-500/5 border-red-500/20 shadow-[0_4px_12px_rgba(239,68,68,0.1)]":"bg-blue-500/5 border-blue-500/20 shadow-[0_4px_12px_rgba(59,130,246,0.1)]"}`,children:[s.jsx("div",{className:`flex items-center gap-2 text-[10px] font-black uppercase tracking-widest ${w==="anti-annulation"?"text-emerald-400":w==="post-refus"?"text-red-400":"text-blue-400"}`,children:w==="anti-annulation"?`üõ°Ô∏è ANTI-ANNULATION ${A.toUpperCase()}`:w==="post-refus"?`‚ùå POST-REFUS ${A.toUpperCase()}`:"üöÄ PROSPECTION"}),_?s.jsxs("div",{className:"flex flex-col gap-1.5",children:[s.jsxs("div",{className:"flex justify-between items-center text-[9px]",children:[s.jsx("span",{className:"text-slate-600 font-bold",children:"Dernier :"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:`font-mono font-bold ${w==="anti-annulation"?"text-emerald-400":w==="post-refus"?"text-red-400":"text-blue-400"}`,children:["j",[0,1,3,7,14][k-1]||0," ",A]}),s.jsxs("span",{className:"text-slate-500 font-mono",children:["(",new Date(_.sent_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"}),")"]})]})]}),s.jsxs("div",{className:"flex justify-between items-center text-[9px]",children:[s.jsx("span",{className:"text-slate-700 font-bold",children:"Ouvertures :"}),s.jsxs("div",{className:"flex items-center gap-2",children:[_.opened_at&&s.jsxs("span",{className:"text-[8px] text-slate-500 font-mono",children:["Lu le: ",new Date(_.opened_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})," √† ",new Date(_.opened_at).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]}),s.jsxs("span",{className:`font-mono font-bold px-1.5 py-0.5 rounded ${j.total_opens>0?w==="anti-annulation"?"bg-emerald-500/10 text-emerald-400":w==="post-refus"?"bg-red-500/10 text-red-400":"bg-blue-500/10 text-blue-400":"bg-slate-800 text-slate-600"}`,children:[j.total_opens||0,"x"]})]})]})]}):s.jsx("div",{className:"text-[10px] text-slate-500 italic py-1",children:"‚åõ En attente du premier envoi..."}),k<C&&s.jsx("div",{className:"flex flex-col gap-1.5 border-t border-white/5 pt-2 mt-1",children:s.jsxs("div",{className:"flex justify-between items-center text-[9px]",children:[s.jsx("span",{className:"text-slate-600 font-bold",children:"Prochain :"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"text-orange-400 font-mono font-bold",children:["j",[0,1,3,7,14][k]||"?"," ",A]}),g?s.jsxs("span",{className:"text-orange-400/60 font-mono",children:["‚Üí ",new Date(g.scheduled_for).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})]}):s.jsx("span",{className:"text-slate-500/50 font-mono text-[8px] uppercase tracking-wider border border-slate-700/30 px-1.5 py-0.5 rounded",children:"Non planifi√©"})]})]})}),k>=C&&s.jsx("div",{className:`flex items-center justify-center gap-1 rounded-md px-2 py-1.5 border mt-1 font-black text-[8px] uppercase tracking-widest ${w==="anti-annulation"?"bg-emerald-500/10 border-emerald-500/30 text-emerald-400":w==="post-refus"?"bg-red-500/10 border-red-500/30 text-red-400":"bg-blue-500/10 border-blue-500/30 text-blue-400"}`,children:"‚úÖ S√âQUENCE TERMIN√âE"})]})]}):s.jsxs("div",{className:"text-center py-4",children:[s.jsx("div",{className:"text-[10px] text-slate-600 font-black uppercase tracking-widest mb-1 opacity-50",children:"Engagement Flow"}),s.jsx("div",{className:"text-xs text-slate-500 italic",children:"Aucune s√©quence active d√©tect√©e"})]})}),s.jsxs("div",{className:"flex flex-col items-end justify-center h-full min-w-[180px] gap-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[s.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-[0.2em]",children:"VALEUR DOSSIER"}),e.financing_mode&&s.jsx("span",{className:`text-[8px] px-1.5 py-0.5 rounded-md border font-black tracking-widest ${e.financing_mode==="cash_payment"?"bg-indigo-500/10 border-indigo-500/30 text-indigo-400":"bg-blue-500/10 border-blue-500/30 text-blue-400"}`,children:e.financing_mode==="cash_payment"?"COMPTANT":"FINANC√â"})]}),s.jsx("div",{className:"text-3xl font-black text-white tracking-tighter mb-1 select-none",children:Bs(e.total_price)}),s.jsxs("div",{className:"flex flex-col items-end gap-1.5 w-full",children:[e.cash_apport>0&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-yellow-500/5 border border-yellow-500/10 w-full justify-end",children:[s.jsx(yl,{className:"w-3 h-3 text-yellow-500/70"}),s.jsxs("span",{className:"text-[9px] font-black text-yellow-500/90 font-mono tracking-tight uppercase",children:["APPORT: ",Bs(e.cash_apport)]})]}),e.status==="signed"&&e.has_deposit&&s.jsx("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-[9px] font-black uppercase w-full justify-end
                ${e.deposit_paid?"bg-emerald-500/5 border-emerald-500/10 text-emerald-400/80":"bg-orange-500/5 border-orange-500/10 text-orange-400/80"}`,children:e.deposit_paid?"‚úÖ R√®glement Acompte":`‚è≥ Acompte: ${Bs(e.deposit_amount||1500)}`})]})]}),s.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 px-8 border-l border-white/5 h-full min-w-[160px]",children:[s.jsxs("div",{className:"relative w-16 h-16 flex-shrink-0 group/gauge",children:[s.jsxs("svg",{className:"w-full h-full -rotate-90 transform",viewBox:"0 0 36 36",children:[s.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",className:"stroke-slate-800/60",strokeWidth:"2"}),s.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",className:`${v?"stroke-orange-500":"stroke-blue-500"} transition-all duration-1000 ease-out`,strokeWidth:"2",strokeDasharray:`${x}, 100`,strokeLinecap:"round",stroke:"currentColor"})]}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsxs("span",{className:"text-sm font-black text-white font-mono tracking-tighter",children:[x,"%"]})})]}),s.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[s.jsx("span",{className:"text-[8px] text-slate-600 font-black uppercase tracking-[0.3em]",children:"RISQUE"}),s.jsx("div",{className:`px-4 py-1 rounded-lg border ${p.class} uppercase text-[10px] font-black tracking-[0.15em] shadow-lg whitespace-nowrap`,children:p.label.replace(/^[^\s]+\s/,"")})]})]}),c&&s.jsxs("div",{className:"flex flex-row lg:flex-col gap-2 border-l border-white/5 pl-4 ml-4",children:[s.jsx("button",{onClick:()=>{const T=typeof window<"u"?window.location.origin:"";T?window.open(`${T}/guest/${e.id}`,"_blank"):console.error("‚ùå Impossible d'ouvrir l'√©tude : URL de base introuvable")},className:"p-2.5 rounded-xl bg-white/5 border border-white/10 text-slate-400 hover:text-white hover:bg-white/10 transition-all active:scale-95",title:"Voir Document",children:s.jsx(xi,{className:"w-4 h-4"})}),s.jsxs("button",{onClick:()=>{e.phone?window.location.href=`tel:${e.phone}`:alert("Num√©ro de t√©l√©phone non renseign√©")},className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-blue-600/20 border border-blue-500/30 text-blue-400 hover:bg-blue-600/30 hover:text-blue-300 transition-all active:scale-95 shadow-lg shadow-blue-900/20",title:"Appeler Client",children:[s.jsx("span",{className:"text-sm",children:"üìû"}),s.jsx("span",{className:"text-[10px] font-black uppercase tracking-tight",children:"Appeler"})]}),e.status!=="signed"&&e.status!=="cancelled"&&i&&s.jsxs("button",{onClick:()=>i(e.id,e.name),className:"group/sign relative p-2.5 rounded-xl bg-gradient-to-br from-emerald-600/20 to-emerald-500/10 border border-emerald-500/40 text-emerald-400 hover:from-emerald-600/30 hover:to-emerald-500/20 hover:text-emerald-300 hover:border-emerald-400/60 transition-all active:scale-95 shadow-lg shadow-emerald-900/30 hover:shadow-emerald-900/50",title:"Signer le Dossier",children:[s.jsx("div",{className:"absolute inset-0 rounded-xl bg-emerald-500/20 blur-md opacity-0 group-hover/sign:opacity-100 transition-opacity duration-300"}),s.jsx("span",{className:"relative text-base",children:"‚úçÔ∏è"})]}),e.status!=="cancelled"&&a&&s.jsxs("button",{onClick:()=>a(e.id,e.name),className:"group/cancel relative p-2.5 rounded-xl bg-gradient-to-br from-red-600/20 to-red-500/10 border border-red-500/40 text-red-400 hover:from-red-600/30 hover:to-red-500/20 hover:text-red-300 hover:border-red-400/60 transition-all active:scale-95 shadow-lg shadow-red-900/30 hover:shadow-red-900/50",title:"Annuler l'√âtude",children:[s.jsx("div",{className:"absolute inset-0 rounded-xl bg-red-500/20 blur-md opacity-0 group-hover/cancel:opacity-100 transition-opacity duration-300"}),s.jsx("span",{className:"relative text-base",children:"‚ùå"})]}),e.status==="signed"&&e.has_deposit&&!e.deposit_paid&&r&&s.jsxs("button",{onClick:()=>r(e.id,e.name),className:"group/deposit relative p-2.5 rounded-xl bg-gradient-to-br from-green-600/20 to-green-500/10 border border-green-500/40 text-green-400 hover:from-green-600/30 hover:to-green-500/20 hover:text-green-300 hover:border-green-400/60 transition-all active:scale-95 shadow-lg shadow-green-900/30 hover:shadow-green-900/50",title:"Marquer Acompte Pay√©",children:[s.jsx("div",{className:"absolute inset-0 rounded-xl bg-green-500/20 blur-md opacity-0 group-hover/deposit:opacity-100 transition-opacity duration-300"}),s.jsx("span",{className:"relative text-base",children:"üí∞"})]})]})]})]})},_f=({studies:e,filters:t,emailFlowByClient:n,antiAnnulationByStudy:i,postRefusByStudy:a,leads:o,onSignStudy:r,onCancelStudy:l,onDeleteStudy:c})=>{let d=e.filter(u=>{var p,h;if(u.status==="signed")return!1;if(t.search){const m=t.search.toLowerCase(),f=((p=u.name)==null?void 0:p.toLowerCase())||"",y=((h=u.email)==null?void 0:h.toLowerCase())||"";if(!f.includes(m)&&!y.includes(m))return!1}return!(t.views==="5+"&&u.views<5||t.clicks==="1+"&&u.clicks<1||t.status&&u.status!==t.status||t.optout&&!u.email_optout)});return d=d.sort((u,p)=>{const h={hot:0,warm:1,cold:2,signed:3},m=ji(u),f=ji(p);return h[m]-h[f]}),s.jsx("div",{className:"mb-8",children:d.length===0?s.jsxs("div",{className:"p-8 bg-slate-800/30 border border-slate-700/50 rounded-2xl text-center",children:[s.jsx("div",{className:"text-4xl mb-3",children:"üîç"}),s.jsx("div",{className:"text-lg font-bold text-slate-400",children:"Aucun dossier trouv√©"}),s.jsx("div",{className:"text-sm text-slate-500 mt-2",children:"Ajustez vos filtres ou crit√®res de recherche"})]}):s.jsx("div",{className:"space-y-3",children:d.map(u=>s.jsx(Go,{study:u,antiAnnulationByStudy:i,postRefusByStudy:a,leads:o,onSignStudy:r,onCancelStudy:l,onDeleteStudy:c},u.id))})})},Cf=({studies:e,metrics:t,filters:n,antiAnnulationByStudy:i,postRefusByStudy:a,leads:o,onSignStudy:r,onMarkDepositPaid:l,onMarkRibSent:c,onCancelStudy:d,onDeleteStudy:u})=>{const m=t.signed.filter(y=>{if(n.search){const b=n.search.toLowerCase();if(!y.name.toLowerCase().includes(b)&&!y.email.toLowerCase().includes(b))return!1}return!(n.views==="5+"&&(y.views||0)<5||n.clicks==="1+"&&(y.clicks||0)<1||n.optout&&!y.email_optout)}).sort((y,b)=>{var k,C;if((k=y.name)!=null&&k.toUpperCase().includes("GUYOT"))return-1;if((C=b.name)!=null&&C.toUpperCase().includes("GUYOT"))return 1;const w=y.daysLate||0;return(b.daysLate||0)-w}),f=m.filter(y=>y.requiresDeposit&&!y.deposit_paid&&y.financing_mode!=="full_financing").length;return s.jsxs("div",{id:"late-deposits-section",className:"mb-8",children:[s.jsx("div",{className:"flex items-center justify-between mb-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-3xl",children:"‚úÖ"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white",children:"AXE A ‚Äî DOSSIERS SIGN√âS (HISTORIQUE)"}),s.jsxs("div",{className:"text-sm text-slate-400",children:[m.length," dossiers au total ‚Ä¢"," ",s.jsxs("span",{className:`${f>0?"text-red-400":"text-emerald-400"} font-bold`,children:[f," en attente d'acompte"]})]})]})]})}),m.length===0?s.jsxs("div",{className:"p-8 bg-slate-800/30 border border-slate-700/50 rounded-2xl text-center",children:[s.jsx("div",{className:"text-4xl mb-3",children:"üéâ"}),s.jsx("div",{className:"text-lg font-bold text-emerald-400",children:"Tous les acomptes sont √† jour !"}),s.jsx("div",{className:"text-sm text-slate-500 mt-2",children:"Aucun retard hors War Room"})]}):s.jsx("div",{className:"space-y-3",children:m.map(y=>s.jsx(Go,{study:y,antiAnnulationByStudy:i,postRefusByStudy:a,leads:o,onMarkDepositPaid:l,onMarkRibSent:c,onCancelStudy:d,onDeleteStudy:u},y.id))})]})},dt={clicked:"#3DDC97",opened:"#7CA3BA",sentNeg:"#2A3142"},Tf=({data:e,width:t,height:n})=>{const{showTooltip:i,hideTooltip:a,tooltipData:o,tooltipLeft:r,tooltipTop:l}=Ya(),c={top:15,bottom:25,left:10,right:10},d=t-c.left-c.right,u=n-c.top-c.bottom,p=e.map(f=>({date:f.date,originalTotal:f.count,originalOpened:f.opened||0,originalClicked:f.clicked||0})),h=gn({range:[0,d],round:!0,domain:p.map(f=>f.date),padding:.4}),m=Ae({range:[u,0],round:!0,domain:[0,Math.max(...e.flatMap(f=>[f.count,f.opened||0,f.clicked||0]))||10]});return s.jsxs("div",{className:"relative",children:[s.jsx("svg",{width:t,height:n,children:s.jsxs(ie,{top:c.top,left:c.left,children:[p.map(f=>{const y=h.bandwidth(),b=h(f.date)||0,w=1,j=(y-w*2)/3,k=u-m(f.originalTotal),C=u-m(f.originalOpened),_=u-m(f.originalClicked);return s.jsxs(ie,{left:b,children:[s.jsx("rect",{x:0,y:u-k,width:j,height:k,fill:dt.sentNeg,rx:2,opacity:.8,onMouseMove:g=>{const x=Qt(g)||{x:0,y:0};i({tooltipData:f,tooltipLeft:x.x,tooltipTop:x.y})},onMouseLeave:()=>a(),style:{cursor:"pointer"}}),s.jsx("rect",{x:j+w,y:u-C,width:j,height:C,fill:dt.opened,rx:2,opacity:.9,style:{filter:"drop-shadow(0 0 3px rgba(124,163,186,0.3))",cursor:"pointer"},onMouseMove:g=>{const x=Qt(g)||{x:0,y:0};i({tooltipData:f,tooltipLeft:x.x,tooltipTop:x.y})},onMouseLeave:()=>a()}),s.jsx("rect",{x:(j+w)*2,y:u-_,width:j,height:_,fill:dt.clicked,rx:2,opacity:1,style:{filter:"drop-shadow(0 0 4px rgba(61,220,151,0.4))",cursor:"pointer"},onMouseMove:g=>{const x=Qt(g)||{x:0,y:0};i({tooltipData:f,tooltipLeft:x.x,tooltipTop:x.y})},onMouseLeave:()=>a()})]},`bar-group-${f.date}`)}),s.jsx(ht,{top:u,scale:h,stroke:"rgba(255,255,255,0.1)",tickStroke:"rgba(255,255,255,0.1)",tickLabelProps:()=>({fill:"#ffffff",fontSize:10,opacity:.5,textAnchor:"middle",fontFamily:"sans-serif",fontWeight:500}),tickFormat:f=>new Date(f).toLocaleDateString("fr-FR",{day:"numeric",month:"numeric"})})]})}),o&&s.jsx(Xa,{top:l,left:r,style:{...Za,background:"rgba(15, 23, 42, 0.95)",border:"1px solid rgba(255, 255, 255, 0.1)",padding:"12px",color:"white",borderRadius:"12px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.5)",fontSize:"11px",backdropFilter:"blur(8px)",pointerEvents:"none"},children:s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("div",{className:"font-bold text-slate-400 uppercase tracking-widest text-[9px] mb-1",children:new Date(o.date).toLocaleDateString("fr-FR",{day:"numeric",month:"long"})}),s.jsxs("div",{className:"flex justify-between gap-4",children:[s.jsx("span",{className:"text-slate-500 font-bold uppercase",children:"Emails Envoy√©s"}),s.jsx("span",{className:"font-mono text-white",children:o.originalTotal})]}),s.jsxs("div",{className:"flex justify-between gap-4",children:[s.jsx("span",{className:"text-indigo-400 font-bold uppercase",children:"Emails Ouverts"}),s.jsx("span",{className:"font-mono text-white",children:o.originalOpened})]}),s.jsxs("div",{className:"flex justify-between gap-4",children:[s.jsx("span",{className:"text-[#3DDC97] font-bold uppercase",children:"Emails Cliqu√©s"}),s.jsx("span",{className:"font-mono text-white font-bold",children:o.originalClicked})]})]})},Math.random())]})},Af=({data:e})=>!e||e.length===0?null:s.jsxs("div",{className:"w-full h-48 rounded-2xl p-6 border flex flex-col justify-between backdrop-blur-xl",style:{background:"rgba(255,255,255,0.03)",borderColor:"rgba(255,255,255,0.08)",boxShadow:"0 8px 32px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.03)"},children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-[11px] uppercase tracking-widest text-white/50 font-black mb-1",children:"Pression d'envoi (14 jours)"}),s.jsx("div",{className:"flex items-center gap-3",children:s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500"}),s.jsx("span",{className:"text-[10px] text-indigo-200 font-bold uppercase",children:"Activit√© Totale"})]})})]}),s.jsxs("div",{className:"flex items-center gap-4 bg-white/5 px-3 py-1.5 rounded-lg border border-white/5",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{background:dt.sentNeg,opacity:.8}}),s.jsx("span",{className:"text-[9px] text-white/40 font-bold uppercase tracking-wider",children:"Envoy√©s"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{background:dt.opened,opacity:.9}}),s.jsx("span",{className:"text-[9px] text-white/50 font-bold uppercase tracking-wider",children:"Ouverts"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{background:dt.clicked,opacity:.95}}),s.jsx("span",{className:"text-[9px] text-[#3DDC97] font-bold uppercase tracking-wider",children:"Cliqu√©s"})]})]})]}),s.jsx("div",{className:"w-full h-32 relative",children:s.jsx(pt,{children:({width:t,height:n})=>s.jsx(Tf,{data:e,width:t,height:n})})})]}),Ef=({leads:e,trafficData:t,globalFilters:n,onSetOptOut:i,onDeleteLead:a})=>{const[o,r]=N.useState({search:"",today:!1,optedOut:!1});let l=e.filter(c=>{const d=((n==null?void 0:n.search)||o.search).toLowerCase();if(d&&!c.client_name.toLowerCase().includes(d)&&!c.client_email.toLowerCase().includes(d))return!1;if(o.today&&c.next_email_date){const u=new Date().toDateString(),p=new Date(c.next_email_date).toDateString();if(u!==p)return!1}return!(o.optedOut&&!c.opted_out)});return l=l.sort((c,d)=>c.next_email_date?d.next_email_date?new Date(c.next_email_date).getTime()-new Date(d.next_email_date).getTime():-1:1),s.jsxs("div",{className:"mb-8",children:[s.jsx("div",{className:"flex items-center justify-between mb-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-3xl",children:"üìß"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white",children:"AXE C ‚Äî LEADS EMAIL (AUTOMATISATION)"}),s.jsxs("div",{className:"text-sm text-slate-400",children:[l.length," lead",l.length>1?"s":""," en nurturing"]})]})]})}),s.jsx("div",{className:"mb-8",children:s.jsx(Af,{data:t})}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-6",children:[s.jsx("input",{type:"text",placeholder:"üîç Rechercher un lead...",value:o.search,onChange:c=>r({...o,search:c.target.value}),className:"flex-1 min-w-[200px] px-4 py-2 bg-slate-800/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:outline-none"}),s.jsx("button",{onClick:()=>r({...o,today:!o.today}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${o.today?"bg-green-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üìÖ Aujourd'hui"}),s.jsx("button",{onClick:()=>r({...o,optedOut:!o.optedOut}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${o.optedOut?"bg-red-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üö´ D√©sabonn√©s"}),(o.search||o.today||o.optedOut)&&s.jsx("button",{onClick:()=>r({search:"",today:!1,optedOut:!1}),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-bold text-sm transition-colors",children:"üîÑ Reset"})]}),l.length===0?s.jsxs("div",{className:"p-8 bg-slate-800/30 border border-slate-700/50 rounded-2xl text-center",children:[s.jsx("div",{className:"text-4xl mb-3",children:"üîç"}),s.jsx("div",{className:"text-lg font-bold text-slate-400",children:"Aucun lead trouv√©"})]}):s.jsx("div",{className:"space-y-3",children:l.map(c=>{const d=kf(c),u=c.next_email_date&&new Date(c.next_email_date).toDateString()===new Date().toDateString();return s.jsx("div",{className:`rounded-xl p-5 border-2 transition-all ${c.opted_out?"bg-red-500/10 border-red-500/50":u?"bg-green-500/10 border-green-500/50":"bg-slate-800/50 border-slate-700/50 hover:bg-slate-800/70"}`,children:s.jsxs("div",{className:"grid grid-cols-[2fr_minmax(180px,1.2fr)_1.2fr_auto] gap-4 items-center",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("div",{className:"flex items-center gap-3 mb-1",children:s.jsx("div",{className:"text-2xl font-black text-white uppercase tracking-tight leading-none",children:c.client_name})}),s.jsx("div",{className:"text-sm text-slate-400 font-medium ml-0.5",children:c.client_email})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsxs("span",{className:"px-2 py-0.5 bg-blue-900/40 border border-blue-500/30 text-blue-300 rounded text-[10px] font-bold uppercase flex items-center gap-1",children:[s.jsx("span",{children:"üîÑ"})," √âTAPE ",c.email_sequence_step]}),c.opted_out&&s.jsx("span",{className:"px-2 py-0.5 bg-red-500/20 text-red-400 border border-red-500/30 rounded text-[10px] font-bold uppercase",children:"üö´ D√âSABONN√â"})]})]}),s.jsx("div",{children:s.jsxs("div",{className:"pl-4 border-l border-white/5",children:[s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Engagement"}),s.jsxs("div",{className:"flex items-end gap-3 mb-2",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-2xl font-black text-white leading-none",children:c.total_opens}),s.jsx("span",{className:"text-[10px] text-slate-500 uppercase font-bold",children:"Ouvertures"})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-2xl font-black text-white leading-none",children:c.total_clicks}),s.jsx("span",{className:"text-[10px] text-slate-500 uppercase font-bold",children:"Clics"})]})]})]})}),s.jsx("div",{children:s.jsxs("div",{className:"pl-4 border-l border-white/5 space-y-2",children:[s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider",children:"Prochaine relance"}),(()=>{let p=!1;if(d!=="Imm√©diat"&&d!=="Termin√©"){const[h,m,f]=d.split("/");if(h&&m&&f){const y=new Date(parseInt(f),parseInt(m)-1,parseInt(h)),b=new Date;b.setHours(0,0,0,0),y<b&&(p=!0)}}return s.jsx("div",{className:`text-sm font-bold ${p?"text-red-400 animate-pulse":d==="Imm√©diat"||u?"text-green-400":"text-white"}`,children:p?`üî• RETARD (${d})`:d==="Imm√©diat"?"üî• Imm√©diat":d})})()]}),c.last_email_sent?s.jsxs("div",{className:"text-xs font-bold text-slate-400 flex items-center gap-1.5 mt-1",children:[s.jsx("span",{children:"üìß"})," Email envoy√© le"," ",new Date(c.last_email_sent).toLocaleDateString("fr-FR")]}):s.jsx("div",{className:"text-[10px] font-medium text-slate-600 italic mt-1",children:"üí§ Aucun envoi"})]})}),s.jsxs("div",{className:"flex flex-col gap-2 pl-4 border-l border-transparent",children:[!c.opted_out&&s.jsx("button",{onClick:()=>{confirm(`D√©sabonner ${c.client_name} ?`)&&i(c.client_email)},className:"w-full h-10 bg-red-600/20 hover:bg-red-600 text-red-500 hover:text-white border border-red-500/30 rounded-lg font-bold text-xs uppercase tracking-wide transition-all flex items-center justify-center gap-2",children:"üö´ Opt-out"}),s.jsx("button",{onClick:()=>{confirm(`Supprimer d√©finitivement ${c.client_name} ?`)&&a(c.client_id,c.client_email,c.client_name)},className:"w-full h-9 bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white border border-slate-700 rounded-lg font-bold text-[10px] uppercase tracking-wide transition-all flex items-center justify-center gap-2",children:"üóëÔ∏è Supprimer"})]})]})},c.id)})})]})},Df=({system:e})=>{const{studies:t,metrics:n,emailLeads:i,trafficData:a,antiAnnulationByStudy:o,postRefusByStudy:r,emailFlowByClient:l,actions:{signStudy:c,cancelStudy:d,deleteStudy:u,markDepositPaid:p,markRibSent:h,setOptOut:m,deleteLeadPermanently:f}}=e,[y,b]=N.useState({search:"",views:null,clicks:null,status:null,optout:!1});return s.jsxs("div",{className:"space-y-12",children:[s.jsx("div",{className:"flex items-center justify-between mb-8",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-3xl",children:"üóÑÔ∏è"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white uppercase tracking-wider",children:"Registres & Data"}),s.jsx("div",{className:"text-sm text-emerald-400 font-medium",children:"Historique complet et gestion du pipeline"})]})]})}),s.jsx(Nf,{filters:y,onFilterChange:b}),s.jsx(Cf,{studies:t,metrics:n,filters:y,antiAnnulationByStudy:o,postRefusByStudy:r,leads:i,onSignStudy:c,onMarkDepositPaid:p,onMarkRibSent:h,onCancelStudy:d,onDeleteStudy:u}),s.jsxs("div",{className:"mt-16",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("span",{className:"text-3xl",children:"üöÄ"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white",children:"AXE B ‚Äî PIPELINE (WARM & HOT)"}),s.jsx("div",{className:"text-sm text-slate-400",children:"Focus: Conversion & Momentum"})]})]}),s.jsx(_f,{studies:t,filters:y,emailFlowByClient:l,antiAnnulationByStudy:o,postRefusByStudy:r,leads:i,onSignStudy:c,onCancelStudy:d,onDeleteStudy:u})]}),s.jsx("div",{className:"mt-16",children:s.jsx(Ef,{leads:i.filter(w=>!t.some(j=>j.client_id===w.client_id)),trafficData:a,globalFilters:y,onSetOptOut:m,onDeleteLead:f})})]})},Rf=({logs:e,zenMode:t})=>{if(t)return null;const[n,i]=N.useState(!1),a=n?e:e.slice(0,10);return s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-3xl",children:"üìú"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white",children:"LOGS DE D√âCISIONS"}),s.jsxs("div",{className:"text-sm text-slate-400",children:[e.length," action",e.length>1?"s":""," enregistr√©e",e.length>1?"s":""]})]})]}),e.length>10&&s.jsx("button",{onClick:()=>i(!n),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-bold text-sm transition-colors",children:n?"‚¨ÜÔ∏è R√©duire":`‚¨áÔ∏è Voir tous (${e.length})`})]}),e.length===0?s.jsxs("div",{className:"p-8 bg-slate-800/30 border border-slate-700/50 rounded-2xl text-center",children:[s.jsx("div",{className:"text-4xl mb-3",children:"üìù"}),s.jsx("div",{className:"text-lg font-bold text-slate-400",children:"Aucune action enregistr√©e"}),s.jsx("div",{className:"text-sm text-slate-500 mt-2",children:"Les d√©cisions appara√Ætront ici"})]}):s.jsx("div",{className:"space-y-2",children:a.map(o=>{const r=new Date().getTime()-new Date(o.created_at).getTime()<36e5;return s.jsx("div",{className:`p-4 rounded-xl border transition-all ${r?"glass-panel bg-blue-500/10 border-blue-500/30 shadow-[0_0_15px_rgba(59,130,246,0.1)]":"glass-panel border-white/5 hover:border-white/10"}`,children:s.jsx("div",{className:"flex items-start justify-between gap-4",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("span",{className:"text-lg font-bold text-white",children:o.client_name}),s.jsx("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-400 border border-blue-500/30 rounded text-xs font-bold",children:o.action_performed})]}),s.jsx("p",{className:"text-sm text-slate-400 mb-1",children:o.justification}),s.jsx("div",{className:"text-xs text-slate-500",children:Sf(o.created_at)})]})})},o.id)})})]})},Mf=({system:e})=>{const{logs:t,zenMode:n}=e;return s.jsxs("div",{className:"space-y-12",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("span",{className:"text-3xl",children:"‚öôÔ∏è"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white uppercase tracking-wider",children:"Syst√®me & Logs"}),s.jsx("div",{className:"text-sm text-slate-400 font-medium",children:"Diagnostic, activit√©s en temps r√©el et √©tat du Brain"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsx(Rf,{logs:t,zenMode:n})}),s.jsx("div",{className:"space-y-6",children:s.jsxs("div",{className:"glass-panel p-6 rounded-2xl border border-white/5",children:[s.jsx("h3",{className:"text-blue-400 font-bold mb-4 uppercase text-xs tracking-widest",children:"√âtat du Cerveau"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-slate-400",children:"Version Architecture"}),s.jsx("span",{className:"text-white font-mono",children:"v2.0 (Cockpit)"})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-slate-400",children:"Mode Synchronisation"}),s.jsx("span",{className:"text-emerald-400 font-mono",children:"Real-time"})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-slate-400",children:"Latence Brain"}),s.jsx("span",{className:"text-white font-mono",children:"12ms"})]})]})]})})]})]})},tt=({active:e,onClick:t,icon:n,label:i})=>s.jsxs("button",{onClick:t,className:`
      flex items-center gap-2 px-3 py-2 rounded-lg text-xs font-bold uppercase tracking-wider transition-all
      ${e?"bg-blue-600 text-white shadow-lg shadow-blue-500/25":"text-slate-400 hover:text-white hover:bg-white/5"}
    `,children:[s.jsx("span",{children:n}),s.jsx("span",{className:"hidden md:inline",children:i})]}),Pf=({zenMode:e,priorityMode:t,onToggleZenMode:n,onTogglePriorityMode:i,onRefresh:a,lastRefresh:o,systemStatus:r="normal",totalStudies:l=0,totalClients:c=0,signedClients:d=0,unsubscribedCount:u=0,unsubscribeRate:p=0,activeSection:h,setActiveSection:m})=>{const f=c>0?Math.round(d/c*100):0,y={normal:"bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]",active:"bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]",warning:"bg-orange-500 shadow-[0_0_8px_rgba(245,158,11,0.5)] animate-pulse",critical:"bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.5)] animate-ping"},b=xl();return s.jsx("header",{className:"fixed top-4 left-4 right-4 z-50",children:s.jsxs("div",{className:"glass-panel rounded-2xl px-2 md:px-4 py-2 border border-white/10 shadow-2xl relative overflow-hidden h-16 grid grid-cols-[auto_1fr_auto] md:grid-cols-[1.2fr_auto_1fr] items-center gap-2 md:gap-4",children:[s.jsx("div",{className:"absolute top-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-blue-500/30 to-transparent"}),s.jsxs("div",{className:"flex items-center gap-4 overflow-hidden",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/20 ring-1 ring-white/10",children:s.jsx("span",{className:"text-xl",children:"‚ö°"})}),s.jsxs("div",{className:"hidden xl:block",children:[s.jsxs("h1",{className:"text-base font-black text-white tracking-widest leading-none",children:["AUTOPILOTE ",s.jsx("span",{className:"text-blue-400",children:"SOLAIRE"})]}),s.jsxs("div",{className:"text-[9px] text-zinc-500 font-bold uppercase tracking-tight mt-1 truncate",children:["Clients: ",c," ",s.jsx("span",{className:"mx-0.5 opacity-30",children:"‚Ä¢"})," Dossiers: ",l]})]})]}),s.jsxs("div",{className:"hidden lg:flex items-center gap-3 pl-4 border-l border-white/5 overflow-hidden whitespace-nowrap",children:[s.jsx("div",{className:"flex flex-col",children:s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsxs("span",{className:"text-sm font-black text-white",children:[f,"%"]}),s.jsx("div",{className:"w-8 h-1 bg-white/5 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${f}%`}})})]})}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[9px] text-emerald-500/70 font-black uppercase leading-none",children:"Sign√©s"}),s.jsx("span",{className:"text-sm font-black text-emerald-400",children:d})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[9px] text-red-500/70 font-black uppercase leading-none",children:"D√©sab."}),s.jsxs("div",{className:"flex items-baseline gap-1",children:[s.jsx("span",{className:"text-sm font-black text-red-400",children:u}),s.jsxs("span",{className:"text-[8px] text-red-500/40 font-bold",children:[p.toFixed(0),"%"]})]})]})]})]}),s.jsx("div",{className:"flex justify-center px-0 md:px-2 overflow-x-auto no-scrollbar",children:s.jsxs("div",{className:"flex items-center gap-1 bg-black/40 p-1 rounded-xl border border-white/5 shadow-inner backdrop-blur-md",children:[s.jsx(tt,{active:h==="cockpit"||h==="dashboard",onClick:()=>m("cockpit"),icon:"üõ∞Ô∏è",label:"Cockpit"}),s.jsx(tt,{active:h==="war_room",onClick:()=>m("war_room"),icon:"‚öîÔ∏è",label:"War Room"}),s.jsx(tt,{active:h==="pilotage",onClick:()=>m("pilotage"),icon:"üß≠",label:"Pilotage"}),s.jsx(tt,{active:h==="sales",onClick:()=>m("sales"),icon:"üìà",label:"Vente"}),s.jsx(tt,{active:h==="roi",onClick:()=>m("roi"),icon:"üíé",label:"ROI"}),s.jsx(tt,{active:h==="registry",onClick:()=>m("registry"),icon:"üóÇÔ∏è",label:"Registre"})]})}),s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[o&&s.jsxs("div",{className:"hidden min-[1600px]:flex items-center gap-2 px-2 py-1 rounded-lg bg-black/20 border border-white/5 whitespace-nowrap",children:[s.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${y[r]||y.normal}`}),s.jsxs("div",{className:"text-[9px] text-slate-500 font-mono font-bold",children:["SYNC: ",o.toLocaleTimeString("fr-FR")]})]}),s.jsx("button",{onClick:a,className:"w-8 h-8 flex items-center justify-center bg-white/5 hover:bg-white/10 rounded-lg text-slate-400 hover:text-white transition-all active:scale-95 group border border-white/5",children:s.jsx("span",{className:"text-xs group-hover:rotate-180 transition-transform duration-700",children:"üîÑ"})}),s.jsx("div",{className:"h-4 w-px bg-white/10 mx-1"}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsxs("button",{onClick:i,className:`h-8 px-2.5 rounded-lg font-black text-[9px] uppercase tracking-wider transition-all flex items-center gap-1.5 ${t?"bg-orange-600 text-white shadow-lg shadow-orange-600/20":"bg-white/5 text-slate-500 hover:text-slate-300"}`,children:[s.jsx("span",{children:"üî•"}),s.jsx("span",{className:"hidden sm:inline",children:"Priorit√©"})]}),s.jsxs("button",{onClick:n,className:`h-8 px-2.5 rounded-lg font-black text-[9px] uppercase tracking-wider transition-all flex items-center gap-1.5 ${e?"bg-violet-600 text-white shadow-lg shadow-violet-600/20":"bg-white/5 text-slate-500 hover:text-slate-300"}`,children:[s.jsx("span",{children:"üßò"}),s.jsx("span",{className:"hidden sm:inline",children:"Zen"})]})]}),s.jsx("button",{onClick:()=>b("/admin"),className:"w-auto h-8 px-3 rounded-full border border-white/10 flex items-center justify-center bg-slate-900 ml-1 flex-shrink-0 hover:bg-slate-800 hover:border-orange-500/50 hover:text-orange-500 transition-all cursor-pointer group",children:s.jsx("span",{className:"text-[10px] font-black text-slate-400 group-hover:text-orange-500 transition-colors",children:"ADMIN"})})]})]})})},If=({progress:e,step:t})=>{const n=[{id:1,label:"Connexion",threshold:15},{id:2,label:"Chargement",threshold:35},{id:3,label:"Analyse",threshold:60},{id:4,label:"Calcul",threshold:85}];return s.jsxs("div",{className:"fixed inset-0 z-50 bg-[#020617] flex items-center justify-center overflow-hidden",children:[s.jsx("style",{children:`
  @keyframes scan-line {
    0% { transform: translateY(-100%); }
    100% { transform: translateY(100%); }
  }
  .scan-overlay {
    background: linear-gradient(to bottom, transparent, rgba(59, 130, 246, 0.1), transparent);
    animation: scan-line 3s linear infinite;
  }
`}),s.jsx("div",{className:"absolute inset-0 scan-overlay pointer-events-none"}),s.jsxs("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden",children:[s.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-blue-600/10 rounded-full blur-[120px] animate-pulse-soft"}),s.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-purple-600/10 rounded-full blur-[120px] animate-pulse-soft",style:{animationDelay:"1s"}})]}),s.jsxs("div",{className:"relative z-10 flex flex-col items-center gap-10 p-12 w-full max-w-3xl",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"w-32 h-32 glass-panel rounded-3xl flex items-center justify-center shadow-[0_0_40px_rgba(59,130,246,0.3)]",children:s.jsx("span",{className:"text-6xl filter drop-shadow-[0_0_15px_rgba(255,255,255,0.5)]",children:"‚ö°"})}),s.jsx("div",{className:"absolute inset-0 rounded-3xl border border-blue-500/30 animate-ping",style:{animationDuration:"3s"}})]}),s.jsxs("div",{className:"text-center space-y-2",children:[s.jsx("h1",{className:"text-4xl font-black text-white tracking-tight neon-text-blue",children:"AUTOPILOTE SOLAIRE"}),s.jsx("div",{className:"text-sm text-slate-400 uppercase tracking-[0.3em] font-mono",children:"Initialisation du Syst√®me"})]}),s.jsxs("div",{className:"w-full max-w-md space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-end",children:[s.jsx("span",{className:"text-blue-400 font-mono text-xs",children:t}),s.jsxs("span",{className:"text-2xl font-bold font-mono text-white",children:[e,"%"]})]}),s.jsx("div",{className:"h-1.5 w-full bg-slate-800/50 rounded-full overflow-hidden backdrop-blur-sm border border-white/5",children:s.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500 transition-all duration-300 ease-out shadow-[0_0_15px_rgba(59,130,246,0.6)]",style:{width:`${e}%`}})})]}),s.jsx("div",{className:"grid grid-cols-4 gap-4 w-full",children:n.map(i=>{const a=e>=i.threshold;return s.jsxs("div",{className:`
                  relative flex flex-col items-center gap-3 p-4 rounded-xl border transition-all duration-500
                  ${a?"bg-blue-900/20 border-blue-500/30 shadow-[0_0_20px_rgba(59,130,246,0.1)]":"bg-slate-900/20 border-white/5 text-slate-600"}
                `,children:[s.jsx("div",{className:`
                  w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold font-mono border
                  ${a?"bg-blue-500 border-blue-400 text-white shadow-[0_0_10px_rgba(59,130,246,0.5)]":"bg-slate-800 border-slate-700 text-slate-500"}
                `,children:a?"‚úì":i.id}),s.jsx("div",{className:`
                  text-xs font-bold uppercase tracking-wider
                  ${a?"text-blue-300":"text-slate-600"}
                `,children:i.label})]},i.id)})})]})]})},Lf=({isOpen:e,title:t,message:n,studyName:i,actionType:a,onConfirm:o,onCancel:r})=>{const[l,c]=N.useState(""),[d,u]=N.useState(!1);if(!e)return null;const p=a==="force_sign"?"green":a==="delete"?"red":a==="override"?"orange":"blue",h={green:{border:"border-green-500/50",btn:"bg-green-600 hover:bg-green-500 shadow-green-500/20",icon:"‚úÖ"},red:{border:"border-red-500/50",btn:"bg-red-600 hover:bg-red-500 shadow-red-500/20",icon:"üóëÔ∏è"},orange:{border:"border-orange-500/50",btn:"bg-orange-600 hover:bg-orange-500 shadow-orange-500/20",icon:"‚ö†Ô∏è"},blue:{border:"border-blue-500/50",btn:"bg-blue-600 hover:bg-blue-500 shadow-blue-500/20",icon:"‚ÑπÔ∏è"}}[p],m=["Contact t√©l√©phonique confirm√©","Accord oral en attente","Erreur de tracking connue","Client en d√©placement","Paiement en cours de validation"],f=async()=>{if(!l.trim()){alert("‚ö†Ô∏è Veuillez fournir une justification");return}if(l.trim().length<10){alert("‚ö†Ô∏è La justification doit contenir au moins 10 caract√®res");return}u(!0);try{await o(l.trim()),c("")}catch(b){console.error("Error confirming override:",b),alert("‚ùå Erreur lors de la confirmation")}finally{u(!1)}},y=()=>{c(""),r()};return s.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-fadeIn",children:s.jsxs("div",{className:`
          glass-panel w-full max-w-lg rounded-2xl overflow-hidden border-2 ${h.border} 
          shadow-[0_0_50px_rgba(0,0,0,0.5)] transform transition-all animate-slideUp
        `,children:[s.jsx("div",{className:"p-6 border-b border-white/5 bg-white/5",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-bold text-white mb-1 flex items-center gap-2",children:[s.jsx("span",{className:"text-2xl",children:h.icon}),t]}),i&&s.jsxs("div",{className:"text-sm text-slate-300 ml-9",children:["Dossier :"," ",s.jsx("span",{className:"font-bold text-white",children:i})]})]}),s.jsx("button",{onClick:y,disabled:d,className:"text-slate-400 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-full",children:"‚úï"})]})}),s.jsxs("div",{className:"p-6 space-y-6",children:[n&&s.jsx("div",{className:"bg-slate-900/50 border border-slate-700/50 rounded-xl p-4",children:s.jsx("p",{className:"text-slate-300 leading-relaxed text-sm",children:n})}),s.jsx("div",{className:`rounded-xl p-4 ${p==="red"?"bg-red-500/10 border border-red-500/20":"bg-orange-500/10 border border-orange-500/20"}`,children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("span",{className:"text-xl",children:"üõ°Ô∏è"}),s.jsxs("div",{children:[s.jsx("div",{className:`font-bold text-sm mb-0.5 ${p==="red"?"text-red-400":"text-orange-400"}`,children:"Action critique - Justification requise"}),s.jsx("div",{className:"text-xs text-slate-400",children:"Cette action sera enregistr√©e de mani√®re immuable dans les logs de s√©curit√©."})]})]})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("label",{className:"block text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Justification"}),s.jsx("span",{className:"text-[10px] text-slate-500",children:"Requis pour valider"})]}),s.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:m.map(b=>s.jsx("button",{onClick:()=>c(b),className:"px-2.5 py-1 bg-slate-800 hover:bg-slate-700 border border-slate-700 hover:border-slate-600 rounded-md text-[10px] text-slate-300 transition-colors",children:b},b))}),s.jsx("textarea",{value:l,onChange:b=>c(b.target.value),rows:3,disabled:d,placeholder:"Expliquez la raison de cette action exceptionnelle...",className:"w-full bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-slate-600 focus:border-white/20 focus:ring-1 focus:ring-white/20 focus:outline-none resize-none text-sm transition-all"}),s.jsx("div",{className:"flex justify-end mt-1",children:s.jsxs("span",{className:`text-[10px] ${l.trim().length<10?"text-orange-400":"text-emerald-400"}`,children:[l.trim().length,"/10 caract√®res"]})})]})]}),s.jsxs("div",{className:"p-4 bg-black/20 border-t border-white/5 flex items-center justify-end gap-3",children:[s.jsx("button",{onClick:y,disabled:d,className:"px-4 py-2 hover:bg-white/5 text-slate-400 hover:text-white rounded-lg font-bold text-sm transition-colors",children:"Annuler"}),s.jsx("button",{onClick:f,disabled:d||l.trim().length<10,className:`px-4 py-2 text-white rounded-lg font-bold text-sm transition-all shadow-lg hover:shadow-xl hover:scale-[1.02] active:scale-95 ${h.btn} disabled:opacity-50 disabled:cursor-not-allowed`,children:"Confirmer Action"})]})]})})};function Ff(){const{studies:e,emailLeads:t,logs:n,metrics:i,financialStats:a,loading:o,loadingProgress:r,loadingStep:l,error:c,trafficData:d,emailFlowByClient:u,antiAnnulationByStudy:p,postRefusByStudy:h,actions:{refresh:m,signStudy:f,cancelStudy:y,deleteStudy:b,markDepositPaid:w,markRibSent:j,deleteLeadPermanently:k,setOptOut:C,logForceAction:_}}=hc(),[g,x]=N.useState("cockpit"),[v,S]=N.useState(new Date),[A,M]=N.useState({search:"",views:null,clicks:null,status:null,optout:!1}),[P,I]=N.useState(!1),[T,V]=N.useState(!1),[te,W]=N.useState("performance"),[F,Y]=N.useState({isOpen:!1,title:"",onConfirm:async()=>{}}),pe=N.useCallback(()=>{m(),S(new Date)},[m]),me=N.useMemo(()=>pc(e,t,i),[e,t,i]);N.useCallback(()=>{x("war_room")},[]);const Ge=()=>{Y(O=>({...O,isOpen:!1}))},Ke=async(O,$)=>{Y({isOpen:!0,title:"Forcer la signature ?",message:"Cette action va contourner les v√©rifications automatiques.",studyName:$,actionType:"force_sign",onConfirm:async ae=>{await f(O,$),Y(se=>({...se,isOpen:!1}))}})},Ye=async(O,$)=>{Y({isOpen:!0,title:"Confirmer l'annulation",message:"Le dossier sera marqu√© comme annul√©. Irr√©versible.",studyName:$,actionType:"delete",onConfirm:async ae=>{await y(O,$),Y(se=>({...se,isOpen:!1}))}})},Ve=async(O,$)=>{Y({isOpen:!0,title:"Supprimer d√©finitivement ?",message:"Toutes les donn√©es associ√©es seront perdues.",studyName:$,actionType:"delete",onConfirm:async ae=>{await b(O,$),Y(se=>({...se,isOpen:!1}))}})},Xe=async(O,$)=>{await w(O,$)},R=async(O,$)=>{await j(O,$)},L=async O=>{await C(O)},U=async(O,$,ae)=>{await k(O,$,ae)},z=N.useMemo(()=>({studies:e,emailLeads:t,logs:n,metrics:i,financialStats:a,loading:o,systemInitialized:!0,loadingProgress:100,loadingStep:"Ready",error:null,emailFlowByClient:u,antiAnnulationByStudy:p,postRefusByStudy:h,trafficData:d,zenMode:P,setActiveSection:x,actions:{refresh:m,signStudy:Ke,cancelStudy:Ye,deleteStudy:Ve,markDepositPaid:Xe,markRibSent:R,setOptOut:L,deleteLeadPermanently:U,logForceAction:_||(async(O,$)=>console.warn(`Agent Log System inactive: ${$} on ${O}`)),updateStudyStatus:async()=>console.warn("Update Study Status: Not connected to Agent yet")}}),[e,t,n,i,a,o,u,p,h,d,P,m,_]);return o?s.jsx(If,{progress:r,step:l}):c?s.jsxs("div",{className:"text-red-500 p-10 text-center text-xl font-bold bg-slate-900 h-screen flex items-center justify-center",children:["üõë ",c]}):s.jsxs("div",{className:"min-h-screen bg-[#020617] text-slate-200 font-sans selection:bg-blue-500/30",children:[s.jsx(Lf,{isOpen:F.isOpen,title:F.title,message:F.message,studyName:F.studyName,actionType:F.actionType,onConfirm:F.onConfirm,onCancel:Ge}),s.jsx(Pf,{zenMode:P,priorityMode:T,onToggleZenMode:()=>I(!P),onTogglePriorityMode:()=>V(!T),onRefresh:pe,lastRefresh:v,systemStatus:(i==null?void 0:i.systemState)==="stable"?"normal":i==null?void 0:i.systemState,activeSection:g,setActiveSection:x,unsubscribedCount:me.unsubscribedCount,unsubscribeRate:me.unsubscribeRate,totalStudies:me.totalStudies,totalClients:me.totalStudies,signedClients:me.signedStudies}),s.jsxs("main",{className:"max-w-[1600px] mx-auto px-6 py-8 space-y-12 mt-20",children:[g==="cockpit"&&s.jsx(sf,{system:z}),g==="war_room"&&s.jsx(lf,{system:z}),g==="pilotage"&&s.jsx(ff,{system:z}),g==="sales"&&s.jsx(vf,{system:z}),g==="roi"&&s.jsx(jf,{system:z}),g==="registry"&&s.jsx(Df,{system:z}),g==="system"&&s.jsx(Mf,{system:z}),g==="dashboard"&&s.jsxs("div",{className:"text-center py-20",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-500",children:"Le Monolithe a √©t√© d√©mantel√©."}),s.jsx("p",{className:"text-slate-600 mt-2",children:"Veuillez utiliser le Cockpit comme point d'entr√©e."}),s.jsx("button",{onClick:()=>x("cockpit"),className:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg font-bold",children:"Retour au Cockpit"})]})]})]})}export{Ff as default};
