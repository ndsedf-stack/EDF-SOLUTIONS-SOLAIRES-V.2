import{c as Vt,a as sl,p as nl,R as Oe,G as se,b as yn,i as vn,t as il,d as al,e as Ht,l as rl,f as Ka,r as N,s as U,g as ol,h as wn,k as ll,m as Xa,n as cl,o as dl,q as ul,P as fi,_ as mi,j as s,v as qs,w as Re,L as xi,A as Rt,x as _e,y as ht,z as xt,B as bs,C as hl,D as ns,E as pl,T as Ct,S as Ke,Z as fl,F as ml,H as xl,I as gl,J as gi,K as bl,M as gt,N as Za,O as Ja,Q as Qa,U as yl,V as vl,W as bi,X as wl,u as jl}from"./index-CLqH0EQD.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nl=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],yi=Vt("activity",Nl);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sl=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],kl=Vt("credit-card",Sl);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _l=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]],Cl=Vt("file-down",_l);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Al=[["path",{d:"M5 12h14",key:"1ays0h"}]],Tl=Vt("minus",Al);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const El=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Dl=Vt("search",El);var Rl=["className","top","left","data","centroid","innerRadius","outerRadius","cornerRadius","startAngle","endAngle","padAngle","padRadius","pieSort","pieSortValues","pieValue","children","fill"];function Hs(){return Hs=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Hs.apply(this,arguments)}function Ml(e,t){if(e==null)return{};var n={},i=Object.keys(e),a,r;for(r=0;r<i.length;r++)a=i[r],!(t.indexOf(a)>=0)&&(n[a]=e[a]);return n}function Pl(e){var t=e.className,n=e.top,i=e.left,a=e.data,r=a===void 0?[]:a,o=e.centroid,l=e.innerRadius,c=l===void 0?0:l,d=e.outerRadius,u=e.cornerRadius,p=e.startAngle,h=e.endAngle,f=e.padAngle,m=e.padRadius,y=e.pieSort,b=e.pieSortValues,w=e.pieValue,j=e.children,k=e.fill,C=k===void 0?"":k,_=Ml(e,Rl),g=sl({innerRadius:c,outerRadius:d,cornerRadius:u,padRadius:m}),x=nl({startAngle:p,endAngle:h,padAngle:f,value:w,sort:y,sortValues:b}),v=x(r);return j?Oe.createElement(Oe.Fragment,null,j({arcs:v,path:g,pie:x})):Oe.createElement(se,{className:"visx-pie-arcs-group",top:n,left:i},v.map(function(S,T){return Oe.createElement("g",{key:"pie-arc-"+T},Oe.createElement("path",Hs({className:yn("visx-pie-arc",t),d:g(S)||"",fill:C==null||typeof C=="string"?C:C(S)},_)),o==null?void 0:o(g.centroid(S),S))}))}var Il=["className","innerRef"];function Gs(){return Gs=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Gs.apply(this,arguments)}function Ll(e,t){if(e==null)return{};var n={},i=Object.keys(e),a,r;for(r=0;r<i.length;r++)a=i[r],!(t.indexOf(a)>=0)&&(n[a]=e[a]);return n}function vi(e){var t=e.className,n=e.innerRef,i=Ll(e,Il);return Oe.createElement("circle",Gs({ref:n,className:yn("visx-circle",t)},i))}class wi extends Map{constructor(t,n=Fl){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[i,a]of t)this.set(i,a)}get(t){return super.get(ji(this,t))}has(t){return super.has(ji(this,t))}set(t,n){return super.set(Ol(this,t),n)}delete(t){return super.delete(Vl(this,t))}}function ji({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):n}function Ol({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):(e.set(i,n),n)}function Vl({_intern:e,_key:t},n){const i=t(n);return e.has(i)&&(n=e.get(i),e.delete(i)),n}function Fl(e){return e!==null&&typeof e=="object"?e.valueOf():e}function Bl(e,t,n){e=+e,t=+t,n=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+n;for(var i=-1,a=Math.max(0,Math.ceil((t-e)/n))|0,r=new Array(a);++i<a;)r[i]=e+i*n;return r}const Ni=Symbol("implicit");function er(){var e=new wi,t=[],n=[],i=Ni;function a(r){let o=e.get(r);if(o===void 0){if(i!==Ni)return i;e.set(r,o=t.push(r)-1)}return n[o%n.length]}return a.domain=function(r){if(!arguments.length)return t.slice();t=[],e=new wi;for(const o of r)e.has(o)||e.set(o,t.push(o)-1);return a},a.range=function(r){return arguments.length?(n=Array.from(r),a):n.slice()},a.unknown=function(r){return arguments.length?(i=r,a):i},a.copy=function(){return er(t,n).unknown(i)},vn.apply(a,arguments),a}function tr(){var e=er().unknown(void 0),t=e.domain,n=e.range,i=0,a=1,r,o,l=!1,c=0,d=0,u=.5;delete e.unknown;function p(){var h=t().length,f=a<i,m=f?a:i,y=f?i:a;r=(y-m)/Math.max(1,h-c+d*2),l&&(r=Math.floor(r)),m+=(y-m-r*(h-c))*u,o=r*(1-c),l&&(m=Math.round(m),o=Math.round(o));var b=Bl(h).map(function(w){return m+r*w});return n(f?b.reverse():b)}return e.domain=function(h){return arguments.length?(t(h),p()):t()},e.range=function(h){return arguments.length?([i,a]=h,i=+i,a=+a,p()):[i,a]},e.rangeRound=function(h){return[i,a]=h,i=+i,a=+a,l=!0,p()},e.bandwidth=function(){return o},e.step=function(){return r},e.round=function(h){return arguments.length?(l=!!h,p()):l},e.padding=function(h){return arguments.length?(c=Math.min(1,d=+h),p()):c},e.paddingInner=function(h){return arguments.length?(c=Math.min(1,h),p()):c},e.paddingOuter=function(h){return arguments.length?(d=+h,p()):d},e.align=function(h){return arguments.length?(u=Math.max(0,Math.min(1,h)),p()):u},e.copy=function(){return tr(t(),[i,a]).round(l).paddingInner(c).paddingOuter(d).align(u)},vn.apply(p(),arguments)}function Si(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function $l(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Ul(e){return e<0?-e*e:e*e}function Wl(e){var t=e(Ht,Ht),n=1;function i(){return n===1?e(Ht,Ht):n===.5?e($l,Ul):e(Si(n),Si(1/n))}return t.exponent=function(a){return arguments.length?(n=+a,i()):n},rl(t)}function sr(){var e=Wl(il());return e.copy=function(){return al(e,sr()).exponent(e.exponent())},vn.apply(e,arguments),e}function zl(){return sr.apply(null,arguments).exponent(.5)}var ql=Ka("domain","range","reverse","align","padding","round");function jn(e){return ql(tr(),e)}var Hl=Ka("domain","range","reverse","clamp","interpolate","nice","round","zero");function Gl(e){return Hl(zl(),e)}function bt(e){const t=new Date(e),i=new Date().getTime()-t.getTime();return Math.floor(i/(1e3*60*60*24))}function Ze(e){const t=e.views||0,n=e.clicks||0,i=e.send_count||0;return t===0&&n===0&&i>=4?"fatigue":t===0&&n===0?"muet":t>10?"cas_limite":t>=3&&n===0?"agite":n>=1?"interesse":"stable"}function Yl(e){let a=0;if(e.signed_at){const p=bt(e.signed_at);a=Math.min(p/14*100,100)}const r=e.total_price||0,o=Math.min(r/3e4*100,100),l=Ze(e);let c=0;l==="stable"&&(c=0),l==="interesse"&&(c=20),l==="agite"&&(c=60),l==="muet"&&(c=80),l==="fatigue"&&(c=100),(e.send_count||0)>5&&(c=Math.min(c+20,100));const u=a*.5+o*.3+c*.2;return Math.min(100,Math.round(u))}const nr=[];function Kl(){return nr.filter(e=>e.outcome==="FAILURE")}function Xl(){return nr.filter(e=>e.outcome==="SUCCESS")}function ir(e){const t=Kl(),n=Xl();if(t.length+n.length<5)return Math.min(100,Math.round(e.dangerScore));let i=0;i+=e.dangerScore*.5,i+=e.tensionLevel*.3,e.behavior==="muet"&&(i+=15),e.behavior==="agite"&&(i+=8);const a=t.length/(t.length+n.length);return i=i*(1+a),Math.min(100,Math.round(i))}const Zl=14,Jl=2e4,Ql=1e4,ec=5,tc=2;function sc(e){return e.status!=="signed"||e.has_deposit!==!0||e.deposit_paid===!0||!e.signed_at?!1:bt(e.signed_at)<=Zl}function nc(e){return e.status!=="signed"?!1:e.has_deposit===!0&&e.deposit_paid===!1}function ic(e){return e.status!=="signed"||e.has_deposit!==!0||e.deposit_paid===!0||!e.signed_at?!1:bt(e.signed_at)>10}function ar(e){const t=Ze(e);return t==="fatigue"?"STOP_AUTO_CALL":t==="muet"?"CALL":t==="agite"?"RELANCE":t==="interesse"?"ACCELERER":(e.dangerScore||0)>70?"CALL":"SURVEILLER"}function ac(e){if(e.length===0)return null;const t=e[0],n=Ze(t),i=ar(t);let a="Dossier prioritaire";return n==="muet"?a="Client muet apr√®s signature, risque de d√©crochage":n==="fatigue"?a="Lead br√ªl√© : 0 interaction apr√®s relances multiples":n==="agite"?a="Client agit√©, consulte sans avancer":n==="interesse"&&(a="Client int√©ress√©, moment cl√© pour conclure"),t.dangerScore>70&&(a="Risque critique (temps + argent + comportement)"),{id:t.id,name:t.name,email:t.email,phone:t.phone,dangerScore:t.dangerScore,behavior:n,action:i,reason:a,daysSinceSigned:t.signed_at?bt(t.signed_at):null,total_price:t.total_price||0,requiresDeposit:t.requiresDeposit||!1,status:t.status,signed_at:t.signed_at,created_at:t.created_at,last_view:t.last_view}}function rc(e){return e.slice(0,3).map((t,n)=>{const i=Ze(t),a=ar(t);let r="Suivi standard";return i==="muet"?r="Client muet, risque de d√©crochage":i==="agite"?r="Client agit√©, bloque mentalement":i==="interesse"&&(r="Client int√©ress√©, moment cl√©"),t.dangerScore>70&&(r="Risque critique (temps + argent + comportement)"),{rank:n+1,id:t.id,name:t.name,email:t.email,phone:t.phone,dangerScore:t.dangerScore,behavior:i,action:a,reason:r,total_price:t.total_price||0,requiresDeposit:t.requiresDeposit||!1,status:t.status,signed_at:t.signed_at,created_at:t.created_at,last_view:t.last_view}})}function oc(e,t){if(e.length===0&&t===0)return 0;let i=e.length>0?e.reduce((a,r)=>a+r.dangerScore,0)/e.length:0;return i+=e.length*5,i+=Math.min(t/5e3,30),Math.min(100,Math.round(i))}function lc(e){if(e.lateDepositCount>0)return"critical";const{actionNowCount:t,cashAtRisk:n,sentCount:i,signedCount:a}=e;return t>=ec||n>Jl?"critical":t>=tc||n>Ql?"warning":i>=5||a>=3?"active":"stable"}function cc(e){const{tensionLevel:t,systemState:n,priorityActions:i}=e;return n==="critical"?{active:!0,level:"critical",message:"üö® SYST√àME SOUS PRESSION CRITIQUE",focus:i[0]||null}:t>70?{active:!0,level:"high",message:"‚ö†Ô∏è Forte tension d√©tect√©e",focus:i[0]||null}:t>40?{active:!0,level:"medium",message:"‚ö° Syst√®me sous tension",focus:i[0]||null}:{active:!1,level:"normal",message:"Syst√®me stable",focus:null}}function dc(e,t){if(!t||!t.warRoom||!t.finance)return{cashSecured:0,cashAtRisk:0,warRoomCA:0,securedCount:0,riskCount:0,warRoomCount:0,lateCount:0,lateNames:"‚Äî",nextDeadlineDate:"‚Äî",nextDeadlineClient:"‚Äî",caTotal:0,tauxConversion:0,cashWaitingDeposit:0,waitingDepositCount:0,cashCancellable:0,cancellableCount:0,cashAtFatigue:0,securedPotential:0};const n=new Date,i=e.filter(g=>g.status==="signed"),a=i.reduce((g,x)=>g+(x.total_price||0),0),r=i.filter(g=>g.contract_secured),o=r.reduce((g,x)=>g+(x.total_price||0),0),l=i.filter(g=>!g.contract_secured&&!g.deposit_paid&&g.has_deposit),c=l.reduce((g,x)=>g+(x.total_price||0),0),d=i.filter(g=>!g.contract_secured&&!(!g.deposit_paid&&g.has_deposit)),u=d.reduce((g,x)=>g+(x.total_price||0),0),p=t.behavioral.fatigues.reduce((g,x)=>g+(x.total_price||0),0),h=a,f=t.warRoom.studies,m=t.finance.cashAtRisk,y=t.warRoom.ca,b=f.filter(g=>{if(!g.signed_at)return!1;const x=new Date(g.signed_at);return Math.floor((n.getTime()-x.getTime())/864e5)>10&&!g.deposit_paid}),w=b.map(g=>g.name).join(", ")||"Aucun retard",j=d.filter(g=>g.signed_at).map(g=>({name:g.name,signedDate:new Date(g.signed_at),deadlineDate:new Date(new Date(g.signed_at).getTime()+336*60*60*1e3)})).sort((g,x)=>g.deadlineDate.getTime()-x.deadlineDate.getTime())[0],k=j?j.deadlineDate.toLocaleDateString("fr-FR"):"‚Äî",C=j?j.name:"Aucune √©ch√©ance proche",_=e.length>0?i.length/e.length*100:0;return{cashSecured:o,cashAtRisk:m,warRoomCA:y,securedCount:r.length,riskCount:f.length,warRoomCount:t.warRoom.studies.length,lateCount:b.length,lateNames:w,nextDeadlineDate:k,nextDeadlineClient:C,caTotal:a,tauxConversion:_,cashWaitingDeposit:c,waitingDepositCount:l.length,cashCancellable:u,cancellableCount:d.length,cashAtFatigue:p,securedPotential:h}}function rr(e){const t=e.filter(v=>v.status==="signed"),n=e.filter(v=>v.status==="sent"),i=t.filter(sc).map(v=>{const S=Yl(v),T=Ze(v),M=v.signed_at?bt(v.signed_at):0;return{...v,dangerScore:S,behavior:T,daysLate:M,cancellationRisk:0}}).sort((v,S)=>S.dangerScore-v.dangerScore),a=i.map(v=>v.id),r=i.reduce((v,S)=>v+(S.total_price||0),0),o=t.filter(nc),l=t.filter(ic),c=o.reduce((v,S)=>v+(S.total_price||0),0),d=oc(i,c),u=i.map(v=>({...v,cancellationRisk:ir({dangerScore:v.dangerScore,tensionLevel:d,behavior:v.behavior})})),p=ac(u),h=rc(u),f=[...u,...o.filter(v=>!a.includes(v.id)),...l.filter(v=>!a.includes(v.id)&&!o.find(S=>S.id===v.id))],m=e.map(v=>{const S=Ze(v);return{...v,risk:S}}),y=m.filter(v=>v.risk==="muet"),b=m.filter(v=>v.risk==="agite"),w=m.filter(v=>v.risk==="interesse"),j=m.filter(v=>v.risk==="fatigue"),k=e.filter(v=>!a.includes(v.id)&&!o.find(S=>S.id===v.id)),C=lc({actionNowCount:f.length,cashAtRisk:c,sentCount:n.length,signedCount:t.length,lateDepositCount:l.length}),_=cc({tensionLevel:d,systemState:C,priorityActions:h}),g={signed:t,sent:n,healthy:k,lateDeposits:l,warRoom:{studies:u,count:u.length,ca:r},finance:{riskyDeposits:o,cashAtRisk:c},actionNow:f,behavioral:{muets:y,agites:b,interesses:w,fatigues:j},systemState:C,priorityCase:p,tensionLevel:d,priorityActions:h,urgencyMode:_},x=dc(e,g);return{...g,financialStats:x}}function or(e){const t=e.views||0,n=e.clicks||0,i=e.send_count||0;if(t===0&&n===0&&i>=4)return{state:"FATIGUE",icon:"üò¥",label:"FATIGUE"};const a=Ze(e);return a==="muet"?{state:"MUET",icon:"üßä",label:"SILENCE"}:a==="cas_limite"?{state:"CAS_LIMITE",icon:"‚ö†Ô∏è",label:"CAS LIMITE"}:a==="agite"?{state:"AGIT√â",icon:"üî•",label:"AGIT√â"}:a==="interesse"?{state:"INT√âRESS√â",icon:"üü¢",label:"INT√âRESS√â"}:{state:"STABLE",icon:"‚ö™",label:"STABLE"}}function uc(e,t,n={},i={}){var x,v,S,T,M,P,V,A,F,ae,W,O,X,be,ve,Je,Qe,et;const a=e.id,r=((x=e.clients)==null?void 0:x.id)||"",o=n[String(a)]||n[String(r)],l=i[String(a)]||i[String(r)],c=(((v=o==null?void 0:o.sent)==null?void 0:v.length)||0)+(((S=l==null?void 0:l.sent)==null?void 0:S.length)||0);t||console.warn("‚ö†Ô∏è Pas de stats trouv√© pour study:",e.id,(T=e.clients)==null?void 0:T.email);const d=bt(e.created_at),u=new Date;let p=(t==null?void 0:t.email_opens)??(t==null?void 0:t.views)??(t==null?void 0:t.total_opens)??0,h=(t==null?void 0:t.interactions)??(t==null?void 0:t.clicks)??(t==null?void 0:t.total_clicks)??0;(P=(M=e.clients)==null?void 0:M.last_name)!=null&&P.toUpperCase().includes("GUYOT")&&console.log(`üìä Study ${(V=e.clients)==null?void 0:V.first_name} ${(A=e.clients)==null?void 0:A.last_name}:`,{id:e.id,views:p,clicks:h,stat_found:!!t,stat_data:t});const f=e.total_price||e.install_cost||((F=e.study_data)==null?void 0:F.installCost)||0,m=e.cash_apport??((ae=e.study_data)==null?void 0:ae.cashApport)??0;let y,b;m>=f&&f>0?(y="cash",b="cash_payment"):m>0&&m<f?(y="financing",b="partial_financing"):(y="financing",b="full_financing"),e.payment_mode&&(y=e.payment_mode),e.financing_mode&&(b=e.financing_mode);const w=b==="cash_payment"||b==="partial_financing";(O=(W=e.clients)==null?void 0:W.last_name)!=null&&O.toUpperCase().includes("DUCHENE")&&console.log("üîç MAPPERS DEBUG DUCHENE:",{name:`${(X=e.clients)==null?void 0:X.first_name} ${(be=e.clients)==null?void 0:be.last_name}`,apport:m,totalCost:f,mode:y,financingMode:b,requiresDepositCalc:w,db_has_deposit:e.has_deposit,db_deposit_amount:e.deposit_amount});const j=e.signed_at?Math.floor((u.getTime()-new Date(e.signed_at).getTime())/864e5):null,k=!e.signed_at||e.status!=="signed"||e.deposit_paid||!w?!1:j!==null&&j>0,C={id:e.id,client_id:((ve=e.clients)==null?void 0:ve.id)||"",name:e.clients?`${e.clients.first_name||""} ${e.clients.last_name||""}`.trim():"Inconnu",email:((Je=e.clients)==null?void 0:Je.email)||"Pas d'email",phone:(Qe=e.clients)==null?void 0:Qe.phone,status:e.status,created_at:e.created_at,signed_at:e.signed_at,study_data:e.study_data,deposit_amount:e.deposit_amount||0,deposit_paid:e.deposit_paid||!1,deposit_paid_at:e.deposit_paid_at,payment_mode:y,payment_type:e.payment_type||null,financing_mode:b,has_deposit:w||e.has_deposit,cash_apport:m,total_price:f,install_cost:e.install_cost||0,contract_secured:e.status==="signed"&&(j!==null&&j>=14||e.deposit_paid||!1),cancellation_deadline:e.cancellation_deadline||null,revenue_secured:e.status==="signed"?f:0,revenue_projected:f,revenue_gap:e.status!=="signed"?f:0,views:p,clicks:h,diffDays:Math.floor(d),hasLog:!1,rib_sent:e.rib_sent||!1,rib_sent_at:e.rib_sent_at,email_optout:((et=e.clients)==null?void 0:et.email_optout)||!1,last_open:(t==null?void 0:t.last_open)||(t==null?void 0:t.last_open_at)||(t==null?void 0:t.last_email_open)||null,last_click:(t==null?void 0:t.last_click)||(t==null?void 0:t.last_click_at)||null,last_view:(t==null?void 0:t.last_view)||null,requiresDeposit:w,daysLate:j||0,daysSinceSigned:j,isDepositLate:k,behavioralState:void 0,behavioralIcon:void 0,behavioralLabel:void 0,send_count:c},_=or(C);C.behavioralState=_.state;let g=C.dangerScore||0;if(g===0){const Ue=p||0,tt=h||0,D=Math.max(j||0,d||0);_.state==="MUET"?g=65+Math.min(D,20):_.state==="FATIGUE"?g=85+Math.min(D,15):_.state==="AGIT√â"?g=45+Math.min(Ue*2,20):_.state==="CAS_LIMITE"?g=30+Math.min(D,10):_.state==="INT√âRESS√â"?g=18+Math.min(D,12)-Math.min(tt*2,10)+Math.min(Ue,5):g=5+Math.min(Ue,7);const L=parseInt(C.id.slice(0,2),16)%5-2;g+=L}return C.cancellationRisk=ir({dangerScore:Math.max(5,Math.min(98,g)),tensionLevel:C.status==="signed"?50:30,behavior:_.state}),C.dangerScore=g,C}function ki(e){return e.status==="signed"?"signed":e.clicks>0?"hot":e.views>=2?"warm":"cold"}const le=[];for(let e=0;e<256;++e)le.push((e+256).toString(16).slice(1));function hc(e,t=0){return(le[e[t+0]]+le[e[t+1]]+le[e[t+2]]+le[e[t+3]]+"-"+le[e[t+4]]+le[e[t+5]]+"-"+le[e[t+6]]+le[e[t+7]]+"-"+le[e[t+8]]+le[e[t+9]]+"-"+le[e[t+10]]+le[e[t+11]]+le[e[t+12]]+le[e[t+13]]+le[e[t+14]]+le[e[t+15]]).toLowerCase()}let Ns;const pc=new Uint8Array(16);function fc(){if(!Ns){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Ns=crypto.getRandomValues.bind(crypto)}return Ns(pc)}const mc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),_i={randomUUID:mc};function xc(e,t,n){var a;e=e||{};const i=e.random??((a=e.rng)==null?void 0:a.call(e))??fc();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,hc(i)}function gc(e,t,n){return _i.randomUUID&&!e?_i.randomUUID():xc(e)}const bc=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():gc(),yc=e=>new Promise((t,n)=>setTimeout(()=>n(new Error(`Timeout Supabase after ${e}ms`)),e));async function Ss(e,t=15e3){return Promise.race([e,yc(t)])}function vc(){const[e,t]=N.useState([]),[n,i]=N.useState([]),[a,r]=N.useState([]),[o,l]=N.useState(null),[c,d]=N.useState(!0),[u,p]=N.useState(null),[h,f]=N.useState(!1),[m,y]=N.useState(null),[b,w]=N.useState({}),[j,k]=N.useState({}),[C,_]=N.useState({}),[g,x]=N.useState([]),[v,S]=N.useState(0),[T,M]=N.useState(""),P=N.useCallback(async()=>{if(h)return;const D=[{progress:15,text:"Connexion Supabase...",duration:600},{progress:35,text:"Chargement dossiers...",duration:800},{progress:60,text:"Analyse m√©triques...",duration:700},{progress:85,text:"Calcul risques...",duration:600},{progress:100,text:"Syst√®me pr√™t !",duration:500}];for(let L=0;L<D.length;L++){const $=D[L];await new Promise(z=>setTimeout(z,$.duration)),S($.progress),M($.text)}await new Promise(L=>setTimeout(L,200)),f(!0)},[h]),V=async(D,L,$,z="*",G)=>{const fe=[];for(let de=0;de<$.length;de+=800){const ye=$.slice(de,de+800);let re=U.from(D).select(z).in(L,ye);G&&(re=re.order(G.col,{ascending:G.ascending}));const{data:I,error:Y}=await Ss(re);if(Y)throw Y;I&&fe.push(...I)}return{data:fe,error:null}},A=N.useCallback(async(D=!1)=>{try{D||d(!0),y(null);const L=U.from("decision_logs").select("*").order("created_at",{ascending:!1}).limit(50),$=Ss(U.from("studies").select(`
            id, client_id, status, created_at, signed_at, study_data,
            deposit_amount, deposit_paid, deposit_paid_at, has_deposit,
            payment_type, payment_mode, cash_apport,
            total_price: install_cost, financing_mode, contract_secured, cancellation_deadline,
            clients (id, first_name, last_name, email, phone, email_optout)
        `)),[z,G]=await Promise.all([L,$]),{data:ne,error:fe}=G,de=z.data||[];if(z.error&&console.error("Logs fetch failed",z.error),r(de),fe)throw fe;const ye=(ne||[]).map(E=>E.id),re=(ne||[]).map(E=>E.client_id).filter(Boolean),I=ye.length>0?V("tracking_events","study_id",ye,"study_id, event_type, created_at"):Promise.resolve({data:[]}),Y=re.length>0?V("email_queue","client_id",re,"study_id, client_id, email_type, status, sent_at, scheduled_for, created_at",{col:"created_at",ascending:!1}):Promise.resolve({data:[]}),[ee,me]=await Promise.allSettled([I,Y]),jt=ee.status==="fulfilled"?ee.value.data||[]:[];ee.status==="rejected"&&console.error("Tracking fetch failed",ee.reason);const Wt=me.status==="fulfilled"?me.value.data||[]:[];me.status==="rejected"&&console.error("Queue fetch failed",me.reason);const We=new Map,ue={},Nt=new Map;jt.forEach(E=>{if(!E.study_id)return;We.has(E.study_id)||(We.set(E.study_id,{id:E.study_id,email_opens:0,interactions:0,last_open_at:null,last_click_at:null}),ue[E.study_id]={total_opens:0},Nt.set(E.study_id,new Set));const B=We.get(E.study_id),J=ue[E.study_id],K=Nt.get(E.study_id),q=new Date(E.created_at).toISOString().substring(0,16);if(E.event_type==="email_open"||E.event_type==="view")K.has(q)||(B.email_opens++,J.total_opens++,K.add(q)),(!B.last_open_at||E.created_at>B.last_open_at)&&(B.last_open_at=E.created_at,J.last_open=E.created_at);else if(E.event_type==="email_click"||E.event_type==="click"){const Ne=`click-${q}`;K.has(Ne)||(B.interactions++,K.add(Ne)),(!B.last_click_at||E.created_at>B.last_click_at)&&(B.last_click_at=E.created_at,J.last_click=E.created_at)}});const Jo=Array.from(We.values()),ni={};(ne||[]).forEach(E=>{E.client_id&&(ni[E.client_id]=E.id)});const zt={},qt={};Wt.forEach(E=>{var nt,oi,li,ci,di,ui,hi;const B=E.study_id||(E.client_id?ni[E.client_id]:null);if(!B)return;const J={...E,opened_at:((nt=ue[B])==null?void 0:nt.last_open)||null,clicked_at:((oi=ue[B])==null?void 0:oi.last_click)||null},q=((li=E.email_type)==null?void 0:li.startsWith("post_refus"))||((ci=E.email_type)==null?void 0:ci.includes("relance"))||((di=E.email_type)==null?void 0:di.includes("prospecting"))?qt:zt;q[B]||(q[B]={sent:[],next:null,total_opens:((ui=ue[B])==null?void 0:ui.total_opens)||0});const Ne=["sent","SUCCESS","success","delivered","processed"].includes(((hi=E.status)==null?void 0:hi.toLowerCase())||""),st=["pending","scheduled","PENDING"].includes(E.status||"");if(Ne)q[B].sent.push(J);else if(st){const pi=q[B].next;(!pi||new Date(E.scheduled_for)<new Date(pi.scheduled_for))&&(q[B].next=J)}E.client_id&&(q[String(E.client_id)]=q[B])}),[zt,qt].forEach(E=>{Object.keys(E).forEach(B=>{E[B].sent.sort((J,K)=>new Date(J.sent_at).getTime()-new Date(K.sent_at).getTime())})}),k(zt),_(qt);const ii=(ne||[]).map(E=>{var st;const J=(st=(Array.isArray(E.clients)?E.clients:E.clients?[E.clients]:[])[0])==null?void 0:st.id,K=J?n.find(nt=>nt.client_id===J):null,q=Jo.find(nt=>nt.id===E.id)||{id:E.id,email_opens:0,interactions:0},Ne={...q,email_opens:q.email_opens>0?q.email_opens:(K==null?void 0:K.total_opens)||0,interactions:q.interactions>0?q.interactions:(K==null?void 0:K.total_clicks)||0,last_open:q.last_open_at||(K==null?void 0:K.last_opened_at),last_click:q.last_click_at||(K==null?void 0:K.last_clicked_at)};return uc(E,Ne,zt,qt)});t(ii);const Pe=rr(ii);if(l(Pe),p(Pe.financialStats),Pe.priorityCase){const E=bc();try{await U.from("decision_logs").insert({id:E,study_id:Pe.priorityCase.id,created_at:new Date().toISOString(),action_performed:`PRIORITY_FLAG_${Pe.priorityCase.action.toUpperCase().replace(/\s+/g,"_")}`,justification:JSON.stringify({danger:Pe.priorityCase.dangerScore,behavior:Pe.priorityCase.behavior,state:Pe.systemState})})}catch(B){console.warn("Log failed:",B)}}const Qo=14,ze=new Map,el=new Date;for(let E=Qo-1;E>=0;E--){const B=new Date;B.setDate(el.getDate()-E);const J=B.toISOString().split("T")[0];ze.set(J,{date:J,count:0,opened:0,clicked:0})}const St=new Map;Wt.forEach(E=>{var J;if(["sent","SUCCESS","success","delivered","processed"].includes(((J=E.status)==null?void 0:J.toLowerCase())||"")&&E.sent_at&&E.study_id){const K=new Date(E.sent_at).getTime();St.has(E.study_id)||St.set(E.study_id,[]),St.get(E.study_id).push(K);const q=new Date(E.sent_at).toISOString().split("T")[0];ze.has(q)&&ze.get(q).count++}}),St.forEach(E=>E.sort((B,J)=>B-J));const ai=new Set,ri=new Set;jt.forEach(E=>{if(!E.study_id||!E.created_at)return;const B=new Date(E.created_at).getTime(),J=St.get(E.study_id);if(!J)return;const K=[...J].reverse().find(st=>st<=B);if(!K)return;const q=new Date(K).toISOString().split("T")[0];if(!ze.has(q))return;const Ne=`${E.study_id}-${q}`;(E.event_type==="email_open"||E.event_type==="view")&&(ai.has(Ne)||(ai.add(Ne),ze.get(q).opened++)),(E.event_type==="email_click"||E.event_type==="click")&&(ri.has(Ne)||(ri.add(Ne),ze.get(q).clicked++))});const tl=Array.from(ze.values()).sort((E,B)=>E.date.localeCompare(B.date));x(tl)}catch(L){console.error("‚ùå System Brain Error:",L),y(L.message)}finally{d(!1)}},[n]),F=N.useCallback(async()=>{try{const{data:D,error:L}=await Ss(U.from("email_leads").select(`
          id, client_id, created_at, last_email_sent_at, next_email_scheduled_at,
          email_step, total_opens, total_clicks, last_opened_at, last_clicked_at,
          clients!inner(id, first_name, last_name, email, email_optout)
        `).order("next_email_scheduled_at",{ascending:!0}));if(L)throw L;const $=D.map(I=>I.client_id).filter(Boolean),{data:z}=await U.from("studies").select("id, client_id").in("client_id",$),G={};(z||[]).forEach(I=>{I.client_id&&(G[I.client_id]=I.id)});const ne=Object.values(G).filter(Boolean);let fe={},de={};if(ne.length>0){const{data:I}=await U.from("tracking_events").select("study_id, created_at").in("study_id",ne).in("event_type",["email_open","view"]);(I||[]).forEach(ee=>{fe[ee.study_id]||(fe[ee.study_id]=ee.created_at)});const{data:Y}=await U.from("tracking_events").select("study_id, created_at").in("study_id",ne).in("event_type",["email_click","click"]);(Y||[]).forEach(ee=>{de[ee.study_id]||(de[ee.study_id]=ee.created_at)})}const ye=(D||[]).map(I=>ae(I,G,fe,de));i(ye);const re={};ye.forEach(I=>{re[I.client_id]={step:I.email_sequence_step,last:I.last_email_sent,next:I.next_email_date,opens:I.total_opens,clicks:I.total_clicks,opted_out:I.opted_out,last_opened:I.last_opened_at,last_clicked:I.last_clicked_at}}),w(re)}catch(D){console.error(D)}},[]);function ae(D,L,$,z){var ne,fe,de,ye;const G=L[D.client_id]||null;return{id:D.id,client_id:D.client_id,study_id:G,client_name:`${((ne=D.clients)==null?void 0:ne.first_name)||""} ${((fe=D.clients)==null?void 0:fe.last_name)||""}`.trim(),client_email:((de=D.clients)==null?void 0:de.email)||"",opted_out:((ye=D.clients)==null?void 0:ye.email_optout)||!1,email_sequence_step:D.email_step||0,last_email_sent:D.last_email_sent_at,next_email_date:D.next_email_scheduled_at,total_opens:D.total_opens||0,total_clicks:D.total_clicks||0,last_opened_at:G?$[G]:D.last_opened_at,last_clicked_at:G?z[G]:D.last_clicked_at,created_at:D.created_at}}const W=N.useCallback(async(D,L,$,z="Manuel")=>{const{error:G}=await U.from("studies").update({status:L,signed_at:L==="signed"?new Date().toISOString():null}).eq("id",D);G||(await U.from("decision_logs").insert({study_id:D,client_name:$,action_performed:`STATUS_CHANGE_${L.toUpperCase()}`,justification:z}),A())},[A]),O=N.useCallback(async(D,L)=>{const{error:$}=await U.from("studies").update({status:"signed",signed_at:new Date().toISOString()}).eq("id",D);return $?(console.error("Erreur signature",$),!1):(await A(!0),!0)},[A]),X=N.useCallback(async(D,L,$="Annulation Manuelle")=>{const{data:z}=await U.from("studies").select("study_data").eq("id",D).single(),G={...z==null?void 0:z.study_data,cancellation_reason:$},{error:ne}=await U.from("studies").update({status:"cancelled",study_data:G}).eq("id",D);return ne?(console.error("Erreur annulation",ne),!1):(await U.from("decision_logs").insert({study_id:D,client_name:L,action_performed:"CANCEL_STUDY",justification:$}),await A(!0),!0)},[A]),be=N.useCallback(async(D,L,$="virement")=>{let z;try{z=(await U.from("studies").update({deposit_paid:!0,deposit_paid_at:new Date().toISOString(),deposit_payment_mode:$.toLowerCase().trim()}).eq("id",D)).error}catch{z=(await U.from("studies").update({deposit_paid:!0,deposit_paid_at:new Date().toISOString()}).eq("id",D)).error}if(z)return console.error("Erreur paiement",z),!1;try{await U.from("decision_logs").insert({study_id:D,client_name:L,action_performed:"DEPOSIT_PAID_CONFIRMED",justification:`Mode: ${$}`})}catch(G){console.warn("Log failed",G)}return await A(!0),!0},[A]),ve=N.useCallback(async(D,L)=>{const{error:$}=await U.from("studies").update({rib_sent:!0,rib_sent_at:new Date().toISOString()}).eq("id",D);$?alert("‚ùå Erreur : "+$.message):(await U.from("decision_logs").insert({study_id:D,client_name:L,action_performed:"RIB_SENT_CONFIRMED",justification:"RIB marqu√© comme envoy√©"}),alert("‚úÖ RIB marqu√© comme envoy√© !"),A())},[A]),Je=N.useCallback(async D=>{const{data:L}=await U.from("clients").update({email_optout:!0}).eq("email",D).select();if(!L||L.length===0){alert("‚ùå ERREUR : Aucun client trouv√© avec cet email");return}await U.from("email_queue").update({status:"cancelled"}).eq("client_id",L[0].id).in("status",["pending","scheduled"]),await U.from("decision_logs").insert({client_name:`${L[0].first_name} ${L[0].last_name}`,action_performed:"EMAIL_OPTOUT",justification:"D√©sabonnement depuis dashboard"}),alert("‚úÖ Client d√©sabonn√© avec succ√®s !"),F(),A()},[A,F]),Qe=N.useCallback(async(D,L,$)=>{await U.from("studies").delete().eq("client_id",D),await U.from("email_queue").delete().eq("client_id",D),await U.from("email_leads").delete().eq("client_id",D),await U.from("clients").delete().eq("id",D),await U.from("decision_logs").insert({action_performed:"LEAD_DELETED_PERMANENTLY",client_name:$,justification:`Suppression d√©finitive ${L}`}),alert("‚úÖ Lead supprim√© d√©finitivement"),A(),F()},[A,F]),et=N.useCallback(async(D,L)=>{await U.from("studies").delete().eq("id",D),await U.from("decision_logs").insert({client_name:L,action_performed:"DELETE_STUDY",justification:"Suppression d√©finitive"}),A()},[A]),Ue=N.useCallback(async(D,L,$,z)=>{await U.from("decision_logs").insert({study_id:D,client_name:L,action_performed:$,justification:z})},[]),tt=N.useCallback((D=!1)=>{A(D),F()},[A,F]);return N.useEffect(()=>{P(),A(),F();const D=setInterval(()=>{tt(!0)},6e4);return()=>clearInterval(D)},[]),N.useEffect(()=>{n.length>0&&A(!0)},[n]),{studies:e,emailLeads:n,logs:a,metrics:o,financialStats:u,loading:c,systemInitialized:h,loadingProgress:v,loadingStep:T,error:m,emailFlowByClient:b,antiAnnulationByStudy:j,postRefusByStudy:C,trafficData:g,actions:{updateStudyStatus:W,signStudy:O,cancelStudy:X,markDepositPaid:be,markRibSent:ve,setOptOut:Je,deleteLeadPermanently:Qe,deleteStudy:et,logForceAction:Ue,refresh:tt}}}function wc(e,t,n){var m,y,b;const i=e.length,a=e.filter(w=>w.status!=="cancelled").length,r=e.filter(w=>w.status==="signed").length,o=(m=n==null?void 0:n.finance)!=null&&m.riskyDeposits?r-n.finance.riskyDeposits.length:e.filter(w=>w.status==="signed"&&(w.deposit_paid||w.contract_secured)).length,l=((b=(y=n==null?void 0:n.finance)==null?void 0:y.riskyDeposits)==null?void 0:b.length)||0,c=t.length,d=t.filter(w=>!w.opted_out).length,u=t.reduce((w,j)=>w+(j.email_sequence_step||0),0),p=t.filter(w=>w.next_email_date).length,h=t.filter(w=>w.opted_out).length,f=c>0?h/c*100:0;return{totalStudies:i,activeStudies:a,signedStudies:r,securedStudies:o,waitingStudies:l,totalLeads:c,activeLeads:d,totalEmailsSent:u,pendingEmails:p,unsubscribedCount:h,unsubscribeRate:f}}var Gt={},Yt={},Ci;function jc(){if(Ci)return Yt;Ci=1,Yt.__esModule=!0,Yt.default=o;var e=n(ol()),t=wn();function n(l){return l&&l.__esModule?l:{default:l}}function i(){return i=Object.assign?Object.assign.bind():function(l){for(var c=1;c<arguments.length;c++){var d=arguments[c];for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])}return l},i.apply(this,arguments)}var a=[],r={width:0,height:0,top:0,left:0};function o(l){var c=l===void 0?{}:l,d=c.initialSize,u=d===void 0?r:d,p=c.debounceTime,h=p===void 0?300:p,f=c.ignoreDimensions,m=f===void 0?a:f,y=c.enableDebounceLeadingCall,b=y===void 0?!0:y,w=c.resizeObserverPolyfill,j=(0,t.useRef)(null),k=(0,t.useRef)(0),C=(0,t.useState)(i({},r,u)),_=C[0],g=C[1],x=(0,t.useMemo)(function(){var v=Array.isArray(m)?m:[m];return(0,e.default)(function(S){g(function(T){var M=Object.keys(T),P=M.filter(function(A){return T[A]!==S[A]}),V=P.every(function(A){return v.includes(A)});return V?T:S})},h,{leading:b})},[h,b,m]);return(0,t.useEffect)(function(){var v=w||window.ResizeObserver,S=new v(function(T){T.forEach(function(M){var P,V=(P=M==null?void 0:M.contentRect)!=null?P:{},A=V.left,F=V.top,ae=V.width,W=V.height;k.current=window.requestAnimationFrame(function(){x({width:ae,height:W,top:F,left:A})})})});return j.current&&S.observe(j.current),function(){window.cancelAnimationFrame(k.current),S.disconnect(),x.cancel()}},[x,w]),i({parentRef:j,resize:x},_)}return Yt}var Ai;function Nc(){if(Ai)return Gt;Ai=1,Gt.__esModule=!0,Gt.default=d;var e=r(ll()),t=r(wn()),n=r(jc()),i=["className","children","debounceTime","ignoreDimensions","initialSize","parentSizeStyles","enableDebounceLeadingCall","resizeObserverPolyfill"],a=["parentRef","resize"];function r(u){return u&&u.__esModule?u:{default:u}}function o(){return o=Object.assign?Object.assign.bind():function(u){for(var p=1;p<arguments.length;p++){var h=arguments[p];for(var f in h)Object.prototype.hasOwnProperty.call(h,f)&&(u[f]=h[f])}return u},o.apply(this,arguments)}function l(u,p){if(u==null)return{};var h={},f=Object.keys(u),m,y;for(y=0;y<f.length;y++)m=f[y],!(p.indexOf(m)>=0)&&(h[m]=u[m]);return h}var c={width:"100%",height:"100%"};function d(u){var p=u.className,h=u.children,f=u.debounceTime,m=u.ignoreDimensions,y=u.initialSize,b=u.parentSizeStyles,w=b===void 0?c:b,j=u.enableDebounceLeadingCall,k=j===void 0?!0:j,C=u.resizeObserverPolyfill,_=l(u,i),g=(0,n.default)({initialSize:y,debounceTime:f,ignoreDimensions:m,enableDebounceLeadingCall:k,resizeObserverPolyfill:C}),x=g.parentRef,v=g.resize,S=l(g,a);return t.default.createElement("div",o({style:w,ref:x,className:p},_),h(o({},S,{ref:x.current,resize:v})))}return d.propTypes={className:e.default.string,children:e.default.func.isRequired},Gt}var Sc=Nc();const lr=Xa(Sc);var Kt={},Ti;function kc(){if(Ti)return Kt;Ti=1,Kt.__esModule=!0,Kt.default=o;var e=i(wn()),t=i(cl()),n=["from","to","fill","className","innerRef"];function i(l){return l&&l.__esModule?l:{default:l}}function a(){return a=Object.assign?Object.assign.bind():function(l){for(var c=1;c<arguments.length;c++){var d=arguments[c];for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])}return l},a.apply(this,arguments)}function r(l,c){if(l==null)return{};var d={},u=Object.keys(l),p,h;for(h=0;h<u.length;h++)p=u[h],!(c.indexOf(p)>=0)&&(d[p]=l[p]);return d}function o(l){var c=l.from,d=c===void 0?{x:0,y:0}:c,u=l.to,p=u===void 0?{x:1,y:1}:u,h=l.fill,f=h===void 0?"transparent":h,m=l.className,y=l.innerRef,b=r(l,n),w=d.x===p.x||d.y===p.y;return e.default.createElement("line",a({ref:y,className:(0,t.default)("visx-line",m),x1:d.x,y1:d.y,x2:p.x,y2:p.y,fill:f,shapeRendering:w?"crispEdges":"auto"},b))}return Kt}var _c=kc();const Cc=Xa(_c);function Ac(e){return"bandwidth"in e?e.bandwidth():0}var Tc=["top","left","scale","width","stroke","strokeWidth","strokeDasharray","className","children","numTicks","lineStyle","offset","tickValues"];function Ys(){return Ys=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Ys.apply(this,arguments)}function Ec(e,t){if(e==null)return{};var n={},i=Object.keys(e),a,r;for(r=0;r<i.length;r++)a=i[r],!(t.indexOf(a)>=0)&&(n[a]=e[a]);return n}function Nn(e){var t=e.top,n=t===void 0?0:t,i=e.left,a=i===void 0?0:i,r=e.scale,o=e.width,l=e.stroke,c=l===void 0?"#eaf0f6":l,d=e.strokeWidth,u=d===void 0?1:d,p=e.strokeDasharray,h=e.className,f=e.children,m=e.numTicks,y=m===void 0?10:m,b=e.lineStyle,w=e.offset,j=e.tickValues,k=Ec(e,Tc),C=j??dl(r,y),_=(w??0)+Ac(r)/2,g=C.map(function(x,v){var S,T=((S=ul(r(x)))!=null?S:0)+_;return{index:v,from:new fi({x:0,y:T}),to:new fi({x:o,y:T})}});return Oe.createElement(se,{className:yn("visx-rows",h),top:n,left:a},f?f({lines:g}):g.map(function(x){var v=x.from,S=x.to,T=x.index;return Oe.createElement(Cc,Ys({key:"row-line-"+T,from:v,to:S,stroke:c,strokeWidth:u,strokeDasharray:p,style:b},k))}))}Nn.propTypes={tickValues:mi.array,width:mi.number.isRequired};const Sn=N.createContext({});function kn(e){const t=N.useRef(null);return t.current===null&&(t.current=e()),t.current}const cr=typeof window<"u",dr=cr?N.useLayoutEffect:N.useEffect,ys=N.createContext(null);function _n(e,t){e.indexOf(t)===-1&&e.push(t)}function Cn(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const Ee=(e,t,n)=>n>t?t:n<e?e:n;let An=()=>{};const Me={},ur=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function hr(e){return typeof e=="object"&&e!==null}const pr=e=>/^0[^.\s]+$/u.test(e);function Tn(e){let t;return()=>(t===void 0&&(t=e()),t)}const je=e=>e,Dc=(e,t)=>n=>t(e(n)),Ft=(...e)=>e.reduce(Dc),Mt=(e,t,n)=>{const i=t-e;return i===0?1:(n-e)/i};class En{constructor(){this.subscriptions=[]}add(t){return _n(this.subscriptions,t),()=>Cn(this.subscriptions,t)}notify(t,n,i){const a=this.subscriptions.length;if(a)if(a===1)this.subscriptions[0](t,n,i);else for(let r=0;r<a;r++){const o=this.subscriptions[r];o&&o(t,n,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Ae=e=>e*1e3,we=e=>e/1e3;function fr(e,t){return t?e*(1e3/t):0}const mr=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,Rc=1e-7,Mc=12;function Pc(e,t,n,i,a){let r,o,l=0;do o=t+(n-t)/2,r=mr(o,i,a)-e,r>0?n=o:t=o;while(Math.abs(r)>Rc&&++l<Mc);return o}function Bt(e,t,n,i){if(e===t&&n===i)return je;const a=r=>Pc(r,0,1,e,n);return r=>r===0||r===1?r:mr(a(r),t,i)}const xr=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,gr=e=>t=>1-e(1-t),br=Bt(.33,1.53,.69,.99),Dn=gr(br),yr=xr(Dn),vr=e=>(e*=2)<1?.5*Dn(e):.5*(2-Math.pow(2,-10*(e-1))),Rn=e=>1-Math.sin(Math.acos(e)),wr=gr(Rn),jr=xr(Rn),Ic=Bt(.42,0,1,1),Lc=Bt(0,0,.58,1),Nr=Bt(.42,0,.58,1),Oc=e=>Array.isArray(e)&&typeof e[0]!="number",Sr=e=>Array.isArray(e)&&typeof e[0]=="number",Vc={linear:je,easeIn:Ic,easeInOut:Nr,easeOut:Lc,circIn:Rn,circInOut:jr,circOut:wr,backIn:Dn,backInOut:yr,backOut:br,anticipate:vr},Fc=e=>typeof e=="string",Ei=e=>{if(Sr(e)){An(e.length===4);const[t,n,i,a]=e;return Bt(t,n,i,a)}else if(Fc(e))return Vc[e];return e},Xt=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Bc(e,t){let n=new Set,i=new Set,a=!1,r=!1;const o=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(u){o.has(u)&&(d.schedule(u),e()),u(l)}const d={schedule:(u,p=!1,h=!1)=>{const m=h&&a?n:i;return p&&o.add(u),m.has(u)||m.add(u),u},cancel:u=>{i.delete(u),o.delete(u)},process:u=>{if(l=u,a){r=!0;return}a=!0,[n,i]=[i,n],n.forEach(c),n.clear(),a=!1,r&&(r=!1,d.process(u))}};return d}const $c=40;function kr(e,t){let n=!1,i=!0;const a={delta:0,timestamp:0,isProcessing:!1},r=()=>n=!0,o=Xt.reduce((k,C)=>(k[C]=Bc(r),k),{}),{setup:l,read:c,resolveKeyframes:d,preUpdate:u,update:p,preRender:h,render:f,postRender:m}=o,y=()=>{const k=Me.useManualTiming?a.timestamp:performance.now();n=!1,Me.useManualTiming||(a.delta=i?1e3/60:Math.max(Math.min(k-a.timestamp,$c),1)),a.timestamp=k,a.isProcessing=!0,l.process(a),c.process(a),d.process(a),u.process(a),p.process(a),h.process(a),f.process(a),m.process(a),a.isProcessing=!1,n&&t&&(i=!1,e(y))},b=()=>{n=!0,i=!0,a.isProcessing||e(y)};return{schedule:Xt.reduce((k,C)=>{const _=o[C];return k[C]=(g,x=!1,v=!1)=>(n||b(),_.schedule(g,x,v)),k},{}),cancel:k=>{for(let C=0;C<Xt.length;C++)o[Xt[C]].cancel(k)},state:a,steps:o}}const{schedule:H,cancel:Fe,state:ce,steps:ks}=kr(typeof requestAnimationFrame<"u"?requestAnimationFrame:je,!0);let is;function Uc(){is=void 0}const xe={now:()=>(is===void 0&&xe.set(ce.isProcessing||Me.useManualTiming?ce.timestamp:performance.now()),is),set:e=>{is=e,queueMicrotask(Uc)}},_r=e=>t=>typeof t=="string"&&t.startsWith(e),Cr=_r("--"),Wc=_r("var(--"),Mn=e=>Wc(e)?zc.test(e.split("/*")[0].trim()):!1,zc=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function Di(e){return typeof e!="string"?!1:e.split("/*")[0].includes("var(--")}const yt={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Pt={...yt,transform:e=>Ee(0,1,e)},Zt={...yt,default:1},At=e=>Math.round(e*1e5)/1e5,Pn=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function qc(e){return e==null}const Hc=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,In=(e,t)=>n=>!!(typeof n=="string"&&Hc.test(n)&&n.startsWith(e)||t&&!qc(n)&&Object.prototype.hasOwnProperty.call(n,t)),Ar=(e,t,n)=>i=>{if(typeof i!="string")return i;const[a,r,o,l]=i.match(Pn);return{[e]:parseFloat(a),[t]:parseFloat(r),[n]:parseFloat(o),alpha:l!==void 0?parseFloat(l):1}},Gc=e=>Ee(0,255,e),_s={...yt,transform:e=>Math.round(Gc(e))},Ge={test:In("rgb","red"),parse:Ar("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:i=1})=>"rgba("+_s.transform(e)+", "+_s.transform(t)+", "+_s.transform(n)+", "+At(Pt.transform(i))+")"};function Yc(e){let t="",n="",i="",a="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),i=e.substring(5,7),a=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),i=e.substring(3,4),a=e.substring(4,5),t+=t,n+=n,i+=i,a+=a),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:a?parseInt(a,16)/255:1}}const Ks={test:In("#"),parse:Yc,transform:Ge.transform},$t=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Ie=$t("deg"),Te=$t("%"),R=$t("px"),Kc=$t("vh"),Xc=$t("vw"),Ri={...Te,parse:e=>Te.parse(e)/100,transform:e=>Te.transform(e*100)},ot={test:In("hsl","hue"),parse:Ar("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:i=1})=>"hsla("+Math.round(e)+", "+Te.transform(At(t))+", "+Te.transform(At(n))+", "+At(Pt.transform(i))+")"},te={test:e=>Ge.test(e)||Ks.test(e)||ot.test(e),parse:e=>Ge.test(e)?Ge.parse(e):ot.test(e)?ot.parse(e):Ks.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?Ge.transform(e):ot.transform(e),getAnimatableNone:e=>{const t=te.parse(e);return t.alpha=0,te.transform(t)}},Zc=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Jc(e){var t,n;return isNaN(e)&&typeof e=="string"&&(((t=e.match(Pn))==null?void 0:t.length)||0)+(((n=e.match(Zc))==null?void 0:n.length)||0)>0}const Tr="number",Er="color",Qc="var",ed="var(",Mi="${}",td=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function It(e){const t=e.toString(),n=[],i={color:[],number:[],var:[]},a=[];let r=0;const l=t.replace(td,c=>(te.test(c)?(i.color.push(r),a.push(Er),n.push(te.parse(c))):c.startsWith(ed)?(i.var.push(r),a.push(Qc),n.push(c)):(i.number.push(r),a.push(Tr),n.push(parseFloat(c))),++r,Mi)).split(Mi);return{values:n,split:l,indexes:i,types:a}}function Dr(e){return It(e).values}function Rr(e){const{split:t,types:n}=It(e),i=t.length;return a=>{let r="";for(let o=0;o<i;o++)if(r+=t[o],a[o]!==void 0){const l=n[o];l===Tr?r+=At(a[o]):l===Er?r+=te.transform(a[o]):r+=a[o]}return r}}const sd=e=>typeof e=="number"?0:te.test(e)?te.getAnimatableNone(e):e;function nd(e){const t=Dr(e);return Rr(e)(t.map(sd))}const Be={test:Jc,parse:Dr,createTransformer:Rr,getAnimatableNone:nd};function Cs(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function id({hue:e,saturation:t,lightness:n,alpha:i}){e/=360,t/=100,n/=100;let a=0,r=0,o=0;if(!t)a=r=o=n;else{const l=n<.5?n*(1+t):n+t-n*t,c=2*n-l;a=Cs(c,l,e+1/3),r=Cs(c,l,e),o=Cs(c,l,e-1/3)}return{red:Math.round(a*255),green:Math.round(r*255),blue:Math.round(o*255),alpha:i}}function ds(e,t){return n=>n>0?t:e}const Z=(e,t,n)=>e+(t-e)*n,As=(e,t,n)=>{const i=e*e,a=n*(t*t-i)+i;return a<0?0:Math.sqrt(a)},ad=[Ks,Ge,ot],rd=e=>ad.find(t=>t.test(e));function Pi(e){const t=rd(e);if(!t)return!1;let n=t.parse(e);return t===ot&&(n=id(n)),n}const Ii=(e,t)=>{const n=Pi(e),i=Pi(t);if(!n||!i)return ds(e,t);const a={...n};return r=>(a.red=As(n.red,i.red,r),a.green=As(n.green,i.green,r),a.blue=As(n.blue,i.blue,r),a.alpha=Z(n.alpha,i.alpha,r),Ge.transform(a))},Xs=new Set(["none","hidden"]);function od(e,t){return Xs.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}function ld(e,t){return n=>Z(e,t,n)}function Ln(e){return typeof e=="number"?ld:typeof e=="string"?Mn(e)?ds:te.test(e)?Ii:ud:Array.isArray(e)?Mr:typeof e=="object"?te.test(e)?Ii:cd:ds}function Mr(e,t){const n=[...e],i=n.length,a=e.map((r,o)=>Ln(r)(r,t[o]));return r=>{for(let o=0;o<i;o++)n[o]=a[o](r);return n}}function cd(e,t){const n={...e,...t},i={};for(const a in n)e[a]!==void 0&&t[a]!==void 0&&(i[a]=Ln(e[a])(e[a],t[a]));return a=>{for(const r in i)n[r]=i[r](a);return n}}function dd(e,t){const n=[],i={color:0,var:0,number:0};for(let a=0;a<t.values.length;a++){const r=t.types[a],o=e.indexes[r][i[r]],l=e.values[o]??0;n[a]=l,i[r]++}return n}const ud=(e,t)=>{const n=Be.createTransformer(t),i=It(e),a=It(t);return i.indexes.var.length===a.indexes.var.length&&i.indexes.color.length===a.indexes.color.length&&i.indexes.number.length>=a.indexes.number.length?Xs.has(e)&&!a.values.length||Xs.has(t)&&!i.values.length?od(e,t):Ft(Mr(dd(i,a),a.values),n):ds(e,t)};function Pr(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?Z(e,t,n):Ln(e)(e,t)}const hd=e=>{const t=({timestamp:n})=>e(n);return{start:(n=!0)=>H.update(t,n),stop:()=>Fe(t),now:()=>ce.isProcessing?ce.timestamp:xe.now()}},Ir=(e,t,n=10)=>{let i="";const a=Math.max(Math.round(t/n),2);for(let r=0;r<a;r++)i+=Math.round(e(r/(a-1))*1e4)/1e4+", ";return`linear(${i.substring(0,i.length-2)})`},us=2e4;function On(e){let t=0;const n=50;let i=e.next(t);for(;!i.done&&t<us;)t+=n,i=e.next(t);return t>=us?1/0:t}function pd(e,t=100,n){const i=n({...e,keyframes:[0,t]}),a=Math.min(On(i),us);return{type:"keyframes",ease:r=>i.next(a*r).value/t,duration:we(a)}}const fd=5;function Lr(e,t,n){const i=Math.max(t-fd,0);return fr(n-e(i),t-i)}const Q={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Ts=.001;function md({duration:e=Q.duration,bounce:t=Q.bounce,velocity:n=Q.velocity,mass:i=Q.mass}){let a,r,o=1-t;o=Ee(Q.minDamping,Q.maxDamping,o),e=Ee(Q.minDuration,Q.maxDuration,we(e)),o<1?(a=d=>{const u=d*o,p=u*e,h=u-n,f=Zs(d,o),m=Math.exp(-p);return Ts-h/f*m},r=d=>{const p=d*o*e,h=p*n+n,f=Math.pow(o,2)*Math.pow(d,2)*e,m=Math.exp(-p),y=Zs(Math.pow(d,2),o);return(-a(d)+Ts>0?-1:1)*((h-f)*m)/y}):(a=d=>{const u=Math.exp(-d*e),p=(d-n)*e+1;return-Ts+u*p},r=d=>{const u=Math.exp(-d*e),p=(n-d)*(e*e);return u*p});const l=5/e,c=gd(a,r,l);if(e=Ae(e),isNaN(c))return{stiffness:Q.stiffness,damping:Q.damping,duration:e};{const d=Math.pow(c,2)*i;return{stiffness:d,damping:o*2*Math.sqrt(i*d),duration:e}}}const xd=12;function gd(e,t,n){let i=n;for(let a=1;a<xd;a++)i=i-e(i)/t(i);return i}function Zs(e,t){return e*Math.sqrt(1-t*t)}const bd=["duration","bounce"],yd=["stiffness","damping","mass"];function Li(e,t){return t.some(n=>e[n]!==void 0)}function vd(e){let t={velocity:Q.velocity,stiffness:Q.stiffness,damping:Q.damping,mass:Q.mass,isResolvedFromDuration:!1,...e};if(!Li(e,yd)&&Li(e,bd))if(e.visualDuration){const n=e.visualDuration,i=2*Math.PI/(n*1.2),a=i*i,r=2*Ee(.05,1,1-(e.bounce||0))*Math.sqrt(a);t={...t,mass:Q.mass,stiffness:a,damping:r}}else{const n=md(e);t={...t,...n,mass:Q.mass},t.isResolvedFromDuration=!0}return t}function hs(e=Q.visualDuration,t=Q.bounce){const n=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:i,restDelta:a}=n;const r=n.keyframes[0],o=n.keyframes[n.keyframes.length-1],l={done:!1,value:r},{stiffness:c,damping:d,mass:u,duration:p,velocity:h,isResolvedFromDuration:f}=vd({...n,velocity:-we(n.velocity||0)}),m=h||0,y=d/(2*Math.sqrt(c*u)),b=o-r,w=we(Math.sqrt(c/u)),j=Math.abs(b)<5;i||(i=j?Q.restSpeed.granular:Q.restSpeed.default),a||(a=j?Q.restDelta.granular:Q.restDelta.default);let k;if(y<1){const _=Zs(w,y);k=g=>{const x=Math.exp(-y*w*g);return o-x*((m+y*w*b)/_*Math.sin(_*g)+b*Math.cos(_*g))}}else if(y===1)k=_=>o-Math.exp(-w*_)*(b+(m+w*b)*_);else{const _=w*Math.sqrt(y*y-1);k=g=>{const x=Math.exp(-y*w*g),v=Math.min(_*g,300);return o-x*((m+y*w*b)*Math.sinh(v)+_*b*Math.cosh(v))/_}}const C={calculatedDuration:f&&p||null,next:_=>{const g=k(_);if(f)l.done=_>=p;else{let x=_===0?m:0;y<1&&(x=_===0?Ae(m):Lr(k,_,g));const v=Math.abs(x)<=i,S=Math.abs(o-g)<=a;l.done=v&&S}return l.value=l.done?o:g,l},toString:()=>{const _=Math.min(On(C),us),g=Ir(x=>C.next(_*x).value,_,30);return _+"ms "+g},toTransition:()=>{}};return C}hs.applyToOptions=e=>{const t=pd(e,100,hs);return e.ease=t.ease,e.duration=Ae(t.duration),e.type="keyframes",e};function Js({keyframes:e,velocity:t=0,power:n=.8,timeConstant:i=325,bounceDamping:a=10,bounceStiffness:r=500,modifyTarget:o,min:l,max:c,restDelta:d=.5,restSpeed:u}){const p=e[0],h={done:!1,value:p},f=v=>l!==void 0&&v<l||c!==void 0&&v>c,m=v=>l===void 0?c:c===void 0||Math.abs(l-v)<Math.abs(c-v)?l:c;let y=n*t;const b=p+y,w=o===void 0?b:o(b);w!==b&&(y=w-p);const j=v=>-y*Math.exp(-v/i),k=v=>w+j(v),C=v=>{const S=j(v),T=k(v);h.done=Math.abs(S)<=d,h.value=h.done?w:T};let _,g;const x=v=>{f(h.value)&&(_=v,g=hs({keyframes:[h.value,m(h.value)],velocity:Lr(k,v,h.value),damping:a,stiffness:r,restDelta:d,restSpeed:u}))};return x(0),{calculatedDuration:null,next:v=>{let S=!1;return!g&&_===void 0&&(S=!0,C(v),x(v)),_!==void 0&&v>=_?g.next(v-_):(!S&&C(v),h)}}}function wd(e,t,n){const i=[],a=n||Me.mix||Pr,r=e.length-1;for(let o=0;o<r;o++){let l=a(e[o],e[o+1]);if(t){const c=Array.isArray(t)?t[o]||je:t;l=Ft(c,l)}i.push(l)}return i}function jd(e,t,{clamp:n=!0,ease:i,mixer:a}={}){const r=e.length;if(An(r===t.length),r===1)return()=>t[0];if(r===2&&t[0]===t[1])return()=>t[1];const o=e[0]===e[1];e[0]>e[r-1]&&(e=[...e].reverse(),t=[...t].reverse());const l=wd(t,i,a),c=l.length,d=u=>{if(o&&u<e[0])return t[0];let p=0;if(c>1)for(;p<e.length-2&&!(u<e[p+1]);p++);const h=Mt(e[p],e[p+1],u);return l[p](h)};return n?u=>d(Ee(e[0],e[r-1],u)):d}function Nd(e,t){const n=e[e.length-1];for(let i=1;i<=t;i++){const a=Mt(0,t,i);e.push(Z(n,1,a))}}function Sd(e){const t=[0];return Nd(t,e.length-1),t}function kd(e,t){return e.map(n=>n*t)}function _d(e,t){return e.map(()=>t||Nr).splice(0,e.length-1)}function Tt({duration:e=300,keyframes:t,times:n,ease:i="easeInOut"}){const a=Oc(i)?i.map(Ei):Ei(i),r={done:!1,value:t[0]},o=kd(n&&n.length===t.length?n:Sd(t),e),l=jd(o,t,{ease:Array.isArray(a)?a:_d(t,a)});return{calculatedDuration:e,next:c=>(r.value=l(c),r.done=c>=e,r)}}const Cd=e=>e!==null;function Vn(e,{repeat:t,repeatType:n="loop"},i,a=1){const r=e.filter(Cd),l=a<0||t&&n!=="loop"&&t%2===1?0:r.length-1;return!l||i===void 0?r[l]:i}const Ad={decay:Js,inertia:Js,tween:Tt,keyframes:Tt,spring:hs};function Or(e){typeof e.type=="string"&&(e.type=Ad[e.type])}class Fn{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,n){return this.finished.then(t,n)}}const Td=e=>e/100;class Bn extends Fn{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var i,a;const{motionValue:n}=this.options;n&&n.updatedAt!==xe.now()&&this.tick(xe.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(a=(i=this.options).onStop)==null||a.call(i))},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;Or(t);const{type:n=Tt,repeat:i=0,repeatDelay:a=0,repeatType:r,velocity:o=0}=t;let{keyframes:l}=t;const c=n||Tt;c!==Tt&&typeof l[0]!="number"&&(this.mixKeyframes=Ft(Td,Pr(l[0],l[1])),l=[0,100]);const d=c({...t,keyframes:l});r==="mirror"&&(this.mirroredGenerator=c({...t,keyframes:[...l].reverse(),velocity:-o})),d.calculatedDuration===null&&(d.calculatedDuration=On(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+a,this.totalDuration=this.resolvedDuration*(i+1)-a,this.generator=d}updateTime(t){const n=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(t,n=!1){const{generator:i,totalDuration:a,mixKeyframes:r,mirroredGenerator:o,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return i.next(0);const{delay:d=0,keyframes:u,repeat:p,repeatType:h,repeatDelay:f,type:m,onUpdate:y,finalKeyframe:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-a/this.speed,this.startTime)),n?this.currentTime=t:this.updateTime(t);const w=this.currentTime-d*(this.playbackSpeed>=0?1:-1),j=this.playbackSpeed>=0?w<0:w>a;this.currentTime=Math.max(w,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=a);let k=this.currentTime,C=i;if(p){const v=Math.min(this.currentTime,a)/l;let S=Math.floor(v),T=v%1;!T&&v>=1&&(T=1),T===1&&S--,S=Math.min(S,p+1),!!(S%2)&&(h==="reverse"?(T=1-T,f&&(T-=f/l)):h==="mirror"&&(C=o)),k=Ee(0,1,T)*l}const _=j?{done:!1,value:u[0]}:C.next(k);r&&(_.value=r(_.value));let{done:g}=_;!j&&c!==null&&(g=this.playbackSpeed>=0?this.currentTime>=a:this.currentTime<=0);const x=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&g);return x&&m!==Js&&(_.value=Vn(u,this.options,b,this.speed)),y&&y(_.value),x&&this.finish(),_}then(t,n){return this.finished.then(t,n)}get duration(){return we(this.calculatedDuration)}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+we(t)}get time(){return we(this.currentTime)}set time(t){var n;t=Ae(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),(n=this.driver)==null||n.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(xe.now());const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=we(this.currentTime))}play(){var a,r;if(this.isStopped)return;const{driver:t=hd,startTime:n}=this.options;this.driver||(this.driver=t(o=>this.tick(o))),(r=(a=this.options).onPlay)==null||r.call(a);const i=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=i):this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime||(this.startTime=n??i),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(xe.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var t,n;this.notifyFinished(),this.teardown(),this.state="finished",(n=(t=this.options).onComplete)==null||n.call(t)}cancel(){var t,n;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(n=(t=this.options).onCancel)==null||n.call(t)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){var n;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(n=this.driver)==null||n.stop(),t.observe(this)}}function Ed(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const Ye=e=>e*180/Math.PI,Qs=e=>{const t=Ye(Math.atan2(e[1],e[0]));return en(t)},Dd={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:Qs,rotateZ:Qs,skewX:e=>Ye(Math.atan(e[1])),skewY:e=>Ye(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},en=e=>(e=e%360,e<0&&(e+=360),e),Oi=Qs,Vi=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),Fi=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),Rd={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Vi,scaleY:Fi,scale:e=>(Vi(e)+Fi(e))/2,rotateX:e=>en(Ye(Math.atan2(e[6],e[5]))),rotateY:e=>en(Ye(Math.atan2(-e[2],e[0]))),rotateZ:Oi,rotate:Oi,skewX:e=>Ye(Math.atan(e[4])),skewY:e=>Ye(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function tn(e){return e.includes("scale")?1:0}function sn(e,t){if(!e||e==="none")return tn(t);const n=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let i,a;if(n)i=Rd,a=n;else{const l=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);i=Dd,a=l}if(!a)return tn(t);const r=i[t],o=a[1].split(",").map(Pd);return typeof r=="function"?r(o):o[r]}const Md=(e,t)=>{const{transform:n="none"}=getComputedStyle(e);return sn(n,t)};function Pd(e){return parseFloat(e.trim())}const vt=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],wt=new Set(vt),Bi=e=>e===yt||e===R,Id=new Set(["x","y","z"]),Ld=vt.filter(e=>!Id.has(e));function Od(e){const t=[];return Ld.forEach(n=>{const i=e.getValue(n);i!==void 0&&(t.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),t}const Ve={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>sn(t,"x"),y:(e,{transform:t})=>sn(t,"y")};Ve.translateX=Ve.x;Ve.translateY=Ve.y;const Xe=new Set;let nn=!1,an=!1,rn=!1;function Vr(){if(an){const e=Array.from(Xe).filter(i=>i.needsMeasurement),t=new Set(e.map(i=>i.element)),n=new Map;t.forEach(i=>{const a=Od(i);a.length&&(n.set(i,a),i.render())}),e.forEach(i=>i.measureInitialState()),t.forEach(i=>{i.render();const a=n.get(i);a&&a.forEach(([r,o])=>{var l;(l=i.getValue(r))==null||l.set(o)})}),e.forEach(i=>i.measureEndState()),e.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}an=!1,nn=!1,Xe.forEach(e=>e.complete(rn)),Xe.clear()}function Fr(){Xe.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(an=!0)})}function Vd(){rn=!0,Fr(),Vr(),rn=!1}class $n{constructor(t,n,i,a,r,o=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=i,this.motionValue=a,this.element=r,this.isAsync=o}scheduleResolve(){this.state="scheduled",this.isAsync?(Xe.add(this),nn||(nn=!0,H.read(Fr),H.resolveKeyframes(Vr))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:i,motionValue:a}=this;if(t[0]===null){const r=a==null?void 0:a.get(),o=t[t.length-1];if(r!==void 0)t[0]=r;else if(i&&n){const l=i.readValue(n,o);l!=null&&(t[0]=l)}t[0]===void 0&&(t[0]=o),a&&r===void 0&&a.set(t[0])}Ed(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),Xe.delete(this)}cancel(){this.state==="scheduled"&&(Xe.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Fd=e=>e.startsWith("--");function Bd(e,t,n){Fd(t)?e.style.setProperty(t,n):e.style[t]=n}const $d=Tn(()=>window.ScrollTimeline!==void 0),Ud={};function Wd(e,t){const n=Tn(e);return()=>Ud[t]??n()}const Br=Wd(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),_t=([e,t,n,i])=>`cubic-bezier(${e}, ${t}, ${n}, ${i})`,$i={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:_t([0,.65,.55,1]),circOut:_t([.55,0,1,.45]),backIn:_t([.31,.01,.66,-.59]),backOut:_t([.33,1.53,.69,.99])};function $r(e,t){if(e)return typeof e=="function"?Br()?Ir(e,t):"ease-out":Sr(e)?_t(e):Array.isArray(e)?e.map(n=>$r(n,t)||$i.easeOut):$i[e]}function zd(e,t,n,{delay:i=0,duration:a=300,repeat:r=0,repeatType:o="loop",ease:l="easeOut",times:c}={},d=void 0){const u={[t]:n};c&&(u.offset=c);const p=$r(l,a);Array.isArray(p)&&(u.easing=p);const h={delay:i,duration:a,easing:Array.isArray(p)?"linear":p,fill:"both",iterations:r+1,direction:o==="reverse"?"alternate":"normal"};return d&&(h.pseudoElement=d),e.animate(u,h)}function Ur(e){return typeof e=="function"&&"applyToOptions"in e}function qd({type:e,...t}){return Ur(e)&&Br()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class Hd extends Fn{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!t)return;const{element:n,name:i,keyframes:a,pseudoElement:r,allowFlatten:o=!1,finalKeyframe:l,onComplete:c}=t;this.isPseudoElement=!!r,this.allowFlatten=o,this.options=t,An(typeof t.type!="string");const d=qd(t);this.animation=zd(n,i,a,d,r),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!r){const u=Vn(a,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(u):Bd(n,i,u),this.animation.cancel()}c==null||c(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var t,n;(n=(t=this.animation).finish)==null||n.call(t)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var n,i,a;const t=(n=this.options)==null?void 0:n.element;!this.isPseudoElement&&(t!=null&&t.isConnected)&&((a=(i=this.animation).commitStyles)==null||a.call(i))}get duration(){var n,i;const t=((i=(n=this.animation.effect)==null?void 0:n.getComputedTiming)==null?void 0:i.call(n).duration)||0;return we(Number(t))}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+we(t)}get time(){return we(Number(this.animation.currentTime)||0)}set time(t){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=Ae(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(t){this.manualStartTime=this.animation.startTime=t}attachTimeline({timeline:t,observe:n}){var i;return this.allowFlatten&&((i=this.animation.effect)==null||i.updateTiming({easing:"linear"})),this.animation.onfinish=null,t&&$d()?(this.animation.timeline=t,je):n(this)}}const Wr={anticipate:vr,backInOut:yr,circInOut:jr};function Gd(e){return e in Wr}function Yd(e){typeof e.ease=="string"&&Gd(e.ease)&&(e.ease=Wr[e.ease])}const Es=10;class Kd extends Hd{constructor(t){Yd(t),Or(t),super(t),t.startTime!==void 0&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:n,onUpdate:i,onComplete:a,element:r,...o}=this.options;if(!n)return;if(t!==void 0){n.set(t);return}const l=new Bn({...o,autoplay:!1}),c=Math.max(Es,xe.now()-this.startTime),d=Ee(0,Es,c-Es);n.setWithVelocity(l.sample(Math.max(0,c-d)).value,l.sample(c).value,d),l.stop()}}const Ui=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Be.test(e)||e==="0")&&!e.startsWith("url("));function Xd(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function Zd(e,t,n,i){const a=e[0];if(a===null)return!1;if(t==="display"||t==="visibility")return!0;const r=e[e.length-1],o=Ui(a,t),l=Ui(r,t);return!o||!l?!1:Xd(e)||(n==="spring"||Ur(n))&&i}function on(e){e.duration=0,e.type="keyframes"}const Jd=new Set(["opacity","clipPath","filter","transform"]),Qd=Tn(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function eu(e){var u;const{motionValue:t,name:n,repeatDelay:i,repeatType:a,damping:r,type:o}=e;if(!(((u=t==null?void 0:t.owner)==null?void 0:u.current)instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=t.owner.getProps();return Qd()&&n&&Jd.has(n)&&(n!=="transform"||!d)&&!c&&!i&&a!=="mirror"&&r!==0&&o!=="inertia"}const tu=40;class su extends Fn{constructor({autoplay:t=!0,delay:n=0,type:i="keyframes",repeat:a=0,repeatDelay:r=0,repeatType:o="loop",keyframes:l,name:c,motionValue:d,element:u,...p}){var m;super(),this.stop=()=>{var y,b;this._animation&&(this._animation.stop(),(y=this.stopTimeline)==null||y.call(this)),(b=this.keyframeResolver)==null||b.cancel()},this.createdAt=xe.now();const h={autoplay:t,delay:n,type:i,repeat:a,repeatDelay:r,repeatType:o,name:c,motionValue:d,element:u,...p},f=(u==null?void 0:u.KeyframeResolver)||$n;this.keyframeResolver=new f(l,(y,b,w)=>this.onKeyframesResolved(y,b,h,!w),c,d,u),(m=this.keyframeResolver)==null||m.scheduleResolve()}onKeyframesResolved(t,n,i,a){var b,w;this.keyframeResolver=void 0;const{name:r,type:o,velocity:l,delay:c,isHandoff:d,onUpdate:u}=i;this.resolvedAt=xe.now(),Zd(t,r,o,l)||((Me.instantAnimations||!c)&&(u==null||u(Vn(t,i,n))),t[0]=t[t.length-1],on(i),i.repeat=0);const h={startTime:a?this.resolvedAt?this.resolvedAt-this.createdAt>tu?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...i,keyframes:t},f=!d&&eu(h),m=(w=(b=h.motionValue)==null?void 0:b.owner)==null?void 0:w.current,y=f?new Kd({...h,element:m}):new Bn(h);y.finished.then(()=>{this.notifyFinished()}).catch(je),this.pendingTimeline&&(this.stopTimeline=y.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=y}get finished(){return this._animation?this.animation.finished:this._finished}then(t,n){return this.finished.finally(t).then(()=>{})}get animation(){var t;return this._animation||((t=this.keyframeResolver)==null||t.resume(),Vd()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var t;this._animation&&this.animation.cancel(),(t=this.keyframeResolver)==null||t.cancel()}}function zr(e,t,n,i=0,a=1){const r=Array.from(e).sort((d,u)=>d.sortNodePosition(u)).indexOf(t),o=e.size,l=(o-1)*i;return typeof n=="function"?n(r,o):a===1?r*i:l-r*i}const nu=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function iu(e){const t=nu.exec(e);if(!t)return[,];const[,n,i,a]=t;return[`--${n??i}`,a]}function qr(e,t,n=1){const[i,a]=iu(e);if(!i)return;const r=window.getComputedStyle(t).getPropertyValue(i);if(r){const o=r.trim();return ur(o)?parseFloat(o):o}return Mn(a)?qr(a,t,n+1):a}const au={type:"spring",stiffness:500,damping:25,restSpeed:10},ru=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),ou={type:"keyframes",duration:.8},lu={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},cu=(e,{keyframes:t})=>t.length>2?ou:wt.has(e)?e.startsWith("scale")?ru(t[1]):au:lu,du=e=>e!==null;function uu(e,{repeat:t,repeatType:n="loop"},i){const a=e.filter(du),r=t&&n!=="loop"&&t%2===1?0:a.length-1;return a[r]}function Hr(e,t){if(e!=null&&e.inherit&&t){const{inherit:n,...i}=e;return{...t,...i}}return e}function Un(e,t){const n=(e==null?void 0:e[t])??(e==null?void 0:e.default)??e;return n!==e?Hr(n,e):n}function hu({when:e,delay:t,delayChildren:n,staggerChildren:i,staggerDirection:a,repeat:r,repeatType:o,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}const Wn=(e,t,n,i={},a,r)=>o=>{const l=Un(i,e)||{},c=l.delay||i.delay||0;let{elapsed:d=0}=i;d=d-Ae(c);const u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...l,delay:-d,onUpdate:h=>{t.set(h),l.onUpdate&&l.onUpdate(h)},onComplete:()=>{o(),l.onComplete&&l.onComplete()},name:e,motionValue:t,element:r?void 0:a};hu(l)||Object.assign(u,cu(e,u)),u.duration&&(u.duration=Ae(u.duration)),u.repeatDelay&&(u.repeatDelay=Ae(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let p=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(on(u),u.delay===0&&(p=!0)),(Me.instantAnimations||Me.skipAnimations||a!=null&&a.shouldSkipAnimations)&&(p=!0,on(u),u.delay=0),u.allowFlatten=!l.type&&!l.ease,p&&!r&&t.get()!==void 0){const h=uu(u.keyframes,l);if(h!==void 0){H.update(()=>{u.onUpdate(h),u.onComplete()});return}}return l.isSync?new Bn(u):new su(u)};function Wi(e){const t=[{},{}];return e==null||e.values.forEach((n,i)=>{t[0][i]=n.get(),t[1][i]=n.getVelocity()}),t}function zn(e,t,n,i){if(typeof t=="function"){const[a,r]=Wi(i);t=t(n!==void 0?n:e.custom,a,r)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[a,r]=Wi(i);t=t(n!==void 0?n:e.custom,a,r)}return t}function pt(e,t,n){const i=e.getProps();return zn(i,t,n!==void 0?n:i.custom,e)}const Gr=new Set(["width","height","top","left","right","bottom",...vt]),zi=30,pu=e=>!isNaN(parseFloat(e));class fu{constructor(t,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=i=>{var r;const a=xe.now();if(this.updatedAt!==a&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&((r=this.events.change)==null||r.notify(this.current),this.dependents))for(const o of this.dependents)o.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=xe.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=pu(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new En);const i=this.events[t].add(n);return t==="change"?()=>{i(),H.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,n,i){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-i}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var t;(t=this.events.change)==null||t.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=xe.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>zi)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,zi);return fr(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var t,n;(t=this.dependents)==null||t.clear(),(n=this.events.destroy)==null||n.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function mt(e,t){return new fu(e,t)}const ln=e=>Array.isArray(e);function mu(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,mt(n))}function xu(e){return ln(e)?e[e.length-1]||0:e}function gu(e,t){const n=pt(e,t);let{transitionEnd:i={},transition:a={},...r}=n||{};r={...r,...i};for(const o in r){const l=xu(r[o]);mu(e,o,l)}}const pe=e=>!!(e&&e.getVelocity);function bu(e){return!!(pe(e)&&e.add)}function cn(e,t){const n=e.getValue("willChange");if(bu(n))return n.add(t);if(!n&&Me.WillChange){const i=new Me.WillChange("auto");e.addValue("willChange",i),i.add(t)}}function qn(e){return e.replace(/([A-Z])/g,t=>`-${t.toLowerCase()}`)}const yu="framerAppearId",Yr="data-"+qn(yu);function Kr(e){return e.props[Yr]}function vu({protectedKeys:e,needsAnimating:t},n){const i=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,i}function Xr(e,t,{delay:n=0,transitionOverride:i,type:a}={}){let{transition:r,transitionEnd:o,...l}=t;const c=e.getDefaultTransition();r=r?Hr(r,c):c;const d=r==null?void 0:r.reduceMotion;i&&(r=i);const u=[],p=a&&e.animationState&&e.animationState.getState()[a];for(const h in l){const f=e.getValue(h,e.latestValues[h]??null),m=l[h];if(m===void 0||p&&vu(p,h))continue;const y={delay:n,...Un(r||{},h)},b=f.get();if(b!==void 0&&!f.isAnimating&&!Array.isArray(m)&&m===b&&!y.velocity)continue;let w=!1;if(window.MotionHandoffAnimation){const C=Kr(e);if(C){const _=window.MotionHandoffAnimation(C,h,H);_!==null&&(y.startTime=_,w=!0)}}cn(e,h);const j=d??e.shouldReduceMotion;f.start(Wn(h,f,m,j&&Gr.has(h)?{type:!1}:y,e,w));const k=f.animation;k&&u.push(k)}if(o){const h=()=>H.update(()=>{o&&gu(e,o)});u.length?Promise.all(u).then(h):h()}return u}function dn(e,t,n={}){var c;const i=pt(e,t,n.type==="exit"?(c=e.presenceContext)==null?void 0:c.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(a=n.transitionOverride);const r=i?()=>Promise.all(Xr(e,i,n)):()=>Promise.resolve(),o=e.variantChildren&&e.variantChildren.size?(d=0)=>{const{delayChildren:u=0,staggerChildren:p,staggerDirection:h}=a;return wu(e,t,d,u,p,h,n)}:()=>Promise.resolve(),{when:l}=a;if(l){const[d,u]=l==="beforeChildren"?[r,o]:[o,r];return d().then(()=>u())}else return Promise.all([r(),o(n.delay)])}function wu(e,t,n=0,i=0,a=0,r=1,o){const l=[];for(const c of e.variantChildren)c.notify("AnimationStart",t),l.push(dn(c,t,{...o,delay:n+(typeof i=="function"?0:i)+zr(e.variantChildren,c,i,a,r)}).then(()=>c.notify("AnimationComplete",t)));return Promise.all(l)}function ju(e,t,n={}){e.notify("AnimationStart",t);let i;if(Array.isArray(t)){const a=t.map(r=>dn(e,r,n));i=Promise.all(a)}else if(typeof t=="string")i=dn(e,t,n);else{const a=typeof t=="function"?pt(e,t,n.custom):t;i=Promise.all(Xr(e,a,n))}return i.then(()=>{e.notify("AnimationComplete",t)})}const Nu={test:e=>e==="auto",parse:e=>e},Zr=e=>t=>t.test(e),Jr=[yt,R,Te,Ie,Xc,Kc,Nu],qi=e=>Jr.find(Zr(e));function Su(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||pr(e):!0}const ku=new Set(["brightness","contrast","saturate","opacity"]);function _u(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[i]=n.match(Pn)||[];if(!i)return e;const a=n.replace(i,"");let r=ku.has(t)?1:0;return i!==n&&(r*=100),t+"("+r+a+")"}const Cu=/\b([a-z-]*)\(.*?\)/gu,un={...Be,getAnimatableNone:e=>{const t=e.match(Cu);return t?t.map(_u).join(" "):e}},Hi={...yt,transform:Math.round},Au={rotate:Ie,rotateX:Ie,rotateY:Ie,rotateZ:Ie,scale:Zt,scaleX:Zt,scaleY:Zt,scaleZ:Zt,skew:Ie,skewX:Ie,skewY:Ie,distance:R,translateX:R,translateY:R,translateZ:R,x:R,y:R,z:R,perspective:R,transformPerspective:R,opacity:Pt,originX:Ri,originY:Ri,originZ:R},Hn={borderWidth:R,borderTopWidth:R,borderRightWidth:R,borderBottomWidth:R,borderLeftWidth:R,borderRadius:R,borderTopLeftRadius:R,borderTopRightRadius:R,borderBottomRightRadius:R,borderBottomLeftRadius:R,width:R,maxWidth:R,height:R,maxHeight:R,top:R,right:R,bottom:R,left:R,inset:R,insetBlock:R,insetBlockStart:R,insetBlockEnd:R,insetInline:R,insetInlineStart:R,insetInlineEnd:R,padding:R,paddingTop:R,paddingRight:R,paddingBottom:R,paddingLeft:R,paddingBlock:R,paddingBlockStart:R,paddingBlockEnd:R,paddingInline:R,paddingInlineStart:R,paddingInlineEnd:R,margin:R,marginTop:R,marginRight:R,marginBottom:R,marginLeft:R,marginBlock:R,marginBlockStart:R,marginBlockEnd:R,marginInline:R,marginInlineStart:R,marginInlineEnd:R,fontSize:R,backgroundPositionX:R,backgroundPositionY:R,...Au,zIndex:Hi,fillOpacity:Pt,strokeOpacity:Pt,numOctaves:Hi},Tu={...Hn,color:te,backgroundColor:te,outlineColor:te,fill:te,stroke:te,borderColor:te,borderTopColor:te,borderRightColor:te,borderBottomColor:te,borderLeftColor:te,filter:un,WebkitFilter:un},Qr=e=>Tu[e];function eo(e,t){let n=Qr(e);return n!==un&&(n=Be),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const Eu=new Set(["auto","none","0"]);function Du(e,t,n){let i=0,a;for(;i<e.length&&!a;){const r=e[i];typeof r=="string"&&!Eu.has(r)&&It(r).values.length&&(a=e[i]),i++}if(a&&n)for(const r of t)e[r]=eo(n,a)}class Ru extends $n{constructor(t,n,i,a,r){super(t,n,i,a,r,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:i}=this;if(!n||!n.current)return;super.readKeyframes();for(let u=0;u<t.length;u++){let p=t[u];if(typeof p=="string"&&(p=p.trim(),Mn(p))){const h=qr(p,n.current);h!==void 0&&(t[u]=h),u===t.length-1&&(this.finalKeyframe=p)}}if(this.resolveNoneKeyframes(),!Gr.has(i)||t.length!==2)return;const[a,r]=t,o=qi(a),l=qi(r),c=Di(a),d=Di(r);if(c!==d&&Ve[i]){this.needsMeasurement=!0;return}if(o!==l)if(Bi(o)&&Bi(l))for(let u=0;u<t.length;u++){const p=t[u];typeof p=="string"&&(t[u]=parseFloat(p))}else Ve[i]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,i=[];for(let a=0;a<t.length;a++)(t[a]===null||Su(t[a]))&&i.push(a);i.length&&Du(t,i,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:i}=this;if(!t||!t.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Ve[i](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const a=n[n.length-1];a!==void 0&&t.getValue(i,a).jump(a,!1)}measureEndState(){var l;const{element:t,name:n,unresolvedKeyframes:i}=this;if(!t||!t.current)return;const a=t.getValue(n);a&&a.jump(this.measuredOrigin,!1);const r=i.length-1,o=i[r];i[r]=Ve[n](t.measureViewportBox(),window.getComputedStyle(t.current)),o!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=o),(l=this.removedTransforms)!=null&&l.length&&this.removedTransforms.forEach(([c,d])=>{t.getValue(c).set(d)}),this.resolveNoneKeyframes()}}function to(e,t,n){if(e==null)return[];if(e instanceof EventTarget)return[e];if(typeof e=="string"){let i=document;const a=(n==null?void 0:n[e])??i.querySelectorAll(e);return a?Array.from(a):[]}return Array.from(e).filter(i=>i!=null)}const so=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function hn(e){return hr(e)&&"offsetHeight"in e}const{schedule:Gn}=kr(queueMicrotask,!1),ke={x:!1,y:!1};function no(){return ke.x||ke.y}function Mu(e){return e==="x"||e==="y"?ke[e]?null:(ke[e]=!0,()=>{ke[e]=!1}):ke.x||ke.y?null:(ke.x=ke.y=!0,()=>{ke.x=ke.y=!1})}function io(e,t){const n=to(e),i=new AbortController,a={passive:!0,...t,signal:i.signal};return[n,a,()=>i.abort()]}function Pu(e){return!(e.pointerType==="touch"||no())}function Iu(e,t,n={}){const[i,a,r]=io(e,n);return i.forEach(o=>{let l=!1,c=!1,d;const u=()=>{o.removeEventListener("pointerleave",m)},p=b=>{d&&(d(b),d=void 0),u()},h=b=>{l=!1,window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",h),c&&(c=!1,p(b))},f=()=>{l=!0,window.addEventListener("pointerup",h,a),window.addEventListener("pointercancel",h,a)},m=b=>{if(b.pointerType!=="touch"){if(l){c=!0;return}p(b)}},y=b=>{if(!Pu(b))return;c=!1;const w=t(o,b);typeof w=="function"&&(d=w,o.addEventListener("pointerleave",m,a))};o.addEventListener("pointerenter",y,a),o.addEventListener("pointerdown",f,a)}),r}const ao=(e,t)=>t?e===t?!0:ao(e,t.parentElement):!1,Yn=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,Lu=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Ou(e){return Lu.has(e.tagName)||e.isContentEditable===!0}const Vu=new Set(["INPUT","SELECT","TEXTAREA"]);function Fu(e){return Vu.has(e.tagName)||e.isContentEditable===!0}const as=new WeakSet;function Gi(e){return t=>{t.key==="Enter"&&e(t)}}function Ds(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const Bu=(e,t)=>{const n=e.currentTarget;if(!n)return;const i=Gi(()=>{if(as.has(n))return;Ds(n,"down");const a=Gi(()=>{Ds(n,"up")}),r=()=>Ds(n,"cancel");n.addEventListener("keyup",a,t),n.addEventListener("blur",r,t)});n.addEventListener("keydown",i,t),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),t)};function Yi(e){return Yn(e)&&!no()}const Ki=new WeakSet;function $u(e,t,n={}){const[i,a,r]=io(e,n),o=l=>{const c=l.currentTarget;if(!Yi(l)||Ki.has(l))return;as.add(c),n.stopPropagation&&Ki.add(l);const d=t(c,l),u=(f,m)=>{window.removeEventListener("pointerup",p),window.removeEventListener("pointercancel",h),as.has(c)&&as.delete(c),Yi(f)&&typeof d=="function"&&d(f,{success:m})},p=f=>{u(f,c===window||c===document||n.useGlobalTarget||ao(c,f.target))},h=f=>{u(f,!1)};window.addEventListener("pointerup",p,a),window.addEventListener("pointercancel",h,a)};return i.forEach(l=>{(n.useGlobalTarget?window:l).addEventListener("pointerdown",o,a),hn(l)&&(l.addEventListener("focus",d=>Bu(d,a)),!Ou(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),r}function Kn(e){return hr(e)&&"ownerSVGElement"in e}const rs=new WeakMap;let Le;const ro=(e,t,n)=>(i,a)=>a&&a[0]?a[0][e+"Size"]:Kn(i)&&"getBBox"in i?i.getBBox()[t]:i[n],Uu=ro("inline","width","offsetWidth"),Wu=ro("block","height","offsetHeight");function zu({target:e,borderBoxSize:t}){var n;(n=rs.get(e))==null||n.forEach(i=>{i(e,{get width(){return Uu(e,t)},get height(){return Wu(e,t)}})})}function qu(e){e.forEach(zu)}function Hu(){typeof ResizeObserver>"u"||(Le=new ResizeObserver(qu))}function Gu(e,t){Le||Hu();const n=to(e);return n.forEach(i=>{let a=rs.get(i);a||(a=new Set,rs.set(i,a)),a.add(t),Le==null||Le.observe(i)}),()=>{n.forEach(i=>{const a=rs.get(i);a==null||a.delete(t),a!=null&&a.size||Le==null||Le.unobserve(i)})}}const os=new Set;let lt;function Yu(){lt=()=>{const e={get width(){return window.innerWidth},get height(){return window.innerHeight}};os.forEach(t=>t(e))},window.addEventListener("resize",lt)}function Ku(e){return os.add(e),lt||Yu(),()=>{os.delete(e),!os.size&&typeof lt=="function"&&(window.removeEventListener("resize",lt),lt=void 0)}}function Xi(e,t){return typeof e=="function"?Ku(e):Gu(e,t)}function Xu(e){return Kn(e)&&e.tagName==="svg"}const Zu=[...Jr,te,Be],Ju=e=>Zu.find(Zr(e)),Zi=()=>({translate:0,scale:1,origin:0,originPoint:0}),ct=()=>({x:Zi(),y:Zi()}),Ji=()=>({min:0,max:0}),ie=()=>({x:Ji(),y:Ji()}),pn={current:null},oo={current:!1},Qu=typeof window<"u";function eh(){if(oo.current=!0,!!Qu)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>pn.current=e.matches;e.addEventListener("change",t),t()}else pn.current=!1}const th=new WeakMap;function vs(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function Lt(e){return typeof e=="string"||Array.isArray(e)}const Xn=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Zn=["initial",...Xn];function ws(e){return vs(e.animate)||Zn.some(t=>Lt(e[t]))}function lo(e){return!!(ws(e)||e.variants)}function sh(e,t,n){for(const i in t){const a=t[i],r=n[i];if(pe(a))e.addValue(i,a);else if(pe(r))e.addValue(i,mt(a,{owner:e}));else if(r!==a)if(e.hasValue(i)){const o=e.getValue(i);o.liveStyle===!0?o.jump(a):o.hasAnimated||o.set(a)}else{const o=e.getStaticValue(i);e.addValue(i,mt(o!==void 0?o:a,{owner:e}))}}for(const i in n)t[i]===void 0&&e.removeValue(i);return t}const Qi=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let ps={};function co(e){ps=e}function nh(){return ps}class ih{scrapeMotionValuesFromProps(t,n,i){return{}}constructor({parent:t,props:n,presenceContext:i,reducedMotionConfig:a,skipAnimations:r,blockInitialAnimation:o,visualState:l},c={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.shouldSkipAnimations=!1,this.values=new Map,this.KeyframeResolver=$n,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.hasBeenMounted=!1,this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=xe.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,H.render(this.render,!1,!0))};const{latestValues:d,renderState:u}=l;this.latestValues=d,this.baseTarget={...d},this.initialValues=n.initial?{...d}:{},this.renderState=u,this.parent=t,this.props=n,this.presenceContext=i,this.depth=t?t.depth+1:0,this.reducedMotionConfig=a,this.skipAnimationsConfig=r,this.options=c,this.blockInitialAnimation=!!o,this.isControllingVariants=ws(n),this.isVariantNode=lo(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:p,...h}=this.scrapeMotionValuesFromProps(n,{},this);for(const f in h){const m=h[f];d[f]!==void 0&&pe(m)&&m.set(d[f])}}mount(t){var n,i;if(this.hasBeenMounted)for(const a in this.initialValues)(n=this.values.get(a))==null||n.jump(this.initialValues[a]),this.latestValues[a]=this.initialValues[a];this.current=t,th.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((a,r)=>this.bindToMotionValue(r,a)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(oo.current||eh(),this.shouldReduceMotion=pn.current),this.shouldSkipAnimations=this.skipAnimationsConfig??!1,(i=this.parent)==null||i.addChild(this),this.update(this.props,this.presenceContext),this.hasBeenMounted=!0}unmount(){var t;this.projection&&this.projection.unmount(),Fe(this.notifyUpdate),Fe(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(t=this.parent)==null||t.removeChild(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const i=this.features[n];i&&(i.unmount(),i.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,n){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const i=wt.has(t);i&&this.onBindTransform&&this.onBindTransform();const a=n.on("change",o=>{this.latestValues[t]=o,this.props.onUpdate&&H.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let r;typeof window<"u"&&window.MotionCheckAppearSync&&(r=window.MotionCheckAppearSync(this,t,n)),this.valueSubscriptions.set(t,()=>{a(),r&&r(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in ps){const n=ps[t];if(!n)continue;const{isEnabled:i,Feature:a}=n;if(!this.features[t]&&a&&i(this.props)&&(this.features[t]=new a(this)),this.features[t]){const r=this.features[t];r.isMounted?r.update():(r.mount(),r.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ie()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let i=0;i<Qi.length;i++){const a=Qi[i];this.propEventSubscriptions[a]&&(this.propEventSubscriptions[a](),delete this.propEventSubscriptions[a]);const r="on"+a,o=t[r];o&&(this.propEventSubscriptions[a]=this.on(a,o))}this.prevMotionValues=sh(this,this.scrapeMotionValuesFromProps(t,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const i=this.values.get(t);n!==i&&(i&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let i=this.values.get(t);return i===void 0&&n!==void 0&&(i=mt(n===null?void 0:n,{owner:this}),this.addValue(t,i)),i}readValue(t,n){let i=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return i!=null&&(typeof i=="string"&&(ur(i)||pr(i))?i=parseFloat(i):!Ju(i)&&Be.test(n)&&(i=eo(t,n)),this.setBaseTarget(t,pe(i)?i.get():i)),pe(i)?i.get():i}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){var r;const{initial:n}=this.props;let i;if(typeof n=="string"||typeof n=="object"){const o=zn(this.props,n,(r=this.presenceContext)==null?void 0:r.custom);o&&(i=o[t])}if(n&&i!==void 0)return i;const a=this.getBaseTargetFromProps(this.props,t);return a!==void 0&&!pe(a)?a:this.initialValues[t]!==void 0&&i===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new En),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}scheduleRenderMicrotask(){Gn.render(this.render)}}class uo extends ih{constructor(){super(...arguments),this.KeyframeResolver=Ru}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){const i=t.style;return i?i[n]:void 0}removeValueFromRenderState(t,{vars:n,style:i}){delete n[t],delete i[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;pe(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}class $e{constructor(t){this.isMounted=!1,this.node=t}update(){}}function ho({top:e,left:t,right:n,bottom:i}){return{x:{min:t,max:n},y:{min:e,max:i}}}function ah({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function rh(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),i=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}function Rs(e){return e===void 0||e===1}function fn({scale:e,scaleX:t,scaleY:n}){return!Rs(e)||!Rs(t)||!Rs(n)}function He(e){return fn(e)||po(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function po(e){return ea(e.x)||ea(e.y)}function ea(e){return e&&e!=="0%"}function fs(e,t,n){const i=e-n,a=t*i;return n+a}function ta(e,t,n,i,a){return a!==void 0&&(e=fs(e,a,i)),fs(e,n,i)+t}function mn(e,t=0,n=1,i,a){e.min=ta(e.min,t,n,i,a),e.max=ta(e.max,t,n,i,a)}function fo(e,{x:t,y:n}){mn(e.x,t.translate,t.scale,t.originPoint),mn(e.y,n.translate,n.scale,n.originPoint)}const sa=.999999999999,na=1.0000000000001;function oh(e,t,n,i=!1){const a=n.length;if(!a)return;t.x=t.y=1;let r,o;for(let l=0;l<a;l++){r=n[l],o=r.projectionDelta;const{visualElement:c}=r.options;c&&c.props.style&&c.props.style.display==="contents"||(i&&r.options.layoutScroll&&r.scroll&&r!==r.root&&ut(e,{x:-r.scroll.offset.x,y:-r.scroll.offset.y}),o&&(t.x*=o.x.scale,t.y*=o.y.scale,fo(e,o)),i&&He(r.latestValues)&&ut(e,r.latestValues))}t.x<na&&t.x>sa&&(t.x=1),t.y<na&&t.y>sa&&(t.y=1)}function dt(e,t){e.min=e.min+t,e.max=e.max+t}function ia(e,t,n,i,a=.5){const r=Z(e.min,e.max,a);mn(e,t,n,r,i)}function ut(e,t){ia(e.x,t.x,t.scaleX,t.scale,t.originX),ia(e.y,t.y,t.scaleY,t.scale,t.originY)}function mo(e,t){return ho(rh(e.getBoundingClientRect(),t))}function lh(e,t,n){const i=mo(e,n),{scroll:a}=t;return a&&(dt(i.x,a.offset.x),dt(i.y,a.offset.y)),i}const ch={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},dh=vt.length;function uh(e,t,n){let i="",a=!0;for(let r=0;r<dh;r++){const o=vt[r],l=e[o];if(l===void 0)continue;let c=!0;if(typeof l=="number")c=l===(o.startsWith("scale")?1:0);else{const d=parseFloat(l);c=o.startsWith("scale")?d===1:d===0}if(!c||n){const d=so(l,Hn[o]);if(!c){a=!1;const u=ch[o]||o;i+=`${u}(${d}) `}n&&(t[o]=d)}}return i=i.trim(),n?i=n(t,a?"":i):a&&(i="none"),i}function Jn(e,t,n){const{style:i,vars:a,transformOrigin:r}=e;let o=!1,l=!1;for(const c in t){const d=t[c];if(wt.has(c)){o=!0;continue}else if(Cr(c)){a[c]=d;continue}else{const u=so(d,Hn[c]);c.startsWith("origin")?(l=!0,r[c]=u):i[c]=u}}if(t.transform||(o||n?i.transform=uh(t,e.transform,n):i.transform&&(i.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:u=0}=r;i.transformOrigin=`${c} ${d} ${u}`}}function xo(e,{style:t,vars:n},i,a){const r=e.style;let o;for(o in t)r[o]=t[o];a==null||a.applyProjectionStyles(r,i);for(o in n)r.setProperty(o,n[o])}function aa(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const kt={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(R.test(e))e=parseFloat(e);else return e;const n=aa(e,t.target.x),i=aa(e,t.target.y);return`${n}% ${i}%`}},hh={correct:(e,{treeScale:t,projectionDelta:n})=>{const i=e,a=Be.parse(e);if(a.length>5)return i;const r=Be.createTransformer(e),o=typeof a[0]!="number"?1:0,l=n.x.scale*t.x,c=n.y.scale*t.y;a[0+o]/=l,a[1+o]/=c;const d=Z(l,c,.5);return typeof a[2+o]=="number"&&(a[2+o]/=d),typeof a[3+o]=="number"&&(a[3+o]/=d),r(a)}},xn={borderRadius:{...kt,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:kt,borderTopRightRadius:kt,borderBottomLeftRadius:kt,borderBottomRightRadius:kt,boxShadow:hh};function go(e,{layout:t,layoutId:n}){return wt.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!xn[e]||e==="opacity")}function Qn(e,t,n){var o;const i=e.style,a=t==null?void 0:t.style,r={};if(!i)return r;for(const l in i)(pe(i[l])||a&&pe(a[l])||go(l,e)||((o=n==null?void 0:n.getValue(l))==null?void 0:o.liveStyle)!==void 0)&&(r[l]=i[l]);return r}function ph(e){return window.getComputedStyle(e)}class fh extends uo{constructor(){super(...arguments),this.type="html",this.renderInstance=xo}readValueFromInstance(t,n){var i;if(wt.has(n))return(i=this.projection)!=null&&i.isProjecting?tn(n):Md(t,n);{const a=ph(t),r=(Cr(n)?a.getPropertyValue(n):a[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(t,{transformPagePoint:n}){return mo(t,n)}build(t,n,i){Jn(t,n,i.transformTemplate)}scrapeMotionValuesFromProps(t,n,i){return Qn(t,n,i)}}const mh={offset:"stroke-dashoffset",array:"stroke-dasharray"},xh={offset:"strokeDashoffset",array:"strokeDasharray"};function gh(e,t,n=1,i=0,a=!0){e.pathLength=1;const r=a?mh:xh;e[r.offset]=`${-i}`,e[r.array]=`${t} ${n}`}const bh=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function bo(e,{attrX:t,attrY:n,attrScale:i,pathLength:a,pathSpacing:r=1,pathOffset:o=0,...l},c,d,u){if(Jn(e,l,d),c){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:p,style:h}=e;p.transform&&(h.transform=p.transform,delete p.transform),(h.transform||p.transformOrigin)&&(h.transformOrigin=p.transformOrigin??"50% 50%",delete p.transformOrigin),h.transform&&(h.transformBox=(u==null?void 0:u.transformBox)??"fill-box",delete p.transformBox);for(const f of bh)p[f]!==void 0&&(h[f]=p[f],delete p[f]);t!==void 0&&(p.x=t),n!==void 0&&(p.y=n),i!==void 0&&(p.scale=i),a!==void 0&&gh(p,a,r,o,!1)}const yo=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),vo=e=>typeof e=="string"&&e.toLowerCase()==="svg";function yh(e,t,n,i){xo(e,t,void 0,i);for(const a in t.attrs)e.setAttribute(yo.has(a)?a:qn(a),t.attrs[a])}function wo(e,t,n){const i=Qn(e,t,n);for(const a in e)if(pe(e[a])||pe(t[a])){const r=vt.indexOf(a)!==-1?"attr"+a.charAt(0).toUpperCase()+a.substring(1):a;i[r]=e[a]}return i}class vh extends uo{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ie}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(wt.has(n)){const i=Qr(n);return i&&i.default||0}return n=yo.has(n)?n:qn(n),t.getAttribute(n)}scrapeMotionValuesFromProps(t,n,i){return wo(t,n,i)}build(t,n,i){bo(t,n,this.isSVGTag,i.transformTemplate,i.style)}renderInstance(t,n,i,a){yh(t,n,i,a)}mount(t){this.isSVGTag=vo(t.tagName),super.mount(t)}}const wh=Zn.length;function jo(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent?jo(e.parent)||{}:{};return e.props.initial!==void 0&&(n.initial=e.props.initial),n}const t={};for(let n=0;n<wh;n++){const i=Zn[n],a=e.props[i];(Lt(a)||a===!1)&&(t[i]=a)}return t}function No(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}const jh=[...Xn].reverse(),Nh=Xn.length;function Sh(e){return t=>Promise.all(t.map(({animation:n,options:i})=>ju(e,n,i)))}function kh(e){let t=Sh(e),n=ra(),i=!0;const a=c=>(d,u)=>{var h;const p=pt(e,u,c==="exit"?(h=e.presenceContext)==null?void 0:h.custom:void 0);if(p){const{transition:f,transitionEnd:m,...y}=p;d={...d,...y,...m}}return d};function r(c){t=c(e)}function o(c){const{props:d}=e,u=jo(e.parent)||{},p=[],h=new Set;let f={},m=1/0;for(let b=0;b<Nh;b++){const w=jh[b],j=n[w],k=d[w]!==void 0?d[w]:u[w],C=Lt(k),_=w===c?j.isActive:null;_===!1&&(m=b);let g=k===u[w]&&k!==d[w]&&C;if(g&&i&&e.manuallyAnimateOnMount&&(g=!1),j.protectedKeys={...f},!j.isActive&&_===null||!k&&!j.prevProp||vs(k)||typeof k=="boolean")continue;const x=_h(j.prevProp,k);let v=x||w===c&&j.isActive&&!g&&C||b>m&&C,S=!1;const T=Array.isArray(k)?k:[k];let M=T.reduce(a(w),{});_===!1&&(M={});const{prevResolvedValues:P={}}=j,V={...P,...M},A=W=>{v=!0,h.has(W)&&(S=!0,h.delete(W)),j.needsAnimating[W]=!0;const O=e.getValue(W);O&&(O.liveStyle=!1)};for(const W in V){const O=M[W],X=P[W];if(f.hasOwnProperty(W))continue;let be=!1;ln(O)&&ln(X)?be=!No(O,X):be=O!==X,be?O!=null?A(W):h.add(W):O!==void 0&&h.has(W)?A(W):j.protectedKeys[W]=!0}j.prevProp=k,j.prevResolvedValues=M,j.isActive&&(f={...f,...M}),i&&e.blockInitialAnimation&&(v=!1);const F=g&&x;v&&(!F||S)&&p.push(...T.map(W=>{const O={type:w};if(typeof W=="string"&&i&&!F&&e.manuallyAnimateOnMount&&e.parent){const{parent:X}=e,be=pt(X,W);if(X.enteringChildren&&be){const{delayChildren:ve}=be.transition||{};O.delay=zr(X.enteringChildren,e,ve)}}return{animation:W,options:O}}))}if(h.size){const b={};if(typeof d.initial!="boolean"){const w=pt(e,Array.isArray(d.initial)?d.initial[0]:d.initial);w&&w.transition&&(b.transition=w.transition)}h.forEach(w=>{const j=e.getBaseTarget(w),k=e.getValue(w);k&&(k.liveStyle=!0),b[w]=j??null}),p.push({animation:b})}let y=!!p.length;return i&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(y=!1),i=!1,y?t(p):Promise.resolve()}function l(c,d){var p;if(n[c].isActive===d)return Promise.resolve();(p=e.variantChildren)==null||p.forEach(h=>{var f;return(f=h.animationState)==null?void 0:f.setActive(c,d)}),n[c].isActive=d;const u=o(c);for(const h in n)n[h].protectedKeys={};return u}return{animateChanges:o,setActive:l,setAnimateFunction:r,getState:()=>n,reset:()=>{n=ra()}}}function _h(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!No(t,e):!1}function qe(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function ra(){return{animate:qe(!0),whileInView:qe(),whileHover:qe(),whileTap:qe(),whileDrag:qe(),whileFocus:qe(),exit:qe()}}function oa(e,t){e.min=t.min,e.max=t.max}function Se(e,t){oa(e.x,t.x),oa(e.y,t.y)}function la(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}const So=1e-4,Ch=1-So,Ah=1+So,ko=.01,Th=0-ko,Eh=0+ko;function ge(e){return e.max-e.min}function Dh(e,t,n){return Math.abs(e-t)<=n}function ca(e,t,n,i=.5){e.origin=i,e.originPoint=Z(t.min,t.max,e.origin),e.scale=ge(n)/ge(t),e.translate=Z(n.min,n.max,e.origin)-e.originPoint,(e.scale>=Ch&&e.scale<=Ah||isNaN(e.scale))&&(e.scale=1),(e.translate>=Th&&e.translate<=Eh||isNaN(e.translate))&&(e.translate=0)}function Et(e,t,n,i){ca(e.x,t.x,n.x,i?i.originX:void 0),ca(e.y,t.y,n.y,i?i.originY:void 0)}function da(e,t,n){e.min=n.min+t.min,e.max=e.min+ge(t)}function Rh(e,t,n){da(e.x,t.x,n.x),da(e.y,t.y,n.y)}function ua(e,t,n){e.min=t.min-n.min,e.max=e.min+ge(t)}function ms(e,t,n){ua(e.x,t.x,n.x),ua(e.y,t.y,n.y)}function ha(e,t,n,i,a){return e-=t,e=fs(e,1/n,i),a!==void 0&&(e=fs(e,1/a,i)),e}function Mh(e,t=0,n=1,i=.5,a,r=e,o=e){if(Te.test(t)&&(t=parseFloat(t),t=Z(o.min,o.max,t/100)-o.min),typeof t!="number")return;let l=Z(r.min,r.max,i);e===r&&(l-=t),e.min=ha(e.min,t,n,l,a),e.max=ha(e.max,t,n,l,a)}function pa(e,t,[n,i,a],r,o){Mh(e,t[n],t[i],t[a],t.scale,r,o)}const Ph=["x","scaleX","originX"],Ih=["y","scaleY","originY"];function fa(e,t,n,i){pa(e.x,t,Ph,n?n.x:void 0,i?i.x:void 0),pa(e.y,t,Ih,n?n.y:void 0,i?i.y:void 0)}function ma(e){return e.translate===0&&e.scale===1}function _o(e){return ma(e.x)&&ma(e.y)}function xa(e,t){return e.min===t.min&&e.max===t.max}function Lh(e,t){return xa(e.x,t.x)&&xa(e.y,t.y)}function ga(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function Co(e,t){return ga(e.x,t.x)&&ga(e.y,t.y)}function ba(e){return ge(e.x)/ge(e.y)}function ya(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}function Ce(e){return[e("x"),e("y")]}function Oh(e,t,n){let i="";const a=e.x.translate/t.x,r=e.y.translate/t.y,o=(n==null?void 0:n.z)||0;if((a||r||o)&&(i=`translate3d(${a}px, ${r}px, ${o}px) `),(t.x!==1||t.y!==1)&&(i+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:d,rotate:u,rotateX:p,rotateY:h,skewX:f,skewY:m}=n;d&&(i=`perspective(${d}px) ${i}`),u&&(i+=`rotate(${u}deg) `),p&&(i+=`rotateX(${p}deg) `),h&&(i+=`rotateY(${h}deg) `),f&&(i+=`skewX(${f}deg) `),m&&(i+=`skewY(${m}deg) `)}const l=e.x.scale*t.x,c=e.y.scale*t.y;return(l!==1||c!==1)&&(i+=`scale(${l}, ${c})`),i||"none"}const Ao=["TopLeft","TopRight","BottomLeft","BottomRight"],Vh=Ao.length,va=e=>typeof e=="string"?parseFloat(e):e,wa=e=>typeof e=="number"||R.test(e);function Fh(e,t,n,i,a,r){a?(e.opacity=Z(0,n.opacity??1,Bh(i)),e.opacityExit=Z(t.opacity??1,0,$h(i))):r&&(e.opacity=Z(t.opacity??1,n.opacity??1,i));for(let o=0;o<Vh;o++){const l=`border${Ao[o]}Radius`;let c=ja(t,l),d=ja(n,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||wa(c)===wa(d)?(e[l]=Math.max(Z(va(c),va(d),i),0),(Te.test(d)||Te.test(c))&&(e[l]+="%")):e[l]=d}(t.rotate||n.rotate)&&(e.rotate=Z(t.rotate||0,n.rotate||0,i))}function ja(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const Bh=To(0,.5,wr),$h=To(.5,.95,je);function To(e,t,n){return i=>i<e?0:i>t?1:n(Mt(e,t,i))}function Uh(e,t,n){const i=pe(e)?e:mt(e);return i.start(Wn("",i,t,n)),i.animation}function Ot(e,t,n,i={passive:!0}){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n)}const Wh=(e,t)=>e.depth-t.depth;class zh{constructor(){this.children=[],this.isDirty=!1}add(t){_n(this.children,t),this.isDirty=!0}remove(t){Cn(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Wh),this.isDirty=!1,this.children.forEach(t)}}function qh(e,t){const n=xe.now(),i=({timestamp:a})=>{const r=a-n;r>=t&&(Fe(i),e(r-t))};return H.setup(i,!0),()=>Fe(i)}function ls(e){return pe(e)?e.get():e}class Hh{constructor(){this.members=[]}add(t){_n(this.members,t),t.scheduleRender()}remove(t){if(Cn(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(a=>t===a);if(n===0)return!1;let i;for(let a=n;a>=0;a--){const r=this.members[a];if(r.isPresent!==!1){i=r;break}}return i?(this.promote(i),!0):!1}promote(t,n){const i=this.lead;if(t!==i&&(this.prevLead=i,this.lead=t,t.show(),i)){i.instance&&i.scheduleRender(),t.scheduleRender();const a=i.options.layoutDependency,r=t.options.layoutDependency;a!==void 0&&r!==void 0&&a===r||(t.resumeFrom=i,n&&(t.resumeFrom.preserveOpacity=!0),i.snapshot&&(t.snapshot=i.snapshot,t.snapshot.latestValues=i.animationValues||i.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0));const{crossfade:l}=t.options;l===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:i}=t;n.onExitComplete&&n.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const cs={hasAnimatedSinceResize:!0,hasEverUpdated:!1},Ms=["","X","Y","Z"],Gh=1e3;let Yh=0;function Ps(e,t,n,i){const{latestValues:a}=t;a[e]&&(n[e]=a[e],t.setStaticValue(e,0),i&&(i[e]=0))}function Eo(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=Kr(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:a,layoutId:r}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",H,!(a||r))}const{parent:i}=e;i&&!i.hasCheckedOptimisedAppear&&Eo(i)}function Do({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:i,resetTransform:a}){return class{constructor(o={},l=t==null?void 0:t()){this.id=Yh++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(Zh),this.nodes.forEach(tp),this.nodes.forEach(sp),this.nodes.forEach(Jh)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new zh)}addEventListener(o,l){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new En),this.eventHandlers.get(o).add(l)}notifyListeners(o,...l){const c=this.eventHandlers.get(o);c&&c.notify(...l)}hasListeners(o){return this.eventHandlers.has(o)}mount(o){if(this.instance)return;this.isSVG=Kn(o)&&!Xu(o),this.instance=o;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),e){let u,p=0;const h=()=>this.root.updateBlockedByResize=!1;H.read(()=>{p=window.innerWidth}),e(o,()=>{const f=window.innerWidth;f!==p&&(p=f,this.root.updateBlockedByResize=!0,u&&u(),u=qh(h,250),cs.hasAnimatedSinceResize&&(cs.hasAnimatedSinceResize=!1,this.nodes.forEach(ka)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:p,hasRelativeLayoutChanged:h,layout:f})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||d.getDefaultTransition()||op,{onLayoutAnimationStart:y,onLayoutAnimationComplete:b}=d.getProps(),w=!this.targetLayout||!Co(this.targetLayout,f),j=!p&&h;if(this.options.layoutRoot||this.resumeFrom||j||p&&(w||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const k={...Un(m,"layout"),onPlay:y,onComplete:b};(d.shouldReduceMotion||this.options.layoutRoot)&&(k.delay=0,k.type=!1),this.startAnimation(k),this.setAnimationOrigin(u,j)}else p||ka(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=f})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Fe(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(np),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Eo(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const p=this.path[u];p.shouldResetTransform=!0,p.updateScroll("snapshot"),p.options.layoutRoot&&p.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Na);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(Sa);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(ep),this.nodes.forEach(Kh),this.nodes.forEach(Xh)):this.nodes.forEach(Sa),this.clearAllSnapshots();const l=xe.now();ce.delta=Ee(0,1e3/60,l-ce.timestamp),ce.timestamp=l,ce.isProcessing=!0,ks.update.process(ce),ks.preRender.process(ce),ks.render.process(ce),ce.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Gn.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Qh),this.sharedNodes.forEach(ip)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,H.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){H.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ge(this.snapshot.measuredBox.x)&&!ge(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=ie(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(l=!1),l&&this.instance){const c=i(this.instance);this.scroll={animationId:this.root.animationId,phase:o,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!a)return;const o=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!_o(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;o&&this.instance&&(l||He(this.latestValues)||u)&&(a(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return o&&(c=this.removeTransform(c)),lp(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var d;const{visualElement:o}=this.options;if(!o)return ie();const l=o.measureViewportBox();if(!(((d=this.scroll)==null?void 0:d.wasRoot)||this.path.some(cp))){const{scroll:u}=this.root;u&&(dt(l.x,u.offset.x),dt(l.y,u.offset.y))}return l}removeElementScroll(o){var c;const l=ie();if(Se(l,o),(c=this.scroll)!=null&&c.wasRoot)return l;for(let d=0;d<this.path.length;d++){const u=this.path[d],{scroll:p,options:h}=u;u!==this.root&&p&&h.layoutScroll&&(p.wasRoot&&Se(l,o),dt(l.x,p.offset.x),dt(l.y,p.offset.y))}return l}applyTransform(o,l=!1){const c=ie();Se(c,o);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&ut(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),He(u.latestValues)&&ut(c,u.latestValues)}return He(this.latestValues)&&ut(c,this.latestValues),c}removeTransform(o){const l=ie();Se(l,o);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!He(d.latestValues))continue;fn(d.latestValues)&&d.updateSnapshot();const u=ie(),p=d.measurePageBox();Se(u,p),fa(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return He(this.latestValues)&&fa(l,this.latestValues),l}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ce.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var f;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||(f=this.parent)!=null&&f.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:p}=this.options;if(!this.layout||!(u||p))return;this.resolvedRelativeTargetAt=ce.timestamp;const h=this.getClosestProjectingParent();h&&this.linkedParentVersion!==h.layoutVersion&&!h.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(h&&h.layout?this.createRelativeTarget(h,this.layout.layoutBox,h.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ie(),this.targetWithTransforms=ie()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Rh(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Se(this.target,this.layout.layoutBox),fo(this.target,this.targetDelta)):Se(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?this.createRelativeTarget(h,this.target,h.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||fn(this.parent.latestValues)||po(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(o,l,c){this.relativeParent=o,this.linkedParentVersion=o.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ie(),this.relativeTargetOrigin=ie(),ms(this.relativeTargetOrigin,l,c),Se(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var m;const o=this.getLead(),l=!!this.resumingFrom||this!==o;let c=!0;if((this.isProjectionDirty||(m=this.parent)!=null&&m.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===ce.timestamp&&(c=!1),c)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;Se(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,h=this.treeScale.y;oh(this.layoutCorrected,this.treeScale,this.path,l),o.layout&&!o.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(o.target=o.layout.layoutBox,o.targetWithTransforms=ie());const{target:f}=o;if(!f){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(la(this.prevProjectionDelta.x,this.projectionDelta.x),la(this.prevProjectionDelta.y,this.projectionDelta.y)),Et(this.projectionDelta,this.layoutCorrected,f,this.latestValues),(this.treeScale.x!==p||this.treeScale.y!==h||!ya(this.projectionDelta.x,this.prevProjectionDelta.x)||!ya(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",f))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){var l;if((l=this.options.visualElement)==null||l.scheduleRender(),o){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=ct(),this.projectionDelta=ct(),this.projectionDeltaWithTransform=ct()}setAnimationOrigin(o,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},p=ct();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const h=ie(),f=c?c.source:void 0,m=this.layout?this.layout.source:void 0,y=f!==m,b=this.getStack(),w=!b||b.members.length<=1,j=!!(y&&!w&&this.options.crossfade===!0&&!this.path.some(rp));this.animationProgress=0;let k;this.mixTargetDelta=C=>{const _=C/1e3;_a(p.x,o.x,_),_a(p.y,o.y,_),this.setTargetDelta(p),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ms(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),ap(this.relativeTarget,this.relativeTargetOrigin,h,_),k&&Lh(this.relativeTarget,k)&&(this.isProjectionDirty=!1),k||(k=ie()),Se(k,this.relativeTarget)),y&&(this.animationValues=u,Fh(u,d,this.latestValues,_,j,w)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=_},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){var l,c,d;this.notifyListeners("animationStart"),(l=this.currentAnimation)==null||l.stop(),(d=(c=this.resumingFrom)==null?void 0:c.currentAnimation)==null||d.stop(),this.pendingAnimation&&(Fe(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=H.update(()=>{cs.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=mt(0)),this.currentAnimation=Uh(this.motionValue,[0,1e3],{...o,velocity:0,isSync:!0,onUpdate:u=>{this.mixTargetDelta(u),o.onUpdate&&o.onUpdate(u)},onStop:()=>{},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Gh),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=o;if(!(!l||!c||!d)){if(this!==o&&this.layout&&d&&Ro(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||ie();const p=ge(this.layout.layoutBox.x);c.x.min=o.target.x.min,c.x.max=c.x.min+p;const h=ge(this.layout.layoutBox.y);c.y.min=o.target.y.min,c.y.max=c.y.min+h}Se(l,c),ut(l,u),Et(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(o,l){this.sharedNodes.has(o)||this.sharedNodes.set(o,new Hh),this.sharedNodes.get(o).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var l;const{layoutId:o}=this.options;return o?((l=this.getStack())==null?void 0:l.lead)||this:this}getPrevLead(){var l;const{layoutId:o}=this.options;return o?(l=this.getStack())==null?void 0:l.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),o&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetSkewAndRotation(){const{visualElement:o}=this.options;if(!o)return;let l=!1;const{latestValues:c}=o;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&Ps("z",o,d,this.animationValues);for(let u=0;u<Ms.length;u++)Ps(`rotate${Ms[u]}`,o,d,this.animationValues),Ps(`skew${Ms[u]}`,o,d,this.animationValues);o.render();for(const u in d)o.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);o.scheduleRender()}applyProjectionStyles(o,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){o.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,o.visibility="",o.opacity="",o.pointerEvents=ls(l==null?void 0:l.pointerEvents)||"",o.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(o.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,o.pointerEvents=ls(l==null?void 0:l.pointerEvents)||""),this.hasProjected&&!He(this.latestValues)&&(o.transform=c?c({},""):"none",this.hasProjected=!1);return}o.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let p=Oh(this.projectionDeltaWithTransform,this.treeScale,u);c&&(p=c(u,p)),o.transform=p;const{x:h,y:f}=this.projectionDelta;o.transformOrigin=`${h.origin*100}% ${f.origin*100}% 0`,d.animationValues?o.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:o.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const m in xn){if(u[m]===void 0)continue;const{correct:y,applyTo:b,isCSSVariable:w}=xn[m],j=p==="none"?u[m]:y(u[m],d);if(b){const k=b.length;for(let C=0;C<k;C++)o[b[C]]=j}else w?this.options.visualElement.renderState.vars[m]=j:o[m]=j}this.options.layoutId&&(o.pointerEvents=d===this?ls(l==null?void 0:l.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var l;return(l=o.currentAnimation)==null?void 0:l.stop()}),this.root.nodes.forEach(Na),this.root.sharedNodes.clear()}}}function Kh(e){e.updateLayout()}function Xh(e){var n;const t=((n=e.resumeFrom)==null?void 0:n.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:a}=e.layout,{animationType:r}=e.options,o=t.source!==e.layout.source;r==="size"?Ce(p=>{const h=o?t.measuredBox[p]:t.layoutBox[p],f=ge(h);h.min=i[p].min,h.max=h.min+f}):Ro(r,t.layoutBox,i)&&Ce(p=>{const h=o?t.measuredBox[p]:t.layoutBox[p],f=ge(i[p]);h.max=h.min+f,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[p].max=e.relativeTarget[p].min+f)});const l=ct();Et(l,i,t.layoutBox);const c=ct();o?Et(c,e.applyTransform(a,!0),t.measuredBox):Et(c,i,t.layoutBox);const d=!_o(l);let u=!1;if(!e.resumeFrom){const p=e.getClosestProjectingParent();if(p&&!p.resumeFrom){const{snapshot:h,layout:f}=p;if(h&&f){const m=ie();ms(m,t.layoutBox,h.layoutBox);const y=ie();ms(y,i,f.layoutBox),Co(m,y)||(u=!0),p.options.layoutRoot&&(e.relativeTarget=y,e.relativeTargetOrigin=m,e.relativeParent=p)}}}e.notifyListeners("didUpdate",{layout:i,snapshot:t,delta:c,layoutDelta:l,hasLayoutChanged:d,hasRelativeLayoutChanged:u})}else if(e.isLead()){const{onExitComplete:i}=e.options;i&&i()}e.options.transition=void 0}function Zh(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Jh(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Qh(e){e.clearSnapshot()}function Na(e){e.clearMeasurements()}function Sa(e){e.isLayoutDirty=!1}function ep(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function ka(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function tp(e){e.resolveTargetDelta()}function sp(e){e.calcProjection()}function np(e){e.resetSkewAndRotation()}function ip(e){e.removeLeadSnapshot()}function _a(e,t,n){e.translate=Z(t.translate,0,n),e.scale=Z(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function Ca(e,t,n,i){e.min=Z(t.min,n.min,i),e.max=Z(t.max,n.max,i)}function ap(e,t,n,i){Ca(e.x,t.x,n.x,i),Ca(e.y,t.y,n.y,i)}function rp(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const op={duration:.45,ease:[.4,0,.1,1]},Aa=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),Ta=Aa("applewebkit/")&&!Aa("chrome/")?Math.round:je;function Ea(e){e.min=Ta(e.min),e.max=Ta(e.max)}function lp(e){Ea(e.x),Ea(e.y)}function Ro(e,t,n){return e==="position"||e==="preserve-aspect"&&!Dh(ba(t),ba(n),.2)}function cp(e){var t;return e!==e.root&&((t=e.scroll)==null?void 0:t.wasRoot)}const dp=Do({attachResizeListener:(e,t)=>Ot(e,"resize",t),measureScroll:()=>{var e,t;return{x:document.documentElement.scrollLeft||((e=document.body)==null?void 0:e.scrollLeft)||0,y:document.documentElement.scrollTop||((t=document.body)==null?void 0:t.scrollTop)||0}},checkIsScrollRoot:()=>!0}),Is={current:void 0},Mo=Do({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Is.current){const e=new dp({});e.mount(window),e.setOptions({layoutScroll:!0}),Is.current=e}return Is.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),ei=N.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function Da(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function up(...e){return t=>{let n=!1;const i=e.map(a=>{const r=Da(a,t);return!n&&typeof r=="function"&&(n=!0),r});if(n)return()=>{for(let a=0;a<i.length;a++){const r=i[a];typeof r=="function"?r():Da(e[a],null)}}}}function hp(...e){return N.useCallback(up(...e),e)}class pp extends N.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent&&this.props.pop!==!1){const i=n.offsetParent,a=hn(i)&&i.offsetWidth||0,r=hn(i)&&i.offsetHeight||0,o=this.props.sizeRef.current;o.height=n.offsetHeight||0,o.width=n.offsetWidth||0,o.top=n.offsetTop,o.left=n.offsetLeft,o.right=a-o.width-o.left,o.bottom=r-o.height-o.top}return null}componentDidUpdate(){}render(){return this.props.children}}function fp({children:e,isPresent:t,anchorX:n,anchorY:i,root:a,pop:r}){var h;const o=N.useId(),l=N.useRef(null),c=N.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:d}=N.useContext(ei),u=((h=e.props)==null?void 0:h.ref)??(e==null?void 0:e.ref),p=hp(l,u);return N.useInsertionEffect(()=>{const{width:f,height:m,top:y,left:b,right:w,bottom:j}=c.current;if(t||r===!1||!l.current||!f||!m)return;const k=n==="left"?`left: ${b}`:`right: ${w}`,C=i==="bottom"?`bottom: ${j}`:`top: ${y}`;l.current.dataset.motionPopId=o;const _=document.createElement("style");d&&(_.nonce=d);const g=a??document.head;return g.appendChild(_),_.sheet&&_.sheet.insertRule(`
          [data-motion-pop-id="${o}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${m}px !important;
            ${k}px !important;
            ${C}px !important;
          }
        `),()=>{g.contains(_)&&g.removeChild(_)}},[t]),s.jsx(pp,{isPresent:t,childRef:l,sizeRef:c,pop:r,children:r===!1?e:N.cloneElement(e,{ref:p})})}const mp=({children:e,initial:t,isPresent:n,onExitComplete:i,custom:a,presenceAffectsLayout:r,mode:o,anchorX:l,anchorY:c,root:d})=>{const u=kn(xp),p=N.useId();let h=!0,f=N.useMemo(()=>(h=!1,{id:p,initial:t,isPresent:n,custom:a,onExitComplete:m=>{u.set(m,!0);for(const y of u.values())if(!y)return;i&&i()},register:m=>(u.set(m,!1),()=>u.delete(m))}),[n,u,i]);return r&&h&&(f={...f}),N.useMemo(()=>{u.forEach((m,y)=>u.set(y,!1))},[n]),N.useEffect(()=>{!n&&!u.size&&i&&i()},[n]),e=s.jsx(fp,{pop:o==="popLayout",isPresent:n,anchorX:l,anchorY:c,root:d,children:e}),s.jsx(ys.Provider,{value:f,children:e})};function xp(){return new Map}function Po(e=!0){const t=N.useContext(ys);if(t===null)return[!0,null];const{isPresent:n,onExitComplete:i,register:a}=t,r=N.useId();N.useEffect(()=>{if(e)return a(r)},[e]);const o=N.useCallback(()=>e&&i&&i(r),[r,i,e]);return!n&&i?[!1,o]:[!0]}const Jt=e=>e.key||"";function Ra(e){const t=[];return N.Children.forEach(e,n=>{N.isValidElement(n)&&t.push(n)}),t}const Io=({children:e,custom:t,initial:n=!0,onExitComplete:i,presenceAffectsLayout:a=!0,mode:r="sync",propagate:o=!1,anchorX:l="left",anchorY:c="top",root:d})=>{const[u,p]=Po(o),h=N.useMemo(()=>Ra(e),[e]),f=o&&!u?[]:h.map(Jt),m=N.useRef(!0),y=N.useRef(h),b=kn(()=>new Map),w=N.useRef(new Set),[j,k]=N.useState(h),[C,_]=N.useState(h);dr(()=>{m.current=!1,y.current=h;for(let v=0;v<C.length;v++){const S=Jt(C[v]);f.includes(S)?(b.delete(S),w.current.delete(S)):b.get(S)!==!0&&b.set(S,!1)}},[C,f.length,f.join("-")]);const g=[];if(h!==j){let v=[...h];for(let S=0;S<C.length;S++){const T=C[S],M=Jt(T);f.includes(M)||(v.splice(S,0,T),g.push(T))}return r==="wait"&&g.length&&(v=g),_(Ra(v)),k(h),null}const{forceRender:x}=N.useContext(Sn);return s.jsx(s.Fragment,{children:C.map(v=>{const S=Jt(v),T=o&&!u?!1:h===C||f.includes(S),M=()=>{if(w.current.has(S))return;if(w.current.add(S),b.has(S))b.set(S,!0);else return;let P=!0;b.forEach(V=>{V||(P=!1)}),P&&(x==null||x(),_(y.current),o&&(p==null||p()),i&&i())};return s.jsx(mp,{isPresent:T,initial:!m.current||n?void 0:!1,custom:t,presenceAffectsLayout:a,mode:r,root:d,onExitComplete:T?void 0:M,anchorX:l,anchorY:c,children:v},S)})})},Lo=N.createContext({strict:!1}),Ma={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let Pa=!1;function gp(){if(Pa)return;const e={};for(const t in Ma)e[t]={isEnabled:n=>Ma[t].some(i=>!!n[i])};co(e),Pa=!0}function Oo(){return gp(),nh()}function bp(e){const t=Oo();for(const n in e)t[n]={...t[n],...e[n]};co(t)}const yp=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","propagate","ignoreStrict","viewport"]);function xs(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||yp.has(e)}let Vo=e=>!xs(e);function vp(e){typeof e=="function"&&(Vo=t=>t.startsWith("on")?!xs(t):e(t))}try{vp(require("@emotion/is-prop-valid").default)}catch{}function wp(e,t,n){const i={};for(const a in e)a==="values"&&typeof e.values=="object"||(Vo(a)||n===!0&&xs(a)||!t&&!xs(a)||e.draggable&&a.startsWith("onDrag"))&&(i[a]=e[a]);return i}const js=N.createContext({});function jp(e,t){if(ws(e)){const{initial:n,animate:i}=e;return{initial:n===!1||Lt(n)?n:void 0,animate:Lt(i)?i:void 0}}return e.inherit!==!1?t:{}}function Np(e){const{initial:t,animate:n}=jp(e,N.useContext(js));return N.useMemo(()=>({initial:t,animate:n}),[Ia(t),Ia(n)])}function Ia(e){return Array.isArray(e)?e.join(" "):e}const ti=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Fo(e,t,n){for(const i in t)!pe(t[i])&&!go(i,n)&&(e[i]=t[i])}function Sp({transformTemplate:e},t){return N.useMemo(()=>{const n=ti();return Jn(n,t,e),Object.assign({},n.vars,n.style)},[t])}function kp(e,t){const n=e.style||{},i={};return Fo(i,n,e),Object.assign(i,Sp(e,t)),i}function _p(e,t){const n={},i=kp(e,t);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=i,n}const Bo=()=>({...ti(),attrs:{}});function Cp(e,t,n,i){const a=N.useMemo(()=>{const r=Bo();return bo(r,t,vo(i),e.transformTemplate,e.style),{...r.attrs,style:{...r.style}}},[t]);if(e.style){const r={};Fo(r,e.style,e),a.style={...r,...a.style}}return a}const Ap=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function si(e){return typeof e!="string"||e.includes("-")?!1:!!(Ap.indexOf(e)>-1||/[A-Z]/u.test(e))}function Tp(e,t,n,{latestValues:i},a,r=!1,o){const c=(o??si(e)?Cp:_p)(t,i,a,e),d=wp(t,typeof e=="string",r),u=e!==N.Fragment?{...d,...c,ref:n}:{},{children:p}=t,h=N.useMemo(()=>pe(p)?p.get():p,[p]);return N.createElement(e,{...u,children:h})}function Ep({scrapeMotionValuesFromProps:e,createRenderState:t},n,i,a){return{latestValues:Dp(n,i,a,e),renderState:t()}}function Dp(e,t,n,i){const a={},r=i(e,{});for(const h in r)a[h]=ls(r[h]);let{initial:o,animate:l}=e;const c=ws(e),d=lo(e);t&&d&&!c&&e.inherit!==!1&&(o===void 0&&(o=t.initial),l===void 0&&(l=t.animate));let u=n?n.initial===!1:!1;u=u||o===!1;const p=u?l:o;if(p&&typeof p!="boolean"&&!vs(p)){const h=Array.isArray(p)?p:[p];for(let f=0;f<h.length;f++){const m=zn(e,h[f]);if(m){const{transitionEnd:y,transition:b,...w}=m;for(const j in w){let k=w[j];if(Array.isArray(k)){const C=u?k.length-1:0;k=k[C]}k!==null&&(a[j]=k)}for(const j in y)a[j]=y[j]}}}return a}const $o=e=>(t,n)=>{const i=N.useContext(js),a=N.useContext(ys),r=()=>Ep(e,t,i,a);return n?r():kn(r)},Rp=$o({scrapeMotionValuesFromProps:Qn,createRenderState:ti}),Mp=$o({scrapeMotionValuesFromProps:wo,createRenderState:Bo}),Pp=Symbol.for("motionComponentSymbol");function Ip(e,t,n){const i=N.useRef(n);N.useInsertionEffect(()=>{i.current=n});const a=N.useRef(null);return N.useCallback(r=>{var l;r&&((l=e.onMount)==null||l.call(e,r)),t&&(r?t.mount(r):t.unmount());const o=i.current;if(typeof o=="function")if(r){const c=o(r);typeof c=="function"&&(a.current=c)}else a.current?(a.current(),a.current=null):o(r);else o&&(o.current=r)},[t])}const Uo=N.createContext({});function rt(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function Lp(e,t,n,i,a,r){var k,C;const{visualElement:o}=N.useContext(js),l=N.useContext(Lo),c=N.useContext(ys),d=N.useContext(ei),u=d.reducedMotion,p=d.skipAnimations,h=N.useRef(null),f=N.useRef(!1);i=i||l.renderer,!h.current&&i&&(h.current=i(e,{visualState:t,parent:o,props:n,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:u,skipAnimations:p,isSVG:r}),f.current&&h.current&&(h.current.manuallyAnimateOnMount=!0));const m=h.current,y=N.useContext(Uo);m&&!m.projection&&a&&(m.type==="html"||m.type==="svg")&&Op(h.current,n,a,y);const b=N.useRef(!1);N.useInsertionEffect(()=>{m&&b.current&&m.update(n,c)});const w=n[Yr],j=N.useRef(!!w&&!((k=window.MotionHandoffIsComplete)!=null&&k.call(window,w))&&((C=window.MotionHasOptimisedAnimation)==null?void 0:C.call(window,w)));return dr(()=>{f.current=!0,m&&(b.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),m.scheduleRenderMicrotask(),j.current&&m.animationState&&m.animationState.animateChanges())}),N.useEffect(()=>{m&&(!j.current&&m.animationState&&m.animationState.animateChanges(),j.current&&(queueMicrotask(()=>{var _;(_=window.MotionHandoffMarkAsComplete)==null||_.call(window,w)}),j.current=!1),m.enteringChildren=void 0)}),m}function Op(e,t,n,i){const{layoutId:a,layout:r,drag:o,dragConstraints:l,layoutScroll:c,layoutRoot:d,layoutCrossfade:u}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:Wo(e.parent)),e.projection.setOptions({layoutId:a,layout:r,alwaysMeasureLayout:!!o||l&&rt(l),visualElement:e,animationType:typeof r=="string"?r:"both",initialPromotionConfig:i,crossfade:u,layoutScroll:c,layoutRoot:d})}function Wo(e){if(e)return e.options.allowProjection!==!1?e.projection:Wo(e.parent)}function Ls(e,{forwardMotionProps:t=!1,type:n}={},i,a){i&&bp(i);const r=n?n==="svg":si(e),o=r?Mp:Rp;function l(d,u){let p;const h={...N.useContext(ei),...d,layoutId:Vp(d)},{isStatic:f}=h,m=Np(d),y=o(d,f);if(!f&&cr){Fp();const b=Bp(h);p=b.MeasureLayout,m.visualElement=Lp(e,y,h,a,b.ProjectionNode,r)}return s.jsxs(js.Provider,{value:m,children:[p&&m.visualElement?s.jsx(p,{visualElement:m.visualElement,...h}):null,Tp(e,d,Ip(y,m.visualElement,u),y,f,t,r)]})}l.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const c=N.forwardRef(l);return c[Pp]=e,c}function Vp({layoutId:e}){const t=N.useContext(Sn).id;return t&&e!==void 0?t+"-"+e:e}function Fp(e,t){N.useContext(Lo).strict}function Bp(e){const t=Oo(),{drag:n,layout:i}=t;if(!n&&!i)return{};const a={...n,...i};return{MeasureLayout:n!=null&&n.isEnabled(e)||i!=null&&i.isEnabled(e)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}function $p(e,t){if(typeof Proxy>"u")return Ls;const n=new Map,i=(r,o)=>Ls(r,o,e,t),a=(r,o)=>i(r,o);return new Proxy(a,{get:(r,o)=>o==="create"?i:(n.has(o)||n.set(o,Ls(o,void 0,e,t)),n.get(o))})}const Up=(e,t)=>t.isSVG??si(e)?new vh(t):new fh(t,{allowProjection:e!==N.Fragment});class Wp extends $e{constructor(t){super(t),t.animationState||(t.animationState=kh(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();vs(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)==null||t.call(this)}}let zp=0;class qp extends $e{constructor(){super(...arguments),this.id=zp++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===i)return;const a=this.node.animationState.setActive("exit",!t);n&&!t&&a.then(()=>{n(this.id)})}mount(){const{register:t,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const Hp={animation:{Feature:Wp},exit:{Feature:qp}};function Ut(e){return{point:{x:e.pageX,y:e.pageY}}}const Gp=e=>t=>Yn(t)&&e(t,Ut(t));function Dt(e,t,n,i){return Ot(e,t,Gp(n),i)}const zo=({current:e})=>e?e.ownerDocument.defaultView:null,La=(e,t)=>Math.abs(e-t);function Yp(e,t){const n=La(e.x,t.x),i=La(e.y,t.y);return Math.sqrt(n**2+i**2)}const Oa=new Set(["auto","scroll"]);class qo{constructor(t,n,{transformPagePoint:i,contextWindow:a=window,dragSnapToOrigin:r=!1,distanceThreshold:o=3,element:l}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=f=>{this.handleScroll(f.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=Vs(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,y=Yp(f.offset,{x:0,y:0})>=this.distanceThreshold;if(!m&&!y)return;const{point:b}=f,{timestamp:w}=ce;this.history.push({...b,timestamp:w});const{onStart:j,onMove:k}=this.handlers;m||(j&&j(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),k&&k(this.lastMoveEvent,f)},this.handlePointerMove=(f,m)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=Os(m,this.transformPagePoint),H.update(this.updatePoint,!0)},this.handlePointerUp=(f,m)=>{this.end();const{onEnd:y,onSessionEnd:b,resumeAnimation:w}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&w&&w(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const j=Vs(f.type==="pointercancel"?this.lastMoveEventInfo:Os(m,this.transformPagePoint),this.history);this.startEvent&&y&&y(f,j),b&&b(f,j)},!Yn(t))return;this.dragSnapToOrigin=r,this.handlers=n,this.transformPagePoint=i,this.distanceThreshold=o,this.contextWindow=a||window;const c=Ut(t),d=Os(c,this.transformPagePoint),{point:u}=d,{timestamp:p}=ce;this.history=[{...u,timestamp:p}];const{onSessionStart:h}=n;h&&h(t,Vs(d,this.history)),this.removeListeners=Ft(Dt(this.contextWindow,"pointermove",this.handlePointerMove),Dt(this.contextWindow,"pointerup",this.handlePointerUp),Dt(this.contextWindow,"pointercancel",this.handlePointerUp)),l&&this.startScrollTracking(l)}startScrollTracking(t){let n=t.parentElement;for(;n;){const i=getComputedStyle(n);(Oa.has(i.overflowX)||Oa.has(i.overflowY))&&this.scrollPositions.set(n,{x:n.scrollLeft,y:n.scrollTop}),n=n.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(t){const n=this.scrollPositions.get(t);if(!n)return;const i=t===window,a=i?{x:window.scrollX,y:window.scrollY}:{x:t.scrollLeft,y:t.scrollTop},r={x:a.x-n.x,y:a.y-n.y};r.x===0&&r.y===0||(i?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=r.x,this.lastMoveEventInfo.point.y+=r.y):this.history.length>0&&(this.history[0].x-=r.x,this.history[0].y-=r.y),this.scrollPositions.set(t,a),H.update(this.updatePoint,!0))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),Fe(this.updatePoint)}}function Os(e,t){return t?{point:t(e.point)}:e}function Va(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Vs({point:e},t){return{point:e,delta:Va(e,Ho(t)),offset:Va(e,Kp(t)),velocity:Xp(t,.1)}}function Kp(e){return e[0]}function Ho(e){return e[e.length-1]}function Xp(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,i=null;const a=Ho(e);for(;n>=0&&(i=e[n],!(a.timestamp-i.timestamp>Ae(t)));)n--;if(!i)return{x:0,y:0};i===e[0]&&e.length>2&&a.timestamp-i.timestamp>Ae(t)*2&&(i=e[1]);const r=we(a.timestamp-i.timestamp);if(r===0)return{x:0,y:0};const o={x:(a.x-i.x)/r,y:(a.y-i.y)/r};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function Zp(e,{min:t,max:n},i){return t!==void 0&&e<t?e=i?Z(t,e,i.min):Math.max(e,t):n!==void 0&&e>n&&(e=i?Z(n,e,i.max):Math.min(e,n)),e}function Fa(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function Jp(e,{top:t,left:n,bottom:i,right:a}){return{x:Fa(e.x,n,a),y:Fa(e.y,t,i)}}function Ba(e,t){let n=t.min-e.min,i=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,i]=[i,n]),{min:n,max:i}}function Qp(e,t){return{x:Ba(e.x,t.x),y:Ba(e.y,t.y)}}function ef(e,t){let n=.5;const i=ge(e),a=ge(t);return a>i?n=Mt(t.min,t.max-i,e.min):i>a&&(n=Mt(e.min,e.max-a,t.min)),Ee(0,1,n)}function tf(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const gn=.35;function sf(e=gn){return e===!1?e=0:e===!0&&(e=gn),{x:$a(e,"left","right"),y:$a(e,"top","bottom")}}function $a(e,t,n){return{min:Ua(e,t),max:Ua(e,n)}}function Ua(e,t){return typeof e=="number"?e:e[t]||0}const nf=new WeakMap;class af{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ie(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:n=!1,distanceThreshold:i}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const r=p=>{n&&this.snapToCursor(Ut(p).point),this.stopAnimation()},o=(p,h)=>{const{drag:f,dragPropagation:m,onDragStart:y}=this.getProps();if(f&&!m&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Mu(f),!this.openDragLock))return;this.latestPointerEvent=p,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ce(w=>{let j=this.getAxisMotionValue(w).get()||0;if(Te.test(j)){const{projection:k}=this.visualElement;if(k&&k.layout){const C=k.layout.layoutBox[w];C&&(j=ge(C)*(parseFloat(j)/100))}}this.originPoint[w]=j}),y&&H.update(()=>y(p,h),!1,!0),cn(this.visualElement,"transform");const{animationState:b}=this.visualElement;b&&b.setActive("whileDrag",!0)},l=(p,h)=>{this.latestPointerEvent=p,this.latestPanInfo=h;const{dragPropagation:f,dragDirectionLock:m,onDirectionLock:y,onDrag:b}=this.getProps();if(!f&&!this.openDragLock)return;const{offset:w}=h;if(m&&this.currentDirection===null){this.currentDirection=of(w),this.currentDirection!==null&&y&&y(this.currentDirection);return}this.updateAxis("x",h.point,w),this.updateAxis("y",h.point,w),this.visualElement.render(),b&&H.update(()=>b(p,h),!1,!0)},c=(p,h)=>{this.latestPointerEvent=p,this.latestPanInfo=h,this.stop(p,h),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>{const{dragSnapToOrigin:p}=this.getProps();(p||this.constraints)&&this.startAnimation({x:0,y:0})},{dragSnapToOrigin:u}=this.getProps();this.panSession=new qo(t,{onSessionStart:r,onStart:o,onMove:l,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:i,contextWindow:zo(this.visualElement),element:this.visualElement.current})}stop(t,n){const i=t||this.latestPointerEvent,a=n||this.latestPanInfo,r=this.isDragging;if(this.cancel(),!r||!a||!i)return;const{velocity:o}=a;this.startAnimation(o);const{onDragEnd:l}=this.getProps();l&&H.postRender(()=>l(i,a))}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.endPanSession();const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(t,n,i){const{drag:a}=this.getProps();if(!i||!Qt(t,a,this.currentDirection))return;const r=this.getAxisMotionValue(t);let o=this.originPoint[t]+i[t];this.constraints&&this.constraints[t]&&(o=Zp(o,this.constraints[t],this.elastic[t])),r.set(o)}resolveConstraints(){var r;const{dragConstraints:t,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(r=this.visualElement.projection)==null?void 0:r.layout,a=this.constraints;t&&rt(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&i?this.constraints=Jp(i.layoutBox,t):this.constraints=!1,this.elastic=sf(n),a!==this.constraints&&!rt(t)&&i&&this.constraints&&!this.hasMutatedConstraints&&Ce(o=>{this.constraints!==!1&&this.getAxisMotionValue(o)&&(this.constraints[o]=tf(i.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!rt(t))return!1;const i=t.current,{projection:a}=this.visualElement;if(!a||!a.layout)return!1;const r=lh(i,a.root,this.visualElement.getTransformPagePoint());let o=Qp(a.layout.layoutBox,r);if(n){const l=n(ah(o));this.hasMutatedConstraints=!!l,l&&(o=ho(l))}return o}startAnimation(t){const{drag:n,dragMomentum:i,dragElastic:a,dragTransition:r,dragSnapToOrigin:o,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=Ce(u=>{if(!Qt(u,n,this.currentDirection))return;let p=c&&c[u]||{};o&&(p={min:0,max:0});const h=a?200:1e6,f=a?40:1e7,m={type:"inertia",velocity:i?t[u]:0,bounceStiffness:h,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...r,...p};return this.startAxisValueAnimation(u,m)});return Promise.all(d).then(l)}startAxisValueAnimation(t,n){const i=this.getAxisMotionValue(t);return cn(this.visualElement,t),i.start(Wn(t,i,0,n,this.visualElement,!1))}stopAnimation(){Ce(t=>this.getAxisMotionValue(t).stop())}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,i=this.visualElement.getProps(),a=i[n];return a||this.visualElement.getValue(t,(i.initial?i.initial[t]:void 0)||0)}snapToCursor(t){Ce(n=>{const{drag:i}=this.getProps();if(!Qt(n,i,this.currentDirection))return;const{projection:a}=this.visualElement,r=this.getAxisMotionValue(n);if(a&&a.layout){const{min:o,max:l}=a.layout.layoutBox[n],c=r.get()||0;r.set(t[n]-Z(o,l,.5)+c)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:i}=this.visualElement;if(!rt(n)||!i||!this.constraints)return;this.stopAnimation();const a={x:0,y:0};Ce(o=>{const l=this.getAxisMotionValue(o);if(l&&this.constraints!==!1){const c=l.get();a[o]=ef({min:c,max:c},this.constraints[o])}});const{transformTemplate:r}=this.visualElement.getProps();this.visualElement.current.style.transform=r?r({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.constraints=!1,this.resolveConstraints(),Ce(o=>{if(!Qt(o,t,null))return;const l=this.getAxisMotionValue(o),{min:c,max:d}=this.constraints[o];l.set(Z(c,d,a[o]))}),this.visualElement.render()}addListeners(){if(!this.visualElement.current)return;nf.set(this.visualElement,this);const t=this.visualElement.current,n=Dt(t,"pointerdown",d=>{const{drag:u,dragListener:p=!0}=this.getProps(),h=d.target,f=h!==t&&Fu(h);u&&p&&!f&&this.start(d)});let i;const a=()=>{const{dragConstraints:d}=this.getProps();rt(d)&&d.current&&(this.constraints=this.resolveRefConstraints(),i||(i=rf(t,d.current,()=>this.scalePositionWithinConstraints())))},{projection:r}=this.visualElement,o=r.addEventListener("measure",a);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),H.read(a);const l=Ot(window,"resize",()=>this.scalePositionWithinConstraints()),c=r.addEventListener("didUpdate",(({delta:d,hasLayoutChanged:u})=>{this.isDragging&&u&&(Ce(p=>{const h=this.getAxisMotionValue(p);h&&(this.originPoint[p]+=d[p].translate,h.set(h.get()+d[p].translate))}),this.visualElement.render())}));return()=>{l(),n(),o(),c&&c(),i&&i()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:i=!1,dragPropagation:a=!1,dragConstraints:r=!1,dragElastic:o=gn,dragMomentum:l=!0}=t;return{...t,drag:n,dragDirectionLock:i,dragPropagation:a,dragConstraints:r,dragElastic:o,dragMomentum:l}}}function Wa(e){let t=!0;return()=>{if(t){t=!1;return}e()}}function rf(e,t,n){const i=Xi(e,Wa(n)),a=Xi(t,Wa(n));return()=>{i(),a()}}function Qt(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function of(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class lf extends $e{constructor(t){super(t),this.removeGroupControls=je,this.removeListeners=je,this.controls=new af(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||je}update(){const{dragControls:t}=this.node.getProps(),{dragControls:n}=this.node.prevProps||{};t!==n&&(this.removeGroupControls(),t&&(this.removeGroupControls=t.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}}const Fs=e=>(t,n)=>{e&&H.update(()=>e(t,n),!1,!0)};class cf extends $e{constructor(){super(...arguments),this.removePointerDownListener=je}onPointerDown(t){this.session=new qo(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:zo(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:i,onPanEnd:a}=this.node.getProps();return{onSessionStart:Fs(t),onStart:Fs(n),onMove:Fs(i),onEnd:(r,o)=>{delete this.session,a&&H.postRender(()=>a(r,o))}}}mount(){this.removePointerDownListener=Dt(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let Bs=!1;class df extends N.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:i,layoutId:a}=this.props,{projection:r}=t;r&&(n.group&&n.group.add(r),i&&i.register&&a&&i.register(r),Bs&&r.root.didUpdate(),r.addEventListener("animationComplete",()=>{this.safeToRemove()}),r.setOptions({...r.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),cs.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:i,drag:a,isPresent:r}=this.props,{projection:o}=i;return o&&(o.isPresent=r,t.layoutDependency!==n&&o.setOptions({...o.options,layoutDependency:n}),Bs=!0,a||t.layoutDependency!==n||n===void 0||t.isPresent!==r?o.willUpdate():this.safeToRemove(),t.isPresent!==r&&(r?o.promote():o.relegate()||H.postRender(()=>{const l=o.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),Gn.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:i}=this.props,{projection:a}=t;Bs=!0,a&&(a.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(a),i&&i.deregister&&i.deregister(a))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function Go(e){const[t,n]=Po(),i=N.useContext(Sn);return s.jsx(df,{...e,layoutGroup:i,switchLayoutGroup:N.useContext(Uo),isPresent:t,safeToRemove:n})}const uf={pan:{Feature:cf},drag:{Feature:lf,ProjectionNode:Mo,MeasureLayout:Go}};function za(e,t,n){const{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover",n==="Start");const a="onHover"+n,r=i[a];r&&H.postRender(()=>r(t,Ut(t)))}class hf extends $e{mount(){const{current:t}=this.node;t&&(this.unmount=Iu(t,(n,i)=>(za(this.node,i,"Start"),a=>za(this.node,a,"End"))))}unmount(){}}class pf extends $e{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Ft(Ot(this.node.current,"focus",()=>this.onFocus()),Ot(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function qa(e,t,n){const{props:i}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap",n==="Start");const a="onTap"+(n==="End"?"":n),r=i[a];r&&H.postRender(()=>r(t,Ut(t)))}class ff extends $e{mount(){const{current:t}=this.node;if(!t)return;const{globalTapTarget:n,propagate:i}=this.node.props;this.unmount=$u(t,(a,r)=>(qa(this.node,r,"Start"),(o,{success:l})=>qa(this.node,o,l?"End":"Cancel")),{useGlobalTarget:n,stopPropagation:(i==null?void 0:i.tap)===!1})}unmount(){}}const bn=new WeakMap,$s=new WeakMap,mf=e=>{const t=bn.get(e.target);t&&t(e)},xf=e=>{e.forEach(mf)};function gf({root:e,...t}){const n=e||document;$s.has(n)||$s.set(n,{});const i=$s.get(n),a=JSON.stringify(t);return i[a]||(i[a]=new IntersectionObserver(xf,{root:e,...t})),i[a]}function bf(e,t,n){const i=gf(t);return bn.set(e,n),i.observe(e),()=>{bn.delete(e),i.unobserve(e)}}const yf={some:0,all:1};class vf extends $e{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:i,amount:a="some",once:r}=t,o={root:n?n.current:void 0,rootMargin:i,threshold:typeof a=="number"?a:yf[a]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,r&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:p}=this.node.getProps(),h=d?u:p;h&&h(c)};return bf(this.node.current,o,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(wf(t,n))&&this.startObserver()}unmount(){}}function wf({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const jf={inView:{Feature:vf},tap:{Feature:ff},focus:{Feature:pf},hover:{Feature:hf}},Nf={layout:{ProjectionNode:Mo,MeasureLayout:Go}},Sf={...Hp,...jf,...uf,...Nf},gs=$p(Sf,Up),he={gradients:{exposed:{from:"#ff0844",to:"rgba(255, 8, 68, 0)"},secured:{from:"#00d9ff",to:"rgba(16, 185, 129, 0)"}},glow:{exposed:"0 0 40px rgba(255, 8, 68, 0.6), 0 0 80px rgba(255, 8, 68, 0.3)",secured:"0 0 40px rgba(0, 217, 255, 0.6), 0 0 80px rgba(0, 217, 255, 0.3)"},spacing:{top:30,right:50,bottom:80,left:100}};function kf({data:e,x:t,y:n}){const i=l=>l>=1e6?`${(l/1e6).toFixed(1)}M‚Ç¨`:l>=1e3?`${Math.round(l/1e3)}k‚Ç¨`:`${Math.round(l)}‚Ç¨`,a=l=>new Date(l).toLocaleDateString("fr-FR",{weekday:"short",day:"2-digit",month:"short",year:"numeric"}).toUpperCase(),r=e.securedCA+e.exposedCA,o=r>0?(e.exposedCA/r*100).toFixed(1):"0.0";return pl.createPortal(s.jsxs(gs.div,{initial:{opacity:0,scale:.8,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:10},transition:{duration:.2,ease:"easeOut"},className:"pointer-events-none fixed z-[9999]",style:{left:t,top:n-20,transform:"translate(-50%, -100%)"},children:[s.jsxs("div",{className:"relative backdrop-blur-2xl bg-slate-900 rounded-2xl border border-white/30 overflow-hidden",style:{boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.9), 0 0 100px rgba(0, 217, 255, 0.3)"},children:[s.jsx("div",{className:"absolute top-0 left-0 right-0 h-[2px] bg-gradient-to-r from-transparent via-cyan-400 to-transparent"}),s.jsxs("div",{className:"p-5 space-y-4 min-w-[280px]",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-white/10",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-400 animate-pulse",style:{boxShadow:he.glow.secured}}),s.jsx("span",{className:"text-[11px] font-black text-blue-300 uppercase tracking-[0.15em]",children:a(e.date)})]}),s.jsx("div",{className:"bg-gradient-to-br from-white/10 to-transparent p-4 rounded-xl border border-white/20",children:s.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[s.jsx("span",{className:"text-xs text-white/60 uppercase tracking-wider font-bold",children:"CA Total"}),s.jsx("span",{className:"text-3xl font-black text-white",style:{textShadow:"0 0 20px rgba(255,255,255,0.5)"},children:i(r)})]})}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-cyan-500/30 to-emerald-500/20 p-3 rounded-xl border border-cyan-400/40",style:{boxShadow:"0 0 20px rgba(0, 217, 255, 0.3)"},children:[s.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-cyan-400/20 rounded-full blur-2xl"}),s.jsxs("div",{className:"relative z-10",children:[s.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-cyan-400",style:{boxShadow:he.glow.secured}}),s.jsx("span",{className:"text-[9px] text-cyan-300 font-black uppercase tracking-wider",children:"S√©curis√©"})]}),s.jsx("span",{className:"text-lg font-black text-cyan-100",children:i(e.securedCA)})]})]}),s.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-red-500/30 to-pink-500/20 p-3 rounded-xl border border-red-400/40",style:{boxShadow:"0 0 20px rgba(255, 8, 68, 0.3)"},children:[s.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-red-400/20 rounded-full blur-2xl"}),s.jsxs("div",{className:"relative z-10",children:[s.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-red-400",style:{boxShadow:he.glow.exposed}}),s.jsx("span",{className:"text-[9px] text-red-300 font-black uppercase tracking-wider",children:"√Ä Risque"})]}),s.jsx("span",{className:"text-lg font-black text-red-100",children:i(e.exposedCA)})]})]})]}),s.jsxs("div",{className:"pt-3 border-t border-white/10",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-[9px] text-white/50 uppercase tracking-wider font-bold",children:"Exposition"}),s.jsxs("span",{className:"text-sm text-white/80 font-black",children:[o,"%"]})]}),s.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:s.jsx(gs.div,{initial:{width:0},animate:{width:`${o}%`},transition:{duration:.5,ease:"easeOut"},className:"h-full bg-gradient-to-r from-red-500 to-pink-500 rounded-full",style:{boxShadow:"0 0 10px rgba(255, 8, 68, 0.5)"}})})]})]})]}),s.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -bottom-2",children:s.jsx("div",{className:"w-4 h-4 bg-slate-900 border-l border-b border-white/30 rotate-45"})})]}),document.body)}function _f({data:e,width:t=1200,height:n=550}){const[i,a]=N.useState(null),r=t-he.spacing.left-he.spacing.right,o=n-he.spacing.top-he.spacing.bottom,l=N.useMemo(()=>e.length===0?qs({domain:[0,1],range:[0,r]}):qs({domain:[new Date(e[0].date),new Date(e[e.length-1].date)],range:[0,r]}),[e,r]),c=N.useMemo(()=>e.length===0?1:Math.max(...e.map(b=>b.securedCA+b.exposedCA)),[e]),d=N.useMemo(()=>Re({domain:[0,c*1.1],range:[o,0],nice:!0}),[c,o]),u=b=>new Date(b.date),p=b=>l(u(b)),h=b=>d(b.securedCA),f=b=>d(b.securedCA+b.exposedCA),m=b=>{const w=ns(b);if(!w)return;const j=w.x-he.spacing.left,k=l.invert(j),C=e.reduce((g,x,v)=>{const S=u(x).getTime(),T=u(e[g]).getTime(),M=k.getTime();return Math.abs(S-M)<Math.abs(T-M)?v:g},0),_=e[C];a({data:_,x:p(_)+he.spacing.left,y:f(_)+he.spacing.top})},y=N.useMemo(()=>{if(e.length===0)return[];const b=Math.max(1,Math.ceil(e.length/7));return e.filter((w,j)=>j%b===0||j===e.length-1).map(w=>u(w))},[e]);return e.length===0||t<10||n<10||r<=0||o<=0?null:s.jsxs("div",{className:"relative w-full overflow-visible",children:[s.jsxs("svg",{width:t,height:n,children:[s.jsxs("defs",{children:[s.jsx(xi,{id:"gradient-exposed-tesla",from:he.gradients.exposed.from,to:he.gradients.exposed.to,vertical:!0}),s.jsx(xi,{id:"gradient-secured-tesla",from:he.gradients.secured.from,to:he.gradients.secured.to,vertical:!0}),s.jsxs("filter",{id:"glow-intense",children:[s.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),s.jsxs("feMerge",{children:[s.jsx("feMergeNode",{in:"coloredBlur"}),s.jsx("feMergeNode",{in:"coloredBlur"}),s.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),s.jsxs("g",{transform:`translate(${he.spacing.left}, ${he.spacing.top})`,children:[s.jsx(Nn,{scale:d,width:r,stroke:"rgba(255, 255, 255, 0.05)",strokeWidth:1,numTicks:6}),s.jsx(Rt,{data:e,x:p,y:h,yScale:d,fill:"url(#gradient-secured-tesla)",curve:_e,style:{filter:"url(#glow-intense)"}}),s.jsx(Rt,{data:e,x:p,y0:h,y1:f,yScale:d,fill:"url(#gradient-exposed-tesla)",curve:_e,style:{filter:"url(#glow-intense)"}}),s.jsx(ht,{data:e,x:p,y:h,stroke:"#00d9ff",strokeWidth:3,curve:_e,strokeLinecap:"round",style:{filter:"drop-shadow(0 0 6px #00d9ff)"}}),s.jsx(ht,{data:e,x:p,y:f,stroke:"#ff0844",strokeWidth:3,curve:_e,strokeLinecap:"round",style:{filter:"drop-shadow(0 0 6px #ff0844)"}}),e.map((b,w)=>s.jsxs("g",{children:[s.jsx(vi,{cx:p(b),cy:f(b),r:(i==null?void 0:i.data)===b?6:3,fill:"#ff0844",stroke:"white",strokeWidth:(i==null?void 0:i.data)===b?2:1,style:{filter:(i==null?void 0:i.data)===b?"drop-shadow(0 0 8px #ff0844)":"none",cursor:"pointer",transition:"all 0.2s ease"}}),s.jsx(vi,{cx:p(b),cy:h(b),r:(i==null?void 0:i.data)===b?6:3,fill:"#00d9ff",stroke:"white",strokeWidth:(i==null?void 0:i.data)===b?2:1,style:{filter:(i==null?void 0:i.data)===b?"drop-shadow(0 0 8px #00d9ff)":"none",cursor:"pointer",transition:"all 0.2s ease"}})]},w)),i&&s.jsx("line",{x1:p(i.data),x2:p(i.data),y1:0,y2:o,stroke:"rgba(255, 255, 255, 0.2)",strokeWidth:2,strokeDasharray:"6,6",pointerEvents:"none"}),s.jsx(xt,{top:o,scale:l,stroke:"rgba(255, 255, 255, 0.2)",tickStroke:"rgba(255, 255, 255, 0.2)",tickValues:y,tickLabelProps:()=>({fill:"rgba(255, 255, 255, 0.6)",fontSize:12,fontFamily:"ui-monospace, monospace",textAnchor:"middle",fontWeight:700,dy:10}),tickFormat:b=>b.toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}).replace(".","")}),s.jsx(bs,{scale:d,stroke:"rgba(255, 255, 255, 0.2)",tickStroke:"rgba(255, 255, 255, 0.2)",numTicks:6,tickLabelProps:()=>({fill:"rgba(255, 255, 255, 0.6)",fontSize:13,fontFamily:"ui-monospace, monospace",textAnchor:"end",fontWeight:700,dx:-12}),tickFormat:b=>{const w=b;return w>=1e6?`${(w/1e6).toFixed(1)}M‚Ç¨`:w>=1e3?`${Math.round(w/1e3)}k‚Ç¨`:`${Math.round(w)}‚Ç¨`}}),s.jsx(hl,{width:r,height:o,fill:"transparent",onMouseMove:m,onMouseLeave:()=>a(null),style:{cursor:"crosshair"}})]})]}),s.jsx(Io,{children:i&&s.jsx(kf,{data:i.data,x:i.x,y:i.y})})]})}const Cf={risk:{bg:"bg-gradient-to-br from-red-950/40 to-red-900/10",border:"border-red-500/30",glow:"shadow-[0_0_30px_rgba(239,68,68,0.15)]",dot:"bg-red-500",text:"text-red-400",textMuted:"text-red-300/60"},revenue:{bg:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/10",border:"border-emerald-500/30",glow:"shadow-[0_0_30px_rgba(16,185,129,0.15)]",dot:"bg-emerald-500",text:"text-emerald-400",textMuted:"text-emerald-300/60"},velocity:{bg:"bg-gradient-to-br from-blue-950/40 to-blue-900/10",border:"border-blue-500/30",glow:"shadow-[0_0_30px_rgba(59,130,246,0.15)]",dot:"bg-blue-500",text:"text-blue-400",textMuted:"text-blue-300/60"}},Af={emerald:"text-emerald-400",blue:"text-blue-400",orange:"text-orange-400",red:"text-red-400",slate:"text-slate-400"};function Tf({data:e}){if(!e||e.length===0)return null;const t=Math.max(...e),n=Math.min(...e),i=t-n||1,a=e.map((r,o)=>{const l=o/(e.length-1)*100,c=100-(r-n)/i*100;return`${l},${c}`}).join(" ");return s.jsx("svg",{viewBox:"0 0 100 100",className:"w-full h-8 opacity-30",preserveAspectRatio:"none",children:s.jsx("polyline",{points:a,fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}function Ef({trend:e}){const t=e.direction==="up"?ml:e.direction==="down"?xl:Tl,n=e.direction==="up"?"text-emerald-400 bg-emerald-500/10":e.direction==="down"?"text-red-400 bg-red-500/10":"text-slate-400 bg-slate-500/10";return s.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-lg ${n} text-[10px] font-bold uppercase tracking-wider`,children:[s.jsx(t,{size:12}),s.jsxs("span",{children:[Math.abs(e.percentage),"%"]})]})}function Us({type:e,title:t,icon:n,heroValue:i,heroLabel:a,trend:r,metrics:o,sparklineData:l}){const c=Cf[e];return s.jsxs("div",{className:`
        ${c.bg} ${c.border} ${c.glow}
        border rounded-3xl p-8
        transition-all duration-500 ease-out
        hover:scale-[1.02] hover:${c.glow.replace("0.15","0.25")}
        group relative overflow-hidden
      `,children:[s.jsx("div",{className:`absolute inset-0 ${c.dot} opacity-0 group-hover:opacity-5 blur-3xl transition-opacity duration-500`}),s.jsxs("header",{className:"flex items-center justify-between mb-6 relative z-10",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${c.dot} animate-pulse`}),s.jsx("h3",{className:`text-[10px] font-black ${c.text} uppercase tracking-widest`,children:t})]}),s.jsx("div",{className:`${c.textMuted} opacity-50`,children:n})]}),s.jsxs("div",{className:"mb-6 relative z-10",children:[s.jsxs("div",{className:"flex items-baseline gap-3 mb-2",children:[s.jsx("span",{className:"text-5xl font-black text-white tracking-tighter font-mono",children:i}),r&&s.jsx(Ef,{trend:r})]}),s.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:a})]}),l&&l.length>0&&s.jsx("div",{className:`mb-6 ${c.text} relative z-10`,children:s.jsx(Tf,{data:l})}),s.jsx("div",{className:"grid grid-cols-2 gap-4 relative z-10",children:o.map((d,u)=>s.jsxs("div",{className:"bg-white/[0.03] backdrop-blur-sm px-4 py-3 rounded-xl border border-white/5 hover:bg-white/[0.06] transition-colors",children:[s.jsx("span",{className:"block text-[9px] uppercase text-slate-500 mb-1 font-bold tracking-widest",children:d.label}),s.jsx("span",{className:`text-xl font-black font-mono ${d.color?Af[d.color]:"text-white"}`,children:d.value})]},u))})]})}function Df({risk:e,revenue:t,velocity:n,history:i}){var a,r,o;return s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx(Us,{type:"risk",title:"Risque Imm√©diat",icon:s.jsx(Ct,{size:20}),heroValue:`${Math.round(e.exposedCA/1e3)}k‚Ç¨`,heroLabel:"CA √† Risque",trend:{value:0,percentage:12,direction:"down"},metrics:[{label:"War Room",value:e.warRoomCount,color:"red"},{label:"Retards Ops",value:e.delayCount,color:"orange"}],sparklineData:(a=i==null?void 0:i.risk)!=null&&a.length?i.risk:[120,100,80,60,40,e.exposedCA/1e3]}),s.jsx(Us,{type:"revenue",title:"Sant√© Revenu",icon:s.jsx(Ke,{size:20}),heroValue:`${Math.round(t.securedCA/1e3)}k‚Ç¨`,heroLabel:"CA S√©curis√©",trend:{value:t.securedCA,percentage:18,direction:"up"},metrics:[{label:"Pipeline",value:t.pipelineCount,color:"emerald"},{label:"Avg Ticket",value:`${Math.round(t.avgTicket/1e3)}k‚Ç¨`,color:"blue"}],sparklineData:(r=i==null?void 0:i.revenue)!=null&&r.length?i.revenue:[150,170,180,200,220,230,t.securedCA/1e3]}),s.jsx(Us,{type:"velocity",title:"V√©locit√© Ops",icon:s.jsx(fl,{size:20}),heroValue:`${n.avgDelayDays.toFixed(1)}j`,heroLabel:"D√©lai Moyen (Depuis Sign√©)",trend:{value:14,percentage:0,direction:"stable"},metrics:[{label:"Actifs",value:n.activeCount,color:"blue"},{label:"Silencieux",value:n.silentCount,color:"orange"}],sparklineData:(o=i==null?void 0:i.velocity)!=null&&o.length?i.velocity:[12,13,14,14,15,14,14]})]})}function Rf({events:e}){return s.jsxs("div",{className:"space-y-4 max-h-[400px] overflow-y-auto pr-4 scrollbar-thin scrollbar-thumb-white/10",children:[e.map(t=>s.jsxs("div",{className:"flex gap-4 p-4 bg-black/40 border border-white/10 rounded-xl hover:border-white/20 transition-all group",children:[s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("div",{className:`w-2 h-2 rounded-full mt-1.5 ${t.type==="email_sent"?"bg-sky-400":t.type==="war_room_entry"?"bg-red-500":t.type==="decision"?"bg-indigo-400":"bg-white/20"}`}),s.jsx("div",{className:"w-[1px] flex-1 bg-white/5 group-last:hidden"})]}),s.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsx("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest font-mono",children:t.time}),s.jsx("span",{className:"text-[9px] font-black text-white/20 uppercase tracking-widest",children:t.type.replace("_"," ")})]}),s.jsx("p",{className:"text-sm font-black text-white uppercase tracking-tight",children:t.label}),s.jsx("p",{className:"text-[11px] text-slate-400 italic font-medium",children:t.detail})]})]},t.id)),e.length===0&&s.jsx("div",{className:"py-12 text-center",children:s.jsx("p",{className:"text-[10px] font-black text-white/20 uppercase tracking-[0.4em] italic",children:"En attente de nouveaux signaux..."})})]})}function Yo(e){let t=0;const n=e.days_since_signature??0,i=e.days_since_last_event??0;return e.status==="signed"&&n>14&&!e.deposit_paid&&(t+=60),e.status==="signed"&&n>=8&&n<=14&&!e.deposit_paid&&(t+=40),i>10?t+=25:i>=6&&(t+=15),e.email_optout&&(t+=100),e.deposit_paid&&(t-=40),i<=2&&(t-=15),Math.max(0,Math.min(100,t))}function Ko(e){let t=0;if(e.days_since_last_event==null)return 60;const n=e.days_since_last_event;return n>14?t+=50:n>=7?t+=35:n>=4&&(t+=20),n<=2&&(t-=25),Math.max(0,Math.min(100,t))}function Mf(e){const t=Yo(e),n=Ko(e),a=100-(t*.6+n*.4);return Math.max(0,Math.round(a))}function Pf(e){return{study_id:e.study_id,risk_score_ops:Yo(e),inertia_score:Ko(e),ops_health_score:Mf(e)}}function If(e){return N.useMemo(()=>e.map(Pf),[e])}const Lf=14,Of=7;function Vf(e){if(e.status!=="signed")return null;const t=[],n=e.days_since_signature??0,i=e.days_since_last_event??null,a=e.deposit_paid===!0,o=(e.install_cost??0)>0;return n>Lf&&!a&&o?(t.push("D√©lai SRU d√©pass√© sans s√©curisation financi√®re"),{studyId:e.study_id,status:"WAR_ROOM",reasons:t,recommendation:"INTERVENTION IMM√âDIATE ‚Äî s√©curiser ou stopper"}):(n>=Of&&!a&&o&&t.push("Signature ancienne sans acompte"),i!==null&&i>=5&&t.push("Aucune interaction r√©cente apr√®s signature"),t.length>=2?{studyId:e.study_id,status:"WAR_ROOM",reasons:t,recommendation:"S√âCURISER EN URGENCE"}:t.length===1?{studyId:e.study_id,status:"A_SECURISER",reasons:t,recommendation:"Relance cibl√©e pour s√©curisation"}:{studyId:e.study_id,status:"SOUS_CONTROLE",reasons:[],recommendation:"RAS ‚Äî dossier sain"})}function Ff(e){return e.status==="sent"&&!e.signed_at&&!e.deposit_paid}function Bf(e){if(!Ff(e))return null;const t=[],n=e.days_since_last_event??null,i=n!==null&&n>7;let a="NEUTRE";const r=e.interaction_score??0;return r>=60?a="INTERESSE":r>=30?a="AGITE":i&&(a="MUET"),a==="INTERESSE"&&i?(t.push("Client int√©ress√© mais silencieux"),{studyId:e.study_id,status:"A_RELANCER",reasons:t,recommendation:"APPELER_EN_PRIORITE"}):a==="MUET"?(t.push("Client silencieux, risque fatigue"),{studyId:e.study_id,status:"A_SURVEILLER",reasons:t,recommendation:"NE_PAS_RELANCER"}):(t.push("Situation normale"),{studyId:e.study_id,status:"A_SURVEILLER",reasons:t,recommendation:"AUCUNE_ACTION"})}const $f=30,Uf=7;function Wf(e){if(e.status==="signed")return null;if(e.email_optout===!0)return{studyId:e.study_id,status:"A_ABANDONNER",reasons:["Client opt-out (RGPD)"],recommendation:"STOP ‚Äî aucun contact autoris√©"};const n=[],i=e.days_since_last_event??null;return i!==null&&i>=$f?(n.push("Aucune interaction depuis plus de 30 jours"),{studyId:e.study_id,status:"A_ABANDONNER",reasons:n,recommendation:"STOP ‚Äî lead froid, d√©sengager"}):i!==null&&i<=Uf?(n.push("Interaction r√©cente d√©tect√©e"),{studyId:e.study_id,status:"A_APPELER",reasons:n,recommendation:"APPEL HUMAIN PRIORITAIRE"}):(n.push("Lead passif sans signal fort"),{studyId:e.study_id,status:"A_OBSERVER",reasons:n,recommendation:"Surveiller sans relance agressive"})}function zf(e){const t=Vf(e);if(t){if(t.status==="WAR_ROOM")return{studyId:e.study_id,priority:"WAR_ROOM",sourceAxis:"A",reasons:t.reasons,recommendation:t.recommendation};if(t.status==="A_SECURISER")return{studyId:e.study_id,priority:"PRIORITY_ACTION",sourceAxis:"A",reasons:t.reasons,recommendation:t.recommendation}}const n=Bf(e);if(n){if(n.status==="A_RELANCER")return{studyId:e.study_id,priority:"PRIORITY_ACTION",sourceAxis:"B",reasons:n.reasons,recommendation:n.recommendation};if(n.status==="A_SURVEILLER")return{studyId:e.study_id,priority:"WATCH",sourceAxis:"B",reasons:n.reasons,recommendation:n.recommendation}}const i=Wf(e);if(i){if(i.status==="A_APPELER")return{studyId:e.study_id,priority:"PRIORITY_ACTION",sourceAxis:"C",reasons:i.reasons,recommendation:i.recommendation};if(i.status==="A_ABANDONNER")return{studyId:e.study_id,priority:"STOP",sourceAxis:"C",reasons:i.reasons,recommendation:i.recommendation}}const a={studyId:e.study_id,priority:"NONE",sourceAxis:null,reasons:["Aucune action requise"],recommendation:"Aucune"};return a.audit_payload={study_id:e.study_id,action_performed:"NONE",justification:"Situation normale, aucune action",source_axis:null,risk_score:0,health_score:0,created_at:new Date().toISOString()},a}function qf(e){return N.useMemo(()=>e.map(t=>zf(t)),[e])}function Hf(e,t){return t<e?{severity:"CRITICAL",message:"Rendered value is lower than raw data",recommendation:"Fix scale or clipping in chart renderer",code:"DATA_MISMATCH"}:null}const Gf=["FinancialRiskProofVisx","ProjectionCAVISX","RiskMapVisx","ClientDriftVisx","BehaviorDriftTimelineVisx","KpiCardsLayout"];function Yf(){return{component:"RISQUE FINANCIER",score:100,severity:"OK",issues:[]}}function Kf(){return{component:"PROJECTION C.A.",score:100,severity:"OK",issues:[]}}function Xf(){return{component:"CARTOGRAPHIE DES RISQUES",score:100,severity:"OK",issues:[]}}function Zf(){return{component:"D√âRIVE CLIENT (DRIFT)",score:100,severity:"OK",issues:[]}}function Jf(){return{component:"TIMELINE COMPORTEMENTALE",score:100,severity:"OK",issues:[]}}function Qf(){return{component:"AGENCEMENT CARTES KPI",score:100,severity:"OK",issues:[]}}const em={FinancialRiskProofVisx:Yf,ProjectionCAVISX:Kf,RiskMapVisx:Xf,ClientDriftVisx:Zf,BehaviorDriftTimelineVisx:Jf,KpiCardsLayout:Qf};function Xo(e){const t=[],n=[];for(const r of Gf){const o=em[r];if(!o)throw new Error(`GOVERNANCE BREACH: Component "${r}" is visible in Cockpit but has NO UX auditor.`);let l;try{l=o()}catch(d){throw new Error(`AUDIT CRASHED for ${r}: ${d}`)}if(!l)throw new Error(`AUDIT FAILURE: Auditor for "${r}" returned no result.`);const c={component:r,...l};r.includes("Cards")||r.includes("KPI")?n.push(c):t.push(c)}const i=[...t.map(r=>r.score),...n.map(r=>r.score),e.dataIntegrityIssues.length?40:100],a=i.length>0?i.reduce((r,o)=>r+o,0)/i.length:100;return{globalScore:Math.round(a),charts:t,cards:n,dataIntegrityIssues:e.dataIntegrityIssues}}const tm="ux_audit_history";function sm(){return typeof window>"u"?[]:JSON.parse(localStorage.getItem(tm)||"[]")}const Ha=14,nm=7,im=.6,am=3e4,Ga={DEPOSIT_RECEIVED:-.15,HIGH_INTERACTION:-.1},it={NO_DEPOSIT_EARLY:.1,NO_DEPOSIT_LATE:.25,SILENCE_LOW:.1,SILENCE_CRITICAL:.2,HIGH_AMOUNT:.08,SRU_DANGER_ZONE:.35};function rm(e){let t=0;const n=[];e.daysSinceSignature>=Ha-2&&(t+=it.SRU_DANGER_ZONE,n.push("SRU danger zone")),e.depositReceived?t+=Ga.DEPOSIT_RECEIVED:(t+=e.daysSinceSignature>nm?it.NO_DEPOSIT_LATE:it.NO_DEPOSIT_EARLY,n.push("Deposit not received")),e.interactionScore<20?(t+=it.SILENCE_CRITICAL,n.push("Client silent")):e.interactionScore<40?t+=it.SILENCE_LOW:e.interactionScore>60&&(t+=Ga.HIGH_INTERACTION),e.amount>am&&(t+=it.HIGH_AMOUNT,n.push("High amount"));const i=t>=im;return{riskScore:t,warRoom:i,status:e.depositReceived||e.daysSinceSignature>Ha?"LOCKED":i?"DANGER":"EXPOSED",reasons:n}}function om(e){return rm(e)}const lm=({system:e,chartsToAudit:t=[]})=>{const[n,i]=N.useState("IDLE"),[a,r]=N.useState(null),o=async()=>{i("RUNNING"),await new Promise(m=>setTimeout(m,1500));const h=Xo({dataIntegrityIssues:[]}),f={decisions:[],uxScore:h.globalScore,dataBreaches:0,uxDetails:h};try{const m=await fetch("/api/ops/audit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});if(m.ok){const y=await m.json();r(y)}else r(gi(f))}catch(m){console.error("Audit History Save Failed",m),r(gi(f))}i("RESULT")},l=()=>{if(a){console.log("üìÑ Generating PDF with result:",a);try{const h=bl(a),f=document.createElement("a");f.href=h,f.download=`EDF_OPS_AUDIT_REPORT_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(f),f.click(),document.body.removeChild(f)}catch(h){console.error("‚ùå PDF Generation Failed:",h),alert(`Erreur g√©n√©ration PDF: ${h.message}
Voir console pour d√©tails.`)}}};if(n==="IDLE")return s.jsxs("button",{onClick:o,className:"flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-lg transition-colors group",children:[s.jsx(Dl,{size:16,className:"text-slate-400 group-hover:text-white"}),s.jsx("span",{className:"text-xs font-bold text-slate-300 group-hover:text-white uppercase tracking-wider",children:"Run Ops & UX Audit"})]});if(n==="RUNNING")return s.jsxs("button",{disabled:!0,className:"flex items-center gap-2 px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg cursor-wait",children:[s.jsx(gl,{size:16,className:"text-blue-500 animate-spin"}),s.jsx("span",{className:"text-xs font-bold text-blue-400 uppercase tracking-wider",children:"Auditing System..."})]});if(!a)return null;const c=a.comparison,d=(c==null?void 0:c.status)==="REGRESSED"||(c==null?void 0:c.uxDelta)<0,u=a.globalScore<60||a.dataIntegrityBreaches>0||d,p=!u&&a.globalScore>=80&&a.dataIntegrityBreaches===0;return s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:()=>i("IDLE"),className:`flex items-center gap-3 px-4 py-2 rounded-lg border ${u?"bg-red-900/20 border-red-500/50":"bg-emerald-900/20 border-emerald-500/50"}`,children:[u?s.jsx(Ct,{size:16,className:"text-red-500"}):s.jsx(Ke,{size:16,className:"text-emerald-500"}),s.jsxs("div",{className:"flex flex-col items-start text-left",children:[s.jsx("span",{className:`text-[10px] font-black uppercase tracking-wider ${u?"text-red-400":"text-emerald-400"}`,children:u?"AUDIT FAILED":"SYSTEM CERTIFIED"}),s.jsxs("span",{className:"text-xs font-bold text-white",children:["Score: ",a.globalScore,"/100"]})]})]}),s.jsxs("div",{className:"absolute top-full right-0 mt-4 w-[400px] bg-[#0F1629] border border-slate-700 rounded-xl shadow-2xl p-6 z-50 animate-in fade-in slide-in-from-top-2",children:[d&&s.jsxs("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-500 rounded flex items-start gap-3",children:[s.jsx(Ct,{className:"text-red-500 shrink-0",size:20}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-red-400 font-bold text-xs uppercase tracking-wider",children:"üö´ REGRESSION DETECTED"}),s.jsxs("p",{className:"text-red-300 text-[10px] mt-1",children:["UX Score dropped by ",Math.abs(c==null?void 0:c.uxDelta)," points.",s.jsx("br",{}),"Deployment is blocked until resolved."]})]})]}),s.jsxs("div",{className:"flex justify-between items-start mb-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-black text-white uppercase tracking-widest",children:"OPS SYSTEM RESULT"}),s.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Generated ",new Date().toLocaleTimeString()]})]}),s.jsx("div",{className:`text-2xl font-black ${u?"text-red-500":"text-emerald-500"}`,children:a.globalScore})]}),s.jsxs("div",{className:"space-y-4 mb-8",children:[s.jsxs("div",{className:"flex justify-between items-center text-sm border-b border-white/5 pb-2",children:[s.jsx("span",{className:"text-slate-400",children:"Data Integrity"}),a.dataIntegrityBreaches>0?s.jsxs("span",{className:"text-red-400 font-bold flex items-center gap-2",children:[s.jsx(Ct,{size:12})," ",a.dataIntegrityBreaches," Breach(es)"]}):s.jsxs("span",{className:"text-emerald-400 font-bold flex items-center gap-2",children:[s.jsx(Ke,{size:12})," Secure"]})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm border-b border-white/5 pb-2",children:[s.jsx("span",{className:"text-slate-400",children:"UX Readability"}),a.uxScore>=80?s.jsx("span",{className:"text-emerald-400 font-bold",children:"Excellent"}):s.jsx("span",{className:"text-orange-400 font-bold",children:"Needs Work"})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm border-b border-white/5 pb-2",children:[s.jsx("span",{className:"text-slate-400",children:"War Room Exposure"}),a.warRoomCount>0?s.jsxs("span",{className:"text-red-400 font-bold",children:[a.warRoomCount," Critical"]}):s.jsx("span",{className:"text-slate-500 font-bold",children:"None"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("button",{onClick:l,className:"w-full py-3 bg-white text-black font-bold uppercase text-xs rounded hover:bg-slate-200 transition-colors flex items-center justify-center gap-2",children:[s.jsx(Cl,{size:14})," Download Official Report"]}),p&&s.jsx("div",{className:"mt-4 pt-4 border-t border-white/10 text-center",children:s.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 bg-emerald-500/10 text-emerald-400 rounded-full border border-emerald-500/30",children:[s.jsx(Ke,{size:12}),s.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Dashboard Certified"})]})})]})]})]})},cm=({study:e})=>{const t=N.useMemo(()=>({daysSinceSignature:Math.floor((Date.now()-new Date(e.signed_at||e.created_at).getTime())/864e5),depositReceived:e.deposit_paid||!1,interactionScore:(e.views||0)*10+(e.clicks||0)*20,amount:e.total_price||0}),[e]);return om(t),null};function dm({system:e}){var k,C,_,g;const{studies:t,metrics:n,financialStats:i,logs:a}=e,r=N.useMemo(()=>t.filter(x=>{const v=new Date(x.created_at),S=new Date,T=v.getMonth()===S.getMonth()&&v.getFullYear()===S.getFullYear();return T||console.log(`[Cockpit] Cleaning old study: ${x.id} (${x.created_at})`),x.status==="archived"||x.archived?(console.log(`[Cockpit] Cleaning archived study: ${x.id}`),!1):T}).map(x=>{const v=x.signed_at?Math.floor((new Date().getTime()-new Date(x.signed_at).getTime())/864e5):null;let S="ACTIVE";return x.status==="signed"?x.deposit_paid?S="SECURED":v!==null&&v>14?S="SRU_EXPIRED":S="UNSECURED_DELAY":x.behavioralState==="MUET"||x.views===0&&x.clicks===0?S="SILENT":S="ACTIVE",{study_id:x.id,ops_state:S,days_since_signature:v,days_since_last_event:x.diffDays||0,deposit_paid:x.deposit_paid||!1,signed_at:x.signed_at,last_interaction_at:x.last_view||x.last_click||null,install_cost:x.total_price||0,status:x.status,interaction_score:(x.views||0)*10+(x.clicks||0)*20,email_optout:x.email_optout||!1}}),[t]),o=N.useMemo(()=>r.reduce((x,v)=>{const S=v.ops_state||"UNKNOWN";return x[S]=(x[S]||0)+1,x},{ACTIVE:0,SILENT:0,UNSECURED_DELAY:0,SRU_EXPIRED:0,SECURED:0}),[r]);i.totalCA||t.reduce((x,v)=>x+(v.total_price||0),0);const l=i.cashAtRisk||0,c=N.useMemo(()=>Array.from({length:30}).map((v,S)=>{const T=new Date;return T.setDate(T.getDate()-(29-S)),T.toISOString().split("T")[0]}).map(v=>{const S=new Date(v);S.setHours(23,59,59,999);let T=0,M=0;return t.forEach(P=>{if(!P.signed_at||new Date(P.signed_at)>S)return;const A=P.deposit_paid_at?new Date(P.deposit_paid_at):null;P.deposit_paid&&A&&A<=S?T+=P.total_price||0:M+=P.total_price||0}),{date:v,securedCA:T,exposedCA:M}}),[t]),d=N.useMemo(()=>(a||[]).slice(0,10).map(v=>({id:v.id,type:v.event_type==="email_sent"?"email_sent":"decision",label:v.title||"Action Syst√®me",time:new Date(v.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),detail:v.description||""})),[a]),u=If(r),p=qf(r),h=N.useMemo(()=>Xo({dataIntegrityIssues:[]}),[]),f=N.useMemo(()=>Hf(5e5,5e5),[]),[m,y]=N.useState([]);[...h.charts,...h.cards].flatMap(x=>x.issues),h.globalScore;const b=N.useMemo(()=>{const x=h.globalScore,v=(f==null?void 0:f.severity)==="CRITICAL";return x<60||v?{blocked:!0,reason:v?"DATA INTEGRITY BREACH":"UX SCORE TOO LOW (<60)"}:{blocked:!1,reason:null}},[h,f]),[w,j]=N.useState([]);return N.useEffect(()=>{j(sm())},[h.globalScore]),s.jsxs("div",{className:"flex flex-col gap-12 py-8 px-4 w-full h-full pb-40",children:[b.blocked&&s.jsxs("div",{className:"bg-red-600 text-white p-6 rounded-2xl border-4 border-red-800 shadow-2xl animate-bounce",children:[s.jsx("h2",{className:"text-2xl font-bold uppercase tracking-widest flex items-center gap-4",children:s.jsx("span",{children:"üö´ DEPLACEMENT BLOQU√â"})}),s.jsxs("p",{className:"font-mono mt-2 text-sm opacity-90",children:["Reason: ",b.reason,s.jsx("br",{}),"Safe decision-making is not guaranteed."]})]}),s.jsxs("header",{className:"p-10 rounded-3xl border border-white/10 bg-black/40 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-8",children:[s.jsx("div",{className:`w-4 h-4 rounded-full shadow-[0_0_15px_rgba(239,68,68,0.5)] animate-pulse ${o.UNSECURED_DELAY>0?"bg-red-500":"bg-emerald-500"}`}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"√âTAT OPS (DB MIRROR)"}),s.jsx("h1",{className:"text-4xl font-black text-white uppercase tracking-tight",children:o.UNSECURED_DELAY>0?"ATTENTION REQUISE":"SYST√àME NOMINAL"})]})]}),s.jsxs("div",{className:"flex gap-8 text-center items-center",children:[s.jsx(lm,{system:e}),s.jsx("div",{className:"h-8 w-px bg-white/10 mx-2"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-black text-white font-mono",children:o.ACTIVE}),s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Actifs"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-black text-orange-400 font-mono",children:o.SILENT}),s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Silencieux"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-black text-red-500 font-mono",children:o.UNSECURED_DELAY}),s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Retard"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-black text-emerald-400 font-mono",children:o.SECURED}),s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"S√©curis√©s"})]})]})]}),s.jsxs("div",{className:"relative overflow-visible rounded-3xl border border-white/10 shadow-2xl",children:[s.jsx("div",{className:"absolute inset-0 bg-[#0F1629]/80 backdrop-blur-xl z-0"}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-900/20 via-transparent to-purple-900/20 pointer-events-none z-0"}),s.jsxs("div",{className:"relative z-10 p-8 space-y-8",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6 border-b border-white/5 pb-8",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white uppercase tracking-tight flex items-center gap-3",children:s.jsx("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-indigo-400",children:"Protection du Chiffre d‚ÄôAffaires"})}),s.jsx("p",{className:"text-slate-500 text-xs font-medium italic mt-2",children:'"V√©rit√© absolue sur la d√©rive entre CA s√©curis√© et CA √† risque (30j)."'})]}),s.jsxs("div",{className:"flex items-center gap-4 bg-white/[0.03] p-2 pr-6 rounded-2xl border border-white/5 shadow-inner backdrop-blur-md",children:[s.jsxs("div",{className:"flex flex-col px-6 py-2 border-r border-white/5",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-400 shadow-[0_0_8px_rgba(52,211,153,0.6)] animate-pulse"}),s.jsx("span",{className:"text-[9px] font-bold text-emerald-400/80 uppercase tracking-widest",children:new Date().toLocaleString("fr-FR",{month:"long"}).toUpperCase()})]}),s.jsxs("span",{className:"text-2xl font-black text-white tracking-tighter font-mono",children:[Math.round(t.filter(x=>x.total_price&&!["cancelled","refused"].includes(x.status)&&x.signed_at&&new Date(x.signed_at).getMonth()===new Date().getMonth()&&new Date(x.signed_at).getFullYear()===new Date().getFullYear()).reduce((x,v)=>x+(v.total_price||0),0)/1e3).toLocaleString("fr-FR")," K‚Ç¨"]})]}),s.jsxs("div",{className:"flex flex-col px-4 py-2 opacity-60",children:[s.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-widest mb-1",children:"Mois Dernier"}),s.jsxs("span",{className:"text-xl font-black text-white/60 tracking-tighter font-mono",children:[Math.round(t.filter(x=>{if(!x.signed_at||["cancelled","refused"].includes(x.status)||!x.total_price)return!1;const v=new Date(x.signed_at),S=new Date,T=S.getMonth()===0?11:S.getMonth()-1,M=S.getMonth()===0?S.getFullYear()-1:S.getFullYear();return v.getMonth()===T&&v.getFullYear()===M}).reduce((x,v)=>x+(v.total_price||0),0)/1e3).toLocaleString("fr-FR")," K‚Ç¨"]})]})]})]}),s.jsx("div",{className:"pt-4 h-[500px] w-full",children:s.jsx(lr,{children:({width:x,height:v})=>s.jsx(_f,{data:c,width:x,height:v})})})]})]}),s.jsx(Df,{risk:{exposedCA:l,warRoomCount:((k=n==null?void 0:n.warRoom)==null?void 0:k.count)||0,delayCount:o.UNSECURED_DELAY},revenue:{securedCA:(i==null?void 0:i.cashSecured)||0,pipelineCount:(((C=n==null?void 0:n.sent)==null?void 0:C.length)||0)+(((_=n==null?void 0:n.healthy)==null?void 0:_.length)||0),avgTicket:(((g=n==null?void 0:n.signed)==null?void 0:g.length)||0)>0?((i==null?void 0:i.cashSecured)||0)/n.signed.length:0},velocity:{avgDelayDays:(()=>{const x=t.filter(S=>S.status==="signed"&&!S.deposit_paid);return x.length?x.reduce((S,T)=>{const M=T.signed_at?new Date(T.signed_at):new Date(T.created_at),P=Math.floor((new Date().getTime()-M.getTime())/(1e3*3600*24));return S+P},0)/x.length:0})(),activeCount:o.ACTIVE,silentCount:o.SILENT},history:{risk:c.map(x=>x.exposedCA/1e3),revenue:c.map(x=>x.securedCA/1e3),velocity:(e.trafficData||[]).slice(-14).map(x=>x.count+x.opened+x.clicked)}}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 space-y-8",children:[s.jsx("h3",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Preuve d'activit√© (Moteur Brain)"}),s.jsx(Rf,{events:d})]}),n.warRoom.count>0&&s.jsx("div",{className:"fixed bottom-12 left-1/2 -translate-x-1/2 z-50",children:s.jsxs("button",{onClick:()=>e.setActiveSection("war_room"),className:"px-12 py-5 bg-red-600 hover:bg-red-500 text-white font-black uppercase tracking-widest text-xs rounded-2xl shadow-[0_20px_50px_rgba(220,38,38,0.4)] transition-all active:scale-95",children:["Entrer en War Room (",n.warRoom.count,")"]})}),s.jsxs("div",{className:"border-t border-white/10 pt-10 mt-10",children:[s.jsx("h4",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-6",children:"Ops Intelligence (Pure Scoring)"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:u.slice(0,12).map(x=>{const v=t.find(T=>T.id===x.study_id),S=((v==null?void 0:v.client_name)||(v==null?void 0:v.name)||x.study_id.substring(0,8)).toUpperCase();return s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-4 rounded-xl border border-white/5 text-xs flex justify-between items-center group hover:border-white/20 transition-all",children:[s.jsx("span",{className:"text-slate-200 font-mono font-black group-hover:text-white transition-colors",children:S}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("span",{className:"text-[8px] uppercase text-slate-500 font-bold",children:"RISK"}),s.jsx("span",{className:`font-black font-mono ${x.risk_score_ops>50?"text-red-400":"text-emerald-400"}`,children:x.risk_score_ops})]}),s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("span",{className:"text-[8px] uppercase text-slate-500 font-bold",children:"HEALTH"}),s.jsx("span",{className:"font-black font-mono text-blue-400",children:x.ops_health_score})]})]})]},x.study_id)})})]}),s.jsxs("div",{className:"mt-12 pt-12 border-t border-white/5",children:[s.jsx("div",{className:"flex items-center justify-between mb-8",children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute -left-4 top-1 w-1 h-full bg-gradient-to-b from-red-500 to-transparent opacity-50"}),s.jsxs("h3",{className:"text-2xl font-black uppercase text-white tracking-tight flex items-center gap-4 pl-4",children:[s.jsx("div",{className:"p-2 bg-red-500/10 rounded-full border border-red-500/20 shadow-[0_0_20px_rgba(220,38,38,0.2)]",children:s.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"})}),"OPS INTELLIGENCE CENTRE"]}),s.jsx("p",{className:"text-white/30 text-xs font-mono mt-1 pl-16 tracking-widest uppercase",children:"Live Priority Matrix ‚Ä¢ Automated Strategy"})]})}),s.jsxs("div",{className:"overflow-hidden rounded-3xl border border-white/10 bg-black/20 backdrop-blur-2xl shadow-2xl ring-1 ring-white/5",children:[s.jsxs("table",{className:"w-full text-left border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-white/10 bg-white/[0.02]",children:[s.jsx("th",{className:"py-6 px-8 text-[9px] uppercase font-bold text-slate-500 tracking-widest w-1/3",children:"Client Identity"}),s.jsx("th",{className:"py-6 px-8 text-[9px] uppercase font-bold text-slate-500 tracking-widest",children:"Operational Status"}),s.jsx("th",{className:"py-6 px-8 text-[9px] uppercase font-bold text-slate-500 tracking-widest",children:"Strategy Axis"}),s.jsx("th",{className:"py-6 px-8 text-[9px] uppercase font-bold text-slate-500 tracking-widest text-right",children:"Recommended Protocol"})]})}),s.jsx("tbody",{className:"divide-y divide-white/[0.03]",children:p.slice(0,12).map(x=>{const v=t.find(P=>P.id===x.studyId),S=((v==null?void 0:v.client_name)||(v==null?void 0:v.name)||x.studyId.slice(0,12)).toUpperCase(),T=((v==null?void 0:v.city)||"N/A").toUpperCase(),M=x.recommendation.replace(/_/g," ").toUpperCase();return s.jsxs("tr",{className:"group hover:bg-white/[0.04] transition-all duration-300 ease-out",children:[s.jsx("td",{className:"py-5 px-8",children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-slate-700 group-hover:bg-blue-400 transition-colors"}),s.jsx("span",{className:"text-sm font-bold text-slate-200 group-hover:text-white transition-colors tracking-wide",children:S})]}),s.jsxs("div",{className:"flex items-center gap-2 pl-4",children:[s.jsx("span",{className:"text-[9px] font-mono text-white/20 px-1.5 rounded border border-white/5",children:x.studyId.slice(0,4)}),s.jsx("span",{className:"text-[9px] font-bold text-white/30 tracking-wider",children:T})]})]})}),s.jsx("td",{className:"py-5 px-8",children:s.jsxs("div",{className:`
                             inline-flex items-center gap-2 px-4 py-2 rounded-lg border text-[10px] font-black uppercase tracking-widest transition-transform group-hover:scale-105
                             ${x.priority==="WAR_ROOM"?"bg-red-500/20 border-red-500/50 text-red-100 shadow-[0_0_20px_rgba(220,38,38,0.3)]":x.priority==="PRIORITY_ACTION"?"bg-orange-500/10 border-orange-500/30 text-orange-200":x.priority==="WATCH"?"bg-blue-500/10 border-blue-500/30 text-blue-200":"bg-slate-500/5 border-slate-500/20 text-slate-500 opacity-50"}
                          `,children:[x.priority==="WAR_ROOM"&&s.jsx("div",{className:"w-1.5 h-1.5 bg-red-400 rounded-full animate-ping"}),x.priority.replace(/_/g," ")]})}),s.jsx("td",{className:"py-5 px-8",children:x.sourceAxis?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-[9px] font-mono text-white/30",children:"AXIS"}),s.jsx("span",{className:"font-bold text-xs text-white/70 bg-white/5 px-2 py-1 rounded border border-white/10 group-hover:border-white/30 transition-colors",children:x.sourceAxis})]}):s.jsx("span",{className:"text-white/10 text-[10px]",children:"‚Äî"})}),s.jsx("td",{className:"py-5 px-8 text-right",children:s.jsx("span",{className:`
                             text-[10px] font-black uppercase tracking-widest py-1 px-3 rounded
                             ${x.recommendation.includes("RELANCER")?"bg-emerald-500/10 text-emerald-300":"text-slate-500 bg-white/[0.02]"}
                          `,children:M})})]},x.studyId)})})]}),p.length===0&&s.jsxs("div",{className:"p-20 text-center flex flex-col items-center gap-4",children:[s.jsx("div",{className:"w-12 h-12 rounded-full bg-white/5 flex items-center justify-center",children:s.jsx("div",{className:"w-4 h-4 bg-emerald-500 rounded-full"})}),s.jsx("div",{className:"text-white/20 text-xs uppercase tracking-widest font-mono",children:"No active priorities detected"})]})]})]}),s.jsxs("section",{className:"bg-slate-900/50 p-8 rounded-xl border border-dashed border-slate-700 mt-12",children:[s.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-[0.2em] mb-6",children:"UX / DATA INTEGRITY AUDIT (PHASE 3)"}),s.jsxs("div",{className:"grid grid-cols-1 gap-8",children:[f&&s.jsxs("div",{className:`p-4 rounded-lg flex items-start gap-4 border ${f.severity==="CRITICAL"?"bg-red-900/20 border-red-500/50":"bg-green-900/10 border-green-500/30"}`,children:[f.severity==="CRITICAL"?s.jsx(Ct,{className:"text-red-500 shrink-0"}):s.jsx(Ke,{className:"text-green-500 shrink-0"}),s.jsxs("div",{children:[s.jsxs("h4",{className:`text-xs font-bold uppercase mb-1 ${f.severity==="CRITICAL"?"text-red-400":"text-green-400"}`,children:["DATA INTEGRITY: ",f.severity]}),s.jsx("p",{className:"text-sm text-slate-300",children:f.message}),f.recommendation&&s.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["‚Üí ",f.recommendation]})]})]}),s.jsx("div",{className:"space-y-4",children:[...h.charts,...h.cards].map((x,v)=>s.jsxs("div",{className:"bg-white/5 p-4 rounded border border-white/10",children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("span",{className:"font-mono text-sm text-white font-bold",children:x.component}),s.jsxs("span",{className:`text-xs px-2 py-1 rounded font-bold ${x.score>=80?"bg-green-500/20 text-green-400":x.score>=60?"bg-orange-500/20 text-orange-400":"bg-red-500/20 text-red-400"}`,children:["SCORE: ",x.score,"/100"]})]}),x.issues.length===0?s.jsxs("div",{className:"text-xs text-slate-500 italic flex items-center gap-2",children:[s.jsx(Ke,{size:12})," Compliant"]}):s.jsx("ul",{className:"space-y-2",children:x.issues.map((S,T)=>s.jsxs("li",{className:"text-xs bg-black/20 p-2 rounded",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsxs("span",{className:S.severity==="CRITICAL"?"text-red-400":"text-orange-400",children:[S.severity==="CRITICAL"?"üö®":"‚ö†Ô∏è"," [",S.severity,"]"]}),s.jsx("span",{className:"text-slate-300",children:S.description})]}),s.jsxs("div",{className:"pl-6 text-slate-500 italic",children:["‚Üí ",S.remediation]})]},T))})]},v))})]})]}),s.jsxs("section",{className:"mt-8 border-t border-white/5 pt-8",children:[s.jsx("h4",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest mb-4",children:"AUDIT HISTORY (LOCAL STORAGE)"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:w.slice(-5).reverse().map((x,v)=>s.jsxs("div",{className:"text-[9px] font-mono text-slate-500 bg-black/20 px-2 py-1 rounded",children:[s.jsxs("span",{className:x.score<60?"text-red-500":"text-emerald-500",children:[x.score,"/100"]}),s.jsx("span",{className:"opacity-50 mx-1",children:"‚Äî"}),x.chartId,s.jsx("span",{className:"opacity-30 ml-2",children:new Date(x.timestamp).toLocaleTimeString()})]},v))})]}),t.map(x=>s.jsx(cm,{study:x},`ops-probe-${x.id}`))]})}const oe={colors:{grid:"rgba(255, 255, 255, 0.05)",axis:"rgba(255, 255, 255, 0.15)",text:"rgba(255, 255, 255, 0.3)",textLight:"rgba(255, 255, 255, 0.5)",bubbles:{safe:"rgba(74, 222, 128, 0.6)",warning:"rgba(251, 191, 36, 0.6)",danger:"rgba(248, 113, 113, 0.7)",critical:"rgba(239, 68, 68, 0.8)"}},fonts:{axis:'"Inter", "SF Pro Display", -apple-system, sans-serif'}},um=({studies:e,width:t,height:n,onPointClick:i,highlightedStudyId:a})=>{const r={top:40,right:60,bottom:60,left:60},o=t-r.left-r.right,l=n-r.top-r.bottom;if(t<10||n<10)return null;const{showTooltip:c,hideTooltip:d,tooltipData:u,tooltipLeft:p=0,tooltipTop:h=0}=Za(),f=N.useMemo(()=>e.length===0?null:e.reduce((g,x)=>g.dangerScore>x.dangerScore?g:x),[e]),m=N.useMemo(()=>e.length===0?null:e.reduce((g,x)=>g.totalPrice>x.totalPrice?g:x),[e]),y=N.useMemo(()=>Re({domain:[14,0],range:[0,o],nice:!0}),[o]),b=Math.max(...e.map(g=>g.totalPrice),2e4),w=N.useMemo(()=>Re({domain:[0,b*1.1],range:[l,0],nice:!0}),[b,l]),j=N.useMemo(()=>{const g=[...e].sort((v,S)=>S.engagementScore-v.engagementScore),x=new Map;return g.map(v=>{const S=Math.round(v.totalPrice/2e3),M=`${Math.round(v.daysBeforeDeadline)}-${S}`,P=x.get(M)||0;x.set(M,P+1);let V=0,A=0;if(P>0){const F=P*(Math.PI*.82),ae=25+(P-1)*10;V=Math.cos(F)*ae,A=Math.sin(F)*ae}return{...v,dx:V,dy:A}})},[e]),k=N.useMemo(()=>Gl({domain:[0,100],range:[6,24]}),[]),C=g=>g<40?oe.colors.bubbles.safe:g<60?oe.colors.bubbles.warning:g<80?oe.colors.bubbles.danger:oe.colors.bubbles.critical,_=(g,x,v,S)=>{c({tooltipData:x,tooltipLeft:v+r.left,tooltipTop:S+r.top})};return s.jsxs(s.Fragment,{children:[s.jsx("svg",{width:t,height:n,className:"overflow-visible",children:s.jsxs(se,{left:r.left,top:r.top,children:[s.jsx("text",{x:15,y:l-15,fill:oe.colors.bubbles.safe,fontSize:9,fontWeight:700,letterSpacing:"0.1em",opacity:.3,children:"ZONE S√âCURIS√âE"}),s.jsx("text",{x:o/2,y:l-15,fill:oe.colors.bubbles.warning,fontSize:9,fontWeight:700,letterSpacing:"0.1em",textAnchor:"middle",opacity:.3,children:"ZONE DE VIGILANCE"}),s.jsx("text",{x:o-15,y:25,fill:oe.colors.bubbles.critical,fontSize:9,fontWeight:700,letterSpacing:"0.1em",textAnchor:"end",opacity:.5,children:"URGENCE CRITIQUE"}),s.jsx("text",{x:o,y:l+40,fill:oe.colors.bubbles.critical,fontSize:10,fontWeight:900,textAnchor:"end",letterSpacing:"0.05em",children:"URGENCE ACCRUE ‚Üí"}),s.jsx(Nn,{scale:w,width:o,stroke:oe.colors.grid,strokeDasharray:"4,4"}),s.jsx(xt,{top:l,scale:y,numTicks:5,stroke:oe.colors.axis,tickStroke:oe.colors.axis,tickLabelProps:()=>({fill:oe.colors.text,fontSize:10,fontFamily:oe.fonts.axis,textAnchor:"middle",fontWeight:600})}),s.jsx(bs,{scale:w,numTicks:4,stroke:"transparent",tickStroke:"transparent",tickLabelProps:()=>({fill:oe.colors.text,fontSize:10,fontFamily:oe.fonts.axis,textAnchor:"end",verticalAnchor:"middle",fontWeight:600,dx:-10}),tickFormat:g=>`${Math.round(g/1e3)}k‚Ç¨`}),s.jsx(Io,{children:j.map(g=>{const x=a===g.studyId,v=(f==null?void 0:f.studyId)===g.studyId,S=(m==null?void 0:m.studyId)===g.studyId,T=y(g.daysBeforeDeadline),M=w(g.totalPrice),P=T+g.dx,V=M+g.dy;return s.jsxs(se,{children:[S&&s.jsxs(gs.g,{initial:{opacity:0},animate:{opacity:.6},transition:{delay:1},children:[s.jsx("line",{x1:P,y1:V-k(g.engagementScore)-4,x2:P,y2:V-k(g.engagementScore)-20,stroke:oe.colors.textLight,strokeWidth:.5}),s.jsx("text",{x:P,y:V-k(g.engagementScore)-25,fill:oe.colors.textLight,fontSize:8,fontWeight:800,textAnchor:"middle",letterSpacing:"0.05em",children:"PLUS GROS ENJEU"})]}),s.jsx(gs.circle,{cx:P,cy:V,r:k(g.engagementScore),initial:{opacity:0,scale:0},animate:{opacity:1,scale:x?1.4:v?1.2:1,strokeOpacity:x||v?1:.2},exit:{opacity:0,scale:0},transition:{duration:.6,ease:[.16,1,.3,1]},fill:C(g.dangerScore),stroke:"white",strokeWidth:x?3:v?2:1,style:{cursor:"pointer",zIndex:x?100:1},whileHover:{scale:1.5,strokeOpacity:1},onMouseEnter:A=>_(A,g,P,V),onMouseLeave:()=>d(),onClick:()=>i&&i(g.studyId)})]},g.studyId)})})]})}),u&&s.jsx(Ja,{top:h-8,left:p,style:{...Qa,backgroundColor:"#0F1629",color:"white",border:"none",borderRadius:"4px",padding:"10px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.5)",zIndex:100},children:s.jsxs("div",{className:"flex flex-col gap-0.5",children:[s.jsx("span",{className:"text-[8px] font-bold text-white/30 uppercase tracking-[0.15em] mb-0.5",children:"Focus Dossier"}),s.jsx("p",{className:"text-[11px] font-bold text-white tracking-tight leading-tight",children:u.name}),s.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[7px] text-white/20 uppercase font-black",children:"Potentiel"}),s.jsxs("span",{className:"text-[10px] text-emerald-400 font-mono",children:[Math.round(u.totalPrice).toLocaleString(),"‚Ç¨"]})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[7px] text-white/20 uppercase font-black",children:"Score"}),s.jsxs("span",{className:"text-[10px] text-red-400 font-mono",children:[u.dangerScore,"/100"]})]})]})]})},"tooltip")]})};function hm({studies:e,onPointClick:t,highlightedStudyId:n}){return s.jsx("div",{style:{width:"100%",height:"65vh",minHeight:"500px"},children:s.jsx(gt,{children:({width:i,height:a})=>s.jsx(um,{studies:e,width:i,height:a,onPointClick:t,highlightedStudyId:n})})})}function pm({events:e}){return s.jsxs("div",{className:"flex flex-col gap-6",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute left-[3px] top-4 bottom-4 w-px bg-white/10"}),s.jsx("div",{className:"space-y-8",children:e.map((t,n)=>s.jsxs("div",{className:"flex gap-6 items-start relative",children:[s.jsx("div",{className:`w-2 h-2 rounded-full mt-2 z-10 ${t.type==="signature"?"bg-emerald-400":t.type==="opening"?"bg-sky-400":t.type==="click"?"bg-indigo-400":t.type==="email_sent"?"bg-slate-400":"bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.5)]"}`}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[s.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${t.type==="silence"?"text-red-400":"text-slate-500"}`,children:t.type.replace("_"," ")}),s.jsx("span",{className:"text-[10px] font-mono text-slate-500",children:t.date})]}),s.jsx("p",{className:`text-sm font-black uppercase tracking-tight ${t.type==="silence"?"text-red-200":"text-white"}`,children:t.label})]})]},`${t.type}-${n}`))})]}),e.length===0&&s.jsx("div",{className:"py-8 text-center text-[10px] font-black text-white/10 uppercase tracking-widest",children:"Aucun historique comportemental d√©tect√©"})]})}function fm({study:e,recommendation:t,onAction:n}){const i=e.dangerScore>70;return s.jsxs("div",{className:"h-full bg-[#0B0F14] rounded-xl border border-white/5 flex flex-col overflow-hidden backdrop-blur-sm shadow-2xl",children:[s.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-slate-100 tracking-tight mb-1 font-sans",children:e.name}),s.jsxs("div",{className:"flex items-center gap-3 text-sm font-medium font-mono text-slate-500",children:[s.jsxs("span",{className:"text-emerald-400/80",children:[Math.round(e.totalPrice).toLocaleString()," ‚Ç¨"]}),s.jsx("span",{className:"w-1 h-1 rounded-full bg-slate-700"}),s.jsxs("span",{className:i?"text-red-400":"text-amber-400",children:["J-",e.daysBeforeDeadline]})]})]}),s.jsx("div",{className:`
          flex flex-col items-center justify-center w-12 h-12 rounded-lg border 
          ${i?"bg-red-500/5 border-red-500/20 text-red-500":"bg-amber-500/5 border-amber-500/20 text-amber-500"}
        `,children:s.jsx("span",{className:"text-lg font-bold leading-none",children:e.dangerScore})})]}),s.jsxs("div",{className:"flex-1 p-6 space-y-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Analyse Comportementale"}),s.jsxs("p",{className:"text-sm text-slate-300 leading-relaxed border-l-2 border-white/10 pl-3 italic",children:['"',t.reason,'"']})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-white/[0.02] p-3 rounded-lg border border-white/5",children:[s.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase block mb-1",children:"Strat√©gie"}),s.jsx("span",{className:"text-xs font-semibold text-slate-200",children:t.type})]}),s.jsxs("div",{className:"bg-white/[0.02] p-3 rounded-lg border border-white/5",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Urgence"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${i?"bg-red-500 animate-pulse":"bg-amber-500"}`}),s.jsx("span",{className:"text-xs font-semibold text-slate-200 uppercase",children:t.urgency})]})]})]})]}),s.jsx("div",{className:"p-6 border-t border-white/5 bg-white/[0.01]",children:s.jsxs("button",{onClick:()=>n(e.id),className:`
            w-full py-3 px-4 rounded-lg flex items-center justify-center gap-3 transition-all duration-200
            ${i?"bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/20":"bg-white/5 hover:bg-white/10 text-slate-300 border border-white/10"}
          `,children:[s.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:i?"D√©clencher Intervention":"Actions de Relance"}),s.jsx("svg",{className:"w-4 h-4 opacity-70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]})})]})}function mm({system:e}){const{metrics:t,studies:n,logs:i}=e,a=N.useMemo(()=>t.warRoom.studies.map(g=>({studyId:g.id,name:g.name,daysBeforeDeadline:g.daysLate?14-g.daysLate:14,totalPrice:g.total_price||0,dangerScore:g.dangerScore||50,engagementScore:(g.views||0)*10+(g.clicks||0)*20})),[t.warRoom.studies]),[r,o]=N.useState(a.length>0?a[0].studyId:null),[l,c]=N.useState(null),d=a.length,u=a.reduce((g,x)=>g+x.totalPrice,0),p=N.useMemo(()=>(n||[]).find(g=>{var x;return g.id===(r||((x=a[0])==null?void 0:x.studyId))}),[n,r,a]),h=N.useMemo(()=>{if(!p)return[];const g=[];return p.signed_at&&g.push({type:"signature",date:new Date(p.signed_at).toLocaleDateString(),label:"Signature du contrat"}),p.views>0&&g.push({type:"opening",date:"J+1",label:`${p.views} ouvertures d√©tect√©es`}),p.clicks>0&&g.push({type:"click",date:"J+2",label:`${p.clicks} interactions avec l'√©tude`}),p.send_count>0&&g.push({type:"email_sent",date:"J+3",label:"Relance automatique de r√©assurance"}),p.behavioralState==="MUET"&&g.push({type:"silence",date:"Aujourd'hui",label:"Silence prolong√© - Risque d'annulation √©lev√©"}),g},[p]),f=N.useMemo(()=>(n||[]).filter(g=>g.status==="sent"),[n]),m=N.useMemo(()=>f.filter(g=>g.behavioralState==="INT√âRESS√â"),[f]),y=N.useMemo(()=>f.filter(g=>g.behavioralState==="AGIT√â"),[f]),b=N.useMemo(()=>f.filter(g=>g.behavioralState==="MUET"&&g.diffDays<7),[f]),w=N.useMemo(()=>f.filter(g=>g.behavioralState==="FATIGUE"),[f]),j=N.useMemo(()=>(e.emailLeads||[]).filter(g=>!g.study_id),[e.emailLeads]),k=N.useMemo(()=>j.filter(g=>g.total_clicks>=1),[j]),C=N.useMemo(()=>j.filter(g=>g.total_clicks===0&&g.total_opens>=1),[j]),_=N.useMemo(()=>j.filter(g=>g.total_clicks===0&&g.total_opens===0),[j]);return s.jsxs("div",{className:"flex flex-col gap-12 py-8 px-4 w-full h-full pb-40",children:[s.jsxs("header",{className:"flex flex-col gap-1",children:[s.jsx("h1",{className:"text-3xl font-black text-slate-100 tracking-tight uppercase",children:"War Room Operations"}),s.jsx("p",{className:"text-slate-500 text-[10px] font-bold uppercase tracking-widest",children:"Concentration humaine sur le CA r√©cup√©rable"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8 items-start",children:[s.jsxs("div",{className:"lg:col-span-8 xl:col-span-9 space-y-6",children:[s.jsxs("div",{className:"bg-black/40 backdrop-blur-md rounded-2xl border border-white/10 overflow-hidden shadow-2xl relative",children:[s.jsxs("div",{className:"absolute top-6 left-6 z-10 pointer-events-none",children:[s.jsxs("h2",{className:"text-lg font-black text-white tracking-tight uppercase",children:["Focus D√©cisionnel ‚Äî ",d," Dossiers en Zone de Danger"]}),s.jsxs("p",{className:"text-slate-500 text-[10px] font-bold uppercase tracking-widest mt-1",children:["EXPOSITION TOTALE : ",s.jsxs("span",{className:"font-mono",children:[Math.round(u).toLocaleString("fr-FR")," ‚Ç¨"]})]})]}),s.jsxs("div",{className:"pt-10",children:[" ",s.jsx(hm,{studies:a,onPointClick:o,highlightedStudyId:l})]})]}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm rounded-xl border border-white/10 overflow-hidden",children:[s.jsxs("div",{className:"px-6 py-4 border-b border-white/10 flex justify-between items-center bg-white/[0.01]",children:[s.jsxs("h3",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:["Dossiers en Alerte (",a.length,")"]}),s.jsx("span",{className:"text-[9px] text-slate-600 font-mono uppercase tracking-widest",children:"Sync: Active"})]}),s.jsxs("div",{className:"divide-y divide-white/[0.03]",children:[a.slice(0,5).map(g=>s.jsxs("button",{onClick:()=>o(g.studyId),onMouseEnter:()=>c(g.studyId),onMouseLeave:()=>c(null),className:`w-full px-6 py-3 flex justify-between items-center hover:bg-white/[0.02] transition-colors group ${r===g.studyId?"bg-white/[0.04]":""}`,children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${g.dangerScore>70?"bg-red-500":"bg-amber-500"}`}),s.jsx("span",{className:`text-sm font-black uppercase tracking-tight ${r===g.studyId?"text-white":"text-slate-400 group-hover:text-slate-200"}`,children:g.name})]}),s.jsxs("div",{className:"flex items-center gap-1 text-[11px] font-mono text-slate-500",children:[s.jsxs("span",{className:"w-14 text-right inline-block font-black",children:[Math.round(g.totalPrice/1e3),"k‚Ç¨"]}),s.jsxs("span",{className:`w-12 text-right inline-block font-black ${g.daysBeforeDeadline<5?"text-red-400":"text-blue-400"}`,children:["J-",g.daysBeforeDeadline]}),s.jsxs("span",{className:"text-slate-600 w-10 text-right inline-block font-black",children:[g.dangerScore,"%"]})]})]},g.studyId)),a.length>5&&s.jsx("div",{className:"px-6 py-2 text-center border-t border-white/5",children:s.jsxs("span",{className:"text-[10px] text-slate-600 uppercase tracking-widest",children:["+ ",a.length-5," autres dossiers"]})})]})]})]}),s.jsx("div",{className:"lg:col-span-4 xl:col-span-3 space-y-6",children:p?s.jsxs(s.Fragment,{children:[s.jsx(fm,{study:{id:p.id,name:p.name,totalPrice:p.total_price||0,dangerScore:p.dangerScore||50,daysBeforeDeadline:p.daysLate?14-p.daysLate:14},recommendation:{type:"Appel T√©l√©phonique",reason:p.behavioralState==="MUET"?"Silence prolong√© post-signature. Suspicion de doute.":"Baisse d'engagement suspecte sur l'√©tude.",urgency:(p.dangerScore||0)>70?"high":"medium"},onAction:g=>console.log("Action human intervention launched for",g)}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-10 rounded-xl border border-white/10 space-y-8",children:[s.jsx("h3",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:"D√©rive Comportementale"}),s.jsx(pm,{events:h})]})]}):s.jsx("div",{className:"h-full flex items-center justify-center p-20 text-center",children:s.jsx("p",{className:"text-[10px] font-black text-white/20 uppercase tracking-[0.4em] italic",children:"S√©lectionnez un dossier pour lancer l'analyse"})})})]}),s.jsxs("div",{className:"border-t border-white/10 pt-12 mt-8",children:[s.jsx("h2",{className:"text-xl font-black text-white uppercase tracking-tight mb-8",children:"AXE A ‚Äî DOSSIERS SIGN√âS (ANTI-ANNULATION)"}),(()=>{const x=(e.studies||[]).filter(A=>A.status==="signed"),v=A=>{const F=A.signed_at?Math.floor((new Date().getTime()-new Date(A.signed_at).getTime())/864e5):0,ae=A.dangerScore||0;return A.contract_secured?F>30?"HORS_PERIMETRE":"SOUS_CONTROLE":ae>=70||!A.deposit_paid&&F>7?"WAR_ROOM":!A.deposit_paid||A.behavioralState==="AGIT√â"?"A_SECURISER":"SOUS_CONTROLE"},S=A=>A.deposit_paid?"PAY√â ‚úÖ":A.has_deposit&&!A.deposit_paid?"EN ATTENTE ‚ö†Ô∏è":"NON REQUIS ‚ûñ",T=x.filter(A=>v(A)==="WAR_ROOM"),M=x.filter(A=>v(A)==="A_SECURISER"),P=x.filter(A=>v(A)==="SOUS_CONTROLE"),V=x.filter(A=>v(A)==="HORS_PERIMETRE");return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8 mb-12",children:[s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-red-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"War Room"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:T.length})]}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-amber-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"√Ä S√©curiser"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:M.length})]}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-emerald-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Sous Contr√¥le"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:P.length})]}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-8 rounded-xl border border-white/10 opacity-30",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest",children:"Hors P√©rim√®tre"}),s.jsx("p",{className:"text-3xl font-black text-slate-600 mt-1 font-mono",children:V.length})]})]}),s.jsxs("div",{className:"bg-[#0B0F14] rounded-2xl border border-white/5 overflow-hidden",children:[s.jsx("div",{className:"px-8 py-4 border-b border-white/5 bg-white/[0.01]",children:s.jsxs("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:["Dossiers √† S√©curiser (",T.length+M.length,")"]})}),s.jsxs("div",{className:"divide-y divide-white/[0.03]",children:[[...T,...M].length===0&&s.jsx("div",{className:"p-8 text-center text-white/20 text-xs uppercase tracking-widest",children:"Aucun dossier critique"}),[...T,...M].map(A=>{const F=v(A)==="WAR_ROOM",ae=A.last_click||A.last_open||A.signed_at,W=A.signed_at?Math.floor((new Date().getTime()-new Date(A.signed_at).getTime())/(1e3*60*60*24)):0;return s.jsxs("div",{className:`p-6 flex items-center justify-between hover:bg-white/[0.02] transition-colors ${F?"bg-red-500/5":""}`,children:[s.jsx("div",{className:"w-[35%]",children:s.jsxs("div",{className:"flex items-center gap-2",children:[F&&s.jsx("span",{className:"text-lg",children:"üö®"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-white font-black text-sm truncate pr-2 uppercase tracking-tight",children:A.name}),s.jsxs("p",{className:"text-slate-500 text-[10px] font-bold uppercase",children:["Sign√© il y a ",s.jsx("span",{className:"font-mono",children:W})," jours"]})]})]})}),s.jsxs("div",{className:"w-[15%]",children:[s.jsx("p",{className:"text-white/40 text-[10px] uppercase tracking-wider mb-1",children:"Acompte"}),(()=>{const O=S(A);return s.jsx("span",{className:`text-xs font-bold uppercase ${O.includes("PAY√â")?"text-emerald-400":O.includes("EN COURS")?"text-blue-400":"text-orange-400"}`,children:O})})()]}),s.jsxs("div",{className:"w-[20%] flex flex-col items-end",children:[s.jsxs("p",{className:"text-white font-bold text-sm",children:[Math.round(A.total_price).toLocaleString("fr-FR")," ‚Ç¨"]}),s.jsx("p",{className:"text-white/40 text-[10px] uppercase tracking-wider mt-1 text-right",children:ae?s.jsxs(s.Fragment,{children:["Interaction il y a ",Math.floor((new Date().getTime()-new Date(ae).getTime())/(1e3*60*60*24))," j"]}):"Aucune interaction"})]}),s.jsx("div",{className:"w-[30%] flex justify-end pl-4",children:s.jsx("div",{className:`px-4 py-2 rounded-lg border ${F?"bg-red-500/5 border-red-500/10":"bg-amber-500/5 border-white/5"} whitespace-nowrap`,children:s.jsx("p",{className:`${F?"text-red-400":"text-slate-400"} text-[10px] font-bold uppercase tracking-widest`,children:F?"URGENCE : S√âCURISER":"ACTION : S√âCURISER"})})})]},A.id)})]})]})]})})()]}),s.jsxs("div",{className:"border-t border-white/5 pt-16 mt-16",children:[s.jsxs("header",{className:"mb-10",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Retention Strategy"}),s.jsx("h2",{className:"text-2xl font-black text-slate-100 tracking-tight mt-1 uppercase",children:"AXE B ‚Äî Post-Pr√©sentation sans Signature"}),s.jsxs("p",{className:"text-amber-500/60 text-[10px] font-bold uppercase tracking-widest mt-2",children:["Impact : ",s.jsx("span",{className:"font-mono",children:m.length})," Relances Prioritaires en attente"]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8 mb-12",children:[s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-red-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Priorit√© Relance"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:m.length})]}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-amber-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"√Ä Surveiller"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:y.length})]}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-blue-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"R√©veil N√©cessaire"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:b.length})]}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-8 rounded-xl border border-white/10 opacity-30",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest",children:"Interruption (Stop)"}),s.jsx("p",{className:"text-3xl font-black text-slate-600 mt-1 font-mono",children:w.length})]})]}),s.jsxs("div",{className:"overflow-hidden rounded-xl border border-white/10 bg-black/20 backdrop-blur-sm shadow-2xl",children:[s.jsx("div",{className:"px-6 py-4 border-b border-white/10 bg-white/[0.01]",children:s.jsxs("h3",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-3",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full animate-pulse shadow-[0_0_8px_rgba(245,158,11,0.5)]"}),"Priorit√© Relance (",m.length,")"]})}),s.jsxs("table",{className:"w-full text-left border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-white/10 bg-white/[0.02]",children:[s.jsx("th",{className:"py-4 px-6 text-[9px] uppercase font-bold text-slate-500 tracking-widest",children:"Client Identity"}),s.jsx("th",{className:"py-4 px-6 text-[9px] uppercase font-bold text-slate-500 tracking-widest",children:"Potentiel"}),s.jsx("th",{className:"py-4 px-6 text-[9px] uppercase font-bold text-slate-500 tracking-widest text-right",children:"Last Interaction"}),s.jsx("th",{className:"py-4 px-6 text-[9px] uppercase font-bold text-slate-500 tracking-widest text-right",children:"Action"})]})}),s.jsx("tbody",{className:"divide-y divide-white/[0.03]",children:m.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:4,className:"p-8 text-center text-white/20 text-xs uppercase tracking-widest font-mono",children:"Aucun dossier √† relancer"})}):m.map(g=>{var T;const x=g.last_click||g.last_open||g.created_at,v=((T=g.clients)==null?void 0:T.phone)||g.phone||"N/A",S=(g.client_name||g.name||"CLIENT INCONNU").toUpperCase();return s.jsxs("tr",{className:"group hover:bg-white/[0.04] transition-all duration-300 ease-out",children:[s.jsx("td",{className:"py-4 px-6",children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("span",{className:"text-sm font-black text-slate-200 group-hover:text-white transition-colors tracking-wide uppercase",children:S}),s.jsx("span",{className:"text-[10px] font-mono text-white/30",children:v})]})}),s.jsx("td",{className:"py-4 px-6",children:s.jsxs("span",{className:"text-emerald-400 font-bold font-mono text-xs bg-emerald-500/10 px-2 py-1 rounded border border-emerald-500/20",children:[Math.round(g.total_price).toLocaleString("fr-FR")," ‚Ç¨"]})}),s.jsx("td",{className:"py-4 px-6 text-right",children:s.jsx("span",{className:"text-white/40 text-[10px] font-mono uppercase",children:(()=>{if(!x)return"N/A";const M=Math.floor((new Date().getTime()-new Date(x).getTime())/(1e3*60*60*24));return M===0?"Aujourd'hui":`il y a ${M}j`})()})}),s.jsx("td",{className:"py-4 px-6 text-right",children:s.jsx("button",{className:"bg-white/5 hover:bg-white/10 text-slate-300 text-[10px] font-bold uppercase tracking-widest px-4 py-2 rounded-lg border border-white/10 transition-all",children:"Lancer Appel"})})]},g.id)})})]})]})]}),s.jsxs("div",{className:"border-t border-white/5 pt-16 mt-16",children:[s.jsxs("header",{className:"mb-10",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Acquisition Control"}),s.jsx("h2",{className:"text-2xl font-black text-slate-100 tracking-tight mt-1 uppercase",children:"AXE C ‚Äî Leads Qualifi√©s jamais joints"}),s.jsxs("p",{className:"text-red-500/60 text-[10px] font-bold uppercase tracking-widest mt-2",children:["Priorit√© : ",s.jsx("span",{className:"font-mono",children:k.length})," Appels Recommand√©s"]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12",children:[s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-red-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Priorit√© Appel"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:k.length})]}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-amber-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Observation Active"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:C.length})]}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-8 rounded-xl border border-white/10 opacity-30",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest",children:"Interruption (Abandon)"}),s.jsx("p",{className:"text-3xl font-black text-slate-600 mt-1 font-mono",children:_.length})]})]}),s.jsxs("div",{className:"bg-[#0B0F14] rounded-xl border border-white/5 overflow-hidden shadow-2xl",children:[s.jsx("div",{className:"px-6 py-4 border-b border-white/5 bg-white/[0.01]",children:s.jsxs("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:["Priorit√© Appel (",k.length,")"]})}),s.jsx("div",{className:"divide-y divide-white/[0.03]",children:k.length===0?s.jsx("div",{className:"p-8 text-center text-slate-500 text-xs uppercase tracking-widest",children:"Aucun lead √† rappeler"}):k.map(g=>s.jsxs("div",{className:"p-6 flex items-center justify-between hover:bg-white/[0.02] transition-colors",children:[s.jsxs("div",{className:"w-[40%]",children:[s.jsx("p",{className:"text-white font-bold text-sm tracking-tight",children:g.client_name.toUpperCase()}),s.jsx("p",{className:"text-slate-500 text-xs mt-0.5",children:g.client_email})]}),s.jsxs("div",{className:"w-[30%] text-right",children:[s.jsx("p",{className:"text-slate-500 text-[9px] uppercase tracking-wider mb-1",children:"Derni√®re interaction"}),s.jsx("p",{className:"text-slate-300 font-mono text-xs",children:(()=>{if(!g.last_clicked_at)return"N/A";const x=Math.floor((new Date().getTime()-new Date(g.last_clicked_at).getTime())/(1e3*60*60*24));return x===0?"Aujourd'hui":`il y a ${x}j`})()})]}),s.jsx("div",{className:"w-[30%] flex justify-end",children:s.jsx("div",{className:"px-4 py-2 bg-red-500/5 rounded-lg border border-red-500/20",children:s.jsx("p",{className:"text-red-400 text-[10px] font-bold uppercase tracking-widest italic",children:"Intervention Recommand√©e"})})})]},g.id))})]})]})]})}function xm({data:e}){const t=e.securedCA+e.exposedCA+e.cancelledCA,n=t>0?e.securedCA/t*100:0,i=t>0?e.exposedCA/t*100:0,a=t>0?e.cancelledCA/t*100:0;return s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{className:"w-full h-10 bg-white/5 rounded-lg overflow-hidden flex border border-white/10 shadow-lg",children:[s.jsx("div",{style:{width:`${n}%`},className:"h-full bg-[#4ADE80] opacity-80 shadow-[inset_0_1px_2px_rgba(255,255,255,0.1)] transition-all duration-700",title:`S√©curis√©: ${e.securedCA.toLocaleString()}‚Ç¨`}),s.jsx("div",{style:{width:`${i}%`},className:"h-full bg-[#F59E0B] opacity-70 shadow-[inset_0_1px_2px_rgba(255,255,255,0.1)] transition-all duration-700",title:`Expos√©: ${e.exposedCA.toLocaleString()}‚Ç¨`}),s.jsx("div",{style:{width:`${a}%`},className:"h-full bg-[#F87171] opacity-60 shadow-[inset_0_1px_2px_rgba(255,255,255,0.1)] transition-all duration-700",title:`Annul√©: ${e.cancelledCA.toLocaleString()}‚Ç¨`})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-8 px-2",children:[s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-[#4ADE80]"}),s.jsx("span",{className:"text-xs font-bold text-white/40 uppercase tracking-[0.2em]",children:"S√©curis√©"})]}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsxs("span",{className:"text-2xl font-bold text-white/90 tabular-nums",children:[Math.round(n),"%"]}),s.jsxs("span",{className:"text-sm font-bold text-white/20 tracking-tight",children:["(",Math.round(e.securedCA/1e3),"k‚Ç¨)"]})]})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-[#F59E0B]"}),s.jsx("span",{className:"text-xs font-bold text-white/40 uppercase tracking-[0.2em]",children:"Expos√©"})]}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsxs("span",{className:"text-2xl font-bold text-white/90 tabular-nums",children:[Math.round(i),"%"]}),s.jsxs("span",{className:"text-sm font-bold text-white/20 tracking-tight",children:["(",Math.round(e.exposedCA/1e3),"k‚Ç¨)"]})]})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-[#F87171]"}),s.jsx("span",{className:"text-xs font-bold text-white/40 uppercase tracking-[0.2em]",children:"Annul√©"})]}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsxs("span",{className:"text-2xl font-bold text-white/90 tabular-nums",children:[Math.round(a),"%"]}),s.jsxs("span",{className:"text-sm font-bold text-white/20 tracking-tight",children:["(",Math.round(e.cancelledCA/1e3),"k‚Ç¨)"]})]})]})]})]})}const es={line:"#38BDF8",area:"#38BDF8",axis:"#ffffff20"},gm=({data:e,width:t,height:n})=>{if(t<10||n<10)return null;const i={top:20,right:30,bottom:50,left:60},a=Math.max(0,t-i.left-i.right),r=Math.max(0,n-i.top-i.bottom),o=N.useMemo(()=>Re({domain:[0,14],range:[0,a]}),[a]),l=N.useMemo(()=>Re({domain:[0,100],range:[r,0],nice:!0}),[r]),c=N.useMemo(()=>!e||!e.length?null:e.reduce((d,u)=>d.activeRate>u.activeRate?d:u),[e]);return s.jsx("svg",{width:t,height:n,children:s.jsxs(se,{left:i.left,top:i.top,children:[s.jsx("rect",{x:o(7),y:0,width:Math.max(0,o(14)-o(7)),height:r,fill:"#F59E0B",fillOpacity:.04}),s.jsx("line",{x1:o(7),y1:0,x2:o(7),y2:r,stroke:"#F59E0B",strokeWidth:1,strokeDasharray:"4,4",opacity:.3}),s.jsx("line",{x1:o(14),y1:0,x2:o(14),y2:r,stroke:"#F87171",strokeWidth:1,strokeDasharray:"4,4",opacity:.3}),s.jsx("text",{x:o(10.5),y:20,fill:"#F59E0B",fontSize:10,fontWeight:"700",textAnchor:"middle",className:"uppercase tracking-[0.2em] opacity-40 hover:opacity-100 transition-opacity",children:"Zone critique churn"}),s.jsx(Rt,{data:e,x:d=>o(d.day),y:d=>l(d.activeRate),yScale:l,fill:es.area,fillOpacity:.05,curve:_e}),s.jsx(ht,{data:e,x:d=>o(d.day),y:d=>l(d.activeRate),stroke:es.line,strokeWidth:4,strokeOpacity:.9,curve:_e}),c&&s.jsxs(se,{children:[s.jsx("circle",{cx:o(c.day),cy:l(c.activeRate),r:5,fill:"#F87171",className:"animate-pulse"}),s.jsx("text",{x:o(c.day),y:l(c.activeRate)-15,fill:"#F87171",fontSize:10,fontWeight:"bold",textAnchor:"middle",className:"font-sans uppercase tracking-widest",children:"Pic d√©crochage"})]}),s.jsx(xt,{top:r,scale:o,stroke:"transparent",tickStroke:es.axis,tickLabelProps:()=>({fill:"#ffffff20",fontSize:10,fontWeight:"bold",className:"font-sans",textAnchor:"middle"}),tickValues:[0,2,4,6,8,10,12,14],tickFormat:d=>`J+${d}`}),s.jsx(bs,{scale:l,stroke:"transparent",tickStroke:es.axis,tickLabelProps:()=>({fill:"#ffffff20",fontSize:10,fontWeight:"bold",className:"font-sans",textAnchor:"end",verticalAnchor:"middle",dx:-4}),tickValues:[0,25,50,75,100],tickFormat:d=>`${d}%`})]})})};function bm({data:e}){return s.jsx("div",{style:{width:"100%",height:"350px"},children:s.jsx(gt,{children:({width:t,height:n})=>s.jsx(gm,{data:e,width:t,height:n})})})}const ym=({leads:e,visited:t,signed:n,waitingSignatureStudies:i=[],waitingDepositStudies:a=[],secured:r,securedAmount:o=0})=>{const l=Math.max(e,1),c=t?Math.round(n/t*100):0,d=e?Math.round(t/e*100):0,u=e?Math.round(n/e*100):0,p=Math.max(0,e-t),h=i.length,f=a.length,m=r,y=e>0,b=e?t/e*100:0,w=t?n/t*100:0,j=n?r/n*100:0,k=Math.min(b,w,j)===b?"Qualification":Math.min(b,w,j)===w?"Closing":"Administratif";return s.jsxs("div",{className:"w-full space-y-12",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-end gap-6 border-l-4 border-emerald-500 pl-8 py-2",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-[9px] tracking-[0.4em] text-emerald-400 font-black uppercase",children:"S03 ‚Äî Pipeline Momentum"}),s.jsx("h1",{className:"text-4xl font-black text-white tracking-tight uppercase",children:"Trajectoire Dossiers"}),s.jsx("p",{className:"text-white/40 text-[10px] uppercase font-bold tracking-widest",children:"Donn√©es d√©doublonn√©es par email ¬∑ 1 Email = 1 Dossier"})]}),s.jsxs("div",{className:"flex gap-12",children:[s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-4xl font-black text-white font-mono tracking-tighter tabular-nums",children:e}),s.jsx("div",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-widest",children:"Leads Entrants"})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-4xl font-black text-emerald-400 font-mono tracking-tighter tabular-nums",children:o>0?`${Math.round(o/1e3)}k‚Ç¨`:r}),s.jsx("div",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-widest",children:"Valeur Encaiss√©e"})]})]})]}),s.jsx("div",{className:"relative bg-black/60 rounded-[2.5rem] p-12 border border-white/5 shadow-2xl backdrop-blur-xl overflow-hidden",children:y?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"relative h-6 mb-2 flex",children:[s.jsx("div",{style:{width:`${m/l*100}%`},className:"relative",children:s.jsx("span",{className:"absolute right-0 bottom-0 text-[10px] font-black text-emerald-400 uppercase translate-x-1/2",children:m})}),s.jsx("div",{style:{width:`${f/l*100}%`},className:"relative",children:s.jsx("span",{className:"absolute right-0 bottom-0 text-[10px] font-black text-white/40 uppercase translate-x-1/2",children:n})}),s.jsx("div",{style:{width:`${h/l*100}%`},className:"relative",children:s.jsx("span",{className:"absolute right-0 bottom-0 text-[10px] font-black text-white/30 uppercase translate-x-1/2",children:t})}),s.jsx("div",{style:{width:`${p/l*100}%`},className:"relative",children:s.jsx("span",{className:"absolute right-0 bottom-0 text-[10px] font-black text-white/20 uppercase",children:e})})]}),s.jsxs("div",{className:"relative h-20 mb-12 flex gap-1 items-center",children:[s.jsxs("div",{className:"h-full bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-l-2xl relative group transition-all duration-700",style:{width:`${Math.max(m/l*100,2)}%`},children:[s.jsx("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"}),s.jsx("div",{className:"absolute -top-8 left-0 text-[8px] font-black text-emerald-400 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all",children:"S√âCURIS√â"})]}),s.jsxs("div",{className:"h-2/3 bg-white/10 border border-white/10 relative group transition-all duration-700",style:{width:`${f/l*100}%`},children:[s.jsx("div",{className:"absolute inset-0 bg-orange-500/10 opacity-0 group-hover:opacity-100 transition-opacity"}),f>0&&s.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-black text-white/20",children:["-",f]}),s.jsx("div",{className:"absolute -top-8 left-0 text-[8px] font-black text-white/40 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all whitespace-nowrap",children:"ATTENTE ACOMPTE"})]}),s.jsxs("div",{className:"h-1/2 bg-white/5 border border-white/5 relative group transition-all duration-700",style:{width:`${h/l*100}%`},children:[s.jsx("div",{className:"absolute inset-0 bg-blue-500/5 opacity-0 group-hover:opacity-100 transition-opacity"}),h>0&&s.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-black text-white/10",children:["-",h]}),s.jsx("div",{className:"absolute -top-8 left-0 text-[8px] font-black text-white/30 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all whitespace-nowrap",children:"VISIT√â ¬∑ SANS CONTRAT"})]}),s.jsxs("div",{className:"h-1/4 bg-white/[0.02] border border-white/[0.02] rounded-r-2xl relative group transition-all duration-700",style:{width:`${p/l*100}%`},children:[s.jsx("div",{className:"absolute inset-0 bg-slate-500/[0.02] opacity-0 group-hover:opacity-100 transition-opacity"}),p>0&&s.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-black text-white/[0.05]",children:["-",p]}),s.jsx("div",{className:"absolute -top-8 right-0 text-[8px] font-black text-white/20 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all whitespace-nowrap",children:"LEADS BRUTS"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-12",children:[s.jsx(Ws,{label:"Qualit√© Commerciale",rate:c,lostLabel:"Visites sans contrat",loss:h,color:"text-emerald-400",subLabel:"Sign√©s / Total Visites"}),s.jsx(Ws,{label:"P√©n√©tration Prospect",rate:d,lostLabel:"Leads sans Dossier",loss:p,color:"text-cyan-400",subLabel:"Dossiers / Total Leads"}),s.jsx(Ws,{label:"Conversion Totale",rate:u,lostLabel:"Dossiers non sign√©s",loss:p+h,color:"text-white",subLabel:"Sign√©s / Total Leads"})]})]}):s.jsx("div",{className:"h-32 flex items-center justify-center text-white/20 uppercase font-black tracking-widest italic",children:"Aucune donn√©e de pipeline disponible"})}),s.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsx(ts,{label:"Conversion Vente",value:`${c}%`,color:"text-emerald-400",sub:"Sign√©s vs Visit√©s"}),s.jsx(ts,{label:"Taux P√©n√©tration",value:`${d}%`,color:"text-sky-400",sub:"Visit√©s vs Leads"}),s.jsx(ts,{label:"Bottleneck",value:k,color:"text-orange-400",sub:"Point critique",isTextValue:!0}),s.jsx(ts,{label:"En Attente",value:h+f,color:"text-white",sub:"Dossiers √† d√©bloquer",hoverList:[...i,...a]})]})]})},Ws=({label:e,rate:t,loss:n,lostLabel:i,color:a,subLabel:r})=>s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-baseline",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[10px] font-black text-white uppercase tracking-[0.2em]",children:e}),s.jsx("span",{className:"text-[9px] font-bold text-white/40 uppercase",children:r})]}),s.jsxs("span",{className:`text-3xl font-black font-mono tracking-tighter ${a}`,children:[t,"%"]})]}),s.jsx("div",{className:"h-1 bg-white/5 rounded-full overflow-hidden",children:s.jsx("div",{className:`h-full ${a.replace("text-","bg-")} opacity-60 transition-all duration-1000`,style:{width:`${t}%`}})}),s.jsx("div",{className:"flex flex-col gap-1",children:s.jsxs("span",{className:"text-[10px] font-mono text-red-500/60 font-bold uppercase tracking-wider tabular-nums",children:["-",n," ",i]})})]}),ts=({label:e,value:t,color:n,sub:i,isTextValue:a=!1,hoverList:r})=>s.jsxs("div",{className:"bg-black/40 rounded-3xl p-6 border border-white/5 hover:border-white/20 transition-all duration-300 shadow-lg group relative",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("div",{className:"text-[10px] text-white/30 uppercase font-black tracking-widest mb-1",children:e}),s.jsx("div",{className:"text-[9px] text-white/20 uppercase font-bold tracking-widest mb-4",children:i})]}),s.jsx("div",{className:`${a?"text-xl":"text-3xl"} font-black font-mono tracking-tighter ${n} truncate transition-transform duration-300 group-hover:scale-105 origin-left`,children:t}),r&&r.length>0&&s.jsxs("div",{className:"absolute bottom-full left-0 mb-4 w-64 bg-[#0a0e27] border border-white/10 rounded-2xl p-4 shadow-2xl opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity z-50",children:[s.jsx("div",{className:"text-[8px] font-black text-white/30 uppercase tracking-[0.2em] mb-4 border-b border-white/5 pb-2",children:"D√©tail des dossiers"}),s.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2 pr-2 custom-scrollbar",children:r.map((o,l)=>s.jsxs("div",{className:"flex justify-between items-center gap-4",children:[s.jsx("span",{className:"text-[10px] font-black text-white truncate uppercase",children:o.name||"Inconnu"}),s.jsx("span",{className:"text-[8px] font-bold text-white/20 uppercase px-2 py-0.5 bg-white/5 rounded-full",children:o.status==="signed"?"Attente ‚Ç¨":"Attente Signature"})]},l))})]})]}),De={secured:"#4ADE80",projected:"#38BDF8",target:"#ffffff",axis:"#ffffff10"},vm=({data:e,width:t,height:n})=>{if(t<10||n<10)return null;const i={top:40,right:30,bottom:50,left:70},a=Math.max(0,t-i.left-i.right),r=Math.max(0,n-i.top-i.bottom),o=N.useMemo(()=>qs({domain:yl(e,d=>d.date),range:[0,a]}),[e,a]),l=N.useMemo(()=>Re({domain:[0,vl(e,d=>Math.max(d.projected,d.target))||1e6],nice:!0,range:[r,0]}),[e,r]),c=e[e.length-1];return s.jsx("svg",{width:t,height:n,children:s.jsxs(se,{left:i.left,top:i.top,children:[s.jsx(Rt,{data:e,x:d=>o(d.date),y:d=>l(d.secured),yScale:l,fill:De.secured,fillOpacity:.05,curve:_e}),s.jsx(Rt,{data:e,x:d=>o(d.date),y0:d=>l(d.secured),y1:d=>l(d.projected),yScale:l,fill:De.projected,fillOpacity:.03,curve:_e}),s.jsx(ht,{data:e,x:d=>o(d.date),y:d=>l(d.projected),stroke:De.projected,strokeWidth:1,strokeDasharray:"4 4",strokeOpacity:.2,curve:_e}),s.jsx(ht,{data:e,x:d=>o(d.date),y:d=>l(d.target),stroke:De.target,strokeWidth:2,strokeDasharray:"6,4",strokeOpacity:.6,curve:_e}),s.jsx(ht,{data:e,x:d=>o(d.date),y:d=>l((d.secured+d.projected)/2),stroke:De.projected,strokeWidth:4,strokeOpacity:.9,curve:_e}),c&&s.jsxs(se,{children:[s.jsx("circle",{cx:o(c.date),cy:l((c.secured+c.projected)/2),r:6,fill:De.projected,className:"animate-pulse"}),s.jsx("text",{x:o(c.date),y:l((c.secured+c.projected)/2)-15,fill:De.projected,fontSize:10,fontWeight:"black",textAnchor:"end",className:"font-mono uppercase tracking-widest",children:"Atterrissage projet√©"})]}),c&&s.jsx("text",{x:a,y:l(c.target)-12,fill:"white",fontSize:10,fontWeight:"black",textAnchor:"end",className:"uppercase tracking-widest opacity-40 font-sans",children:"Objectif Board Q2"}),s.jsx(xt,{top:r,scale:o,stroke:"transparent",tickStroke:De.axis,tickLabelProps:()=>({fill:"#64748b",fontSize:10,fontWeight:"bold",className:"font-mono",textAnchor:"middle"})}),s.jsx(bs,{scale:l,stroke:"transparent",tickStroke:De.axis,tickLabelProps:()=>({fill:"#64748b",fontSize:10,fontWeight:"bold",className:"font-mono",textAnchor:"end",verticalAnchor:"middle",dx:-5}),tickFormat:d=>`${Math.round(d/1e3)}k`,tickValues:[0,25e4,5e5,75e4,1e6]})]})})};function wm({data:e}){return!e||e.length===0?null:s.jsx("div",{style:{width:"100%",height:"350px"},children:s.jsx(gt,{children:({width:t,height:n})=>s.jsx(vm,{data:e,width:t,height:n})})})}function jm({studies:e}){var a;const t=N.useMemo(()=>e.filter(r=>r.status==="cancelled"||r.status==="refused"),[e]),n=N.useMemo(()=>{const r={"Ignor√© (Avant Vue)":0,"Refus√© (Apr√®s Vue)":0,"R√©tractation (Post-Sign)":0},o={"Ignor√© (Avant Vue)":"#64748b","Refus√© (Apr√®s Vue)":"#f97316","R√©tractation (Post-Sign)":"#ef4444","Trop cher / Budget":"#eab308","Raison Technique / Toiture":"#8b5cf6","Concurrent moins cher":"#f43f5e","Refus Client / Ne r√©pond plus":"#f97316","Projet Abandonn√©":"#64748b","Erreur de saisie / Doublon":"#10b981"};return t.forEach(l=>{var d;const c=(d=l.study_data)==null?void 0:d.cancellation_reason;c?r[c]=(r[c]||0)+1:l.signed_at?r["R√©tractation (Post-Sign)"]++:l.views>0?r["Refus√© (Apr√®s Vue)"]++:r["Ignor√© (Avant Vue)"]++}),Object.entries(r).map(([l,c])=>({label:l,value:c,color:o[l]||"#94a3b8"})).filter(l=>l.value>0).sort((l,c)=>c.value-l.value)},[t]),i=t.length;return s.jsxs("div",{className:"flex flex-col md:flex-row gap-8 items-center",children:[s.jsx("div",{className:"w-full md:w-1/3 h-[250px] relative",children:s.jsx(lr,{children:({width:r,height:o})=>{const l=Math.min(r,o)/2,c=o/2,d=r/2;return s.jsx("svg",{width:r,height:o,children:s.jsxs(se,{top:c,left:d,children:[s.jsx(Pl,{data:n,pieValue:u=>u.value,outerRadius:l,innerRadius:l-40,cornerRadius:3,padAngle:.02,children:u=>u.arcs.map((p,h)=>{const[f,m]=u.path.centroid(p),{label:y,value:b,color:w}=p.data;return s.jsxs("g",{children:[s.jsx("path",{d:u.path(p)||"",fill:w}),s.jsx("text",{x:f,y:m,dy:".33em",fill:"#ffffff",fontSize:10,textAnchor:"middle",fontWeight:"bold",children:b})]},`arc-${y}-${h}`)})}),s.jsx(bi,{verticalAnchor:"middle",textAnchor:"middle",fill:"#fff",fontSize:24,fontWeight:"bold",children:i}),s.jsx(bi,{y:20,verticalAnchor:"middle",textAnchor:"middle",fill:"#94a3b8",fontSize:10,fontWeight:"bold",letterSpacing:1,children:"PERDUS"})]})})}})}),s.jsxs("div",{className:"w-full md:w-2/3 space-y-6",children:[s.jsx("h3",{className:"text-xl font-black text-white uppercase tracking-tight",children:"R√©partition des √âchecs"}),s.jsx("p",{className:"text-sm text-slate-400",children:"Analyse automatique bas√©e sur le stade d'avancement du dossier au moment de l'annulation."}),s.jsx("div",{className:"space-y-3",children:n.map(r=>s.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-white/5 border border-white/5",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:r.color}}),s.jsx("span",{className:"text-sm font-bold text-slate-200",children:r.label})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"text-xs font-mono text-slate-500",children:[Math.round(r.value/i*100),"%"]}),s.jsx("span",{className:"text-lg font-black text-white",children:r.value})]})]},r.label))}),s.jsx("div",{className:"p-4 rounded-xl bg-blue-500/10 border border-blue-500/20",children:s.jsxs("p",{className:"text-xs text-blue-300 leading-relaxed",children:[s.jsx("span",{className:"font-bold uppercase",children:"Conseil :"}),((a=n.find(r=>r.label.includes("Post-Sign")))==null?void 0:a.value)>0?"Le taux de r√©tractation est critique. V√©rifiez le discours commercial post-signature.":"La majorit√© des pertes survient avant lecture. Am√©liorez l'objet des emails."]})})]})]})}function Nm({system:e}){const{studies:t,financialStats:n,emailLeads:i,metrics:a}=e,r=N.useMemo(()=>({securedCA:n.cashSecured||0,exposedCA:n.cashAtRisk||0,cancelledCA:n.cashLost||n.totalPotentialCA*.1||5e4}),[n]),o=N.useMemo(()=>{if(!i||i.length===0)return Array.from({length:15}).map((h,f)=>({day:f,activeRate:0}));const d=new Date,u=new Array(15).fill(0);i.forEach(h=>{const f=[h.last_opened_at,h.last_clicked_at,h.created_at].filter(Boolean).map(m=>new Date(m)).sort((m,y)=>y.getTime()-m.getTime())[0];if(f){const m=Math.floor((d.getTime()-f.getTime())/864e5);m<15&&u[m]++}});const p=i.length;return u.map((h,f)=>({day:f,activeRate:Math.round(h/p*100)}))},[i]),l=N.useMemo(()=>{const d=new Map;t.forEach(j=>{if(!d.has(j.email))d.set(j.email,j);else{const k=d.get(j.email);(j.status==="signed"||j.deposit_paid)&&!(k.status==="signed"||k.deposit_paid)&&d.set(j.email,j)}});const p=Array.from(d.values()).filter(j=>j.status!=="cancelled"),h=p.length,f=p.filter(j=>j.status==="signed"||j.deposit_paid),m=f.length,y=p.filter(j=>j.status!=="signed"&&!j.deposit_paid),b=f.filter(j=>!j.deposit_paid&&(j.payment_mode==="cash"||j.financing_mode==="with_deposit"||j.financing_mode==="partial_financing")),w=f.filter(j=>j.deposit_paid||j.financing_mode==="full_financing").length;return{leads:(i==null?void 0:i.length)||0,visited:h,signed:m,waitingSignatureStudies:y,waitingDepositStudies:b,secured:w,securedAmount:(n==null?void 0:n.cashSecured)||0}},[i,t,n]),c=N.useMemo(()=>{const d=[],u=new Date,p=n.cashSecured||0,h=(n.cashAtRisk||0)*.5+(n.totalPotentialCA||0)*.2,f=p+h*1.2;for(let m=0;m<=90;m+=10){const y=new Date(u);y.setDate(y.getDate()+m);const b=m/90;d.push({date:y,secured:p,projected:p+h*b,target:f})}return d},[n]);return s.jsxs("div",{className:"flex flex-col gap-12 py-8 px-4 w-full h-full pb-40",children:[s.jsxs("header",{className:"flex flex-col gap-2",children:[s.jsx("h1",{className:"text-4xl font-black text-white tracking-tight uppercase",children:"Salle de Navigation"}),s.jsx("p",{className:"text-slate-500 text-[10px] font-bold uppercase tracking-widest",children:"Vision Dirigeant & Trajectoire Strat√©gique"})]}),s.jsxs("section",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 space-y-12 shadow-2xl",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-12",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"S01 ‚Äî ANALYSE DE TR√âSORERIE"}),s.jsx("h2",{className:"text-4xl font-black text-white uppercase tracking-tight",children:"Niveau de s√©curisation du CA"}),s.jsxs("div",{className:"flex items-center gap-6 mt-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.3)] animate-pulse"}),s.jsx("span",{className:"text-lg font-bold text-white/70",children:"60% S√©curis√©"}),s.jsx("span",{className:"text-sm font-bold text-emerald-400",children:"(+3.2 pts)"})]}),s.jsx("div",{className:"h-6 w-[2px] bg-white/5"}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("span",{className:"text-lg font-bold text-slate-500",children:"Objectif : 70%"})})]})]}),s.jsxs("div",{className:"text-left md:text-right",children:[s.jsxs("div",{className:"flex items-baseline md:justify-end gap-3",children:[s.jsx("span",{className:"text-6xl font-black text-white tracking-tighter tabular-nums font-mono drop-shadow-2xl",children:(n.cashSecured||0).toLocaleString()}),s.jsx("span",{className:"text-2xl font-bold text-white/10",children:"‚Ç¨"})]}),s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest block mt-2",children:"CASH NET S√âCURIS√â"})]})]}),s.jsx("div",{className:"pt-6",children:s.jsx(xm,{data:r})}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-xl border border-white/10 p-8 rounded-2xl flex items-start gap-6 transition-all hover:border-white/20",children:[s.jsx("div",{className:"w-1.5 h-full bg-blue-500 rounded-full shadow-[0_0_15px_rgba(59,130,246,0.3)] min-h-[50px]"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[10px] font-bold text-blue-400 uppercase tracking-widest",children:"Insight Strat√©gique"}),s.jsxs("p",{className:"text-sm text-slate-300 font-medium leading-relaxed max-w-3xl",children:[s.jsx("span",{className:"text-white font-bold text-base",children:"ALERTE SEGMENT :"})," 28% de l'exposition r√©side dans le segment ",s.jsx("span",{className:"text-orange-400 font-bold",children:"√âtudes Complexes"}),". Une s√©curisation des acomptes sur ce p√©rim√®tre permettrait d'atteindre l'objectif de 70% d'ici 14 jours."]})]})]})]}),s.jsxs("div",{className:"flex flex-col gap-12",children:[s.jsxs("section",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 space-y-10 shadow-xl",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start gap-8",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"S02 ‚Äî MOMENT CRITIQUE CHURN"}),s.jsx("h2",{className:"text-3xl font-black text-white uppercase tracking-tight",children:"Moment critique de d√©crochage"}),s.jsx("p",{className:"text-[10px] font-bold text-orange-400 uppercase tracking-widest",children:"70% des annulations se pr√©parent apr√®s J+7"})]}),s.jsxs("div",{className:"flex flex-col md:items-end gap-1",children:[s.jsx("span",{className:"text-3xl font-black text-white font-mono tabular-nums tracking-tighter uppercase",children:"8.2 JOURS"}),s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"D√âLAI MOYEN AVANT D√âCROCHAGE"})]})]}),s.jsx("div",{className:"py-4",children:s.jsx(bm,{data:o})}),s.jsxs("div",{className:"bg-black/40 border border-orange-500/20 p-6 rounded-2xl flex items-start gap-4",children:[s.jsx("div",{className:"w-1 h-full bg-orange-500 rounded-full opacity-40 min-h-[40px]"}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-[10px] font-bold text-orange-400 uppercase tracking-widest",children:"Action Recommand√©e"}),s.jsxs("p",{className:"text-sm text-slate-300 leading-relaxed",children:[s.jsx("span",{className:"text-white font-bold",children:"INTERVENTION PROACTIVE :"})," Le pic de d√©crochage se situe √† ",s.jsx("span",{className:"text-white font-bold font-mono",children:"J+8"}),". D√©clenchement automatique d'un call de courtoisie √† ",s.jsx("span",{className:"text-white font-bold font-mono",children:"J+4"})," pour valider l'onboarding."]})]})]})]}),s.jsx("section",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 shadow-xl",children:s.jsx(ym,{leads:l.leads,visited:l.visited,signed:l.signed,waitingSignatureStudies:l.waitingSignatureStudies,waitingDepositStudies:l.waitingDepositStudies,secured:l.secured,securedAmount:l.securedAmount})})]}),s.jsxs("section",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 space-y-12 shadow-2xl",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-12",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"S04 ‚Äî TRAJECTOIRE FINANCI√àRE"}),s.jsx("h2",{className:"text-4xl font-black text-white uppercase tracking-tight",children:"Atterrissage √† 90 Jours"}),s.jsxs("div",{className:"flex flex-wrap items-center gap-6 mt-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.3)] animate-pulse"}),s.jsx("span",{className:"text-lg font-bold text-white/70",children:"Probabilit√© d'atteinte"}),s.jsx("span",{className:"text-lg font-black text-red-500 font-mono tracking-tighter",children:"38%"})]}),s.jsx("div",{className:"h-6 w-[2px] bg-white/5"}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("span",{className:"text-lg font-bold text-slate-500 italic",children:'"Objectif manqu√© fin avril"'})})]})]}),s.jsxs("div",{className:"text-left md:text-right",children:[s.jsx("div",{className:"flex items-baseline md:justify-end gap-3",children:s.jsx("span",{className:"text-7xl font-black text-red-500 font-mono tracking-tighter tabular-nums drop-shadow-2xl font-mono",children:"-122k‚Ç¨"})}),s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest block mt-2",children:"D√âFICIT PROJET√â vs BOARD"})]})]}),s.jsx("div",{className:"py-2",children:s.jsx(wm,{data:c})}),s.jsxs("div",{className:"bg-black/40 border border-red-500/20 p-8 rounded-2xl flex items-start gap-6 transition-all hover:border-red-500/30",children:[s.jsx("div",{className:"w-1.5 h-full bg-red-500 rounded-full opacity-40 min-h-[50px]"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[10px] font-bold text-red-400 uppercase tracking-widest",children:"Alerte Gouvernance"}),s.jsxs("p",{className:"text-sm text-slate-300 leading-relaxed max-w-3xl",children:[s.jsx("span",{className:"text-white font-bold text-base uppercase tracking-tight",children:"Action Corrective :"})," L'objectif Board est atteignable avec ",s.jsx("span",{className:"text-white font-bold font-mono",children:"+12 signatures"})," ou une am√©lioration de ",s.jsx("span",{className:"text-emerald-400 font-bold font-mono",children:"+6%"})," de la conversion du pipeline. Priorit√© absolue sur les dossiers √† ",">","50k‚Ç¨."]})]})]})]}),s.jsxs("section",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 space-y-12 shadow-2xl",children:[s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"S05 ‚Äî POST-MORTEM & REFUS"}),s.jsx("h2",{className:"text-4xl font-black text-white uppercase tracking-tight",children:"Pourquoi perd-on des affaires ?"})]}),s.jsx("div",{className:"bg-black/40 rounded-2xl p-8 border border-white/5",children:s.jsx(jm,{studies:t})})]})]})}const Sm=({data:e,width:t,height:n,benchmarkPercentage:i=42})=>{const[a,r]=N.useState(null),o={top:60,right:30,bottom:80,left:30},l=Math.max(0,t-o.left-o.right),c=Math.max(0,n-o.top-o.bottom),d=N.useMemo(()=>jn({domain:e.map(h=>h.label),range:[0,l],padding:.25}),[e,l]),u=Math.max(...e.map(h=>h.value),1),p=N.useMemo(()=>Re({domain:[0,u],range:[c,10]}),[u,c]);return s.jsxs("div",{className:"relative group/funnel",children:[s.jsx("svg",{width:t,height:n,className:"overflow-visible",children:s.jsxs(se,{left:o.left,top:o.top,children:[i&&s.jsxs(se,{top:c*(1-i/100),children:[s.jsx("line",{x1:0,x2:l,stroke:"#4ECDC4",strokeWidth:1,strokeDasharray:"4,4",opacity:.15}),s.jsxs("text",{x:l,y:-5,fill:"#4ECDC4",fontSize:9,fontWeight:"black",textAnchor:"end",className:"uppercase tracking-widest opacity-40",children:["Target ",i,"%"]})]}),e.map((h,f)=>{const m=d.bandwidth(),y=d(h.label)||0,b=Math.max(50,c-p(h.value)),w=c-b,j=h.isFriction,k=f>0?e[f-1].value:null,C=k?Math.round(h.value/k*100):null;return s.jsxs(se,{onMouseEnter:()=>r(f),onMouseLeave:()=>r(null),className:"cursor-pointer",children:[C!==null&&s.jsxs(se,{left:y-d.step()*d.padding()/2,children:[s.jsxs("text",{y:c-20,textAnchor:"middle",fill:j?"#FF6B6B":"white",opacity:j?1:.6,fontSize:14,fontWeight:"900",fontFamily:"IBM Plex Mono",children:[C,"%"]}),s.jsx("path",{d:"M -5 10 L 0 15 L 5 10",fill:"none",stroke:j?"#FF6B6B":"white",strokeWidth:2,opacity:j?1:.3,transform:`translate(0, ${c-45})`})]}),s.jsx("rect",{x:y,y:w,width:m,height:b,fill:j?"url(#frictionGradient)":h.color,fillOpacity:a===f?.9:.7,stroke:j?"#FF6B6B":"white",strokeOpacity:a===f?1:.4,strokeWidth:j?3:1,rx:6,className:"transition-all duration-300"}),s.jsx("text",{x:y+m/2,y:w-8,fill:"white",fontSize:11,fontWeight:"bold",fontFamily:"IBM Plex Mono",textAnchor:"middle",opacity:.4,children:h.value}),s.jsxs("text",{x:y+m/2,y:w+b/2+6,fill:"white",opacity:.95,fontSize:b>80?18:16,fontWeight:"black",fontFamily:"IBM Plex Mono",textAnchor:"middle",style:{filter:"drop-shadow(0px 2px 8px rgba(0,0,0,0.95))"},children:[Math.round(h.revenue/1e3),"k‚Ç¨"]}),h.avgDelay!==void 0&&h.avgDelay>0&&s.jsx(se,{top:c+16,left:y+m/2,children:s.jsxs("text",{fill:h.avgDelay>7?"#FF6B6B":"white",opacity:.6,fontSize:11,fontWeight:"black",textAnchor:"middle",children:[h.avgDelay,"j"]})}),s.jsx("text",{x:y+m/2,y:c+48,fill:"white",opacity:a===f?1:.3,fontSize:12,fontWeight:"900",className:"uppercase tracking-[0.2em]",textAnchor:"middle",children:h.label})]},`step-${f}`)}),s.jsx("defs",{children:s.jsxs("linearGradient",{id:"frictionGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[s.jsx("stop",{offset:"0%",stopColor:"#FF6B6B",stopOpacity:.8}),s.jsx("stop",{offset:"100%",stopColor:"#E63946",stopOpacity:.3})]})})]})}),a!==null&&s.jsx("div",{className:"absolute z-50 pointer-events-none bg-[#1a1c23] border border-white/20 p-4 rounded-xl shadow-2xl backdrop-blur-xl animate-in fade-in zoom-in duration-200",style:{left:d(e[a].label)+o.left+d.bandwidth()/2,top:o.top+(c-Math.max(25,c-p(e[a].value)))-100,transform:"translateX(-50%)"},children:s.jsxs("div",{className:"flex flex-col gap-1 min-w-[140px]",children:[s.jsx("div",{className:"text-[10px] font-black text-white/30 uppercase tracking-widest",children:e[a].label}),s.jsxs("div",{className:"flex justify-between items-baseline gap-4 mt-2",children:[s.jsx("span",{className:"text-2xl font-black text-white font-mono",children:e[a].value}),s.jsx("span",{className:"text-xs font-bold text-white/40 uppercase",children:"Dossiers"})]}),s.jsxs("div",{className:"text-lg font-black text-emerald-400 font-mono",children:[Math.round(e[a].revenue/1e3),"k‚Ç¨ ",s.jsx("span",{className:"text-[10px] text-white/20 uppercase tracking-tighter",children:"Volume"})]}),a>0&&s.jsxs("div",{className:"mt-2 pt-2 border-t border-white/5 flex justify-between items-center",children:[s.jsx("span",{className:"text-[9px] font-bold text-white/30 uppercase",children:"Efficience"}),s.jsxs("span",{className:"text-sm font-black text-white",children:[Math.round(e[a].value/e[a-1].value*100),"%"]})]})]})})]})};function km({data:e,benchmarkPercentage:t}){return!e||e.length===0?null:s.jsx("div",{style:{width:"100%",height:"320px"},className:"relative",children:s.jsx(gt,{children:({width:n,height:i})=>s.jsx(Sm,{data:e,width:n,height:i,benchmarkPercentage:t})})})}const _m=({data:e,autopilotIndex:t,width:n,height:i})=>{const a={top:40,right:30,bottom:40,left:30},r=Math.max(0,n-a.left-a.right),o=Math.max(0,i-a.top-a.bottom),l=N.useMemo(()=>jn({domain:e.map(u=>u.label),range:[0,r],padding:.3}),[e,r]),c=Math.max(...e.map(u=>Math.max(u.value,u.target||0)),1),d=N.useMemo(()=>Re({domain:[0,c*1.1],range:[o,0]}),[c,o]);return s.jsxs("svg",{width:n,height:i,className:"overflow-visible",children:[s.jsx("defs",{children:s.jsxs("linearGradient",{id:"emeraldGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[s.jsx("stop",{offset:"0%",stopColor:"#10B981",stopOpacity:.8}),s.jsx("stop",{offset:"100%",stopColor:"#059669",stopOpacity:.3})]})}),s.jsxs(se,{left:a.left,top:a.top,children:[s.jsx(se,{children:e.map((u,p)=>{if(p===0||!u.target)return null;const h=e[p-1];return h.target?s.jsx("line",{x1:(l(h.label)||0)+l.bandwidth()/2,y1:d(h.target),x2:(l(u.label)||0)+l.bandwidth()/2,y2:d(u.target),stroke:"white",strokeOpacity:.15,strokeWidth:1,strokeDasharray:"4,4"},`target-line-${p}`):null})}),t<e.length&&s.jsxs(se,{left:l(e[t].label)||0,children:[s.jsx("line",{y1:-20,y2:o,stroke:"white",strokeOpacity:.2,strokeWidth:1,strokeDasharray:"4,2"}),s.jsx("text",{y:-25,fill:"white",opacity:.3,fontSize:8,fontWeight:"black",className:"uppercase tracking-widest text-[7px]",children:"D√©marrage Autopilote"})]}),e.map((u,p)=>{const h=l.bandwidth(),f=l(u.label)||0,m=d(u.value),y=Math.max(2,o-m),b=p>=t;return s.jsxs(se,{children:[s.jsx("rect",{x:f,y:m,width:h,height:y,fill:b?"url(#emeraldGradient)":"white",fillOpacity:b?.9:.15,rx:4,className:"transition-all duration-500"}),s.jsxs("text",{x:f+h/2,y:m-8,fill:"white",opacity:b?1:.3,fontSize:9,fontWeight:"black",fontFamily:"IBM Plex Mono",textAnchor:"middle",children:[Math.round(u.value/1e3),"k"]})]},`revenue-bar-${p}`)}),s.jsx(xt,{top:o,scale:l,stroke:"transparent",tickStroke:"transparent",tickLabelProps:()=>({fill:"#ffffff20",fontSize:9,fontFamily:"IBM Plex Mono",textAnchor:"middle",fontWeight:"bold",className:"uppercase tracking-[0.2em]"})})]})]})};function Cm({data:e,autopilotIndex:t}){return!e||e.length===0?null:s.jsx("div",{style:{width:"100%",height:"280px"},children:s.jsx(gt,{children:({width:n,height:i})=>s.jsx(_m,{data:e,autopilotIndex:t,width:n,height:i})})})}function Am({system:e}){const{studies:t,metrics:n,financialStats:i,emailLeads:a}=e,r=N.useMemo(()=>{const h=new Map;return t.forEach(f=>{if(!h.has(f.email))h.set(f.email,f);else{const m=h.get(f.email);(f.status==="signed"||f.deposit_paid)&&!(m.status==="signed"||m.deposit_paid)&&h.set(f.email,f)}}),Array.from(h.values()).filter(f=>f.status!=="cancelled")},[t]),o=N.useMemo(()=>r.filter(h=>h.status==="signed"||h.deposit_paid).length,[r]),l=N.useMemo(()=>{const h=(a==null?void 0:a.length)||1,f=r.length,m=r.filter(O=>O.views>0).length,y=r.filter(O=>(O.clicks||0)>0).length,b=o,w=h>0?f/h*100:0,j=f>0?m/f*100:0,k=m>0?y/m*100:0,C=y>0?b/y*100:0,_=f>0?b/f*100:0,g=42,x=-6,v=[{label:"QUALIF",rate:w,actual:w,from:"Leads",to:"Dossiers",target:90,input:h},{label:"OUVERTURE",rate:j,actual:j,from:"Dossiers",to:"Ouvertures",target:85,input:f},{label:"CLIC",rate:k,actual:k,from:"Ouvertures",to:"Clics",target:50,input:m},{label:"CLOSING",rate:C,actual:C,from:"Clics",to:"Sign√©s",target:50,input:y}],S=v.reduce((O,X)=>X.rate/X.target<O.rate/O.target?X:O,v[0]),T=S.rate<S.target*.7,M=o>0?i.caTotal/o:28e3,P=S.target-S.actual,V=Math.round(S.input*(P/100));let A=1;S.label==="QUALIF"?A=(m/f||0)*(y/m||0)*(b/y||0):S.label==="OUVERTURE"?A=(y/m||0)*(b/y||0):S.label==="CLIC"&&(A=b/y||0);const F=Math.round(V*A*M),ae=F>15e3?`Potentiel de ${Math.round(F/1e3)}k‚Ç¨/mois en optimisant ${S.from} ‚Üí ${S.to}.`:"Pipeline performant. Focus sur l'optimisation continue.",W=()=>S.label==="QUALIF"?"Augmenter la qualification des leads entrants.":S.label==="OUVERTURE"?"Optimiser l'objet des emails et les horaires d'envoi.":S.label==="CLIC"?"Simplifier le CTA et r√©duire la longueur de l'√©tude.":S.label==="CLOSING"?"Renforcer le social proof et automatiser la relance post-clic.":"Augmenter la qualification des leads entrants.";return{globalConversion:_,benchmark:g,diff:_-g,evolution:x,executiveLine:ae,monthlyRecoveryPotential:F,recommendation:W(),worst:S,isCritical:T,avgBasket:M,metrics:{qualificationRate:w,openRate:j,clickRate:k,closeRate:C,totalLeads:h,totalDossiers:f,totalOpens:m,totalClicks:y,totalSigned:b}}},[a,r,o,i]),c=N.useMemo(()=>[{label:"LEADS",value:l.metrics.totalLeads,revenue:l.metrics.totalLeads*l.avgBasket,color:"#475569"},{label:"DOSSIERS",value:l.metrics.totalDossiers,revenue:l.metrics.totalDossiers*l.avgBasket,color:"#334155"},{label:"OUVERTS",value:l.metrics.totalOpens,revenue:l.metrics.totalOpens*l.avgBasket,color:"#1e293b",isFriction:l.worst.label==="OUVERTURE",avgDelay:2},{label:"CLIQU√âS",value:l.metrics.totalClicks,revenue:l.metrics.totalClicks*l.avgBasket,color:"#0f172a",isFriction:l.worst.label==="CLIC",avgDelay:9},{label:"SIGN√âS",value:l.metrics.totalSigned,revenue:l.metrics.totalSigned*l.avgBasket,color:"#10B981",isFriction:l.worst.label==="CLOSING"}],[l]),d=N.useMemo(()=>{var h;return r.filter(f=>f.was_war_room&&(f.status==="signed"||f.deposit_paid)).reduce((f,m)=>f+(m.total_price||0),0)||((h=n.warRoom)==null?void 0:h.ca)||0},[r,n]),u=l.metrics.totalLeads*.25,p=N.useMemo(()=>{const h=[],f=new Date;for(let m=5;m>=0;m--){const y=new Date(f.getFullYear(),f.getMonth()-m,1),b=y.toLocaleDateString("fr-FR",{month:"short"});h.push({label:b.charAt(0).toUpperCase()+b.slice(1).replace(".",""),m:y.getMonth(),y:y.getFullYear(),value:0,target:1e5+(5-m)*25e3})}return r.forEach(m=>{if(!(m.status==="signed"||m.deposit_paid))return;const b=m.signed_at||m.created_at;if(!b)return;const w=new Date(b),j=w.getMonth(),k=w.getFullYear(),C=h.find(_=>_.m===j&&_.y===k);C&&(C.value+=m.total_price||0)}),h.map(({label:m,value:y,target:b})=>({label:m,value:y,target:b}))},[r]);return s.jsxs("div",{className:"flex flex-col gap-12 py-12 px-8 w-full h-full pb-40",children:[s.jsx("section",{className:"bg-[#0F1115] p-10 rounded-3xl border border-white/[0.08] shadow-[0_20px_50px_rgba(0,0,0,0.5)]",children:s.jsxs("div",{className:"flex flex-col gap-8",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"text-[10px] font-black text-white/20 uppercase tracking-[0.4em]",children:"Executive Summary"}),s.jsx("h1",{className:"text-3xl md:text-4xl font-black text-white leading-tight uppercase tracking-tighter",children:l.executiveLine}),s.jsxs("div",{className:"flex items-baseline gap-4",children:[s.jsx("span",{className:"text-sm font-bold text-white/30 uppercase tracking-widest",children:"Impact:"}),s.jsxs("span",{className:"text-5xl font-black text-[#FF6B6B] font-mono tracking-tighter",children:[Math.round(l.monthlyRecoveryPotential/1e3),"k‚Ç¨"]}),s.jsx("span",{className:"text-xs font-bold text-white/20 uppercase tracking-widest",children:"/ mois non capt√©s"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsxs("div",{className:`p-6 rounded-2xl border-2 backdrop-blur-md ${l.isCritical?"bg-red-500/10 border-red-500/30":"bg-white/5 border-white/10"}`,children:[s.jsx("div",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"Status Audit"}),s.jsx("div",{className:`text-sm font-black uppercase ${l.isCritical?"text-red-500":"text-emerald-500"}`,children:l.isCritical?"Friction Critique":"Friction D√©tect√©e"})]}),s.jsxs("div",{className:"p-6 rounded-2xl bg-white/5 border border-white/10 backdrop-blur-md",children:[s.jsx("div",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"Conversion R√©elle"}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsxs("div",{className:"text-2xl font-black text-white font-mono",children:[Math.round(l.globalConversion),"%"]}),s.jsxs("div",{className:`text-[10px] font-black ${l.evolution<0?"text-red-500":"text-emerald-500"}`,children:[l.evolution<0?"‚Üò":"‚Üó"," ",Math.abs(l.evolution),"pts"]})]})]}),s.jsxs("div",{className:`p-6 rounded-2xl border-2 backdrop-blur-md ${l.diff<0?"bg-orange-500/10 border-orange-500/30":"bg-emerald-500/10 border-emerald-500/30"}`,children:[s.jsx("div",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"vs Benchmark"}),s.jsxs("div",{className:`text-2xl font-black font-mono ${l.diff<0?"text-orange-500":"text-emerald-400"}`,children:[l.diff>0?"+":"",Math.round(l.diff),"pts"]})]}),s.jsxs("div",{className:"p-6 rounded-2xl bg-indigo-500/10 border border-indigo-500/20 backdrop-blur-md",children:[s.jsx("div",{className:"text-[9px] font-black text-indigo-400/60 uppercase tracking-widest mb-1",children:"Panier Moyen"}),s.jsxs("div",{className:"text-2xl font-black text-white font-mono",children:[Math.round(l.avgBasket/1e3),"k‚Ç¨"]})]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[s.jsxs("section",{className:"lg:col-span-12 bg-black/40 backdrop-blur-xl p-10 rounded-[2.5rem] border border-white/5 space-y-10 shadow-2xl relative overflow-hidden",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-8 relative z-10",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsxs("h2",{className:"text-xl font-black text-white uppercase tracking-tight",children:["Flux Commercial ¬∑ ",c[0].label," ‚Üí ",c[c.length-1].label]}),s.jsx("p",{className:"text-xs text-white/20 font-bold uppercase tracking-widest",children:"Analyse d√©doublon√©e 1:1 avec tension visuelle sur frictions."})]}),s.jsxs("div",{className:"bg-emerald-500/10 border-l-4 border-emerald-500 p-4 rounded-r-xl max-w-sm",children:[s.jsx("div",{className:"text-[9px] font-black text-emerald-400 uppercase tracking-widest mb-1",children:"Priorit√© Imm√©diate"}),s.jsxs("div",{className:"text-sm font-bold text-white uppercase leading-tight",children:[l.worst.from," ‚Üí ",l.worst.to," : ",l.recommendation]})]})]}),s.jsx("div",{className:"pt-6",children:s.jsx(km,{data:c,benchmarkPercentage:l.benchmark})}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pt-10 border-t border-white/5",children:[s.jsx(ss,{label:"CA G√©n√©r√©",value:`${Math.round(i.caTotal/1e3)}k‚Ç¨`}),s.jsx(ss,{label:"Potentiel R√©cup√©rable",value:`+${Math.round(l.monthlyRecoveryPotential/1e3)}k‚Ç¨`,color:"text-emerald-400"}),s.jsx(ss,{label:"D√©lai Moyen",value:"11.2 j"}),s.jsx(ss,{label:"Unit√©s Perdues",value:Math.max(0,Math.round(r.length*.42-o)),color:"text-red-500"})]})]}),s.jsxs("section",{className:"lg:col-span-8 bg-[#0b0f17] p-10 rounded-[2.5rem] border border-white/5 space-y-10 shadow-2xl",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-[9px] tracking-[0.35em] text-white/30 uppercase",children:"Trajectoire Business"}),s.jsx("h2",{className:"text-2xl font-black text-white uppercase tracking-tight",children:"Acc√©l√©ration du Chiffre d‚ÄôAffaires"})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("div",{className:"text-3xl font-black text-emerald-400 font-mono tracking-tighter",children:[Math.round(d/1e3),"k‚Ç¨"]}),s.jsx("p",{className:"text-[9px] text-white/20 font-black uppercase tracking-widest",children:"CA S√©curis√©"})]})]}),s.jsx(Cm,{data:p,autopilotIndex:3}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-10",children:[s.jsxs("div",{className:"bg-white/5 rounded-2xl p-6 border border-white/10 backdrop-blur-md",children:[s.jsx("p",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"Temps Lib√©r√© Cumulativement"}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsx("span",{className:"text-3xl font-black text-white font-mono",children:Math.round(u)}),s.jsx("span",{className:"text-sm font-bold text-white/30 uppercase tracking-widest",children:"heures"})]})]}),s.jsxs("div",{className:"bg-emerald-500/10 rounded-2xl p-6 border border-emerald-500/20 backdrop-blur-md",children:[s.jsx("p",{className:"text-[9px] font-black text-emerald-400/60 uppercase tracking-widest mb-1",children:"Impact Business Direct"}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsxs("span",{className:"text-3xl font-black text-emerald-400 font-mono",children:["+",Math.round(d/1e3)]}),s.jsx("span",{className:"text-sm font-bold text-emerald-400/40 uppercase tracking-widest",children:"k‚Ç¨ s√©curis√©s"})]})]})]})]}),s.jsx("section",{className:"lg:col-span-4 flex flex-col gap-6",children:s.jsxs("div",{className:"bg-gradient-to-br from-indigo-950/40 via-black to-black p-12 rounded-[3.5rem] border border-indigo-500/10 flex-1 flex flex-col justify-between shadow-2xl relative overflow-hidden group",children:[s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-indigo-500/5 blur-[80px] rounded-full group-hover:scale-150 transition-transform duration-1000"}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[10px] font-black text-indigo-400/60 uppercase tracking-[0.4em]",children:"Brain Autopilote"}),s.jsx("div",{className:"h-1 w-12 bg-indigo-500 rounded-full"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[9px] font-black text-white/20 uppercase tracking-widest",children:"Efficience Flux"}),s.jsxs("div",{className:"text-5xl font-black text-white font-mono tracking-tighter",children:["98.4",s.jsx("span",{className:"text-sm text-white/20",children:"%"})]})]})]}),s.jsxs("div",{className:"space-y-4 pt-12 border-t border-white/5",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-[9px] font-black text-white/30 uppercase tracking-[0.2em]",children:"Protection CA"}),s.jsx("span",{className:"text-xs font-black text-emerald-500",children:"ACTIF"})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-[9px] font-black text-white/30 uppercase tracking-[0.2em]",children:"Relance √âtudes"}),s.jsx("span",{className:"text-xs font-black text-emerald-500",children:"ACTIF"})]}),s.jsxs("div",{className:"flex justify-between items-center opacity-30",children:[s.jsx("span",{className:"text-[9px] font-black text-white/30 uppercase tracking-[0.2em]",children:"Smart Closing"}),s.jsx("span",{className:"text-xs font-black text-white/40",children:"BETA"})]})]})]})})]})]})}const ss=({label:e,value:t,color:n="text-white"})=>s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"text-[9px] font-black text-white/20 uppercase tracking-[0.2em]",children:e}),s.jsx("div",{className:`text-xl font-black font-mono tracking-tighter ${n}`,children:t})]});function Tm({data:e,securedRevenue:t,cycleBefore:n,cycleNow:i,savedHours:a}){const[r,o]=N.useState(null),l=N.useMemo(()=>Math.max(...e.map(x=>x.creation),1),[e]),c=N.useMemo(()=>Math.max(...e.map(x=>x.protection),1),[e]),d=n&&i?Math.round((i-n)/n*100):null,u={top:40,right:80,bottom:60,left:80},p=800,h=300,f=p-u.left-u.right,m=h-u.top-u.bottom,y=x=>m-x/l*m,b=x=>m-x/c*m,w=x=>{const v=x==="creation"?y:b;return e.map((S,T)=>{const M=T/(e.length-1)*f,P=v(S[x]);return`${T===0?"M":"L"}${M},${P}`}).join(" ")},j=w("creation"),k=w("protection"),C=N.useMemo(()=>{const x=e[e.length-1];return x?x.protection>x.creation?"Le syst√®me prot√®ge d√©sormais plus de chiffre d'affaires qu'il n'en g√©n√®re : effet d√©fensif confirm√©.":x.protection>x.creation*.7?"La protection du CA devient un levier strat√©gique majeur.":"Le syst√®me agit surtout en acquisition : potentiel d√©fensif encore sous‚Äëexploit√©.":""},[e]),_=N.useMemo(()=>{const v=[];for(let S=0;S<=5;S++){const T=l/5*S;v.push(T)}return v},[l]),g=N.useMemo(()=>{const v=[];for(let S=0;S<=5;S++){const T=c/5*S;v.push(T)}return v},[c]);return s.jsxs("section",{className:"w-full rounded-2xl bg-[#0b0e14] border border-white/10 p-8 text-white shadow-[0_20px_60px_rgba(0,0,0,0.45)]",children:[s.jsxs("header",{className:"mb-10",children:[s.jsx("div",{className:"text-xs uppercase tracking-[0.35em] text-white/30 mb-3",children:"Performance commerciale autonome"}),s.jsxs("div",{className:"flex items-end gap-6 flex-wrap",children:[s.jsxs("h1",{className:"text-7xl font-bold leading-none",children:[(t/1e3).toFixed(0),"k‚Ç¨"]}),s.jsx("p",{className:"text-white/50 max-w-sm pb-2",children:"Chiffre d'affaires s√©curis√© automatiquement"})]})]}),s.jsxs("div",{className:"mb-10 bg-[#0f141f] rounded-xl p-6 border border-white/5 relative",children:[s.jsxs("div",{className:"flex gap-6 mb-4 text-xs",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-3 h-0.5 bg-[#3ecfff]"}),s.jsx("span",{className:"text-white/60",children:"Cr√©ation (Clients uniques)"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-3 h-0.5 bg-[#7cffb2]"}),s.jsx("span",{className:"text-white/60",children:"Protection (CA S√©curis√©)"})]})]}),s.jsx("svg",{viewBox:`0 0 ${p} ${h}`,className:"w-full",children:s.jsxs("g",{transform:`translate(${u.left},${u.top})`,children:[g.map((x,v)=>s.jsx("line",{x1:0,y1:b(x),x2:f,y2:b(x),stroke:"rgba(255,255,255,0.05)",strokeDasharray:"2,4"},v)),s.jsx("line",{x1:0,y1:0,x2:0,y2:m,stroke:"rgba(62,207,255,0.3)",strokeWidth:1}),_.map((x,v)=>s.jsx("g",{children:s.jsx("text",{x:-10,y:y(x),fill:"rgba(62,207,255,0.6)",fontSize:10,textAnchor:"end",dominantBaseline:"middle",fontFamily:"IBM Plex Mono",children:Math.round(x)})},v)),s.jsx("text",{x:-60,y:m/2,fill:"rgba(62,207,255,0.6)",fontSize:11,textAnchor:"middle",transform:`rotate(-90, -60, ${m/2})`,fontFamily:"IBM Plex Mono",children:"CLIENTS"}),s.jsx("line",{x1:f,y1:0,x2:f,y2:m,stroke:"rgba(124,255,178,0.3)",strokeWidth:1}),g.map((x,v)=>s.jsxs("text",{x:f+10,y:b(x),fill:"rgba(124,255,178,0.6)",fontSize:10,textAnchor:"start",dominantBaseline:"middle",fontFamily:"IBM Plex Mono",children:[Math.round(x/1e3),"k‚Ç¨"]},v)),s.jsx("text",{x:f+60,y:m/2,fill:"rgba(124,255,178,0.6)",fontSize:11,textAnchor:"middle",transform:`rotate(90, ${f+60}, ${m/2})`,fontFamily:"IBM Plex Mono",children:"CA PROT√âG√â"}),s.jsx("line",{x1:0,y1:m,x2:f,y2:m,stroke:"rgba(255,255,255,0.2)",strokeWidth:1}),e.map((x,v)=>{const S=v/(e.length-1)*f;return s.jsx("text",{x:S,y:m+20,fill:"rgba(255,255,255,0.4)",fontSize:10,textAnchor:"middle",fontFamily:"IBM Plex Mono",children:x.label},v)}),s.jsx("path",{d:j,fill:"none",stroke:"#3ecfff",strokeWidth:"3",opacity:"0.85"}),s.jsx("path",{d:k,fill:"none",stroke:"#7cffb2",strokeWidth:"3",opacity:"0.9"}),e.map((x,v)=>{const S=v/(e.length-1)*f,T=b(x.protection),M=y(x.creation);return s.jsxs("g",{children:[s.jsx("circle",{cx:S,cy:M,r:r===v?5:3,fill:"#3ecfff",onMouseEnter:()=>o(v),onMouseLeave:()=>o(null),style:{cursor:"pointer"}}),s.jsx("circle",{cx:S,cy:T,r:r===v?6:4,fill:"#7cffb2",onMouseEnter:()=>o(v),onMouseLeave:()=>o(null),style:{cursor:"pointer"}})]},v)})]})}),r!==null&&s.jsxs("div",{className:"absolute bottom-4 left-6 text-xs bg-black/90 px-4 py-3 rounded-lg border border-white/20",children:[s.jsx("div",{className:"font-bold mb-1",children:e[r].label}),s.jsxs("div",{className:"text-[#3ecfff]",children:["Leads: ",e[r].creation]}),s.jsxs("div",{className:"text-[#7cffb2]",children:["CA Prot√©g√©: ",(e[r].protection/1e3).toFixed(0),"k‚Ç¨"]})]})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-10",children:[i!==void 0&&s.jsxs("div",{className:"bg-white/[0.04] p-6 rounded-xl border border-white/10",children:[s.jsx("div",{className:"text-xs text-white/40 uppercase mb-1",children:"Cycle commercial"}),s.jsxs("div",{className:"text-4xl font-bold",children:[i," jours"]}),d!==null&&d!==0&&s.jsxs("div",{className:`text-sm mt-1 ${d<0?"text-emerald-400":"text-red-400"}`,children:[d>0?"+":"",d,"% vs avant"]})]}),a!==void 0&&a>0&&s.jsxs("div",{className:"bg-white/[0.04] p-6 rounded-xl border border-white/10",children:[s.jsx("div",{className:"text-xs text-white/40 uppercase mb-1",children:"Temps lib√©r√©"}),s.jsxs("div",{className:"text-4xl font-bold",children:[a,"h"]}),s.jsx("div",{className:"text-white/40 text-sm",children:"Capacit√© commerciale r√©cup√©r√©e"})]}),s.jsxs("div",{className:"bg-white/[0.04] p-6 rounded-xl border border-white/10",children:[s.jsx("div",{className:"text-xs text-white/40 uppercase mb-1",children:"Lecture strat√©gique"}),s.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:C})]})]}),s.jsx("footer",{className:"border-t border-white/10 pt-6",children:s.jsx("p",{className:"text-sm text-white/70",children:"üëâ Priorit√© : renforcer la protection du CA existant avant d'augmenter l'acquisition."})})]})}function Em({system:e}){var u;const{studies:t,metrics:n,emailLeads:i}=e,a=N.useMemo(()=>{const p=new Date,h=new Date(p.getFullYear(),p.getMonth(),1);return t.filter(f=>{if(!f.signed_at||f.status!=="signed"&&!f.deposit_paid)return!1;const m=new Date(f.signed_at);return m>=h&&m<=p}).reduce((f,m)=>f+(m.total_price||0),0)},[t]),r=14.5,o=11.2,l=((u=n.stats)==null?void 0:u.totalEmailsSent)||0,c=Math.max(10,Math.round(l*.25)),d=N.useMemo(()=>{const p=new Date,h=new Date(p.getFullYear(),p.getMonth(),1),f=[];for(let m=0;m<=6;m++){const y=m/6,b=h.getTime()+(p.getTime()-h.getTime())*y,w=new Date(b),j=t.filter(_=>{if(!_.created_at)return!1;const g=new Date(_.created_at);return g>=h&&g<=w}),k=new Set(j.map(_=>_.email).filter(_=>_)),C=t.filter(_=>{if(!_.signed_at||_.status!=="signed"&&!_.deposit_paid)return!1;const g=new Date(_.signed_at);return g>=h&&g<=w}).reduce((_,g)=>_+(g.total_price||0),0);f.push({label:w.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}),creation:k.size,protection:C})}return f},[t]);return s.jsx("div",{className:"flex flex-col gap-8 py-12 px-6 w-full h-full pb-40",children:s.jsx(Tm,{data:d,securedRevenue:a,cycleBefore:r,cycleNow:o,savedHours:c})})}const Dm=({filters:e,onFilterChange:t})=>s.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-6",children:[s.jsx("input",{type:"text",placeholder:"üîç Rechercher un client...",value:e.search,onChange:n=>t({...e,search:n.target.value}),className:"flex-1 min-w-[200px] px-4 py-2 bg-slate-800/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:outline-none"}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx("button",{onClick:()=>t({...e,views:e.views==="5+"?null:"5+"}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${e.views==="5+"?"bg-orange-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üëÅÔ∏è Vues 5+"}),s.jsx("button",{onClick:()=>t({...e,clicks:e.clicks==="1+"?null:"1+"}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${e.clicks==="1+"?"bg-green-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üñ±Ô∏è Clics 1+"}),s.jsx("button",{onClick:()=>t({...e,status:e.status==="sent"?null:"sent"}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${e.status==="sent"?"bg-blue-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üìß Envoy√©s"}),s.jsx("button",{onClick:()=>t({...e,optout:!e.optout}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${e.optout?"bg-red-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üö´ Opt-out"})]}),(e.search||e.views||e.clicks||e.status||e.optout)&&s.jsx("button",{onClick:()=>t({search:"",views:null,clicks:null,status:null,optout:!1}),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-bold text-sm transition-colors",children:"üîÑ Reset"})]});function Rm(e){const t=Math.floor((new Date().getTime()-new Date(e).getTime())/1e3);return t<60?"√Ä l'instant":t<3600?`Il y a ${Math.floor(t/60)}min`:t<86400?`Il y a ${Math.floor(t/3600)}h`:t<604800?`Il y a ${Math.floor(t/86400)}j`:new Date(e).toLocaleDateString("fr-FR")}function zs(e){return e.toLocaleString("fr-FR")+" ‚Ç¨"}function Mm(e){if(!e.last_email_sent)return"Imm√©diat";const t=new Date(e.created_at),n=new Date(e.last_email_sent),a=Math.floor((new Date().getTime()-t.getTime())/864e5);if(a>120)return"Termin√©";const r=a<=60?3:7,o=new Date(n);return o.setDate(o.getDate()+r),o.toLocaleDateString("fr-FR")}const Ya={MUET:{label:"SILENCE",class:"bg-zinc-800/50 text-zinc-400 border border-zinc-700/50",description:"Client inactif"},CAS_LIMITE:{label:"CONTACT EXCESSIF",class:"bg-amber-900/20 text-amber-200/80 border border-amber-800/30",description:"Sur-engagement"},AGIT√â:{label:"AGIT√â",class:"bg-orange-900/20 text-orange-200/80 border border-orange-800/30",description:"Risque annulation"},INT√âRESS√â:{label:"INT√âRESS√â",class:"bg-emerald-900/20 text-emerald-200/80 border border-emerald-800/30",description:"Opportunit√©"},STABLE:{label:"STABLE",class:"bg-zinc-900 text-zinc-500 border border-zinc-800",description:"Sous surveillance"},FATIGUE:{label:"INACTIF",class:"bg-red-900/10 text-red-300 border border-red-900/20",description:"Lead dormant"}},Zo=({study:e,antiAnnulationByStudy:t,postRefusByStudy:n,onSignStudy:i,onCancelStudy:a,onDeleteStudy:r,onMarkDepositPaid:o,onMarkRibSent:l,showActions:c=!0,leads:d=[]})=>{var M,P,V;const u=or(e),p=Ya[u.state]||Ya.STABLE,h=A=>A&&A.sent&&A.sent.length>0,f=t?t[String(e.id)]||t[String(e.client_id)]:null,m=n?n[String(e.id)]||n[String(e.client_id)]:null,y=(d||[]).find(A=>!!(A.study_id&&A.study_id===e.id||A.client_id&&A.client_id===e.client_id||A.client_email&&e.email&&A.client_email.toLowerCase().trim()===e.email.toLowerCase().trim()&&A.client_email!=="Pas d'email")),b=y?{total_opens:y.total_opens||0,sent:y.last_email_sent?[{sent_at:y.last_email_sent,opened_at:y.last_opened_at}]:[],next:y.next_email_date?{scheduled_for:y.next_email_date}:null}:null;let w=null,j=null;e.status==="signed"?h(f)?(w="anti-annulation",j=f):h(m)&&(w="post-refus",j=m):h(m)?(w="post-refus",j=m):h(f)?(w="anti-annulation",j=f):h(b)&&(w="prospection",j=b),w||(e.status==="signed"?f!=null&&f.next?(w="anti-annulation",j=f):m!=null&&m.next?(w="post-refus",j=m):(w="anti-annulation",j=f):m!=null&&m.next?(w="post-refus",j=m):f!=null&&f.next?(w="anti-annulation",j=f):b!=null&&b.next?(w="prospection",j=b):(w="post-refus",j=m));let k=Math.max(((M=j==null?void 0:j.sent)==null?void 0:M.length)||0,(y==null?void 0:y.email_sequence_step)||0,e.send_count||0);e.views>0&&k===0&&(k=1),(P=e.name)!=null&&P.toUpperCase().includes("GUYOT")&&console.log("üéØ GUYOT SELECTED FLOW:",{flowType:w,sentLength:(V=j==null?void 0:j.sent)==null?void 0:V.length,leadStep:y==null?void 0:y.email_sequence_step,studySendCount:e.send_count,finalStep:k});const C=5,_=j!=null&&j.sent&&j.sent.length>0?j.sent[j.sent.length-1]:null,g=(j==null?void 0:j.next)||null;!w&&(e.views>0||e.last_view)&&(w=e.status==="signed"?"anti-annulation":"post-refus",j={total_opens:e.views||0,sent:e.last_view?[{sent_at:e.last_view,opened_at:e.last_view}]:[],next:null,is_fallback:!0},k=Math.min(5,Math.max(1,Math.floor((e.views||0)/2))));const x=Math.min(100,Math.max(0,e.cancellationRisk||e.dangerScore||0)),v=x>80,S=e.payment_mode==="cash"||e.financing_mode==="cash_payment"||e.financing_mode==="cash",T=w==="anti-annulation"||w==="post-refus"?S?"cash":"financement":"prospection";return s.jsxs("div",{className:"group relative mb-4",children:[s.jsx("div",{className:`absolute -inset-0.5 rounded-2xl bg-gradient-to-r from-blue-500/50 to-indigo-600/50 opacity-0 blur-sm group-hover:opacity-30 transition duration-500 ${v?"from-orange-600/50 to-red-600/50 group-hover:opacity-40":""}`}),s.jsxs("div",{className:"relative backdrop-blur-xl rounded-2xl bg-slate-950/40 border border-white/5 p-6 flex flex-col lg:grid lg:grid-cols-[220px_1fr_200px_120px_auto] lg:items-center gap-6 transition-all hover:bg-slate-900/40 hover:border-white/10 shadow-lg",children:[s.jsxs("div",{className:"flex flex-col gap-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("div",{className:"w-1.5 h-1.5 flex-shrink-0 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.8)]"}),s.jsx(wl,{status:e.status}),e.status==="signed"&&s.jsx(Ke,{className:"w-3.5 h-3.5 text-emerald-400"})]}),s.jsxs("h3",{className:"text-white font-black tracking-tight text-base lg:text-lg uppercase leading-none mb-1",children:[e.name.split(" ")[0],s.jsx("br",{}),s.jsx("span",{className:"text-blue-400",children:e.name.split(" ").slice(1).join(" ")})]}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 font-mono truncate",children:[s.jsx("span",{className:"opacity-60 text-[10px] flex-shrink-0",children:"üìß"}),s.jsx("span",{className:"truncate",children:e.email})]}),S&&s.jsx("div",{className:"flex items-center gap-2 mt-1",children:s.jsxs("span",{className:"px-2 py-0.5 rounded text-[10px] bg-amber-500/10 border-amber-500/20 text-amber-400 font-black uppercase tracking-tighter shadow-[0_0_8px_rgba(251,191,36,0.2)]",children:["CASH ",e.has_deposit?"+ ACOMPTE":""]})}),s.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[s.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-black uppercase border ${p.class}`,children:p.label.replace(/^[^\s]+\s/,"")}),e.contract_secured&&s.jsx("span",{className:"px-2 py-0.5 bg-emerald-500/20 text-emerald-400 border border-emerald-500/30 rounded text-[10px] font-black uppercase flex items-center gap-1",children:"üõ°Ô∏è S√âCURIS√â"}),e.rib_sent&&s.jsx("span",{className:"px-2 py-0.5 bg-blue-500/20 text-blue-400 border border-blue-500/30 rounded text-[10px] font-black uppercase",children:"üìÑ RIB OK"}),s.jsxs("span",{className:"px-2 py-0.5 rounded bg-slate-800/50 border border-white/5 text-[10px] font-bold text-slate-400 font-mono flex items-center gap-1",children:["üóìÔ∏è J+",e.daysSinceSigned||e.diffDays||0]})]})]}),s.jsx("div",{className:"hidden lg:flex flex-col gap-3 px-8 border-x border-white/5 min-h-[100px] justify-center",children:w?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between items-center text-[10px] text-slate-500 font-black uppercase tracking-[0.2em]",children:[s.jsxs("span",{className:"flex items-center gap-1.5",children:[s.jsx(yi,{className:"w-3 h-3 text-blue-400"}),"Engagement Flow"]}),s.jsxs("span",{className:"bg-blue-500/10 text-blue-400 px-2 py-0.5 rounded-full border border-blue-500/20",children:[e.views||0," VUES"]})]}),s.jsx("div",{className:"h-2 w-full bg-slate-800/50 rounded-full overflow-hidden flex gap-1.5 p-[2px] border border-white/5",children:[1,2,3,4,5].map(A=>s.jsx("div",{className:`h-full flex-1 rounded-sm transition-all duration-700 ${A<=k?"bg-gradient-to-r from-blue-600 to-indigo-500 shadow-[0_0_12px_rgba(59,130,246,0.4)]":"bg-slate-700/50"}`},A))}),s.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-slate-600 tracking-widest uppercase",children:[s.jsx("span",{children:"S√©quence Auto"}),s.jsxs("span",{children:[k,"/",C," Envoy√©s"]})]}),s.jsxs("div",{className:`flex flex-col gap-2 p-3 rounded-lg border mt-1 ${w==="anti-annulation"?"bg-emerald-500/5 border-emerald-500/20 shadow-[0_4px_12px_rgba(16,185,129,0.1)]":w==="post-refus"?"bg-red-500/5 border-red-500/20 shadow-[0_4px_12px_rgba(239,68,68,0.1)]":"bg-blue-500/5 border-blue-500/20 shadow-[0_4px_12px_rgba(59,130,246,0.1)]"}`,children:[s.jsx("div",{className:`flex items-center gap-2 text-[10px] font-black uppercase tracking-widest ${w==="anti-annulation"?"text-emerald-400":w==="post-refus"?"text-red-400":"text-blue-400"}`,children:w==="anti-annulation"?`üõ°Ô∏è ANTI-ANNULATION ${T.toUpperCase()}`:w==="post-refus"?`‚ùå POST-REFUS ${T.toUpperCase()}`:"üöÄ PROSPECTION"}),_?s.jsxs("div",{className:"flex flex-col gap-1.5",children:[s.jsxs("div",{className:"flex justify-between items-center text-[9px]",children:[s.jsx("span",{className:"text-slate-600 font-bold",children:"Dernier :"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:`font-mono font-bold ${w==="anti-annulation"?"text-emerald-400":w==="post-refus"?"text-red-400":"text-blue-400"}`,children:["j",[0,1,3,7,14][k-1]||0," ",T]}),s.jsxs("span",{className:"text-slate-500 font-mono",children:["(",new Date(_.sent_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"}),")"]})]})]}),s.jsxs("div",{className:"flex justify-between items-center text-[9px]",children:[s.jsx("span",{className:"text-slate-700 font-bold",children:"Ouvertures :"}),s.jsxs("div",{className:"flex items-center gap-2",children:[_.opened_at&&s.jsxs("span",{className:"text-[8px] text-slate-500 font-mono",children:["Lu le: ",new Date(_.opened_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})," √† ",new Date(_.opened_at).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]}),s.jsxs("span",{className:`font-mono font-bold px-1.5 py-0.5 rounded ${j.total_opens>0?w==="anti-annulation"?"bg-emerald-500/10 text-emerald-400":w==="post-refus"?"bg-red-500/10 text-red-400":"bg-blue-500/10 text-blue-400":"bg-slate-800 text-slate-600"}`,children:[j.total_opens||0,"x"]})]})]})]}):s.jsx("div",{className:"text-[10px] text-slate-500 italic py-1",children:"‚åõ En attente du premier envoi..."}),k<C&&s.jsx("div",{className:"flex flex-col gap-1.5 border-t border-white/5 pt-2 mt-1",children:s.jsxs("div",{className:"flex justify-between items-center text-[9px]",children:[s.jsx("span",{className:"text-slate-600 font-bold",children:"Prochain :"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"text-orange-400 font-mono font-bold",children:["j",[0,1,3,7,14][k]||"?"," ",T]}),g?s.jsxs("span",{className:"text-orange-400/60 font-mono",children:["‚Üí ",new Date(g.scheduled_for).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})]}):s.jsx("span",{className:"text-slate-500/50 font-mono text-[8px] uppercase tracking-wider border border-slate-700/30 px-1.5 py-0.5 rounded",children:"Non planifi√©"})]})]})}),k>=C&&s.jsx("div",{className:`flex items-center justify-center gap-1 rounded-md px-2 py-1.5 border mt-1 font-black text-[8px] uppercase tracking-widest ${w==="anti-annulation"?"bg-emerald-500/10 border-emerald-500/30 text-emerald-400":w==="post-refus"?"bg-red-500/10 border-red-500/30 text-red-400":"bg-blue-500/10 border-blue-500/30 text-blue-400"}`,children:"‚úÖ S√âQUENCE TERMIN√âE"})]})]}):s.jsxs("div",{className:"text-center py-4",children:[s.jsx("div",{className:"text-[10px] text-slate-600 font-black uppercase tracking-widest mb-1 opacity-50",children:"Engagement Flow"}),s.jsx("div",{className:"text-xs text-slate-500 italic",children:"Aucune s√©quence active d√©tect√©e"})]})}),s.jsxs("div",{className:"flex flex-col items-end justify-center h-full min-w-[180px] gap-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[s.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-[0.2em]",children:"VALEUR DOSSIER"}),e.financing_mode&&s.jsx("span",{className:`text-[8px] px-1.5 py-0.5 rounded-md border font-black tracking-widest ${e.financing_mode==="cash_payment"?"bg-indigo-500/10 border-indigo-500/30 text-indigo-400":"bg-blue-500/10 border-blue-500/30 text-blue-400"}`,children:e.financing_mode==="cash_payment"?"COMPTANT":"FINANC√â"})]}),s.jsx("div",{className:"text-3xl font-black text-white tracking-tighter mb-1 select-none",children:zs(e.total_price)}),s.jsxs("div",{className:"flex flex-col items-end gap-1.5 w-full",children:[e.cash_apport>0&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-yellow-500/5 border border-yellow-500/10 w-full justify-end",children:[s.jsx(kl,{className:"w-3 h-3 text-yellow-500/70"}),s.jsxs("span",{className:"text-[9px] font-black text-yellow-500/90 font-mono tracking-tight uppercase",children:["APPORT: ",zs(e.cash_apport)]})]}),e.status==="signed"&&e.has_deposit&&s.jsx("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-[9px] font-black uppercase w-full justify-end
                ${e.deposit_paid?"bg-emerald-500/5 border-emerald-500/10 text-emerald-400/80":"bg-orange-500/5 border-orange-500/10 text-orange-400/80"}`,children:e.deposit_paid?"‚úÖ R√®glement Acompte":`‚è≥ Acompte: ${zs(e.deposit_amount||1500)}`})]})]}),s.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 px-8 border-l border-white/5 h-full min-w-[160px]",children:[s.jsxs("div",{className:"relative w-16 h-16 flex-shrink-0 group/gauge",children:[s.jsxs("svg",{className:"w-full h-full -rotate-90 transform",viewBox:"0 0 36 36",children:[s.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",className:"stroke-slate-800/60",strokeWidth:"2"}),s.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",className:`${v?"stroke-orange-500":"stroke-blue-500"} transition-all duration-1000 ease-out`,strokeWidth:"2",strokeDasharray:`${x}, 100`,strokeLinecap:"round",stroke:"currentColor"})]}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsxs("span",{className:"text-sm font-black text-white font-mono tracking-tighter",children:[x,"%"]})})]}),s.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[s.jsx("span",{className:"text-[8px] text-slate-600 font-black uppercase tracking-[0.3em]",children:"RISQUE"}),s.jsx("div",{className:`px-4 py-1 rounded-lg border ${p.class} uppercase text-[10px] font-black tracking-[0.15em] shadow-lg whitespace-nowrap`,children:p.label.replace(/^[^\s]+\s/,"")})]})]}),c&&s.jsxs("div",{className:"flex flex-row lg:flex-col gap-2 border-l border-white/5 pl-4 ml-4",children:[s.jsx("button",{onClick:()=>{const A=typeof window<"u"?window.location.origin:"";A?window.open(`${A}/guest/${e.id}`,"_blank"):console.error("‚ùå Impossible d'ouvrir l'√©tude : URL de base introuvable")},className:"p-2.5 rounded-xl bg-white/5 border border-white/10 text-slate-400 hover:text-white hover:bg-white/10 transition-all active:scale-95",title:"Voir Document",children:s.jsx(yi,{className:"w-4 h-4"})}),s.jsxs("button",{onClick:()=>{e.phone?window.location.href=`tel:${e.phone}`:alert("Num√©ro de t√©l√©phone non renseign√©")},className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-blue-600/20 border border-blue-500/30 text-blue-400 hover:bg-blue-600/30 hover:text-blue-300 transition-all active:scale-95 shadow-lg shadow-blue-900/20",title:"Appeler Client",children:[s.jsx("span",{className:"text-sm",children:"üìû"}),s.jsx("span",{className:"text-[10px] font-black uppercase tracking-tight",children:"Appeler"})]}),e.status!=="signed"&&e.status!=="cancelled"&&i&&s.jsxs("button",{onClick:()=>i(e.id,e.name),className:"group/sign relative p-2.5 rounded-xl bg-gradient-to-br from-emerald-600/20 to-emerald-500/10 border border-emerald-500/40 text-emerald-400 hover:from-emerald-600/30 hover:to-emerald-500/20 hover:text-emerald-300 hover:border-emerald-400/60 transition-all active:scale-95 shadow-lg shadow-emerald-900/30 hover:shadow-emerald-900/50",title:"Signer le Dossier",children:[s.jsx("div",{className:"absolute inset-0 rounded-xl bg-emerald-500/20 blur-md opacity-0 group-hover/sign:opacity-100 transition-opacity duration-300"}),s.jsx("span",{className:"relative text-base",children:"‚úçÔ∏è"})]}),e.status!=="cancelled"&&a&&s.jsxs("button",{onClick:()=>a(e.id,e.name),className:"group/cancel relative p-2.5 rounded-xl bg-gradient-to-br from-red-600/20 to-red-500/10 border border-red-500/40 text-red-400 hover:from-red-600/30 hover:to-red-500/20 hover:text-red-300 hover:border-red-400/60 transition-all active:scale-95 shadow-lg shadow-red-900/30 hover:shadow-red-900/50",title:"Annuler l'√âtude",children:[s.jsx("div",{className:"absolute inset-0 rounded-xl bg-red-500/20 blur-md opacity-0 group-hover/cancel:opacity-100 transition-opacity duration-300"}),s.jsx("span",{className:"relative text-base",children:"‚ùå"})]}),e.status==="signed"&&e.has_deposit&&!e.deposit_paid&&o&&s.jsxs("button",{onClick:()=>o(e.id,e.name),className:"group/deposit relative p-2.5 rounded-xl bg-gradient-to-br from-green-600/20 to-green-500/10 border border-green-500/40 text-green-400 hover:from-green-600/30 hover:to-green-500/20 hover:text-green-300 hover:border-green-400/60 transition-all active:scale-95 shadow-lg shadow-green-900/30 hover:shadow-green-900/50",title:"Marquer Acompte Pay√©",children:[s.jsx("div",{className:"absolute inset-0 rounded-xl bg-green-500/20 blur-md opacity-0 group-hover/deposit:opacity-100 transition-opacity duration-300"}),s.jsx("span",{className:"relative text-base",children:"üí∞"})]})]})]})]})},Pm=({studies:e,filters:t,emailFlowByClient:n,antiAnnulationByStudy:i,postRefusByStudy:a,leads:r,onSignStudy:o,onCancelStudy:l,onDeleteStudy:c})=>{let d=e.filter(u=>{var p,h;if(u.status==="signed")return!1;if(t.search){const f=t.search.toLowerCase(),m=((p=u.name)==null?void 0:p.toLowerCase())||"",y=((h=u.email)==null?void 0:h.toLowerCase())||"";if(!m.includes(f)&&!y.includes(f))return!1}return!(t.views==="5+"&&u.views<5||t.clicks==="1+"&&u.clicks<1||t.status&&u.status!==t.status||t.optout&&!u.email_optout)});return d=d.sort((u,p)=>{const h={hot:0,warm:1,cold:2,signed:3},f=ki(u),m=ki(p);return h[f]-h[m]}),s.jsx("div",{className:"mb-8",children:d.length===0?s.jsxs("div",{className:"p-8 bg-slate-800/30 border border-slate-700/50 rounded-2xl text-center",children:[s.jsx("div",{className:"text-4xl mb-3",children:"üîç"}),s.jsx("div",{className:"text-lg font-bold text-slate-400",children:"Aucun dossier trouv√©"}),s.jsx("div",{className:"text-sm text-slate-500 mt-2",children:"Ajustez vos filtres ou crit√®res de recherche"})]}):s.jsx("div",{className:"space-y-3",children:d.map(u=>s.jsx(Zo,{study:u,antiAnnulationByStudy:i,postRefusByStudy:a,leads:r,onSignStudy:o,onCancelStudy:l,onDeleteStudy:c},u.id))})})},Im=({studies:e,metrics:t,filters:n,antiAnnulationByStudy:i,postRefusByStudy:a,leads:r,onSignStudy:o,onMarkDepositPaid:l,onMarkRibSent:c,onCancelStudy:d,onDeleteStudy:u})=>{const f=t.signed.filter(y=>{if(n.search){const b=n.search.toLowerCase();if(!y.name.toLowerCase().includes(b)&&!y.email.toLowerCase().includes(b))return!1}return!(n.views==="5+"&&(y.views||0)<5||n.clicks==="1+"&&(y.clicks||0)<1||n.optout&&!y.email_optout)}).sort((y,b)=>{var k,C;if((k=y.name)!=null&&k.toUpperCase().includes("GUYOT"))return-1;if((C=b.name)!=null&&C.toUpperCase().includes("GUYOT"))return 1;const w=y.daysLate||0;return(b.daysLate||0)-w}),m=f.filter(y=>y.requiresDeposit&&!y.deposit_paid&&y.financing_mode!=="full_financing").length;return s.jsxs("div",{id:"late-deposits-section",className:"mb-8",children:[s.jsx("div",{className:"flex items-center justify-between mb-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-3xl",children:"‚úÖ"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white",children:"AXE A ‚Äî DOSSIERS SIGN√âS (HISTORIQUE)"}),s.jsxs("div",{className:"text-sm text-slate-400",children:[f.length," dossiers au total ‚Ä¢"," ",s.jsxs("span",{className:`${m>0?"text-red-400":"text-emerald-400"} font-bold`,children:[m," en attente d'acompte"]})]})]})]})}),f.length===0?s.jsxs("div",{className:"p-8 bg-slate-800/30 border border-slate-700/50 rounded-2xl text-center",children:[s.jsx("div",{className:"text-4xl mb-3",children:"üéâ"}),s.jsx("div",{className:"text-lg font-bold text-emerald-400",children:"Tous les acomptes sont √† jour !"}),s.jsx("div",{className:"text-sm text-slate-500 mt-2",children:"Aucun retard hors War Room"})]}):s.jsx("div",{className:"space-y-3",children:f.map(y=>s.jsx(Zo,{study:y,antiAnnulationByStudy:i,postRefusByStudy:a,leads:r,onMarkDepositPaid:l,onMarkRibSent:c,onCancelStudy:d,onDeleteStudy:u},y.id))})]})},ft={clicked:"#3DDC97",opened:"#7CA3BA",sentNeg:"#2A3142"},Lm=({data:e,width:t,height:n})=>{const{showTooltip:i,hideTooltip:a,tooltipData:r,tooltipLeft:o,tooltipTop:l}=Za(),c={top:15,bottom:25,left:10,right:10},d=t-c.left-c.right,u=n-c.top-c.bottom,p=e.map(m=>({date:m.date,originalTotal:m.count,originalOpened:m.opened||0,originalClicked:m.clicked||0})),h=jn({range:[0,d],round:!0,domain:p.map(m=>m.date),padding:.4}),f=Re({range:[u,0],round:!0,domain:[0,Math.max(...e.flatMap(m=>[m.count,m.opened||0,m.clicked||0]))||10]});return s.jsxs("div",{className:"relative",children:[s.jsx("svg",{width:t,height:n,children:s.jsxs(se,{top:c.top,left:c.left,children:[p.map(m=>{const y=h.bandwidth(),b=h(m.date)||0,w=1,j=(y-w*2)/3,k=u-f(m.originalTotal),C=u-f(m.originalOpened),_=u-f(m.originalClicked);return s.jsxs(se,{left:b,children:[s.jsx("rect",{x:0,y:u-k,width:j,height:k,fill:ft.sentNeg,rx:2,opacity:.8,onMouseMove:g=>{const x=ns(g)||{x:0,y:0};i({tooltipData:m,tooltipLeft:x.x,tooltipTop:x.y})},onMouseLeave:()=>a(),style:{cursor:"pointer"}}),s.jsx("rect",{x:j+w,y:u-C,width:j,height:C,fill:ft.opened,rx:2,opacity:.9,style:{filter:"drop-shadow(0 0 3px rgba(124,163,186,0.3))",cursor:"pointer"},onMouseMove:g=>{const x=ns(g)||{x:0,y:0};i({tooltipData:m,tooltipLeft:x.x,tooltipTop:x.y})},onMouseLeave:()=>a()}),s.jsx("rect",{x:(j+w)*2,y:u-_,width:j,height:_,fill:ft.clicked,rx:2,opacity:1,style:{filter:"drop-shadow(0 0 4px rgba(61,220,151,0.4))",cursor:"pointer"},onMouseMove:g=>{const x=ns(g)||{x:0,y:0};i({tooltipData:m,tooltipLeft:x.x,tooltipTop:x.y})},onMouseLeave:()=>a()})]},`bar-group-${m.date}`)}),s.jsx(xt,{top:u,scale:h,stroke:"rgba(255,255,255,0.1)",tickStroke:"rgba(255,255,255,0.1)",tickLabelProps:()=>({fill:"#ffffff",fontSize:10,opacity:.5,textAnchor:"middle",fontFamily:"sans-serif",fontWeight:500}),tickFormat:m=>new Date(m).toLocaleDateString("fr-FR",{day:"numeric",month:"numeric"})})]})}),r&&s.jsx(Ja,{top:l,left:o,style:{...Qa,background:"rgba(15, 23, 42, 0.95)",border:"1px solid rgba(255, 255, 255, 0.1)",padding:"12px",color:"white",borderRadius:"12px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.5)",fontSize:"11px",backdropFilter:"blur(8px)",pointerEvents:"none"},children:s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("div",{className:"font-bold text-slate-400 uppercase tracking-widest text-[9px] mb-1",children:new Date(r.date).toLocaleDateString("fr-FR",{day:"numeric",month:"long"})}),s.jsxs("div",{className:"flex justify-between gap-4",children:[s.jsx("span",{className:"text-slate-500 font-bold uppercase",children:"Emails Envoy√©s"}),s.jsx("span",{className:"font-mono text-white",children:r.originalTotal})]}),s.jsxs("div",{className:"flex justify-between gap-4",children:[s.jsx("span",{className:"text-indigo-400 font-bold uppercase",children:"Emails Ouverts"}),s.jsx("span",{className:"font-mono text-white",children:r.originalOpened})]}),s.jsxs("div",{className:"flex justify-between gap-4",children:[s.jsx("span",{className:"text-[#3DDC97] font-bold uppercase",children:"Emails Cliqu√©s"}),s.jsx("span",{className:"font-mono text-white font-bold",children:r.originalClicked})]})]})},Math.random())]})},Om=({data:e})=>!e||e.length===0?null:s.jsxs("div",{className:"w-full h-48 rounded-2xl p-6 border flex flex-col justify-between backdrop-blur-xl",style:{background:"rgba(255,255,255,0.03)",borderColor:"rgba(255,255,255,0.08)",boxShadow:"0 8px 32px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.03)"},children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-[11px] uppercase tracking-widest text-white/50 font-black mb-1",children:"Pression d'envoi (14 jours)"}),s.jsx("div",{className:"flex items-center gap-3",children:s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500"}),s.jsx("span",{className:"text-[10px] text-indigo-200 font-bold uppercase",children:"Activit√© Totale"})]})})]}),s.jsxs("div",{className:"flex items-center gap-4 bg-white/5 px-3 py-1.5 rounded-lg border border-white/5",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{background:ft.sentNeg,opacity:.8}}),s.jsx("span",{className:"text-[9px] text-white/40 font-bold uppercase tracking-wider",children:"Envoy√©s"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{background:ft.opened,opacity:.9}}),s.jsx("span",{className:"text-[9px] text-white/50 font-bold uppercase tracking-wider",children:"Ouverts"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{background:ft.clicked,opacity:.95}}),s.jsx("span",{className:"text-[9px] text-[#3DDC97] font-bold uppercase tracking-wider",children:"Cliqu√©s"})]})]})]}),s.jsx("div",{className:"w-full h-32 relative",children:s.jsx(gt,{children:({width:t,height:n})=>s.jsx(Lm,{data:e,width:t,height:n})})})]}),Vm=({leads:e,trafficData:t,globalFilters:n,onSetOptOut:i,onDeleteLead:a})=>{const[r,o]=N.useState({search:"",today:!1,optedOut:!1});let l=e.filter(c=>{const d=((n==null?void 0:n.search)||r.search).toLowerCase();if(d&&!c.client_name.toLowerCase().includes(d)&&!c.client_email.toLowerCase().includes(d))return!1;if(r.today&&c.next_email_date){const u=new Date().toDateString(),p=new Date(c.next_email_date).toDateString();if(u!==p)return!1}return!(r.optedOut&&!c.opted_out)});return l=l.sort((c,d)=>c.next_email_date?d.next_email_date?new Date(c.next_email_date).getTime()-new Date(d.next_email_date).getTime():-1:1),s.jsxs("div",{className:"mb-8",children:[s.jsx("div",{className:"flex items-center justify-between mb-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-3xl",children:"üìß"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white",children:"AXE C ‚Äî LEADS EMAIL (AUTOMATISATION)"}),s.jsxs("div",{className:"text-sm text-slate-400",children:[l.length," lead",l.length>1?"s":""," en nurturing"]})]})]})}),s.jsx("div",{className:"mb-8",children:s.jsx(Om,{data:t})}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-6",children:[s.jsx("input",{type:"text",placeholder:"üîç Rechercher un lead...",value:r.search,onChange:c=>o({...r,search:c.target.value}),className:"flex-1 min-w-[200px] px-4 py-2 bg-slate-800/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:outline-none"}),s.jsx("button",{onClick:()=>o({...r,today:!r.today}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${r.today?"bg-green-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üìÖ Aujourd'hui"}),s.jsx("button",{onClick:()=>o({...r,optedOut:!r.optedOut}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${r.optedOut?"bg-red-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üö´ D√©sabonn√©s"}),(r.search||r.today||r.optedOut)&&s.jsx("button",{onClick:()=>o({search:"",today:!1,optedOut:!1}),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-bold text-sm transition-colors",children:"üîÑ Reset"})]}),l.length===0?s.jsxs("div",{className:"p-8 bg-slate-800/30 border border-slate-700/50 rounded-2xl text-center",children:[s.jsx("div",{className:"text-4xl mb-3",children:"üîç"}),s.jsx("div",{className:"text-lg font-bold text-slate-400",children:"Aucun lead trouv√©"})]}):s.jsx("div",{className:"space-y-3",children:l.map(c=>{const d=Mm(c),u=c.next_email_date&&new Date(c.next_email_date).toDateString()===new Date().toDateString();return s.jsx("div",{className:`rounded-xl p-5 border-2 transition-all ${c.opted_out?"bg-red-500/10 border-red-500/50":u?"bg-green-500/10 border-green-500/50":"bg-slate-800/50 border-slate-700/50 hover:bg-slate-800/70"}`,children:s.jsxs("div",{className:"grid grid-cols-[2fr_minmax(180px,1.2fr)_1.2fr_auto] gap-4 items-center",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("div",{className:"flex items-center gap-3 mb-1",children:s.jsx("div",{className:"text-2xl font-black text-white uppercase tracking-tight leading-none",children:c.client_name})}),s.jsx("div",{className:"text-sm text-slate-400 font-medium ml-0.5",children:c.client_email})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsxs("span",{className:"px-2 py-0.5 bg-blue-900/40 border border-blue-500/30 text-blue-300 rounded text-[10px] font-bold uppercase flex items-center gap-1",children:[s.jsx("span",{children:"üîÑ"})," √âTAPE ",c.email_sequence_step]}),c.opted_out&&s.jsx("span",{className:"px-2 py-0.5 bg-red-500/20 text-red-400 border border-red-500/30 rounded text-[10px] font-bold uppercase",children:"üö´ D√âSABONN√â"})]})]}),s.jsx("div",{children:s.jsxs("div",{className:"pl-4 border-l border-white/5",children:[s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Engagement"}),s.jsxs("div",{className:"flex items-end gap-3 mb-2",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-2xl font-black text-white leading-none",children:c.total_opens}),s.jsx("span",{className:"text-[10px] text-slate-500 uppercase font-bold",children:"Ouvertures"})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-2xl font-black text-white leading-none",children:c.total_clicks}),s.jsx("span",{className:"text-[10px] text-slate-500 uppercase font-bold",children:"Clics"})]})]})]})}),s.jsx("div",{children:s.jsxs("div",{className:"pl-4 border-l border-white/5 space-y-2",children:[s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider",children:"Prochaine relance"}),(()=>{let p=!1;if(d!=="Imm√©diat"&&d!=="Termin√©"){const[h,f,m]=d.split("/");if(h&&f&&m){const y=new Date(parseInt(m),parseInt(f)-1,parseInt(h)),b=new Date;b.setHours(0,0,0,0),y<b&&(p=!0)}}return s.jsx("div",{className:`text-sm font-bold ${p?"text-red-400 animate-pulse":d==="Imm√©diat"||u?"text-green-400":"text-white"}`,children:p?`üî• RETARD (${d})`:d==="Imm√©diat"?"üî• Imm√©diat":d})})()]}),c.last_email_sent?s.jsxs("div",{className:"text-xs font-bold text-slate-400 flex items-center gap-1.5 mt-1",children:[s.jsx("span",{children:"üìß"})," Email envoy√© le"," ",new Date(c.last_email_sent).toLocaleDateString("fr-FR")]}):s.jsx("div",{className:"text-[10px] font-medium text-slate-600 italic mt-1",children:"üí§ Aucun envoi"})]})}),s.jsxs("div",{className:"flex flex-col gap-2 pl-4 border-l border-transparent",children:[!c.opted_out&&s.jsx("button",{onClick:()=>{confirm(`D√©sabonner ${c.client_name} ?`)&&i(c.client_email)},className:"w-full h-10 bg-red-600/20 hover:bg-red-600 text-red-500 hover:text-white border border-red-500/30 rounded-lg font-bold text-xs uppercase tracking-wide transition-all flex items-center justify-center gap-2",children:"üö´ Opt-out"}),s.jsx("button",{onClick:()=>{confirm(`Supprimer d√©finitivement ${c.client_name} ?`)&&a(c.client_id,c.client_email,c.client_name)},className:"w-full h-9 bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white border border-slate-700 rounded-lg font-bold text-[10px] uppercase tracking-wide transition-all flex items-center justify-center gap-2",children:"üóëÔ∏è Supprimer"})]})]})},c.id)})})]})},Fm=({system:e})=>{const{studies:t,metrics:n,emailLeads:i,trafficData:a,antiAnnulationByStudy:r,postRefusByStudy:o,emailFlowByClient:l,actions:{signStudy:c,cancelStudy:d,deleteStudy:u,markDepositPaid:p,markRibSent:h,setOptOut:f,deleteLeadPermanently:m}}=e,[y,b]=N.useState({search:"",views:null,clicks:null,status:null,optout:!1});return s.jsxs("div",{className:"space-y-12",children:[s.jsx("div",{className:"flex items-center justify-between mb-8",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-3xl",children:"üóÑÔ∏è"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white uppercase tracking-wider",children:"Registres & Data"}),s.jsx("div",{className:"text-sm text-emerald-400 font-medium",children:"Historique complet et gestion du pipeline"})]})]})}),s.jsx(Dm,{filters:y,onFilterChange:b}),s.jsx(Im,{studies:t,metrics:n,filters:y,antiAnnulationByStudy:r,postRefusByStudy:o,leads:i,onSignStudy:c,onMarkDepositPaid:p,onMarkRibSent:h,onCancelStudy:d,onDeleteStudy:u}),s.jsxs("div",{className:"mt-16",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("span",{className:"text-3xl",children:"üöÄ"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white",children:"AXE B ‚Äî PIPELINE (WARM & HOT)"}),s.jsx("div",{className:"text-sm text-slate-400",children:"Focus: Conversion & Momentum"})]})]}),s.jsx(Pm,{studies:t,filters:y,emailFlowByClient:l,antiAnnulationByStudy:r,postRefusByStudy:o,leads:i,onSignStudy:c,onCancelStudy:d,onDeleteStudy:u})]}),s.jsx("div",{className:"mt-16",children:s.jsx(Vm,{leads:i.filter(w=>!t.some(j=>j.client_id===w.client_id)),trafficData:a,globalFilters:y,onSetOptOut:f,onDeleteLead:m})})]})},Bm=({logs:e,zenMode:t})=>{if(t)return null;const[n,i]=N.useState(!1),a=n?e:e.slice(0,10);return s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-3xl",children:"üìú"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white",children:"LOGS DE D√âCISIONS"}),s.jsxs("div",{className:"text-sm text-slate-400",children:[e.length," action",e.length>1?"s":""," enregistr√©e",e.length>1?"s":""]})]})]}),e.length>10&&s.jsx("button",{onClick:()=>i(!n),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-bold text-sm transition-colors",children:n?"‚¨ÜÔ∏è R√©duire":`‚¨áÔ∏è Voir tous (${e.length})`})]}),e.length===0?s.jsxs("div",{className:"p-8 bg-slate-800/30 border border-slate-700/50 rounded-2xl text-center",children:[s.jsx("div",{className:"text-4xl mb-3",children:"üìù"}),s.jsx("div",{className:"text-lg font-bold text-slate-400",children:"Aucune action enregistr√©e"}),s.jsx("div",{className:"text-sm text-slate-500 mt-2",children:"Les d√©cisions appara√Ætront ici"})]}):s.jsx("div",{className:"space-y-2",children:a.map(r=>{const o=new Date().getTime()-new Date(r.created_at).getTime()<36e5;return s.jsx("div",{className:`p-4 rounded-xl border transition-all ${o?"glass-panel bg-blue-500/10 border-blue-500/30 shadow-[0_0_15px_rgba(59,130,246,0.1)]":"glass-panel border-white/5 hover:border-white/10"}`,children:s.jsx("div",{className:"flex items-start justify-between gap-4",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("span",{className:"text-lg font-bold text-white",children:r.client_name}),s.jsx("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-400 border border-blue-500/30 rounded text-xs font-bold",children:r.action_performed})]}),s.jsx("p",{className:"text-sm text-slate-400 mb-1",children:r.justification}),s.jsx("div",{className:"text-xs text-slate-500",children:Rm(r.created_at)})]})})},r.id)})})]})},$m=({system:e})=>{const{logs:t,zenMode:n}=e;return s.jsxs("div",{className:"space-y-12",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("span",{className:"text-3xl",children:"‚öôÔ∏è"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white uppercase tracking-wider",children:"Syst√®me & Logs"}),s.jsx("div",{className:"text-sm text-slate-400 font-medium",children:"Diagnostic, activit√©s en temps r√©el et √©tat du Brain"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsx(Bm,{logs:t,zenMode:n})}),s.jsx("div",{className:"space-y-6",children:s.jsxs("div",{className:"glass-panel p-6 rounded-2xl border border-white/5",children:[s.jsx("h3",{className:"text-blue-400 font-bold mb-4 uppercase text-xs tracking-widest",children:"√âtat du Cerveau"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-slate-400",children:"Version Architecture"}),s.jsx("span",{className:"text-white font-mono",children:"v2.0 (Cockpit)"})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-slate-400",children:"Mode Synchronisation"}),s.jsx("span",{className:"text-emerald-400 font-mono",children:"Real-time"})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-slate-400",children:"Latence Brain"}),s.jsx("span",{className:"text-white font-mono",children:"12ms"})]})]})]})})]})]})},at=({active:e,onClick:t,icon:n,label:i})=>s.jsxs("button",{onClick:t,className:`
      flex items-center gap-2 px-3 py-2 rounded-lg text-xs font-bold uppercase tracking-wider transition-all
      ${e?"bg-blue-600 text-white shadow-lg shadow-blue-500/25":"text-slate-400 hover:text-white hover:bg-white/5"}
    `,children:[s.jsx("span",{children:n}),s.jsx("span",{className:"hidden md:inline",children:i})]}),Um=({zenMode:e,priorityMode:t,onToggleZenMode:n,onTogglePriorityMode:i,onRefresh:a,lastRefresh:r,systemStatus:o="normal",totalStudies:l=0,totalClients:c=0,signedClients:d=0,unsubscribedCount:u=0,unsubscribeRate:p=0,activeSection:h,setActiveSection:f,globalDateFilter:m="current_month",onSetDateFilter:y})=>{const b=c>0?Math.round(d/c*100):0,w={normal:"bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]",active:"bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]",warning:"bg-orange-500 shadow-[0_0_8px_rgba(245,158,11,0.5)] animate-pulse",critical:"bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.5)] animate-ping"},j=jl();return s.jsx("header",{className:"fixed top-2 left-2 right-2 z-50",children:s.jsxs("div",{className:"glass-panel rounded-2xl px-2 md:px-4 py-2 border border-white/10 shadow-2xl relative overflow-visible min-h-16 h-auto flex flex-wrap xl:grid xl:grid-cols-[1.2fr_auto_1fr] items-center gap-2 md:gap-4 justify-between",children:[s.jsx("div",{className:"absolute top-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-blue-500/30 to-transparent"}),s.jsxs("div",{className:"flex items-center gap-4 overflow-hidden",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/20 ring-1 ring-white/10",children:s.jsx("span",{className:"text-xl",children:"‚ö°"})}),s.jsxs("div",{className:"hidden xl:block",children:[s.jsxs("h1",{className:"text-base font-black text-white tracking-widest leading-none",children:["AUTOPILOTE ",s.jsx("span",{className:"text-blue-400",children:"SOLAIRE"})]}),s.jsxs("div",{className:"text-[9px] text-zinc-500 font-bold uppercase tracking-tight mt-1 truncate",children:["Clients: ",c," ",s.jsx("span",{className:"mx-0.5 opacity-30",children:"‚Ä¢"})," Dossiers: ",l]})]})]}),s.jsxs("div",{className:"hidden lg:flex items-center gap-3 pl-4 border-l border-white/5 overflow-hidden whitespace-nowrap",children:[s.jsx("div",{className:"flex flex-col",children:s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsxs("span",{className:"text-sm font-black text-white",children:[b,"%"]}),s.jsx("div",{className:"w-8 h-1 bg-white/5 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${b}%`}})})]})}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[9px] text-emerald-500/70 font-black uppercase leading-none",children:"Sign√©s"}),s.jsx("span",{className:"text-sm font-black text-emerald-400",children:d})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[9px] text-red-500/70 font-black uppercase leading-none",children:"D√©sab."}),s.jsxs("div",{className:"flex items-baseline gap-1",children:[s.jsx("span",{className:"text-sm font-black text-red-400",children:u}),s.jsxs("span",{className:"text-[8px] text-red-500/40 font-bold",children:[p.toFixed(0),"%"]})]})]})]})]}),s.jsx("div",{className:"flex justify-center px-0 md:px-2 overflow-x-auto no-scrollbar",children:s.jsxs("div",{className:"flex items-center gap-1 bg-black/40 p-1 rounded-xl border border-white/5 shadow-inner backdrop-blur-md",children:[s.jsx(at,{active:h==="cockpit"||h==="dashboard",onClick:()=>f("cockpit"),icon:"üõ∞Ô∏è",label:"Cockpit"}),s.jsx(at,{active:h==="war_room",onClick:()=>f("war_room"),icon:"‚öîÔ∏è",label:"War Room"}),s.jsx(at,{active:h==="pilotage",onClick:()=>f("pilotage"),icon:"üß≠",label:"Pilotage"}),s.jsx(at,{active:h==="sales",onClick:()=>f("sales"),icon:"üìà",label:"Vente"}),s.jsx(at,{active:h==="roi",onClick:()=>f("roi"),icon:"üíé",label:"ROI"}),s.jsx(at,{active:h==="registry",onClick:()=>f("registry"),icon:"üóÇÔ∏è",label:"Registre"})]})}),s.jsx("div",{className:"h-4 w-px bg-white/10 mx-1"}),s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[r&&s.jsxs("div",{className:"hidden min-[1600px]:flex items-center gap-2 px-2 py-1 rounded-lg bg-black/20 border border-white/5 whitespace-nowrap",children:[s.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${w[o]||w.normal}`}),s.jsxs("div",{className:"text-[9px] text-slate-500 font-mono font-bold",children:["SYNC: ",r.toLocaleTimeString("fr-FR")]})]}),s.jsxs("div",{className:"flex bg-black/40 p-0.5 rounded-lg border border-white/10",children:[s.jsx("button",{onClick:()=>y==null?void 0:y("current_month"),className:`px-3 py-1.5 rounded-md text-[9px] font-black uppercase tracking-wider transition-all ${m==="current_month"?"bg-emerald-500 text-white shadow-lg shadow-emerald-500/20":"text-slate-500 hover:text-slate-300"}`,children:"Mois en Cours"}),s.jsx("button",{onClick:()=>y==null?void 0:y("all_time"),className:`px-3 py-1.5 rounded-md text-[9px] font-black uppercase tracking-wider transition-all ${m==="all_time"?"bg-violet-600 text-white shadow-lg shadow-violet-600/20":"text-slate-500 hover:text-slate-300"}`,children:"Historique"})]}),s.jsx("div",{className:"h-4 w-px bg-white/10 mx-1"}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsxs("button",{onClick:i,className:`h-8 px-2.5 rounded-lg font-black text-[9px] uppercase tracking-wider transition-all flex items-center gap-1.5 ${t?"bg-orange-600 text-white shadow-lg shadow-orange-600/20":"bg-white/5 text-slate-500 hover:text-slate-300"}`,children:[s.jsx("span",{children:"üî•"}),s.jsx("span",{className:"hidden sm:inline",children:"Priorit√©"})]}),s.jsxs("button",{onClick:n,className:`h-8 px-2.5 rounded-lg font-black text-[9px] uppercase tracking-wider transition-all flex items-center gap-1.5 ${e?"bg-violet-600 text-white shadow-lg shadow-violet-600/20":"bg-white/5 text-slate-500 hover:text-slate-300"}`,children:[s.jsx("span",{children:"üßò"}),s.jsx("span",{className:"hidden sm:inline",children:"Zen"})]})]}),s.jsx("button",{onClick:()=>j("/admin"),className:"w-auto h-8 px-3 rounded-full border border-white/10 flex items-center justify-center bg-slate-900 ml-1 flex-shrink-0 hover:bg-slate-800 hover:border-orange-500/50 hover:text-orange-500 transition-all cursor-pointer group",children:s.jsx("span",{className:"text-[10px] font-black text-slate-400 group-hover:text-orange-500 transition-colors",children:"ADMIN"})})]})]})})},Wm=({progress:e,step:t})=>{const n=[{id:1,label:"Connexion",threshold:15},{id:2,label:"Chargement",threshold:35},{id:3,label:"Analyse",threshold:60},{id:4,label:"Calcul",threshold:85}];return s.jsxs("div",{className:"fixed inset-0 z-50 bg-[#020617] flex items-center justify-center overflow-hidden",children:[s.jsx("style",{children:`
  @keyframes scan-line {
    0% { transform: translateY(-100%); }
    100% { transform: translateY(100%); }
  }
  .scan-overlay {
    background: linear-gradient(to bottom, transparent, rgba(59, 130, 246, 0.1), transparent);
    animation: scan-line 3s linear infinite;
  }
`}),s.jsx("div",{className:"absolute inset-0 scan-overlay pointer-events-none"}),s.jsxs("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden",children:[s.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-blue-600/10 rounded-full blur-[120px] animate-pulse-soft"}),s.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-purple-600/10 rounded-full blur-[120px] animate-pulse-soft",style:{animationDelay:"1s"}})]}),s.jsxs("div",{className:"relative z-10 flex flex-col items-center gap-10 p-12 w-full max-w-3xl",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"w-32 h-32 glass-panel rounded-3xl flex items-center justify-center shadow-[0_0_40px_rgba(59,130,246,0.3)]",children:s.jsx("span",{className:"text-6xl filter drop-shadow-[0_0_15px_rgba(255,255,255,0.5)]",children:"‚ö°"})}),s.jsx("div",{className:"absolute inset-0 rounded-3xl border border-blue-500/30 animate-ping",style:{animationDuration:"3s"}})]}),s.jsxs("div",{className:"text-center space-y-2",children:[s.jsx("h1",{className:"text-4xl font-black text-white tracking-tight neon-text-blue",children:"AUTOPILOTE SOLAIRE"}),s.jsx("div",{className:"text-sm text-slate-400 uppercase tracking-[0.3em] font-mono",children:"Initialisation du Syst√®me"})]}),s.jsxs("div",{className:"w-full max-w-md space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-end",children:[s.jsx("span",{className:"text-blue-400 font-mono text-xs",children:t}),s.jsxs("span",{className:"text-2xl font-bold font-mono text-white",children:[e,"%"]})]}),s.jsx("div",{className:"h-1.5 w-full bg-slate-800/50 rounded-full overflow-hidden backdrop-blur-sm border border-white/5",children:s.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500 transition-all duration-300 ease-out shadow-[0_0_15px_rgba(59,130,246,0.6)]",style:{width:`${e}%`}})})]}),s.jsx("div",{className:"grid grid-cols-4 gap-4 w-full",children:n.map(i=>{const a=e>=i.threshold;return s.jsxs("div",{className:`
                  relative flex flex-col items-center gap-3 p-4 rounded-xl border transition-all duration-500
                  ${a?"bg-blue-900/20 border-blue-500/30 shadow-[0_0_20px_rgba(59,130,246,0.1)]":"bg-slate-900/20 border-white/5 text-slate-600"}
                `,children:[s.jsx("div",{className:`
                  w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold font-mono border
                  ${a?"bg-blue-500 border-blue-400 text-white shadow-[0_0_10px_rgba(59,130,246,0.5)]":"bg-slate-800 border-slate-700 text-slate-500"}
                `,children:a?"‚úì":i.id}),s.jsx("div",{className:`
                  text-xs font-bold uppercase tracking-wider
                  ${a?"text-blue-300":"text-slate-600"}
                `,children:i.label})]},i.id)})})]})]})},zm=({isOpen:e,title:t,message:n,studyName:i,actionType:a,onConfirm:r,onCancel:o})=>{const[l,c]=N.useState(""),[d,u]=N.useState(!1);if(!e)return null;const p=a==="force_sign"?"green":a==="delete"?"red":a==="override"?"orange":"blue",h={green:{border:"border-green-500/50",btn:"bg-green-600 hover:bg-green-500 shadow-green-500/20",icon:"‚úÖ"},red:{border:"border-red-500/50",btn:"bg-red-600 hover:bg-red-500 shadow-red-500/20",icon:"üóëÔ∏è"},orange:{border:"border-orange-500/50",btn:"bg-orange-600 hover:bg-orange-500 shadow-orange-500/20",icon:"‚ö†Ô∏è"},blue:{border:"border-blue-500/50",btn:"bg-blue-600 hover:bg-blue-500 shadow-blue-500/20",icon:"‚ÑπÔ∏è"}}[p],f=["Trop cher / Budget","Raison Technique / Toiture","Concurrent moins cher","Refus Client / Ne r√©pond plus","Projet Abandonn√©","Erreur de saisie / Doublon"],m=async()=>{if(!l.trim()){alert("‚ö†Ô∏è Veuillez fournir une justification");return}if(l.trim().length<10){alert("‚ö†Ô∏è La justification doit contenir au moins 10 caract√®res");return}u(!0);try{await r(l.trim()),c("")}catch(b){console.error("Error confirming override:",b),alert("‚ùå Erreur lors de la confirmation")}finally{u(!1)}},y=()=>{c(""),o()};return s.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-fadeIn",children:s.jsxs("div",{className:`
          glass-panel w-full max-w-lg rounded-2xl overflow-hidden border-2 ${h.border} 
          shadow-[0_0_50px_rgba(0,0,0,0.5)] transform transition-all animate-slideUp
        `,children:[s.jsx("div",{className:"p-6 border-b border-white/5 bg-white/5",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-bold text-white mb-1 flex items-center gap-2",children:[s.jsx("span",{className:"text-2xl",children:h.icon}),t]}),i&&s.jsxs("div",{className:"text-sm text-slate-300 ml-9",children:["Dossier :"," ",s.jsx("span",{className:"font-bold text-white",children:i})]})]}),s.jsx("button",{onClick:y,disabled:d,className:"text-slate-400 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-full",children:"‚úï"})]})}),s.jsxs("div",{className:"p-6 space-y-6",children:[n&&s.jsx("div",{className:"bg-slate-900/50 border border-slate-700/50 rounded-xl p-4",children:s.jsx("p",{className:"text-slate-300 leading-relaxed text-sm",children:n})}),s.jsx("div",{className:`rounded-xl p-4 ${p==="red"?"bg-red-500/10 border border-red-500/20":"bg-orange-500/10 border border-orange-500/20"}`,children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("span",{className:"text-xl",children:"üõ°Ô∏è"}),s.jsxs("div",{children:[s.jsx("div",{className:`font-bold text-sm mb-0.5 ${p==="red"?"text-red-400":"text-orange-400"}`,children:"Action critique - Justification requise"}),s.jsx("div",{className:"text-xs text-slate-400",children:"Cette action sera enregistr√©e de mani√®re immuable dans les logs de s√©curit√©."})]})]})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("label",{className:"block text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Justification"}),s.jsx("span",{className:"text-[10px] text-slate-500",children:"Requis pour valider"})]}),s.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:f.map(b=>s.jsx("button",{onClick:()=>c(b),className:"px-2.5 py-1 bg-slate-800 hover:bg-slate-700 border border-slate-700 hover:border-slate-600 rounded-md text-[10px] text-slate-300 transition-colors",children:b},b))}),s.jsx("textarea",{value:l,onChange:b=>c(b.target.value),rows:3,disabled:d,placeholder:"Expliquez la raison de cette action exceptionnelle...",className:"w-full bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-slate-600 focus:border-white/20 focus:ring-1 focus:ring-white/20 focus:outline-none resize-none text-sm transition-all"}),s.jsx("div",{className:"flex justify-end mt-1",children:s.jsxs("span",{className:`text-[10px] ${l.trim().length<10?"text-orange-400":"text-emerald-400"}`,children:[l.trim().length,"/10 caract√®res"]})})]})]}),s.jsxs("div",{className:"p-4 bg-black/20 border-t border-white/5 flex items-center justify-end gap-3",children:[s.jsx("button",{onClick:y,disabled:d,className:"px-4 py-2 hover:bg-white/5 text-slate-400 hover:text-white rounded-lg font-bold text-sm transition-colors",children:"Annuler"}),s.jsx("button",{onClick:m,disabled:d||l.trim().length<10,className:`px-4 py-2 text-white rounded-lg font-bold text-sm transition-all shadow-lg hover:shadow-xl hover:scale-[1.02] active:scale-95 ${h.btn} disabled:opacity-50 disabled:cursor-not-allowed`,children:"Confirmer Action"})]})]})})};function Gm(){const{studies:e,emailLeads:t,logs:n,metrics:i,financialStats:a,loading:r,loadingProgress:o,loadingStep:l,error:c,trafficData:d,emailFlowByClient:u,antiAnnulationByStudy:p,postRefusByStudy:h,actions:{refresh:f,signStudy:m,cancelStudy:y,deleteStudy:b,markDepositPaid:w,markRibSent:j,deleteLeadPermanently:k,setOptOut:C,logForceAction:_}}=vc(),[g,x]=N.useState("cockpit"),[v,S]=N.useState(new Date),[T,M]=N.useState({search:"",views:null,clicks:null,status:null,optout:!1}),[P,V]=N.useState(!1),[A,F]=N.useState(!1),[ae,W]=N.useState("performance"),[O,X]=N.useState({isOpen:!1,title:"",onConfirm:async()=>{}}),be=N.useCallback(()=>{f(),S(new Date)},[f]),ve=N.useMemo(()=>wc(e,t,i),[e,t,i]);N.useCallback(()=>{x("war_room")},[]);const Je=()=>{X(I=>({...I,isOpen:!1}))},Qe=async(I,Y)=>{X({isOpen:!0,title:"Forcer la signature ?",message:"Cette action va contourner les v√©rifications automatiques.",studyName:Y,actionType:"force_sign",onConfirm:async ee=>{await m(I,Y),X(me=>({...me,isOpen:!1}))}})},et=async(I,Y)=>{X({isOpen:!0,title:"Confirmer l'annulation",message:"Le dossier sera marqu√© comme annul√©. Irr√©versible.",studyName:Y,actionType:"delete",onConfirm:async ee=>{await y(I,Y,ee),X(me=>({...me,isOpen:!1}))}})},Ue=async(I,Y)=>{X({isOpen:!0,title:"Supprimer d√©finitivement ?",message:"Toutes les donn√©es associ√©es seront perdues.",studyName:Y,actionType:"delete",onConfirm:async ee=>{await b(I,Y),X(me=>({...me,isOpen:!1}))}})},tt=async(I,Y)=>{await w(I,Y)},D=async(I,Y)=>{await j(I,Y)},L=async I=>{await C(I)},$=async(I,Y,ee)=>{await k(I,Y,ee)},[z,G]=N.useState("current_month"),{filteredStudies:ne,filteredLeads:fe,filteredMetrics:de,filteredFinancialStats:ye}=N.useMemo(()=>{if(z==="all_time")return{filteredStudies:e,filteredLeads:t,filteredMetrics:i,filteredFinancialStats:a};const I=new Date,Y=I.getMonth(),ee=I.getFullYear(),me=ue=>{if(!ue)return!1;const Nt=new Date(ue);return Nt.getMonth()===Y&&Nt.getFullYear()===ee},jt=e.filter(ue=>me(ue.created_at)||ue.signed_at&&me(ue.signed_at)||ue.deposit_paid_at&&me(ue.deposit_paid_at)),Wt=t.filter(ue=>me(ue.created_at)),We=rr(jt);return{filteredStudies:jt,filteredLeads:Wt,filteredMetrics:We,filteredFinancialStats:We.financialStats}},[e,t,i,a,z]),re=N.useMemo(()=>({studies:ne,emailLeads:fe,logs:n,metrics:de,financialStats:ye,loading:r,systemInitialized:!0,loadingProgress:100,loadingStep:"Ready",error:null,emailFlowByClient:u,antiAnnulationByStudy:p,postRefusByStudy:h,trafficData:d,zenMode:P,setActiveSection:x,actions:{refresh:f,signStudy:Qe,cancelStudy:et,deleteStudy:Ue,markDepositPaid:tt,markRibSent:D,setOptOut:L,deleteLeadPermanently:$,logForceAction:_||(async(I,Y)=>console.warn(`Agent Log System inactive: ${Y} on ${I}`)),updateStudyStatus:async()=>console.warn("Update Study Status: Not connected to Agent yet")}}),[ne,fe,n,de,ye,r,u,p,h,d,P,f,_]);return r?s.jsx(Wm,{progress:o,step:l}):c?s.jsxs("div",{className:"text-red-500 p-10 text-center text-xl font-bold bg-slate-900 h-screen flex items-center justify-center",children:["üõë ",c]}):s.jsxs("div",{className:"min-h-screen bg-[#020617] text-slate-200 font-sans selection:bg-blue-500/30",children:[s.jsx(zm,{isOpen:O.isOpen,title:O.title,message:O.message,studyName:O.studyName,actionType:O.actionType,onConfirm:O.onConfirm,onCancel:Je}),s.jsx(Um,{zenMode:P,priorityMode:A,onToggleZenMode:()=>V(!P),onTogglePriorityMode:()=>F(!A),onRefresh:be,lastRefresh:v,systemStatus:(i==null?void 0:i.systemState)==="stable"?"normal":i==null?void 0:i.systemState,activeSection:g,setActiveSection:x,unsubscribedCount:ve.unsubscribedCount,unsubscribeRate:ve.unsubscribeRate,totalStudies:ve.totalStudies,totalClients:ve.totalStudies,signedClients:ve.signedStudies,globalDateFilter:z,onSetDateFilter:G}),s.jsxs("main",{className:"max-w-[1600px] mx-auto px-6 py-8 space-y-12 mt-20",children:[g==="cockpit"&&s.jsx(dm,{system:re}),g==="war_room"&&s.jsx(mm,{system:re}),g==="pilotage"&&s.jsx(Nm,{system:re}),g==="sales"&&s.jsx(Am,{system:re}),g==="roi"&&s.jsx(Em,{system:re}),g==="registry"&&s.jsx(Fm,{system:re}),g==="system"&&s.jsx($m,{system:re}),g==="dashboard"&&s.jsxs("div",{className:"text-center py-20",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-500",children:"Le Monolithe a √©t√© d√©mantel√©."}),s.jsx("p",{className:"text-slate-600 mt-2",children:"Veuillez utiliser le Cockpit comme point d'entr√©e."}),s.jsx("button",{onClick:()=>x("cockpit"),className:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg font-bold",children:"Retour au Cockpit"})]})]})]})}export{Gm as default};
