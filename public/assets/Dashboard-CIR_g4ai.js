import{c as Ot,R as zs,a as qa,i as bn,t as Qo,b as el,d as Ht,l as tl,s as Ga,r as N,e as W,f as sl,g as yn,h as nl,k as Ka,m as il,n as al,o as rl,P as hi,G as ie,_ as pi,j as s,p as Hs,q as Me,L as fi,A as Dt,v as _e,w as ut,x as mt,y as gs,B as ol,z as ss,C as ll,T as _t,S as Ke,Z as cl,D as dl,E as ul,F as hl,H as mi,I as pl,J as xt,K as Ya,M as Xa,N as Za,O as fl,Q as ml,U as xl,u as gl}from"./index-DMr2AfFM.js";/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bl=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],xi=Ot("activity",bl);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yl=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],vl=Ot("credit-card",yl);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wl=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]],jl=Ot("file-down",wl);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nl=[["path",{d:"M5 12h14",key:"1ays0h"}]],Sl=Ot("minus",Nl);/**
 * @license lucide-react v0.555.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kl=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],_l=Ot("search",kl);var Cl=["className","innerRef"];function qs(){return qs=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},qs.apply(this,arguments)}function Tl(e,t){if(e==null)return{};var n={},i=Object.keys(e),a,o;for(o=0;o<i.length;o++)a=i[o],!(t.indexOf(a)>=0)&&(n[a]=e[a]);return n}function gi(e){var t=e.className,n=e.innerRef,i=Tl(e,Cl);return zs.createElement("circle",qs({ref:n,className:qa("visx-circle",t)},i))}class bi extends Map{constructor(t,n=Dl){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[i,a]of t)this.set(i,a)}get(t){return super.get(yi(this,t))}has(t){return super.has(yi(this,t))}set(t,n){return super.set(Al(this,t),n)}delete(t){return super.delete(El(this,t))}}function yi({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):n}function Al({_intern:e,_key:t},n){const i=t(n);return e.has(i)?e.get(i):(e.set(i,n),n)}function El({_intern:e,_key:t},n){const i=t(n);return e.has(i)&&(n=e.get(i),e.delete(i)),n}function Dl(e){return e!==null&&typeof e=="object"?e.valueOf():e}function Ml(e,t,n){e=+e,t=+t,n=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+n;for(var i=-1,a=Math.max(0,Math.ceil((t-e)/n))|0,o=new Array(a);++i<a;)o[i]=e+i*n;return o}const vi=Symbol("implicit");function Ja(){var e=new bi,t=[],n=[],i=vi;function a(o){let r=e.get(o);if(r===void 0){if(i!==vi)return i;e.set(o,r=t.push(o)-1)}return n[r%n.length]}return a.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new bi;for(const r of o)e.has(r)||e.set(r,t.push(r)-1);return a},a.range=function(o){return arguments.length?(n=Array.from(o),a):n.slice()},a.unknown=function(o){return arguments.length?(i=o,a):i},a.copy=function(){return Ja(t,n).unknown(i)},bn.apply(a,arguments),a}function Qa(){var e=Ja().unknown(void 0),t=e.domain,n=e.range,i=0,a=1,o,r,l=!1,c=0,d=0,u=.5;delete e.unknown;function p(){var h=t().length,f=a<i,m=f?a:i,y=f?i:a;o=(y-m)/Math.max(1,h-c+d*2),l&&(o=Math.floor(o)),m+=(y-m-o*(h-c))*u,r=o*(1-c),l&&(m=Math.round(m),r=Math.round(r));var b=Ml(h).map(function(w){return m+o*w});return n(f?b.reverse():b)}return e.domain=function(h){return arguments.length?(t(h),p()):t()},e.range=function(h){return arguments.length?([i,a]=h,i=+i,a=+a,p()):[i,a]},e.rangeRound=function(h){return[i,a]=h,i=+i,a=+a,l=!0,p()},e.bandwidth=function(){return r},e.step=function(){return o},e.round=function(h){return arguments.length?(l=!!h,p()):l},e.padding=function(h){return arguments.length?(c=Math.min(1,d=+h),p()):c},e.paddingInner=function(h){return arguments.length?(c=Math.min(1,h),p()):c},e.paddingOuter=function(h){return arguments.length?(d=+h,p()):d},e.align=function(h){return arguments.length?(u=Math.max(0,Math.min(1,h)),p()):u},e.copy=function(){return Qa(t(),[i,a]).round(l).paddingInner(c).paddingOuter(d).align(u)},bn.apply(p(),arguments)}function wi(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Rl(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Pl(e){return e<0?-e*e:e*e}function Il(e){var t=e(Ht,Ht),n=1;function i(){return n===1?e(Ht,Ht):n===.5?e(Rl,Pl):e(wi(n),wi(1/n))}return t.exponent=function(a){return arguments.length?(n=+a,i()):n},tl(t)}function er(){var e=Il(Qo());return e.copy=function(){return el(e,er()).exponent(e.exponent())},bn.apply(e,arguments),e}function Ll(){return er.apply(null,arguments).exponent(.5)}var Ol=Ga("domain","range","reverse","align","padding","round");function vn(e){return Ol(Qa(),e)}var Vl=Ga("domain","range","reverse","clamp","interpolate","nice","round","zero");function Fl(e){return Vl(Ll(),e)}function gt(e){const t=new Date(e),i=new Date().getTime()-t.getTime();return Math.floor(i/(1e3*60*60*24))}function Xe(e){const t=e.views||0,n=e.clicks||0,i=e.send_count||0;return t===0&&n===0&&i>=4?"fatigue":t===0&&n===0?"muet":t>10?"cas_limite":t>=3&&n===0?"agite":n>=1?"interesse":"stable"}function Bl(e){let a=0;if(e.signed_at){const p=gt(e.signed_at);a=Math.min(p/14*100,100)}const o=e.total_price||0,r=Math.min(o/3e4*100,100),l=Xe(e);let c=0;l==="stable"&&(c=0),l==="interesse"&&(c=20),l==="agite"&&(c=60),l==="muet"&&(c=80),l==="fatigue"&&(c=100),(e.send_count||0)>5&&(c=Math.min(c+20,100));const u=a*.5+r*.3+c*.2;return Math.min(100,Math.round(u))}const tr=[];function Ul(){return tr.filter(e=>e.outcome==="FAILURE")}function $l(){return tr.filter(e=>e.outcome==="SUCCESS")}function sr(e){const t=Ul(),n=$l();if(t.length+n.length<5)return Math.min(100,Math.round(e.dangerScore));let i=0;i+=e.dangerScore*.5,i+=e.tensionLevel*.3,e.behavior==="muet"&&(i+=15),e.behavior==="agite"&&(i+=8);const a=t.length/(t.length+n.length);return i=i*(1+a),Math.min(100,Math.round(i))}const Wl=14,zl=2e4,Hl=1e4,ql=5,Gl=2;function Kl(e){return e.status!=="signed"||e.has_deposit!==!0||e.deposit_paid===!0||!e.signed_at?!1:gt(e.signed_at)<=Wl}function Yl(e){return e.status!=="signed"?!1:e.has_deposit===!0&&e.deposit_paid===!1}function Xl(e){return e.status!=="signed"||e.has_deposit!==!0||e.deposit_paid===!0||!e.signed_at?!1:gt(e.signed_at)>10}function nr(e){const t=Xe(e);return t==="fatigue"?"STOP_AUTO_CALL":t==="muet"?"CALL":t==="agite"?"RELANCE":t==="interesse"?"ACCELERER":(e.dangerScore||0)>70?"CALL":"SURVEILLER"}function Zl(e){if(e.length===0)return null;const t=e[0],n=Xe(t),i=nr(t);let a="Dossier prioritaire";return n==="muet"?a="Client muet apr√®s signature, risque de d√©crochage":n==="fatigue"?a="Lead br√ªl√© : 0 interaction apr√®s relances multiples":n==="agite"?a="Client agit√©, consulte sans avancer":n==="interesse"&&(a="Client int√©ress√©, moment cl√© pour conclure"),t.dangerScore>70&&(a="Risque critique (temps + argent + comportement)"),{id:t.id,name:t.name,email:t.email,phone:t.phone,dangerScore:t.dangerScore,behavior:n,action:i,reason:a,daysSinceSigned:t.signed_at?gt(t.signed_at):null,total_price:t.total_price||0,requiresDeposit:t.requiresDeposit||!1,status:t.status,signed_at:t.signed_at,created_at:t.created_at,last_view:t.last_view}}function Jl(e){return e.slice(0,3).map((t,n)=>{const i=Xe(t),a=nr(t);let o="Suivi standard";return i==="muet"?o="Client muet, risque de d√©crochage":i==="agite"?o="Client agit√©, bloque mentalement":i==="interesse"&&(o="Client int√©ress√©, moment cl√©"),t.dangerScore>70&&(o="Risque critique (temps + argent + comportement)"),{rank:n+1,id:t.id,name:t.name,email:t.email,phone:t.phone,dangerScore:t.dangerScore,behavior:i,action:a,reason:o,total_price:t.total_price||0,requiresDeposit:t.requiresDeposit||!1,status:t.status,signed_at:t.signed_at,created_at:t.created_at,last_view:t.last_view}})}function Ql(e,t){if(e.length===0&&t===0)return 0;let i=e.length>0?e.reduce((a,o)=>a+o.dangerScore,0)/e.length:0;return i+=e.length*5,i+=Math.min(t/5e3,30),Math.min(100,Math.round(i))}function ec(e){if(e.lateDepositCount>0)return"critical";const{actionNowCount:t,cashAtRisk:n,sentCount:i,signedCount:a}=e;return t>=ql||n>zl?"critical":t>=Gl||n>Hl?"warning":i>=5||a>=3?"active":"stable"}function tc(e){const{tensionLevel:t,systemState:n,priorityActions:i}=e;return n==="critical"?{active:!0,level:"critical",message:"üö® SYST√àME SOUS PRESSION CRITIQUE",focus:i[0]||null}:t>70?{active:!0,level:"high",message:"‚ö†Ô∏è Forte tension d√©tect√©e",focus:i[0]||null}:t>40?{active:!0,level:"medium",message:"‚ö° Syst√®me sous tension",focus:i[0]||null}:{active:!1,level:"normal",message:"Syst√®me stable",focus:null}}function sc(e,t){if(!t||!t.warRoom||!t.finance)return{cashSecured:0,cashAtRisk:0,warRoomCA:0,securedCount:0,riskCount:0,warRoomCount:0,lateCount:0,lateNames:"‚Äî",nextDeadlineDate:"‚Äî",nextDeadlineClient:"‚Äî",caTotal:0,tauxConversion:0,cashWaitingDeposit:0,waitingDepositCount:0,cashCancellable:0,cancellableCount:0,cashAtFatigue:0,securedPotential:0};const n=new Date,i=e.filter(g=>g.status==="signed"),a=i.reduce((g,x)=>g+(x.total_price||0),0),o=i.filter(g=>g.contract_secured),r=o.reduce((g,x)=>g+(x.total_price||0),0),l=i.filter(g=>!g.contract_secured&&!g.deposit_paid&&g.has_deposit),c=l.reduce((g,x)=>g+(x.total_price||0),0),d=i.filter(g=>!g.contract_secured&&!(!g.deposit_paid&&g.has_deposit)),u=d.reduce((g,x)=>g+(x.total_price||0),0),p=t.behavioral.fatigues.reduce((g,x)=>g+(x.total_price||0),0),h=a,f=t.warRoom.studies,m=t.finance.cashAtRisk,y=t.warRoom.ca,b=f.filter(g=>{if(!g.signed_at)return!1;const x=new Date(g.signed_at);return Math.floor((n.getTime()-x.getTime())/864e5)>10&&!g.deposit_paid}),w=b.map(g=>g.name).join(", ")||"Aucun retard",j=d.filter(g=>g.signed_at).map(g=>({name:g.name,signedDate:new Date(g.signed_at),deadlineDate:new Date(new Date(g.signed_at).getTime()+336*60*60*1e3)})).sort((g,x)=>g.deadlineDate.getTime()-x.deadlineDate.getTime())[0],k=j?j.deadlineDate.toLocaleDateString("fr-FR"):"‚Äî",C=j?j.name:"Aucune √©ch√©ance proche",_=e.length>0?i.length/e.length*100:0;return{cashSecured:r,cashAtRisk:m,warRoomCA:y,securedCount:o.length,riskCount:f.length,warRoomCount:t.warRoom.studies.length,lateCount:b.length,lateNames:w,nextDeadlineDate:k,nextDeadlineClient:C,caTotal:a,tauxConversion:_,cashWaitingDeposit:c,waitingDepositCount:l.length,cashCancellable:u,cancellableCount:d.length,cashAtFatigue:p,securedPotential:h}}function ir(e){const t=e.filter(v=>v.status==="signed"),n=e.filter(v=>v.status==="sent"),i=t.filter(Kl).map(v=>{const S=Bl(v),A=Xe(v),R=v.signed_at?gt(v.signed_at):0;return{...v,dangerScore:S,behavior:A,daysLate:R,cancellationRisk:0}}).sort((v,S)=>S.dangerScore-v.dangerScore),a=i.map(v=>v.id),o=i.reduce((v,S)=>v+(S.total_price||0),0),r=t.filter(Yl),l=t.filter(Xl),c=r.reduce((v,S)=>v+(S.total_price||0),0),d=Ql(i,c),u=i.map(v=>({...v,cancellationRisk:sr({dangerScore:v.dangerScore,tensionLevel:d,behavior:v.behavior})})),p=Zl(u),h=Jl(u),f=[...u,...r.filter(v=>!a.includes(v.id)),...l.filter(v=>!a.includes(v.id)&&!r.find(S=>S.id===v.id))],m=e.map(v=>{const S=Xe(v);return{...v,risk:S}}),y=m.filter(v=>v.risk==="muet"),b=m.filter(v=>v.risk==="agite"),w=m.filter(v=>v.risk==="interesse"),j=m.filter(v=>v.risk==="fatigue"),k=e.filter(v=>!a.includes(v.id)&&!r.find(S=>S.id===v.id)),C=ec({actionNowCount:f.length,cashAtRisk:c,sentCount:n.length,signedCount:t.length,lateDepositCount:l.length}),_=tc({tensionLevel:d,systemState:C,priorityActions:h}),g={signed:t,sent:n,healthy:k,lateDeposits:l,warRoom:{studies:u,count:u.length,ca:o},finance:{riskyDeposits:r,cashAtRisk:c},actionNow:f,behavioral:{muets:y,agites:b,interesses:w,fatigues:j},systemState:C,priorityCase:p,tensionLevel:d,priorityActions:h,urgencyMode:_},x=sc(e,g);return{...g,financialStats:x}}function ar(e){const t=e.views||0,n=e.clicks||0,i=e.send_count||0;if(t===0&&n===0&&i>=4)return{state:"FATIGUE",icon:"üò¥",label:"FATIGUE"};const a=Xe(e);return a==="muet"?{state:"MUET",icon:"üßä",label:"SILENCE"}:a==="cas_limite"?{state:"CAS_LIMITE",icon:"‚ö†Ô∏è",label:"CAS LIMITE"}:a==="agite"?{state:"AGIT√â",icon:"üî•",label:"AGIT√â"}:a==="interesse"?{state:"INT√âRESS√â",icon:"üü¢",label:"INT√âRESS√â"}:{state:"STABLE",icon:"‚ö™",label:"STABLE"}}function nc(e,t,n={},i={}){var x,v,S,A,R,P,L,T,V,te,$,F,K,be,ve,Ze,Je,Qe;const a=e.id,o=((x=e.clients)==null?void 0:x.id)||"",r=n[String(a)]||n[String(o)],l=i[String(a)]||i[String(o)],c=(((v=r==null?void 0:r.sent)==null?void 0:v.length)||0)+(((S=l==null?void 0:l.sent)==null?void 0:S.length)||0);t||console.warn("‚ö†Ô∏è Pas de stats trouv√© pour study:",e.id,(A=e.clients)==null?void 0:A.email);const d=gt(e.created_at),u=new Date;let p=(t==null?void 0:t.email_opens)??(t==null?void 0:t.views)??(t==null?void 0:t.total_opens)??0,h=(t==null?void 0:t.interactions)??(t==null?void 0:t.clicks)??(t==null?void 0:t.total_clicks)??0;(P=(R=e.clients)==null?void 0:R.last_name)!=null&&P.toUpperCase().includes("GUYOT")&&console.log(`üìä Study ${(L=e.clients)==null?void 0:L.first_name} ${(T=e.clients)==null?void 0:T.last_name}:`,{id:e.id,views:p,clicks:h,stat_found:!!t,stat_data:t});const f=e.total_price||e.install_cost||((V=e.study_data)==null?void 0:V.installCost)||0,m=e.cash_apport??((te=e.study_data)==null?void 0:te.cashApport)??0;let y,b;m>=f&&f>0?(y="cash",b="cash_payment"):m>0&&m<f?(y="financing",b="partial_financing"):(y="financing",b="full_financing"),e.payment_mode&&(y=e.payment_mode),e.financing_mode&&(b=e.financing_mode);const w=b==="cash_payment"||b==="partial_financing";(F=($=e.clients)==null?void 0:$.last_name)!=null&&F.toUpperCase().includes("DUCHENE")&&console.log("üîç MAPPERS DEBUG DUCHENE:",{name:`${(K=e.clients)==null?void 0:K.first_name} ${(be=e.clients)==null?void 0:be.last_name}`,apport:m,totalCost:f,mode:y,financingMode:b,requiresDepositCalc:w,db_has_deposit:e.has_deposit,db_deposit_amount:e.deposit_amount});const j=e.signed_at?Math.floor((u.getTime()-new Date(e.signed_at).getTime())/864e5):null,k=!e.signed_at||e.status!=="signed"||e.deposit_paid||!w?!1:j!==null&&j>0,C={id:e.id,client_id:((ve=e.clients)==null?void 0:ve.id)||"",name:e.clients?`${e.clients.first_name||""} ${e.clients.last_name||""}`.trim():"Inconnu",email:((Ze=e.clients)==null?void 0:Ze.email)||"Pas d'email",phone:(Je=e.clients)==null?void 0:Je.phone,status:e.status,created_at:e.created_at,signed_at:e.signed_at,study_data:e.study_data,deposit_amount:e.deposit_amount||0,deposit_paid:e.deposit_paid||!1,deposit_paid_at:e.deposit_paid_at,payment_mode:y,payment_type:e.payment_type||null,financing_mode:b,has_deposit:w||e.has_deposit,cash_apport:m,total_price:f,install_cost:e.install_cost||0,contract_secured:e.status==="signed"&&(j!==null&&j>=14||e.deposit_paid||!1),cancellation_deadline:e.cancellation_deadline||null,revenue_secured:e.status==="signed"?f:0,revenue_projected:f,revenue_gap:e.status!=="signed"?f:0,views:p,clicks:h,diffDays:Math.floor(d),hasLog:!1,rib_sent:e.rib_sent||!1,rib_sent_at:e.rib_sent_at,email_optout:((Qe=e.clients)==null?void 0:Qe.email_optout)||!1,last_open:(t==null?void 0:t.last_open)||(t==null?void 0:t.last_open_at)||(t==null?void 0:t.last_email_open)||null,last_click:(t==null?void 0:t.last_click)||(t==null?void 0:t.last_click_at)||null,last_view:(t==null?void 0:t.last_view)||null,requiresDeposit:w,daysLate:j||0,daysSinceSigned:j,isDepositLate:k,behavioralState:void 0,behavioralIcon:void 0,behavioralLabel:void 0,send_count:c},_=ar(C);C.behavioralState=_.state;let g=C.dangerScore||0;if(g===0){const Ue=p||0,et=h||0,M=Math.max(j||0,d||0);_.state==="MUET"?g=65+Math.min(M,20):_.state==="FATIGUE"?g=85+Math.min(M,15):_.state==="AGIT√â"?g=45+Math.min(Ue*2,20):_.state==="CAS_LIMITE"?g=30+Math.min(M,10):_.state==="INT√âRESS√â"?g=18+Math.min(M,12)-Math.min(et*2,10)+Math.min(Ue,5):g=5+Math.min(Ue,7);const O=parseInt(C.id.slice(0,2),16)%5-2;g+=O}return C.cancellationRisk=sr({dangerScore:Math.max(5,Math.min(98,g)),tensionLevel:C.status==="signed"?50:30,behavior:_.state}),C.dangerScore=g,C}function ji(e){return e.status==="signed"?"signed":e.clicks>0?"hot":e.views>=2?"warm":"cold"}const oe=[];for(let e=0;e<256;++e)oe.push((e+256).toString(16).slice(1));function ic(e,t=0){return(oe[e[t+0]]+oe[e[t+1]]+oe[e[t+2]]+oe[e[t+3]]+"-"+oe[e[t+4]]+oe[e[t+5]]+"-"+oe[e[t+6]]+oe[e[t+7]]+"-"+oe[e[t+8]]+oe[e[t+9]]+"-"+oe[e[t+10]]+oe[e[t+11]]+oe[e[t+12]]+oe[e[t+13]]+oe[e[t+14]]+oe[e[t+15]]).toLowerCase()}let js;const ac=new Uint8Array(16);function rc(){if(!js){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");js=crypto.getRandomValues.bind(crypto)}return js(ac)}const oc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Ni={randomUUID:oc};function lc(e,t,n){var a;e=e||{};const i=e.random??((a=e.rng)==null?void 0:a.call(e))??rc();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,ic(i)}function cc(e,t,n){return Ni.randomUUID&&!e?Ni.randomUUID():lc(e)}const dc=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():cc(),uc=e=>new Promise((t,n)=>setTimeout(()=>n(new Error(`Timeout Supabase after ${e}ms`)),e));async function Ns(e,t=15e3){return Promise.race([e,uc(t)])}function hc(){const[e,t]=N.useState([]),[n,i]=N.useState([]),[a,o]=N.useState([]),[r,l]=N.useState(null),[c,d]=N.useState(!0),[u,p]=N.useState(null),[h,f]=N.useState(!1),[m,y]=N.useState(null),[b,w]=N.useState({}),[j,k]=N.useState({}),[C,_]=N.useState({}),[g,x]=N.useState([]),[v,S]=N.useState(0),[A,R]=N.useState(""),P=N.useCallback(async()=>{if(h)return;const M=[{progress:15,text:"Connexion Supabase...",duration:600},{progress:35,text:"Chargement dossiers...",duration:800},{progress:60,text:"Analyse m√©triques...",duration:700},{progress:85,text:"Calcul risques...",duration:600},{progress:100,text:"Syst√®me pr√™t !",duration:500}];for(let O=0;O<M.length;O++){const U=M[O];await new Promise(Y=>setTimeout(Y,U.duration)),S(U.progress),R(U.text)}await new Promise(O=>setTimeout(O,200)),f(!0)},[h]),L=async(M,O,U,Y="*",X)=>{const fe=[];for(let de=0;de<U.length;de+=800){const ye=U.slice(de,de+800);let ae=W.from(M).select(Y).in(O,ye);X&&(ae=ae.order(X.col,{ascending:X.ascending}));const{data:I,error:q}=await Ns(ae);if(q)throw q;I&&fe.push(...I)}return{data:fe,error:null}},T=N.useCallback(async(M=!1)=>{try{M||d(!0),y(null);const O=W.from("decision_logs").select("*").order("created_at",{ascending:!1}).limit(50),U=Ns(W.from("studies").select(`
            id, client_id, status, created_at, signed_at, study_data,
            deposit_amount, deposit_paid, deposit_paid_at, has_deposit,
            payment_type, payment_mode, cash_apport,
            total_price: install_cost, financing_mode, contract_secured, cancellation_deadline,
            clients (id, first_name, last_name, email, phone, email_optout)
        `)),[Y,X]=await Promise.all([O,U]),{data:ce,error:fe}=X,de=Y.data||[];if(Y.error&&console.error("Logs fetch failed",Y.error),o(de),fe)throw fe;const ye=(ce||[]).map(E=>E.id),ae=(ce||[]).map(E=>E.client_id).filter(Boolean),I=ye.length>0?L("tracking_events","study_id",ye,"study_id, event_type, created_at"):Promise.resolve({data:[]}),q=ae.length>0?L("email_queue","client_id",ae,"study_id, client_id, email_type, status, sent_at, scheduled_for, created_at",{col:"created_at",ascending:!1}):Promise.resolve({data:[]}),[se,me]=await Promise.allSettled([I,q]),wt=se.status==="fulfilled"?se.value.data||[]:[];se.status==="rejected"&&console.error("Tracking fetch failed",se.reason);const $t=me.status==="fulfilled"?me.value.data||[]:[];me.status==="rejected"&&console.error("Queue fetch failed",me.reason);const $e=new Map,ue={},jt=new Map;wt.forEach(E=>{if(!E.study_id)return;$e.has(E.study_id)||($e.set(E.study_id,{id:E.study_id,email_opens:0,interactions:0,last_open_at:null,last_click_at:null}),ue[E.study_id]={total_opens:0},jt.set(E.study_id,new Set));const B=$e.get(E.study_id),J=ue[E.study_id],G=jt.get(E.study_id),z=new Date(E.created_at).toISOString().substring(0,16);if(E.event_type==="email_open"||E.event_type==="view")G.has(z)||(B.email_opens++,J.total_opens++,G.add(z)),(!B.last_open_at||E.created_at>B.last_open_at)&&(B.last_open_at=E.created_at,J.last_open=E.created_at);else if(E.event_type==="email_click"||E.event_type==="click"){const Ne=`click-${z}`;G.has(Ne)||(B.interactions++,G.add(Ne)),(!B.last_click_at||E.created_at>B.last_click_at)&&(B.last_click_at=E.created_at,J.last_click=E.created_at)}});const Yo=Array.from($e.values()),ti={};(ce||[]).forEach(E=>{E.client_id&&(ti[E.client_id]=E.id)});const Wt={},zt={};$t.forEach(E=>{var st,ai,ri,oi,li,ci,di;const B=E.study_id||(E.client_id?ti[E.client_id]:null);if(!B)return;const J={...E,opened_at:((st=ue[B])==null?void 0:st.last_open)||null,clicked_at:((ai=ue[B])==null?void 0:ai.last_click)||null},z=((ri=E.email_type)==null?void 0:ri.startsWith("post_refus"))||((oi=E.email_type)==null?void 0:oi.includes("relance"))||((li=E.email_type)==null?void 0:li.includes("prospecting"))?zt:Wt;z[B]||(z[B]={sent:[],next:null,total_opens:((ci=ue[B])==null?void 0:ci.total_opens)||0});const Ne=["sent","SUCCESS","success","delivered","processed"].includes(((di=E.status)==null?void 0:di.toLowerCase())||""),tt=["pending","scheduled","PENDING"].includes(E.status||"");if(Ne)z[B].sent.push(J);else if(tt){const ui=z[B].next;(!ui||new Date(E.scheduled_for)<new Date(ui.scheduled_for))&&(z[B].next=J)}E.client_id&&(z[String(E.client_id)]=z[B])}),[Wt,zt].forEach(E=>{Object.keys(E).forEach(B=>{E[B].sent.sort((J,G)=>new Date(J.sent_at).getTime()-new Date(G.sent_at).getTime())})}),k(Wt),_(zt);const si=(ce||[]).map(E=>{var tt;const J=(tt=(Array.isArray(E.clients)?E.clients:E.clients?[E.clients]:[])[0])==null?void 0:tt.id,G=J?n.find(st=>st.client_id===J):null,z=Yo.find(st=>st.id===E.id)||{id:E.id,email_opens:0,interactions:0},Ne={...z,email_opens:z.email_opens>0?z.email_opens:(G==null?void 0:G.total_opens)||0,interactions:z.interactions>0?z.interactions:(G==null?void 0:G.total_clicks)||0,last_open:z.last_open_at||(G==null?void 0:G.last_opened_at),last_click:z.last_click_at||(G==null?void 0:G.last_clicked_at)};return nc(E,Ne,Wt,zt)});t(si);const Pe=ir(si);if(l(Pe),p(Pe.financialStats),Pe.priorityCase){const E=dc();try{await W.from("decision_logs").insert({id:E,study_id:Pe.priorityCase.id,created_at:new Date().toISOString(),action_performed:`PRIORITY_FLAG_${Pe.priorityCase.action.toUpperCase().replace(/\s+/g,"_")}`,justification:JSON.stringify({danger:Pe.priorityCase.dangerScore,behavior:Pe.priorityCase.behavior,state:Pe.systemState})})}catch(B){console.warn("Log failed:",B)}}const Xo=14,We=new Map,Zo=new Date;for(let E=Xo-1;E>=0;E--){const B=new Date;B.setDate(Zo.getDate()-E);const J=B.toISOString().split("T")[0];We.set(J,{date:J,count:0,opened:0,clicked:0})}const Nt=new Map;$t.forEach(E=>{var J;if(["sent","SUCCESS","success","delivered","processed"].includes(((J=E.status)==null?void 0:J.toLowerCase())||"")&&E.sent_at&&E.study_id){const G=new Date(E.sent_at).getTime();Nt.has(E.study_id)||Nt.set(E.study_id,[]),Nt.get(E.study_id).push(G);const z=new Date(E.sent_at).toISOString().split("T")[0];We.has(z)&&We.get(z).count++}}),Nt.forEach(E=>E.sort((B,J)=>B-J));const ni=new Set,ii=new Set;wt.forEach(E=>{if(!E.study_id||!E.created_at)return;const B=new Date(E.created_at).getTime(),J=Nt.get(E.study_id);if(!J)return;const G=[...J].reverse().find(tt=>tt<=B);if(!G)return;const z=new Date(G).toISOString().split("T")[0];if(!We.has(z))return;const Ne=`${E.study_id}-${z}`;(E.event_type==="email_open"||E.event_type==="view")&&(ni.has(Ne)||(ni.add(Ne),We.get(z).opened++)),(E.event_type==="email_click"||E.event_type==="click")&&(ii.has(Ne)||(ii.add(Ne),We.get(z).clicked++))});const Jo=Array.from(We.values()).sort((E,B)=>E.date.localeCompare(B.date));x(Jo)}catch(O){console.error("‚ùå System Brain Error:",O),y(O.message)}finally{d(!1)}},[n]),V=N.useCallback(async()=>{try{const{data:M,error:O}=await Ns(W.from("email_leads").select(`
          id, client_id, created_at, last_email_sent_at, next_email_scheduled_at,
          email_step, total_opens, total_clicks, last_opened_at, last_clicked_at,
          clients!inner(id, first_name, last_name, email, email_optout)
        `).order("next_email_scheduled_at",{ascending:!0}));if(O)throw O;const U=M.map(I=>I.client_id).filter(Boolean),{data:Y}=await W.from("studies").select("id, client_id").in("client_id",U),X={};(Y||[]).forEach(I=>{I.client_id&&(X[I.client_id]=I.id)});const ce=Object.values(X).filter(Boolean);let fe={},de={};if(ce.length>0){const{data:I}=await W.from("tracking_events").select("study_id, created_at").in("study_id",ce).in("event_type",["email_open","view"]);(I||[]).forEach(se=>{fe[se.study_id]||(fe[se.study_id]=se.created_at)});const{data:q}=await W.from("tracking_events").select("study_id, created_at").in("study_id",ce).in("event_type",["email_click","click"]);(q||[]).forEach(se=>{de[se.study_id]||(de[se.study_id]=se.created_at)})}const ye=(M||[]).map(I=>te(I,X,fe,de));i(ye);const ae={};ye.forEach(I=>{ae[I.client_id]={step:I.email_sequence_step,last:I.last_email_sent,next:I.next_email_date,opens:I.total_opens,clicks:I.total_clicks,opted_out:I.opted_out,last_opened:I.last_opened_at,last_clicked:I.last_clicked_at}}),w(ae)}catch(M){console.error(M)}},[]);function te(M,O,U,Y){var ce,fe,de,ye;const X=O[M.client_id]||null;return{id:M.id,client_id:M.client_id,study_id:X,client_name:`${((ce=M.clients)==null?void 0:ce.first_name)||""} ${((fe=M.clients)==null?void 0:fe.last_name)||""}`.trim(),client_email:((de=M.clients)==null?void 0:de.email)||"",opted_out:((ye=M.clients)==null?void 0:ye.email_optout)||!1,email_sequence_step:M.email_step||0,last_email_sent:M.last_email_sent_at,next_email_date:M.next_email_scheduled_at,total_opens:M.total_opens||0,total_clicks:M.total_clicks||0,last_opened_at:X?U[X]:M.last_opened_at,last_clicked_at:X?Y[X]:M.last_clicked_at,created_at:M.created_at}}const $=N.useCallback(async(M,O,U,Y="Manuel")=>{const{error:X}=await W.from("studies").update({status:O,signed_at:O==="signed"?new Date().toISOString():null}).eq("id",M);X||(await W.from("decision_logs").insert({study_id:M,client_name:U,action_performed:`STATUS_CHANGE_${O.toUpperCase()}`,justification:Y}),T())},[T]),F=N.useCallback(async(M,O)=>{const{error:U}=await W.from("studies").update({status:"signed",signed_at:new Date().toISOString()}).eq("id",M);return U?(console.error("Erreur signature",U),!1):(await T(!0),!0)},[T]),K=N.useCallback(async(M,O)=>{const{error:U}=await W.from("studies").update({status:"cancelled"}).eq("id",M);return U?(console.error("Erreur annulation",U),!1):(await T(!0),!0)},[T]),be=N.useCallback(async(M,O,U="virement")=>{let Y;try{Y=(await W.from("studies").update({deposit_paid:!0,deposit_paid_at:new Date().toISOString(),deposit_payment_mode:U.toLowerCase().trim()}).eq("id",M)).error}catch{Y=(await W.from("studies").update({deposit_paid:!0,deposit_paid_at:new Date().toISOString()}).eq("id",M)).error}if(Y)return console.error("Erreur paiement",Y),!1;try{await W.from("decision_logs").insert({study_id:M,client_name:O,action_performed:"DEPOSIT_PAID_CONFIRMED",justification:`Mode: ${U}`})}catch(X){console.warn("Log failed",X)}return await T(!0),!0},[T]),ve=N.useCallback(async(M,O)=>{const{error:U}=await W.from("studies").update({rib_sent:!0,rib_sent_at:new Date().toISOString()}).eq("id",M);U?alert("‚ùå Erreur : "+U.message):(await W.from("decision_logs").insert({study_id:M,client_name:O,action_performed:"RIB_SENT_CONFIRMED",justification:"RIB marqu√© comme envoy√©"}),alert("‚úÖ RIB marqu√© comme envoy√© !"),T())},[T]),Ze=N.useCallback(async M=>{const{data:O}=await W.from("clients").update({email_optout:!0}).eq("email",M).select();if(!O||O.length===0){alert("‚ùå ERREUR : Aucun client trouv√© avec cet email");return}await W.from("email_queue").update({status:"cancelled"}).eq("client_id",O[0].id).in("status",["pending","scheduled"]),await W.from("decision_logs").insert({client_name:`${O[0].first_name} ${O[0].last_name}`,action_performed:"EMAIL_OPTOUT",justification:"D√©sabonnement depuis dashboard"}),alert("‚úÖ Client d√©sabonn√© avec succ√®s !"),V(),T()},[T,V]),Je=N.useCallback(async(M,O,U)=>{await W.from("studies").delete().eq("client_id",M),await W.from("email_queue").delete().eq("client_id",M),await W.from("email_leads").delete().eq("client_id",M),await W.from("clients").delete().eq("id",M),await W.from("decision_logs").insert({action_performed:"LEAD_DELETED_PERMANENTLY",client_name:U,justification:`Suppression d√©finitive ${O}`}),alert("‚úÖ Lead supprim√© d√©finitivement"),T(),V()},[T,V]),Qe=N.useCallback(async(M,O)=>{await W.from("studies").delete().eq("id",M),await W.from("decision_logs").insert({client_name:O,action_performed:"DELETE_STUDY",justification:"Suppression d√©finitive"}),T()},[T]),Ue=N.useCallback(async(M,O,U,Y)=>{await W.from("decision_logs").insert({study_id:M,client_name:O,action_performed:U,justification:Y})},[]),et=N.useCallback((M=!1)=>{T(M),V()},[T,V]);return N.useEffect(()=>{P(),T(),V();const M=setInterval(()=>{et(!0)},6e4);return()=>clearInterval(M)},[]),N.useEffect(()=>{n.length>0&&T(!0)},[n]),{studies:e,emailLeads:n,logs:a,metrics:r,financialStats:u,loading:c,systemInitialized:h,loadingProgress:v,loadingStep:A,error:m,emailFlowByClient:b,antiAnnulationByStudy:j,postRefusByStudy:C,trafficData:g,actions:{updateStudyStatus:$,signStudy:F,cancelStudy:K,markDepositPaid:be,markRibSent:ve,setOptOut:Ze,deleteLeadPermanently:Je,deleteStudy:Qe,logForceAction:Ue,refresh:et}}}function pc(e,t,n){var m,y,b;const i=e.length,a=e.filter(w=>w.status!=="cancelled").length,o=e.filter(w=>w.status==="signed").length,r=(m=n==null?void 0:n.finance)!=null&&m.riskyDeposits?o-n.finance.riskyDeposits.length:e.filter(w=>w.status==="signed"&&(w.deposit_paid||w.contract_secured)).length,l=((b=(y=n==null?void 0:n.finance)==null?void 0:y.riskyDeposits)==null?void 0:b.length)||0,c=t.length,d=t.filter(w=>!w.opted_out).length,u=t.reduce((w,j)=>w+(j.email_sequence_step||0),0),p=t.filter(w=>w.next_email_date).length,h=t.filter(w=>w.opted_out).length,f=c>0?h/c*100:0;return{totalStudies:i,activeStudies:a,signedStudies:o,securedStudies:r,waitingStudies:l,totalLeads:c,activeLeads:d,totalEmailsSent:u,pendingEmails:p,unsubscribedCount:h,unsubscribeRate:f}}var qt={},Gt={},Si;function fc(){if(Si)return Gt;Si=1,Gt.__esModule=!0,Gt.default=r;var e=n(sl()),t=yn();function n(l){return l&&l.__esModule?l:{default:l}}function i(){return i=Object.assign?Object.assign.bind():function(l){for(var c=1;c<arguments.length;c++){var d=arguments[c];for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])}return l},i.apply(this,arguments)}var a=[],o={width:0,height:0,top:0,left:0};function r(l){var c=l===void 0?{}:l,d=c.initialSize,u=d===void 0?o:d,p=c.debounceTime,h=p===void 0?300:p,f=c.ignoreDimensions,m=f===void 0?a:f,y=c.enableDebounceLeadingCall,b=y===void 0?!0:y,w=c.resizeObserverPolyfill,j=(0,t.useRef)(null),k=(0,t.useRef)(0),C=(0,t.useState)(i({},o,u)),_=C[0],g=C[1],x=(0,t.useMemo)(function(){var v=Array.isArray(m)?m:[m];return(0,e.default)(function(S){g(function(A){var R=Object.keys(A),P=R.filter(function(T){return A[T]!==S[T]}),L=P.every(function(T){return v.includes(T)});return L?A:S})},h,{leading:b})},[h,b,m]);return(0,t.useEffect)(function(){var v=w||window.ResizeObserver,S=new v(function(A){A.forEach(function(R){var P,L=(P=R==null?void 0:R.contentRect)!=null?P:{},T=L.left,V=L.top,te=L.width,$=L.height;k.current=window.requestAnimationFrame(function(){x({width:te,height:$,top:V,left:T})})})});return j.current&&S.observe(j.current),function(){window.cancelAnimationFrame(k.current),S.disconnect(),x.cancel()}},[x,w]),i({parentRef:j,resize:x},_)}return Gt}var ki;function mc(){if(ki)return qt;ki=1,qt.__esModule=!0,qt.default=d;var e=o(nl()),t=o(yn()),n=o(fc()),i=["className","children","debounceTime","ignoreDimensions","initialSize","parentSizeStyles","enableDebounceLeadingCall","resizeObserverPolyfill"],a=["parentRef","resize"];function o(u){return u&&u.__esModule?u:{default:u}}function r(){return r=Object.assign?Object.assign.bind():function(u){for(var p=1;p<arguments.length;p++){var h=arguments[p];for(var f in h)Object.prototype.hasOwnProperty.call(h,f)&&(u[f]=h[f])}return u},r.apply(this,arguments)}function l(u,p){if(u==null)return{};var h={},f=Object.keys(u),m,y;for(y=0;y<f.length;y++)m=f[y],!(p.indexOf(m)>=0)&&(h[m]=u[m]);return h}var c={width:"100%",height:"100%"};function d(u){var p=u.className,h=u.children,f=u.debounceTime,m=u.ignoreDimensions,y=u.initialSize,b=u.parentSizeStyles,w=b===void 0?c:b,j=u.enableDebounceLeadingCall,k=j===void 0?!0:j,C=u.resizeObserverPolyfill,_=l(u,i),g=(0,n.default)({initialSize:y,debounceTime:f,ignoreDimensions:m,enableDebounceLeadingCall:k,resizeObserverPolyfill:C}),x=g.parentRef,v=g.resize,S=l(g,a);return t.default.createElement("div",r({style:w,ref:x,className:p},_),h(r({},S,{ref:x.current,resize:v})))}return d.propTypes={className:e.default.string,children:e.default.func.isRequired},qt}var xc=mc();const gc=Ka(xc);var Kt={},_i;function bc(){if(_i)return Kt;_i=1,Kt.__esModule=!0,Kt.default=r;var e=i(yn()),t=i(il()),n=["from","to","fill","className","innerRef"];function i(l){return l&&l.__esModule?l:{default:l}}function a(){return a=Object.assign?Object.assign.bind():function(l){for(var c=1;c<arguments.length;c++){var d=arguments[c];for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(l[u]=d[u])}return l},a.apply(this,arguments)}function o(l,c){if(l==null)return{};var d={},u=Object.keys(l),p,h;for(h=0;h<u.length;h++)p=u[h],!(c.indexOf(p)>=0)&&(d[p]=l[p]);return d}function r(l){var c=l.from,d=c===void 0?{x:0,y:0}:c,u=l.to,p=u===void 0?{x:1,y:1}:u,h=l.fill,f=h===void 0?"transparent":h,m=l.className,y=l.innerRef,b=o(l,n),w=d.x===p.x||d.y===p.y;return e.default.createElement("line",a({ref:y,className:(0,t.default)("visx-line",m),x1:d.x,y1:d.y,x2:p.x,y2:p.y,fill:f,shapeRendering:w?"crispEdges":"auto"},b))}return Kt}var yc=bc();const vc=Ka(yc);function wc(e){return"bandwidth"in e?e.bandwidth():0}var jc=["top","left","scale","width","stroke","strokeWidth","strokeDasharray","className","children","numTicks","lineStyle","offset","tickValues"];function Gs(){return Gs=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},Gs.apply(this,arguments)}function Nc(e,t){if(e==null)return{};var n={},i=Object.keys(e),a,o;for(o=0;o<i.length;o++)a=i[o],!(t.indexOf(a)>=0)&&(n[a]=e[a]);return n}function wn(e){var t=e.top,n=t===void 0?0:t,i=e.left,a=i===void 0?0:i,o=e.scale,r=e.width,l=e.stroke,c=l===void 0?"#eaf0f6":l,d=e.strokeWidth,u=d===void 0?1:d,p=e.strokeDasharray,h=e.className,f=e.children,m=e.numTicks,y=m===void 0?10:m,b=e.lineStyle,w=e.offset,j=e.tickValues,k=Nc(e,jc),C=j??al(o,y),_=(w??0)+wc(o)/2,g=C.map(function(x,v){var S,A=((S=rl(o(x)))!=null?S:0)+_;return{index:v,from:new hi({x:0,y:A}),to:new hi({x:r,y:A})}});return zs.createElement(ie,{className:qa("visx-rows",h),top:n,left:a},f?f({lines:g}):g.map(function(x){var v=x.from,S=x.to,A=x.index;return zs.createElement(vc,Gs({key:"row-line-"+A,from:v,to:S,stroke:c,strokeWidth:u,strokeDasharray:p,style:b},k))}))}wn.propTypes={tickValues:pi.array,width:pi.number.isRequired};const jn=N.createContext({});function Nn(e){const t=N.useRef(null);return t.current===null&&(t.current=e()),t.current}const rr=typeof window<"u",or=rr?N.useLayoutEffect:N.useEffect,bs=N.createContext(null);function Sn(e,t){e.indexOf(t)===-1&&e.push(t)}function kn(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const Ee=(e,t,n)=>n>t?t:n<e?e:n;let _n=()=>{};const Re={},lr=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function cr(e){return typeof e=="object"&&e!==null}const dr=e=>/^0[^.\s]+$/u.test(e);function Cn(e){let t;return()=>(t===void 0&&(t=e()),t)}const je=e=>e,Sc=(e,t)=>n=>t(e(n)),Vt=(...e)=>e.reduce(Sc),Mt=(e,t,n)=>{const i=t-e;return i===0?1:(n-e)/i};class Tn{constructor(){this.subscriptions=[]}add(t){return Sn(this.subscriptions,t),()=>kn(this.subscriptions,t)}notify(t,n,i){const a=this.subscriptions.length;if(a)if(a===1)this.subscriptions[0](t,n,i);else for(let o=0;o<a;o++){const r=this.subscriptions[o];r&&r(t,n,i)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Te=e=>e*1e3,we=e=>e/1e3;function ur(e,t){return t?e*(1e3/t):0}const hr=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,kc=1e-7,_c=12;function Cc(e,t,n,i,a){let o,r,l=0;do r=t+(n-t)/2,o=hr(r,i,a)-e,o>0?n=r:t=r;while(Math.abs(o)>kc&&++l<_c);return r}function Ft(e,t,n,i){if(e===t&&n===i)return je;const a=o=>Cc(o,0,1,e,n);return o=>o===0||o===1?o:hr(a(o),t,i)}const pr=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,fr=e=>t=>1-e(1-t),mr=Ft(.33,1.53,.69,.99),An=fr(mr),xr=pr(An),gr=e=>(e*=2)<1?.5*An(e):.5*(2-Math.pow(2,-10*(e-1))),En=e=>1-Math.sin(Math.acos(e)),br=fr(En),yr=pr(En),Tc=Ft(.42,0,1,1),Ac=Ft(0,0,.58,1),vr=Ft(.42,0,.58,1),Ec=e=>Array.isArray(e)&&typeof e[0]!="number",wr=e=>Array.isArray(e)&&typeof e[0]=="number",Dc={linear:je,easeIn:Tc,easeInOut:vr,easeOut:Ac,circIn:En,circInOut:yr,circOut:br,backIn:An,backInOut:xr,backOut:mr,anticipate:gr},Mc=e=>typeof e=="string",Ci=e=>{if(wr(e)){_n(e.length===4);const[t,n,i,a]=e;return Ft(t,n,i,a)}else if(Mc(e))return Dc[e];return e},Yt=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function Rc(e,t){let n=new Set,i=new Set,a=!1,o=!1;const r=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1};function c(u){r.has(u)&&(d.schedule(u),e()),u(l)}const d={schedule:(u,p=!1,h=!1)=>{const m=h&&a?n:i;return p&&r.add(u),m.has(u)||m.add(u),u},cancel:u=>{i.delete(u),r.delete(u)},process:u=>{if(l=u,a){o=!0;return}a=!0,[n,i]=[i,n],n.forEach(c),n.clear(),a=!1,o&&(o=!1,d.process(u))}};return d}const Pc=40;function jr(e,t){let n=!1,i=!0;const a={delta:0,timestamp:0,isProcessing:!1},o=()=>n=!0,r=Yt.reduce((k,C)=>(k[C]=Rc(o),k),{}),{setup:l,read:c,resolveKeyframes:d,preUpdate:u,update:p,preRender:h,render:f,postRender:m}=r,y=()=>{const k=Re.useManualTiming?a.timestamp:performance.now();n=!1,Re.useManualTiming||(a.delta=i?1e3/60:Math.max(Math.min(k-a.timestamp,Pc),1)),a.timestamp=k,a.isProcessing=!0,l.process(a),c.process(a),d.process(a),u.process(a),p.process(a),h.process(a),f.process(a),m.process(a),a.isProcessing=!1,n&&t&&(i=!1,e(y))},b=()=>{n=!0,i=!0,a.isProcessing||e(y)};return{schedule:Yt.reduce((k,C)=>{const _=r[C];return k[C]=(g,x=!1,v=!1)=>(n||b(),_.schedule(g,x,v)),k},{}),cancel:k=>{for(let C=0;C<Yt.length;C++)r[Yt[C]].cancel(k)},state:a,steps:r}}const{schedule:H,cancel:Ve,state:le,steps:Ss}=jr(typeof requestAnimationFrame<"u"?requestAnimationFrame:je,!0);let ns;function Ic(){ns=void 0}const xe={now:()=>(ns===void 0&&xe.set(le.isProcessing||Re.useManualTiming?le.timestamp:performance.now()),ns),set:e=>{ns=e,queueMicrotask(Ic)}},Nr=e=>t=>typeof t=="string"&&t.startsWith(e),Sr=Nr("--"),Lc=Nr("var(--"),Dn=e=>Lc(e)?Oc.test(e.split("/*")[0].trim()):!1,Oc=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu;function Ti(e){return typeof e!="string"?!1:e.split("/*")[0].includes("var(--")}const bt={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Rt={...bt,transform:e=>Ee(0,1,e)},Xt={...bt,default:1},Ct=e=>Math.round(e*1e5)/1e5,Mn=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Vc(e){return e==null}const Fc=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,Rn=(e,t)=>n=>!!(typeof n=="string"&&Fc.test(n)&&n.startsWith(e)||t&&!Vc(n)&&Object.prototype.hasOwnProperty.call(n,t)),kr=(e,t,n)=>i=>{if(typeof i!="string")return i;const[a,o,r,l]=i.match(Mn);return{[e]:parseFloat(a),[t]:parseFloat(o),[n]:parseFloat(r),alpha:l!==void 0?parseFloat(l):1}},Bc=e=>Ee(0,255,e),ks={...bt,transform:e=>Math.round(Bc(e))},qe={test:Rn("rgb","red"),parse:kr("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:i=1})=>"rgba("+ks.transform(e)+", "+ks.transform(t)+", "+ks.transform(n)+", "+Ct(Rt.transform(i))+")"};function Uc(e){let t="",n="",i="",a="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),i=e.substring(5,7),a=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),i=e.substring(3,4),a=e.substring(4,5),t+=t,n+=n,i+=i,a+=a),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(i,16),alpha:a?parseInt(a,16)/255:1}}const Ks={test:Rn("#"),parse:Uc,transform:qe.transform},Bt=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Ie=Bt("deg"),Ae=Bt("%"),D=Bt("px"),$c=Bt("vh"),Wc=Bt("vw"),Ai={...Ae,parse:e=>Ae.parse(e)/100,transform:e=>Ae.transform(e*100)},rt={test:Rn("hsl","hue"),parse:kr("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:i=1})=>"hsla("+Math.round(e)+", "+Ae.transform(Ct(t))+", "+Ae.transform(Ct(n))+", "+Ct(Rt.transform(i))+")"},ee={test:e=>qe.test(e)||Ks.test(e)||rt.test(e),parse:e=>qe.test(e)?qe.parse(e):rt.test(e)?rt.parse(e):Ks.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?qe.transform(e):rt.transform(e),getAnimatableNone:e=>{const t=ee.parse(e);return t.alpha=0,ee.transform(t)}},zc=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Hc(e){var t,n;return isNaN(e)&&typeof e=="string"&&(((t=e.match(Mn))==null?void 0:t.length)||0)+(((n=e.match(zc))==null?void 0:n.length)||0)>0}const _r="number",Cr="color",qc="var",Gc="var(",Ei="${}",Kc=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Pt(e){const t=e.toString(),n=[],i={color:[],number:[],var:[]},a=[];let o=0;const l=t.replace(Kc,c=>(ee.test(c)?(i.color.push(o),a.push(Cr),n.push(ee.parse(c))):c.startsWith(Gc)?(i.var.push(o),a.push(qc),n.push(c)):(i.number.push(o),a.push(_r),n.push(parseFloat(c))),++o,Ei)).split(Ei);return{values:n,split:l,indexes:i,types:a}}function Tr(e){return Pt(e).values}function Ar(e){const{split:t,types:n}=Pt(e),i=t.length;return a=>{let o="";for(let r=0;r<i;r++)if(o+=t[r],a[r]!==void 0){const l=n[r];l===_r?o+=Ct(a[r]):l===Cr?o+=ee.transform(a[r]):o+=a[r]}return o}}const Yc=e=>typeof e=="number"?0:ee.test(e)?ee.getAnimatableNone(e):e;function Xc(e){const t=Tr(e);return Ar(e)(t.map(Yc))}const Fe={test:Hc,parse:Tr,createTransformer:Ar,getAnimatableNone:Xc};function _s(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Zc({hue:e,saturation:t,lightness:n,alpha:i}){e/=360,t/=100,n/=100;let a=0,o=0,r=0;if(!t)a=o=r=n;else{const l=n<.5?n*(1+t):n+t-n*t,c=2*n-l;a=_s(c,l,e+1/3),o=_s(c,l,e),r=_s(c,l,e-1/3)}return{red:Math.round(a*255),green:Math.round(o*255),blue:Math.round(r*255),alpha:i}}function cs(e,t){return n=>n>0?t:e}const Z=(e,t,n)=>e+(t-e)*n,Cs=(e,t,n)=>{const i=e*e,a=n*(t*t-i)+i;return a<0?0:Math.sqrt(a)},Jc=[Ks,qe,rt],Qc=e=>Jc.find(t=>t.test(e));function Di(e){const t=Qc(e);if(!t)return!1;let n=t.parse(e);return t===rt&&(n=Zc(n)),n}const Mi=(e,t)=>{const n=Di(e),i=Di(t);if(!n||!i)return cs(e,t);const a={...n};return o=>(a.red=Cs(n.red,i.red,o),a.green=Cs(n.green,i.green,o),a.blue=Cs(n.blue,i.blue,o),a.alpha=Z(n.alpha,i.alpha,o),qe.transform(a))},Ys=new Set(["none","hidden"]);function ed(e,t){return Ys.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}function td(e,t){return n=>Z(e,t,n)}function Pn(e){return typeof e=="number"?td:typeof e=="string"?Dn(e)?cs:ee.test(e)?Mi:id:Array.isArray(e)?Er:typeof e=="object"?ee.test(e)?Mi:sd:cs}function Er(e,t){const n=[...e],i=n.length,a=e.map((o,r)=>Pn(o)(o,t[r]));return o=>{for(let r=0;r<i;r++)n[r]=a[r](o);return n}}function sd(e,t){const n={...e,...t},i={};for(const a in n)e[a]!==void 0&&t[a]!==void 0&&(i[a]=Pn(e[a])(e[a],t[a]));return a=>{for(const o in i)n[o]=i[o](a);return n}}function nd(e,t){const n=[],i={color:0,var:0,number:0};for(let a=0;a<t.values.length;a++){const o=t.types[a],r=e.indexes[o][i[o]],l=e.values[r]??0;n[a]=l,i[o]++}return n}const id=(e,t)=>{const n=Fe.createTransformer(t),i=Pt(e),a=Pt(t);return i.indexes.var.length===a.indexes.var.length&&i.indexes.color.length===a.indexes.color.length&&i.indexes.number.length>=a.indexes.number.length?Ys.has(e)&&!a.values.length||Ys.has(t)&&!i.values.length?ed(e,t):Vt(Er(nd(i,a),a.values),n):cs(e,t)};function Dr(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?Z(e,t,n):Pn(e)(e,t)}const ad=e=>{const t=({timestamp:n})=>e(n);return{start:(n=!0)=>H.update(t,n),stop:()=>Ve(t),now:()=>le.isProcessing?le.timestamp:xe.now()}},Mr=(e,t,n=10)=>{let i="";const a=Math.max(Math.round(t/n),2);for(let o=0;o<a;o++)i+=Math.round(e(o/(a-1))*1e4)/1e4+", ";return`linear(${i.substring(0,i.length-2)})`},ds=2e4;function In(e){let t=0;const n=50;let i=e.next(t);for(;!i.done&&t<ds;)t+=n,i=e.next(t);return t>=ds?1/0:t}function rd(e,t=100,n){const i=n({...e,keyframes:[0,t]}),a=Math.min(In(i),ds);return{type:"keyframes",ease:o=>i.next(a*o).value/t,duration:we(a)}}const od=5;function Rr(e,t,n){const i=Math.max(t-od,0);return ur(n-e(i),t-i)}const Q={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},Ts=.001;function ld({duration:e=Q.duration,bounce:t=Q.bounce,velocity:n=Q.velocity,mass:i=Q.mass}){let a,o,r=1-t;r=Ee(Q.minDamping,Q.maxDamping,r),e=Ee(Q.minDuration,Q.maxDuration,we(e)),r<1?(a=d=>{const u=d*r,p=u*e,h=u-n,f=Xs(d,r),m=Math.exp(-p);return Ts-h/f*m},o=d=>{const p=d*r*e,h=p*n+n,f=Math.pow(r,2)*Math.pow(d,2)*e,m=Math.exp(-p),y=Xs(Math.pow(d,2),r);return(-a(d)+Ts>0?-1:1)*((h-f)*m)/y}):(a=d=>{const u=Math.exp(-d*e),p=(d-n)*e+1;return-Ts+u*p},o=d=>{const u=Math.exp(-d*e),p=(n-d)*(e*e);return u*p});const l=5/e,c=dd(a,o,l);if(e=Te(e),isNaN(c))return{stiffness:Q.stiffness,damping:Q.damping,duration:e};{const d=Math.pow(c,2)*i;return{stiffness:d,damping:r*2*Math.sqrt(i*d),duration:e}}}const cd=12;function dd(e,t,n){let i=n;for(let a=1;a<cd;a++)i=i-e(i)/t(i);return i}function Xs(e,t){return e*Math.sqrt(1-t*t)}const ud=["duration","bounce"],hd=["stiffness","damping","mass"];function Ri(e,t){return t.some(n=>e[n]!==void 0)}function pd(e){let t={velocity:Q.velocity,stiffness:Q.stiffness,damping:Q.damping,mass:Q.mass,isResolvedFromDuration:!1,...e};if(!Ri(e,hd)&&Ri(e,ud))if(e.visualDuration){const n=e.visualDuration,i=2*Math.PI/(n*1.2),a=i*i,o=2*Ee(.05,1,1-(e.bounce||0))*Math.sqrt(a);t={...t,mass:Q.mass,stiffness:a,damping:o}}else{const n=ld(e);t={...t,...n,mass:Q.mass},t.isResolvedFromDuration=!0}return t}function us(e=Q.visualDuration,t=Q.bounce){const n=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:t}:e;let{restSpeed:i,restDelta:a}=n;const o=n.keyframes[0],r=n.keyframes[n.keyframes.length-1],l={done:!1,value:o},{stiffness:c,damping:d,mass:u,duration:p,velocity:h,isResolvedFromDuration:f}=pd({...n,velocity:-we(n.velocity||0)}),m=h||0,y=d/(2*Math.sqrt(c*u)),b=r-o,w=we(Math.sqrt(c/u)),j=Math.abs(b)<5;i||(i=j?Q.restSpeed.granular:Q.restSpeed.default),a||(a=j?Q.restDelta.granular:Q.restDelta.default);let k;if(y<1){const _=Xs(w,y);k=g=>{const x=Math.exp(-y*w*g);return r-x*((m+y*w*b)/_*Math.sin(_*g)+b*Math.cos(_*g))}}else if(y===1)k=_=>r-Math.exp(-w*_)*(b+(m+w*b)*_);else{const _=w*Math.sqrt(y*y-1);k=g=>{const x=Math.exp(-y*w*g),v=Math.min(_*g,300);return r-x*((m+y*w*b)*Math.sinh(v)+_*b*Math.cosh(v))/_}}const C={calculatedDuration:f&&p||null,next:_=>{const g=k(_);if(f)l.done=_>=p;else{let x=_===0?m:0;y<1&&(x=_===0?Te(m):Rr(k,_,g));const v=Math.abs(x)<=i,S=Math.abs(r-g)<=a;l.done=v&&S}return l.value=l.done?r:g,l},toString:()=>{const _=Math.min(In(C),ds),g=Mr(x=>C.next(_*x).value,_,30);return _+"ms "+g},toTransition:()=>{}};return C}us.applyToOptions=e=>{const t=rd(e,100,us);return e.ease=t.ease,e.duration=Te(t.duration),e.type="keyframes",e};function Zs({keyframes:e,velocity:t=0,power:n=.8,timeConstant:i=325,bounceDamping:a=10,bounceStiffness:o=500,modifyTarget:r,min:l,max:c,restDelta:d=.5,restSpeed:u}){const p=e[0],h={done:!1,value:p},f=v=>l!==void 0&&v<l||c!==void 0&&v>c,m=v=>l===void 0?c:c===void 0||Math.abs(l-v)<Math.abs(c-v)?l:c;let y=n*t;const b=p+y,w=r===void 0?b:r(b);w!==b&&(y=w-p);const j=v=>-y*Math.exp(-v/i),k=v=>w+j(v),C=v=>{const S=j(v),A=k(v);h.done=Math.abs(S)<=d,h.value=h.done?w:A};let _,g;const x=v=>{f(h.value)&&(_=v,g=us({keyframes:[h.value,m(h.value)],velocity:Rr(k,v,h.value),damping:a,stiffness:o,restDelta:d,restSpeed:u}))};return x(0),{calculatedDuration:null,next:v=>{let S=!1;return!g&&_===void 0&&(S=!0,C(v),x(v)),_!==void 0&&v>=_?g.next(v-_):(!S&&C(v),h)}}}function fd(e,t,n){const i=[],a=n||Re.mix||Dr,o=e.length-1;for(let r=0;r<o;r++){let l=a(e[r],e[r+1]);if(t){const c=Array.isArray(t)?t[r]||je:t;l=Vt(c,l)}i.push(l)}return i}function md(e,t,{clamp:n=!0,ease:i,mixer:a}={}){const o=e.length;if(_n(o===t.length),o===1)return()=>t[0];if(o===2&&t[0]===t[1])return()=>t[1];const r=e[0]===e[1];e[0]>e[o-1]&&(e=[...e].reverse(),t=[...t].reverse());const l=fd(t,i,a),c=l.length,d=u=>{if(r&&u<e[0])return t[0];let p=0;if(c>1)for(;p<e.length-2&&!(u<e[p+1]);p++);const h=Mt(e[p],e[p+1],u);return l[p](h)};return n?u=>d(Ee(e[0],e[o-1],u)):d}function xd(e,t){const n=e[e.length-1];for(let i=1;i<=t;i++){const a=Mt(0,t,i);e.push(Z(n,1,a))}}function gd(e){const t=[0];return xd(t,e.length-1),t}function bd(e,t){return e.map(n=>n*t)}function yd(e,t){return e.map(()=>t||vr).splice(0,e.length-1)}function Tt({duration:e=300,keyframes:t,times:n,ease:i="easeInOut"}){const a=Ec(i)?i.map(Ci):Ci(i),o={done:!1,value:t[0]},r=bd(n&&n.length===t.length?n:gd(t),e),l=md(r,t,{ease:Array.isArray(a)?a:yd(t,a)});return{calculatedDuration:e,next:c=>(o.value=l(c),o.done=c>=e,o)}}const vd=e=>e!==null;function Ln(e,{repeat:t,repeatType:n="loop"},i,a=1){const o=e.filter(vd),l=a<0||t&&n!=="loop"&&t%2===1?0:o.length-1;return!l||i===void 0?o[l]:i}const wd={decay:Zs,inertia:Zs,tween:Tt,keyframes:Tt,spring:us};function Pr(e){typeof e.type=="string"&&(e.type=wd[e.type])}class On{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(t=>{this.resolve=t})}notifyFinished(){this.resolve()}then(t,n){return this.finished.then(t,n)}}const jd=e=>e/100;class Vn extends On{constructor(t){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var i,a;const{motionValue:n}=this.options;n&&n.updatedAt!==xe.now()&&this.tick(xe.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(a=(i=this.options).onStop)==null||a.call(i))},this.options=t,this.initAnimation(),this.play(),t.autoplay===!1&&this.pause()}initAnimation(){const{options:t}=this;Pr(t);const{type:n=Tt,repeat:i=0,repeatDelay:a=0,repeatType:o,velocity:r=0}=t;let{keyframes:l}=t;const c=n||Tt;c!==Tt&&typeof l[0]!="number"&&(this.mixKeyframes=Vt(jd,Dr(l[0],l[1])),l=[0,100]);const d=c({...t,keyframes:l});o==="mirror"&&(this.mirroredGenerator=c({...t,keyframes:[...l].reverse(),velocity:-r})),d.calculatedDuration===null&&(d.calculatedDuration=In(d));const{calculatedDuration:u}=d;this.calculatedDuration=u,this.resolvedDuration=u+a,this.totalDuration=this.resolvedDuration*(i+1)-a,this.generator=d}updateTime(t){const n=Math.round(t-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=n}tick(t,n=!1){const{generator:i,totalDuration:a,mixKeyframes:o,mirroredGenerator:r,resolvedDuration:l,calculatedDuration:c}=this;if(this.startTime===null)return i.next(0);const{delay:d=0,keyframes:u,repeat:p,repeatType:h,repeatDelay:f,type:m,onUpdate:y,finalKeyframe:b}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-a/this.speed,this.startTime)),n?this.currentTime=t:this.updateTime(t);const w=this.currentTime-d*(this.playbackSpeed>=0?1:-1),j=this.playbackSpeed>=0?w<0:w>a;this.currentTime=Math.max(w,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=a);let k=this.currentTime,C=i;if(p){const v=Math.min(this.currentTime,a)/l;let S=Math.floor(v),A=v%1;!A&&v>=1&&(A=1),A===1&&S--,S=Math.min(S,p+1),!!(S%2)&&(h==="reverse"?(A=1-A,f&&(A-=f/l)):h==="mirror"&&(C=r)),k=Ee(0,1,A)*l}const _=j?{done:!1,value:u[0]}:C.next(k);o&&(_.value=o(_.value));let{done:g}=_;!j&&c!==null&&(g=this.playbackSpeed>=0?this.currentTime>=a:this.currentTime<=0);const x=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&g);return x&&m!==Zs&&(_.value=Ln(u,this.options,b,this.speed)),y&&y(_.value),x&&this.finish(),_}then(t,n){return this.finished.then(t,n)}get duration(){return we(this.calculatedDuration)}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+we(t)}get time(){return we(this.currentTime)}set time(t){var n;t=Te(t),this.currentTime=t,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.playbackSpeed),(n=this.driver)==null||n.start(!1)}get speed(){return this.playbackSpeed}set speed(t){this.updateTime(xe.now());const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=we(this.currentTime))}play(){var a,o;if(this.isStopped)return;const{driver:t=ad,startTime:n}=this.options;this.driver||(this.driver=t(r=>this.tick(r))),(o=(a=this.options).onPlay)==null||o.call(a);const i=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=i):this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime||(this.startTime=n??i),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(xe.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var t,n;this.notifyFinished(),this.teardown(),this.state="finished",(n=(t=this.options).onComplete)==null||n.call(t)}cancel(){var t,n;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(n=(t=this.options).onCancel)==null||n.call(t)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}attachTimeline(t){var n;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(n=this.driver)==null||n.stop(),t.observe(this)}}function Nd(e){for(let t=1;t<e.length;t++)e[t]??(e[t]=e[t-1])}const Ge=e=>e*180/Math.PI,Js=e=>{const t=Ge(Math.atan2(e[1],e[0]));return Qs(t)},Sd={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:Js,rotateZ:Js,skewX:e=>Ge(Math.atan(e[1])),skewY:e=>Ge(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},Qs=e=>(e=e%360,e<0&&(e+=360),e),Pi=Js,Ii=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),Li=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),kd={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:Ii,scaleY:Li,scale:e=>(Ii(e)+Li(e))/2,rotateX:e=>Qs(Ge(Math.atan2(e[6],e[5]))),rotateY:e=>Qs(Ge(Math.atan2(-e[2],e[0]))),rotateZ:Pi,rotate:Pi,skewX:e=>Ge(Math.atan(e[4])),skewY:e=>Ge(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function en(e){return e.includes("scale")?1:0}function tn(e,t){if(!e||e==="none")return en(t);const n=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let i,a;if(n)i=kd,a=n;else{const l=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);i=Sd,a=l}if(!a)return en(t);const o=i[t],r=a[1].split(",").map(Cd);return typeof o=="function"?o(r):r[o]}const _d=(e,t)=>{const{transform:n="none"}=getComputedStyle(e);return tn(n,t)};function Cd(e){return parseFloat(e.trim())}const yt=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],vt=new Set(yt),Oi=e=>e===bt||e===D,Td=new Set(["x","y","z"]),Ad=yt.filter(e=>!Td.has(e));function Ed(e){const t=[];return Ad.forEach(n=>{const i=e.getValue(n);i!==void 0&&(t.push([n,i.get()]),i.set(n.startsWith("scale")?1:0))}),t}const Oe={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:(e,{transform:t})=>tn(t,"x"),y:(e,{transform:t})=>tn(t,"y")};Oe.translateX=Oe.x;Oe.translateY=Oe.y;const Ye=new Set;let sn=!1,nn=!1,an=!1;function Ir(){if(nn){const e=Array.from(Ye).filter(i=>i.needsMeasurement),t=new Set(e.map(i=>i.element)),n=new Map;t.forEach(i=>{const a=Ed(i);a.length&&(n.set(i,a),i.render())}),e.forEach(i=>i.measureInitialState()),t.forEach(i=>{i.render();const a=n.get(i);a&&a.forEach(([o,r])=>{var l;(l=i.getValue(o))==null||l.set(r)})}),e.forEach(i=>i.measureEndState()),e.forEach(i=>{i.suspendedScrollY!==void 0&&window.scrollTo(0,i.suspendedScrollY)})}nn=!1,sn=!1,Ye.forEach(e=>e.complete(an)),Ye.clear()}function Lr(){Ye.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(nn=!0)})}function Dd(){an=!0,Lr(),Ir(),an=!1}class Fn{constructor(t,n,i,a,o,r=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=i,this.motionValue=a,this.element=o,this.isAsync=r}scheduleResolve(){this.state="scheduled",this.isAsync?(Ye.add(this),sn||(sn=!0,H.read(Lr),H.resolveKeyframes(Ir))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:i,motionValue:a}=this;if(t[0]===null){const o=a==null?void 0:a.get(),r=t[t.length-1];if(o!==void 0)t[0]=o;else if(i&&n){const l=i.readValue(n,r);l!=null&&(t[0]=l)}t[0]===void 0&&(t[0]=r),a&&o===void 0&&a.set(t[0])}Nd(t)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(t=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,t),Ye.delete(this)}cancel(){this.state==="scheduled"&&(Ye.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Md=e=>e.startsWith("--");function Rd(e,t,n){Md(t)?e.style.setProperty(t,n):e.style[t]=n}const Pd=Cn(()=>window.ScrollTimeline!==void 0),Id={};function Ld(e,t){const n=Cn(e);return()=>Id[t]??n()}const Or=Ld(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),kt=([e,t,n,i])=>`cubic-bezier(${e}, ${t}, ${n}, ${i})`,Vi={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:kt([0,.65,.55,1]),circOut:kt([.55,0,1,.45]),backIn:kt([.31,.01,.66,-.59]),backOut:kt([.33,1.53,.69,.99])};function Vr(e,t){if(e)return typeof e=="function"?Or()?Mr(e,t):"ease-out":wr(e)?kt(e):Array.isArray(e)?e.map(n=>Vr(n,t)||Vi.easeOut):Vi[e]}function Od(e,t,n,{delay:i=0,duration:a=300,repeat:o=0,repeatType:r="loop",ease:l="easeOut",times:c}={},d=void 0){const u={[t]:n};c&&(u.offset=c);const p=Vr(l,a);Array.isArray(p)&&(u.easing=p);const h={delay:i,duration:a,easing:Array.isArray(p)?"linear":p,fill:"both",iterations:o+1,direction:r==="reverse"?"alternate":"normal"};return d&&(h.pseudoElement=d),e.animate(u,h)}function Fr(e){return typeof e=="function"&&"applyToOptions"in e}function Vd({type:e,...t}){return Fr(e)&&Or()?e.applyToOptions(t):(t.duration??(t.duration=300),t.ease??(t.ease="easeOut"),t)}class Fd extends On{constructor(t){if(super(),this.finishedTime=null,this.isStopped=!1,this.manualStartTime=null,!t)return;const{element:n,name:i,keyframes:a,pseudoElement:o,allowFlatten:r=!1,finalKeyframe:l,onComplete:c}=t;this.isPseudoElement=!!o,this.allowFlatten=r,this.options=t,_n(typeof t.type!="string");const d=Vd(t);this.animation=Od(n,i,a,d,o),d.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!o){const u=Ln(a,this.options,l,this.speed);this.updateMotionValue?this.updateMotionValue(u):Rd(n,i,u),this.animation.cancel()}c==null||c(),this.notifyFinished()}}play(){this.isStopped||(this.manualStartTime=null,this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var t,n;(n=(t=this.animation).finish)==null||n.call(t)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:t}=this;t==="idle"||t==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var n,i,a;const t=(n=this.options)==null?void 0:n.element;!this.isPseudoElement&&(t!=null&&t.isConnected)&&((a=(i=this.animation).commitStyles)==null||a.call(i))}get duration(){var n,i;const t=((i=(n=this.animation.effect)==null?void 0:n.getComputedTiming)==null?void 0:i.call(n).duration)||0;return we(Number(t))}get iterationDuration(){const{delay:t=0}=this.options||{};return this.duration+we(t)}get time(){return we(Number(this.animation.currentTime)||0)}set time(t){this.manualStartTime=null,this.finishedTime=null,this.animation.currentTime=Te(t)}get speed(){return this.animation.playbackRate}set speed(t){t<0&&(this.finishedTime=null),this.animation.playbackRate=t}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return this.manualStartTime??Number(this.animation.startTime)}set startTime(t){this.manualStartTime=this.animation.startTime=t}attachTimeline({timeline:t,observe:n}){var i;return this.allowFlatten&&((i=this.animation.effect)==null||i.updateTiming({easing:"linear"})),this.animation.onfinish=null,t&&Pd()?(this.animation.timeline=t,je):n(this)}}const Br={anticipate:gr,backInOut:xr,circInOut:yr};function Bd(e){return e in Br}function Ud(e){typeof e.ease=="string"&&Bd(e.ease)&&(e.ease=Br[e.ease])}const As=10;class $d extends Fd{constructor(t){Ud(t),Pr(t),super(t),t.startTime!==void 0&&(this.startTime=t.startTime),this.options=t}updateMotionValue(t){const{motionValue:n,onUpdate:i,onComplete:a,element:o,...r}=this.options;if(!n)return;if(t!==void 0){n.set(t);return}const l=new Vn({...r,autoplay:!1}),c=Math.max(As,xe.now()-this.startTime),d=Ee(0,As,c-As);n.setWithVelocity(l.sample(Math.max(0,c-d)).value,l.sample(c).value,d),l.stop()}}const Fi=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Fe.test(e)||e==="0")&&!e.startsWith("url("));function Wd(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function zd(e,t,n,i){const a=e[0];if(a===null)return!1;if(t==="display"||t==="visibility")return!0;const o=e[e.length-1],r=Fi(a,t),l=Fi(o,t);return!r||!l?!1:Wd(e)||(n==="spring"||Fr(n))&&i}function rn(e){e.duration=0,e.type="keyframes"}const Hd=new Set(["opacity","clipPath","filter","transform"]),qd=Cn(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Gd(e){var u;const{motionValue:t,name:n,repeatDelay:i,repeatType:a,damping:o,type:r}=e;if(!(((u=t==null?void 0:t.owner)==null?void 0:u.current)instanceof HTMLElement))return!1;const{onUpdate:c,transformTemplate:d}=t.owner.getProps();return qd()&&n&&Hd.has(n)&&(n!=="transform"||!d)&&!c&&!i&&a!=="mirror"&&o!==0&&r!=="inertia"}const Kd=40;class Yd extends On{constructor({autoplay:t=!0,delay:n=0,type:i="keyframes",repeat:a=0,repeatDelay:o=0,repeatType:r="loop",keyframes:l,name:c,motionValue:d,element:u,...p}){var m;super(),this.stop=()=>{var y,b;this._animation&&(this._animation.stop(),(y=this.stopTimeline)==null||y.call(this)),(b=this.keyframeResolver)==null||b.cancel()},this.createdAt=xe.now();const h={autoplay:t,delay:n,type:i,repeat:a,repeatDelay:o,repeatType:r,name:c,motionValue:d,element:u,...p},f=(u==null?void 0:u.KeyframeResolver)||Fn;this.keyframeResolver=new f(l,(y,b,w)=>this.onKeyframesResolved(y,b,h,!w),c,d,u),(m=this.keyframeResolver)==null||m.scheduleResolve()}onKeyframesResolved(t,n,i,a){var b,w;this.keyframeResolver=void 0;const{name:o,type:r,velocity:l,delay:c,isHandoff:d,onUpdate:u}=i;this.resolvedAt=xe.now(),zd(t,o,r,l)||((Re.instantAnimations||!c)&&(u==null||u(Ln(t,i,n))),t[0]=t[t.length-1],rn(i),i.repeat=0);const h={startTime:a?this.resolvedAt?this.resolvedAt-this.createdAt>Kd?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:n,...i,keyframes:t},f=!d&&Gd(h),m=(w=(b=h.motionValue)==null?void 0:b.owner)==null?void 0:w.current,y=f?new $d({...h,element:m}):new Vn(h);y.finished.then(()=>{this.notifyFinished()}).catch(je),this.pendingTimeline&&(this.stopTimeline=y.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=y}get finished(){return this._animation?this.animation.finished:this._finished}then(t,n){return this.finished.finally(t).then(()=>{})}get animation(){var t;return this._animation||((t=this.keyframeResolver)==null||t.resume(),Dd()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(t){this.animation.time=t}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(t){this.animation.speed=t}get startTime(){return this.animation.startTime}attachTimeline(t){return this._animation?this.stopTimeline=this.animation.attachTimeline(t):this.pendingTimeline=t,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var t;this._animation&&this.animation.cancel(),(t=this.keyframeResolver)==null||t.cancel()}}function Ur(e,t,n,i=0,a=1){const o=Array.from(e).sort((d,u)=>d.sortNodePosition(u)).indexOf(t),r=e.size,l=(r-1)*i;return typeof n=="function"?n(o,r):a===1?o*i:l-o*i}const Xd=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Zd(e){const t=Xd.exec(e);if(!t)return[,];const[,n,i,a]=t;return[`--${n??i}`,a]}function $r(e,t,n=1){const[i,a]=Zd(e);if(!i)return;const o=window.getComputedStyle(t).getPropertyValue(i);if(o){const r=o.trim();return lr(r)?parseFloat(r):r}return Dn(a)?$r(a,t,n+1):a}const Jd={type:"spring",stiffness:500,damping:25,restSpeed:10},Qd=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),eu={type:"keyframes",duration:.8},tu={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},su=(e,{keyframes:t})=>t.length>2?eu:vt.has(e)?e.startsWith("scale")?Qd(t[1]):Jd:tu,nu=e=>e!==null;function iu(e,{repeat:t,repeatType:n="loop"},i){const a=e.filter(nu),o=t&&n!=="loop"&&t%2===1?0:a.length-1;return a[o]}function Wr(e,t){if(e!=null&&e.inherit&&t){const{inherit:n,...i}=e;return{...t,...i}}return e}function Bn(e,t){const n=(e==null?void 0:e[t])??(e==null?void 0:e.default)??e;return n!==e?Wr(n,e):n}function au({when:e,delay:t,delayChildren:n,staggerChildren:i,staggerDirection:a,repeat:o,repeatType:r,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}const Un=(e,t,n,i={},a,o)=>r=>{const l=Bn(i,e)||{},c=l.delay||i.delay||0;let{elapsed:d=0}=i;d=d-Te(c);const u={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...l,delay:-d,onUpdate:h=>{t.set(h),l.onUpdate&&l.onUpdate(h)},onComplete:()=>{r(),l.onComplete&&l.onComplete()},name:e,motionValue:t,element:o?void 0:a};au(l)||Object.assign(u,su(e,u)),u.duration&&(u.duration=Te(u.duration)),u.repeatDelay&&(u.repeatDelay=Te(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let p=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(rn(u),u.delay===0&&(p=!0)),(Re.instantAnimations||Re.skipAnimations||a!=null&&a.shouldSkipAnimations)&&(p=!0,rn(u),u.delay=0),u.allowFlatten=!l.type&&!l.ease,p&&!o&&t.get()!==void 0){const h=iu(u.keyframes,l);if(h!==void 0){H.update(()=>{u.onUpdate(h),u.onComplete()});return}}return l.isSync?new Vn(u):new Yd(u)};function Bi(e){const t=[{},{}];return e==null||e.values.forEach((n,i)=>{t[0][i]=n.get(),t[1][i]=n.getVelocity()}),t}function $n(e,t,n,i){if(typeof t=="function"){const[a,o]=Bi(i);t=t(n!==void 0?n:e.custom,a,o)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[a,o]=Bi(i);t=t(n!==void 0?n:e.custom,a,o)}return t}function ht(e,t,n){const i=e.getProps();return $n(i,t,n!==void 0?n:i.custom,e)}const zr=new Set(["width","height","top","left","right","bottom",...yt]),Ui=30,ru=e=>!isNaN(parseFloat(e));class ou{constructor(t,n={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=i=>{var o;const a=xe.now();if(this.updatedAt!==a&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(i),this.current!==this.prev&&((o=this.events.change)==null||o.notify(this.current),this.dependents))for(const r of this.dependents)r.dirty()},this.hasAnimated=!1,this.setCurrent(t),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=xe.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=ru(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new Tn);const i=this.events[t].add(n);return t==="change"?()=>{i(),H.read(()=>{this.events.change.getSize()||this.stop()})}:i}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t){this.passiveEffect?this.passiveEffect(t,this.updateAndNotify):this.updateAndNotify(t)}setWithVelocity(t,n,i){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-i}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var t;(t=this.events.change)==null||t.notify(this.current)}addDependent(t){this.dependents||(this.dependents=new Set),this.dependents.add(t)}removeDependent(t){this.dependents&&this.dependents.delete(t)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=xe.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>Ui)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,Ui);return ur(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var t,n;(t=this.dependents)==null||t.clear(),(n=this.events.destroy)==null||n.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function ft(e,t){return new ou(e,t)}const on=e=>Array.isArray(e);function lu(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,ft(n))}function cu(e){return on(e)?e[e.length-1]||0:e}function du(e,t){const n=ht(e,t);let{transitionEnd:i={},transition:a={},...o}=n||{};o={...o,...i};for(const r in o){const l=cu(o[r]);lu(e,r,l)}}const pe=e=>!!(e&&e.getVelocity);function uu(e){return!!(pe(e)&&e.add)}function ln(e,t){const n=e.getValue("willChange");if(uu(n))return n.add(t);if(!n&&Re.WillChange){const i=new Re.WillChange("auto");e.addValue("willChange",i),i.add(t)}}function Wn(e){return e.replace(/([A-Z])/g,t=>`-${t.toLowerCase()}`)}const hu="framerAppearId",Hr="data-"+Wn(hu);function qr(e){return e.props[Hr]}function pu({protectedKeys:e,needsAnimating:t},n){const i=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,i}function Gr(e,t,{delay:n=0,transitionOverride:i,type:a}={}){let{transition:o,transitionEnd:r,...l}=t;const c=e.getDefaultTransition();o=o?Wr(o,c):c;const d=o==null?void 0:o.reduceMotion;i&&(o=i);const u=[],p=a&&e.animationState&&e.animationState.getState()[a];for(const h in l){const f=e.getValue(h,e.latestValues[h]??null),m=l[h];if(m===void 0||p&&pu(p,h))continue;const y={delay:n,...Bn(o||{},h)},b=f.get();if(b!==void 0&&!f.isAnimating&&!Array.isArray(m)&&m===b&&!y.velocity)continue;let w=!1;if(window.MotionHandoffAnimation){const C=qr(e);if(C){const _=window.MotionHandoffAnimation(C,h,H);_!==null&&(y.startTime=_,w=!0)}}ln(e,h);const j=d??e.shouldReduceMotion;f.start(Un(h,f,m,j&&zr.has(h)?{type:!1}:y,e,w));const k=f.animation;k&&u.push(k)}if(r){const h=()=>H.update(()=>{r&&du(e,r)});u.length?Promise.all(u).then(h):h()}return u}function cn(e,t,n={}){var c;const i=ht(e,t,n.type==="exit"?(c=e.presenceContext)==null?void 0:c.custom:void 0);let{transition:a=e.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(a=n.transitionOverride);const o=i?()=>Promise.all(Gr(e,i,n)):()=>Promise.resolve(),r=e.variantChildren&&e.variantChildren.size?(d=0)=>{const{delayChildren:u=0,staggerChildren:p,staggerDirection:h}=a;return fu(e,t,d,u,p,h,n)}:()=>Promise.resolve(),{when:l}=a;if(l){const[d,u]=l==="beforeChildren"?[o,r]:[r,o];return d().then(()=>u())}else return Promise.all([o(),r(n.delay)])}function fu(e,t,n=0,i=0,a=0,o=1,r){const l=[];for(const c of e.variantChildren)c.notify("AnimationStart",t),l.push(cn(c,t,{...r,delay:n+(typeof i=="function"?0:i)+Ur(e.variantChildren,c,i,a,o)}).then(()=>c.notify("AnimationComplete",t)));return Promise.all(l)}function mu(e,t,n={}){e.notify("AnimationStart",t);let i;if(Array.isArray(t)){const a=t.map(o=>cn(e,o,n));i=Promise.all(a)}else if(typeof t=="string")i=cn(e,t,n);else{const a=typeof t=="function"?ht(e,t,n.custom):t;i=Promise.all(Gr(e,a,n))}return i.then(()=>{e.notify("AnimationComplete",t)})}const xu={test:e=>e==="auto",parse:e=>e},Kr=e=>t=>t.test(e),Yr=[bt,D,Ae,Ie,Wc,$c,xu],$i=e=>Yr.find(Kr(e));function gu(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||dr(e):!0}const bu=new Set(["brightness","contrast","saturate","opacity"]);function yu(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[i]=n.match(Mn)||[];if(!i)return e;const a=n.replace(i,"");let o=bu.has(t)?1:0;return i!==n&&(o*=100),t+"("+o+a+")"}const vu=/\b([a-z-]*)\(.*?\)/gu,dn={...Fe,getAnimatableNone:e=>{const t=e.match(vu);return t?t.map(yu).join(" "):e}},Wi={...bt,transform:Math.round},wu={rotate:Ie,rotateX:Ie,rotateY:Ie,rotateZ:Ie,scale:Xt,scaleX:Xt,scaleY:Xt,scaleZ:Xt,skew:Ie,skewX:Ie,skewY:Ie,distance:D,translateX:D,translateY:D,translateZ:D,x:D,y:D,z:D,perspective:D,transformPerspective:D,opacity:Rt,originX:Ai,originY:Ai,originZ:D},zn={borderWidth:D,borderTopWidth:D,borderRightWidth:D,borderBottomWidth:D,borderLeftWidth:D,borderRadius:D,borderTopLeftRadius:D,borderTopRightRadius:D,borderBottomRightRadius:D,borderBottomLeftRadius:D,width:D,maxWidth:D,height:D,maxHeight:D,top:D,right:D,bottom:D,left:D,inset:D,insetBlock:D,insetBlockStart:D,insetBlockEnd:D,insetInline:D,insetInlineStart:D,insetInlineEnd:D,padding:D,paddingTop:D,paddingRight:D,paddingBottom:D,paddingLeft:D,paddingBlock:D,paddingBlockStart:D,paddingBlockEnd:D,paddingInline:D,paddingInlineStart:D,paddingInlineEnd:D,margin:D,marginTop:D,marginRight:D,marginBottom:D,marginLeft:D,marginBlock:D,marginBlockStart:D,marginBlockEnd:D,marginInline:D,marginInlineStart:D,marginInlineEnd:D,fontSize:D,backgroundPositionX:D,backgroundPositionY:D,...wu,zIndex:Wi,fillOpacity:Rt,strokeOpacity:Rt,numOctaves:Wi},ju={...zn,color:ee,backgroundColor:ee,outlineColor:ee,fill:ee,stroke:ee,borderColor:ee,borderTopColor:ee,borderRightColor:ee,borderBottomColor:ee,borderLeftColor:ee,filter:dn,WebkitFilter:dn},Xr=e=>ju[e];function Zr(e,t){let n=Xr(e);return n!==dn&&(n=Fe),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const Nu=new Set(["auto","none","0"]);function Su(e,t,n){let i=0,a;for(;i<e.length&&!a;){const o=e[i];typeof o=="string"&&!Nu.has(o)&&Pt(o).values.length&&(a=e[i]),i++}if(a&&n)for(const o of t)e[o]=Zr(n,a)}class ku extends Fn{constructor(t,n,i,a,o){super(t,n,i,a,o,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:i}=this;if(!n||!n.current)return;super.readKeyframes();for(let u=0;u<t.length;u++){let p=t[u];if(typeof p=="string"&&(p=p.trim(),Dn(p))){const h=$r(p,n.current);h!==void 0&&(t[u]=h),u===t.length-1&&(this.finalKeyframe=p)}}if(this.resolveNoneKeyframes(),!zr.has(i)||t.length!==2)return;const[a,o]=t,r=$i(a),l=$i(o),c=Ti(a),d=Ti(o);if(c!==d&&Oe[i]){this.needsMeasurement=!0;return}if(r!==l)if(Oi(r)&&Oi(l))for(let u=0;u<t.length;u++){const p=t[u];typeof p=="string"&&(t[u]=parseFloat(p))}else Oe[i]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,i=[];for(let a=0;a<t.length;a++)(t[a]===null||gu(t[a]))&&i.push(a);i.length&&Su(t,i,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:i}=this;if(!t||!t.current)return;i==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Oe[i](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const a=n[n.length-1];a!==void 0&&t.getValue(i,a).jump(a,!1)}measureEndState(){var l;const{element:t,name:n,unresolvedKeyframes:i}=this;if(!t||!t.current)return;const a=t.getValue(n);a&&a.jump(this.measuredOrigin,!1);const o=i.length-1,r=i[o];i[o]=Oe[n](t.measureViewportBox(),window.getComputedStyle(t.current)),r!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=r),(l=this.removedTransforms)!=null&&l.length&&this.removedTransforms.forEach(([c,d])=>{t.getValue(c).set(d)}),this.resolveNoneKeyframes()}}function Jr(e,t,n){if(e==null)return[];if(e instanceof EventTarget)return[e];if(typeof e=="string"){let i=document;const a=(n==null?void 0:n[e])??i.querySelectorAll(e);return a?Array.from(a):[]}return Array.from(e).filter(i=>i!=null)}const Qr=(e,t)=>t&&typeof e=="number"?t.transform(e):e;function un(e){return cr(e)&&"offsetHeight"in e}const{schedule:Hn}=jr(queueMicrotask,!1),ke={x:!1,y:!1};function eo(){return ke.x||ke.y}function _u(e){return e==="x"||e==="y"?ke[e]?null:(ke[e]=!0,()=>{ke[e]=!1}):ke.x||ke.y?null:(ke.x=ke.y=!0,()=>{ke.x=ke.y=!1})}function to(e,t){const n=Jr(e),i=new AbortController,a={passive:!0,...t,signal:i.signal};return[n,a,()=>i.abort()]}function Cu(e){return!(e.pointerType==="touch"||eo())}function Tu(e,t,n={}){const[i,a,o]=to(e,n);return i.forEach(r=>{let l=!1,c=!1,d;const u=()=>{r.removeEventListener("pointerleave",m)},p=b=>{d&&(d(b),d=void 0),u()},h=b=>{l=!1,window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",h),c&&(c=!1,p(b))},f=()=>{l=!0,window.addEventListener("pointerup",h,a),window.addEventListener("pointercancel",h,a)},m=b=>{if(b.pointerType!=="touch"){if(l){c=!0;return}p(b)}},y=b=>{if(!Cu(b))return;c=!1;const w=t(r,b);typeof w=="function"&&(d=w,r.addEventListener("pointerleave",m,a))};r.addEventListener("pointerenter",y,a),r.addEventListener("pointerdown",f,a)}),o}const so=(e,t)=>t?e===t?!0:so(e,t.parentElement):!1,qn=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,Au=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function Eu(e){return Au.has(e.tagName)||e.isContentEditable===!0}const Du=new Set(["INPUT","SELECT","TEXTAREA"]);function Mu(e){return Du.has(e.tagName)||e.isContentEditable===!0}const is=new WeakSet;function zi(e){return t=>{t.key==="Enter"&&e(t)}}function Es(e,t){e.dispatchEvent(new PointerEvent("pointer"+t,{isPrimary:!0,bubbles:!0}))}const Ru=(e,t)=>{const n=e.currentTarget;if(!n)return;const i=zi(()=>{if(is.has(n))return;Es(n,"down");const a=zi(()=>{Es(n,"up")}),o=()=>Es(n,"cancel");n.addEventListener("keyup",a,t),n.addEventListener("blur",o,t)});n.addEventListener("keydown",i,t),n.addEventListener("blur",()=>n.removeEventListener("keydown",i),t)};function Hi(e){return qn(e)&&!eo()}const qi=new WeakSet;function Pu(e,t,n={}){const[i,a,o]=to(e,n),r=l=>{const c=l.currentTarget;if(!Hi(l)||qi.has(l))return;is.add(c),n.stopPropagation&&qi.add(l);const d=t(c,l),u=(f,m)=>{window.removeEventListener("pointerup",p),window.removeEventListener("pointercancel",h),is.has(c)&&is.delete(c),Hi(f)&&typeof d=="function"&&d(f,{success:m})},p=f=>{u(f,c===window||c===document||n.useGlobalTarget||so(c,f.target))},h=f=>{u(f,!1)};window.addEventListener("pointerup",p,a),window.addEventListener("pointercancel",h,a)};return i.forEach(l=>{(n.useGlobalTarget?window:l).addEventListener("pointerdown",r,a),un(l)&&(l.addEventListener("focus",d=>Ru(d,a)),!Eu(l)&&!l.hasAttribute("tabindex")&&(l.tabIndex=0))}),o}function Gn(e){return cr(e)&&"ownerSVGElement"in e}const as=new WeakMap;let Le;const no=(e,t,n)=>(i,a)=>a&&a[0]?a[0][e+"Size"]:Gn(i)&&"getBBox"in i?i.getBBox()[t]:i[n],Iu=no("inline","width","offsetWidth"),Lu=no("block","height","offsetHeight");function Ou({target:e,borderBoxSize:t}){var n;(n=as.get(e))==null||n.forEach(i=>{i(e,{get width(){return Iu(e,t)},get height(){return Lu(e,t)}})})}function Vu(e){e.forEach(Ou)}function Fu(){typeof ResizeObserver>"u"||(Le=new ResizeObserver(Vu))}function Bu(e,t){Le||Fu();const n=Jr(e);return n.forEach(i=>{let a=as.get(i);a||(a=new Set,as.set(i,a)),a.add(t),Le==null||Le.observe(i)}),()=>{n.forEach(i=>{const a=as.get(i);a==null||a.delete(t),a!=null&&a.size||Le==null||Le.unobserve(i)})}}const rs=new Set;let ot;function Uu(){ot=()=>{const e={get width(){return window.innerWidth},get height(){return window.innerHeight}};rs.forEach(t=>t(e))},window.addEventListener("resize",ot)}function $u(e){return rs.add(e),ot||Uu(),()=>{rs.delete(e),!rs.size&&typeof ot=="function"&&(window.removeEventListener("resize",ot),ot=void 0)}}function Gi(e,t){return typeof e=="function"?$u(e):Bu(e,t)}function Wu(e){return Gn(e)&&e.tagName==="svg"}const zu=[...Yr,ee,Fe],Hu=e=>zu.find(Kr(e)),Ki=()=>({translate:0,scale:1,origin:0,originPoint:0}),lt=()=>({x:Ki(),y:Ki()}),Yi=()=>({min:0,max:0}),ne=()=>({x:Yi(),y:Yi()}),hn={current:null},io={current:!1},qu=typeof window<"u";function Gu(){if(io.current=!0,!!qu)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>hn.current=e.matches;e.addEventListener("change",t),t()}else hn.current=!1}const Ku=new WeakMap;function ys(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function It(e){return typeof e=="string"||Array.isArray(e)}const Kn=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],Yn=["initial",...Kn];function vs(e){return ys(e.animate)||Yn.some(t=>It(e[t]))}function ao(e){return!!(vs(e)||e.variants)}function Yu(e,t,n){for(const i in t){const a=t[i],o=n[i];if(pe(a))e.addValue(i,a);else if(pe(o))e.addValue(i,ft(a,{owner:e}));else if(o!==a)if(e.hasValue(i)){const r=e.getValue(i);r.liveStyle===!0?r.jump(a):r.hasAnimated||r.set(a)}else{const r=e.getStaticValue(i);e.addValue(i,ft(r!==void 0?r:a,{owner:e}))}}for(const i in n)t[i]===void 0&&e.removeValue(i);return t}const Xi=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];let hs={};function ro(e){hs=e}function Xu(){return hs}class Zu{scrapeMotionValuesFromProps(t,n,i){return{}}constructor({parent:t,props:n,presenceContext:i,reducedMotionConfig:a,skipAnimations:o,blockInitialAnimation:r,visualState:l},c={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.shouldSkipAnimations=!1,this.values=new Map,this.KeyframeResolver=Fn,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.hasBeenMounted=!1,this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const f=xe.now();this.renderScheduledAt<f&&(this.renderScheduledAt=f,H.render(this.render,!1,!0))};const{latestValues:d,renderState:u}=l;this.latestValues=d,this.baseTarget={...d},this.initialValues=n.initial?{...d}:{},this.renderState=u,this.parent=t,this.props=n,this.presenceContext=i,this.depth=t?t.depth+1:0,this.reducedMotionConfig=a,this.skipAnimationsConfig=o,this.options=c,this.blockInitialAnimation=!!r,this.isControllingVariants=vs(n),this.isVariantNode=ao(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:p,...h}=this.scrapeMotionValuesFromProps(n,{},this);for(const f in h){const m=h[f];d[f]!==void 0&&pe(m)&&m.set(d[f])}}mount(t){var n,i;if(this.hasBeenMounted)for(const a in this.initialValues)(n=this.values.get(a))==null||n.jump(this.initialValues[a]),this.latestValues[a]=this.initialValues[a];this.current=t,Ku.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((a,o)=>this.bindToMotionValue(o,a)),this.reducedMotionConfig==="never"?this.shouldReduceMotion=!1:this.reducedMotionConfig==="always"?this.shouldReduceMotion=!0:(io.current||Gu(),this.shouldReduceMotion=hn.current),this.shouldSkipAnimations=this.skipAnimationsConfig??!1,(i=this.parent)==null||i.addChild(this),this.update(this.props,this.presenceContext),this.hasBeenMounted=!0}unmount(){var t;this.projection&&this.projection.unmount(),Ve(this.notifyUpdate),Ve(this.render),this.valueSubscriptions.forEach(n=>n()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(t=this.parent)==null||t.removeChild(this);for(const n in this.events)this.events[n].clear();for(const n in this.features){const i=this.features[n];i&&(i.unmount(),i.isMounted=!1)}this.current=null}addChild(t){this.children.add(t),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(t)}removeChild(t){this.children.delete(t),this.enteringChildren&&this.enteringChildren.delete(t)}bindToMotionValue(t,n){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const i=vt.has(t);i&&this.onBindTransform&&this.onBindTransform();const a=n.on("change",r=>{this.latestValues[t]=r,this.props.onUpdate&&H.preRender(this.notifyUpdate),i&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let o;typeof window<"u"&&window.MotionCheckAppearSync&&(o=window.MotionCheckAppearSync(this,t,n)),this.valueSubscriptions.set(t,()=>{a(),o&&o(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in hs){const n=hs[t];if(!n)continue;const{isEnabled:i,Feature:a}=n;if(!this.features[t]&&a&&i(this.props)&&(this.features[t]=new a(this)),this.features[t]){const o=this.features[t];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ne()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let i=0;i<Xi.length;i++){const a=Xi[i];this.propEventSubscriptions[a]&&(this.propEventSubscriptions[a](),delete this.propEventSubscriptions[a]);const o="on"+a,r=t[o];r&&(this.propEventSubscriptions[a]=this.on(a,r))}this.prevMotionValues=Yu(this,this.scrapeMotionValuesFromProps(t,this.prevProps||{},this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const i=this.values.get(t);n!==i&&(i&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let i=this.values.get(t);return i===void 0&&n!==void 0&&(i=ft(n===null?void 0:n,{owner:this}),this.addValue(t,i)),i}readValue(t,n){let i=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:this.getBaseTargetFromProps(this.props,t)??this.readValueFromInstance(this.current,t,this.options);return i!=null&&(typeof i=="string"&&(lr(i)||dr(i))?i=parseFloat(i):!Hu(i)&&Fe.test(n)&&(i=Zr(t,n)),this.setBaseTarget(t,pe(i)?i.get():i)),pe(i)?i.get():i}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){var o;const{initial:n}=this.props;let i;if(typeof n=="string"||typeof n=="object"){const r=$n(this.props,n,(o=this.presenceContext)==null?void 0:o.custom);r&&(i=r[t])}if(n&&i!==void 0)return i;const a=this.getBaseTargetFromProps(this.props,t);return a!==void 0&&!pe(a)?a:this.initialValues[t]!==void 0&&i===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new Tn),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}scheduleRenderMicrotask(){Hn.render(this.render)}}class oo extends Zu{constructor(){super(...arguments),this.KeyframeResolver=ku}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){const i=t.style;return i?i[n]:void 0}removeValueFromRenderState(t,{vars:n,style:i}){delete n[t],delete i[t]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;pe(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}class Be{constructor(t){this.isMounted=!1,this.node=t}update(){}}function lo({top:e,left:t,right:n,bottom:i}){return{x:{min:t,max:n},y:{min:e,max:i}}}function Ju({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Qu(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),i=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:i.y,right:i.x}}function Ds(e){return e===void 0||e===1}function pn({scale:e,scaleX:t,scaleY:n}){return!Ds(e)||!Ds(t)||!Ds(n)}function He(e){return pn(e)||co(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function co(e){return Zi(e.x)||Zi(e.y)}function Zi(e){return e&&e!=="0%"}function ps(e,t,n){const i=e-n,a=t*i;return n+a}function Ji(e,t,n,i,a){return a!==void 0&&(e=ps(e,a,i)),ps(e,n,i)+t}function fn(e,t=0,n=1,i,a){e.min=Ji(e.min,t,n,i,a),e.max=Ji(e.max,t,n,i,a)}function uo(e,{x:t,y:n}){fn(e.x,t.translate,t.scale,t.originPoint),fn(e.y,n.translate,n.scale,n.originPoint)}const Qi=.999999999999,ea=1.0000000000001;function eh(e,t,n,i=!1){const a=n.length;if(!a)return;t.x=t.y=1;let o,r;for(let l=0;l<a;l++){o=n[l],r=o.projectionDelta;const{visualElement:c}=o.options;c&&c.props.style&&c.props.style.display==="contents"||(i&&o.options.layoutScroll&&o.scroll&&o!==o.root&&dt(e,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),r&&(t.x*=r.x.scale,t.y*=r.y.scale,uo(e,r)),i&&He(o.latestValues)&&dt(e,o.latestValues))}t.x<ea&&t.x>Qi&&(t.x=1),t.y<ea&&t.y>Qi&&(t.y=1)}function ct(e,t){e.min=e.min+t,e.max=e.max+t}function ta(e,t,n,i,a=.5){const o=Z(e.min,e.max,a);fn(e,t,n,o,i)}function dt(e,t){ta(e.x,t.x,t.scaleX,t.scale,t.originX),ta(e.y,t.y,t.scaleY,t.scale,t.originY)}function ho(e,t){return lo(Qu(e.getBoundingClientRect(),t))}function th(e,t,n){const i=ho(e,n),{scroll:a}=t;return a&&(ct(i.x,a.offset.x),ct(i.y,a.offset.y)),i}const sh={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},nh=yt.length;function ih(e,t,n){let i="",a=!0;for(let o=0;o<nh;o++){const r=yt[o],l=e[r];if(l===void 0)continue;let c=!0;if(typeof l=="number")c=l===(r.startsWith("scale")?1:0);else{const d=parseFloat(l);c=r.startsWith("scale")?d===1:d===0}if(!c||n){const d=Qr(l,zn[r]);if(!c){a=!1;const u=sh[r]||r;i+=`${u}(${d}) `}n&&(t[r]=d)}}return i=i.trim(),n?i=n(t,a?"":i):a&&(i="none"),i}function Xn(e,t,n){const{style:i,vars:a,transformOrigin:o}=e;let r=!1,l=!1;for(const c in t){const d=t[c];if(vt.has(c)){r=!0;continue}else if(Sr(c)){a[c]=d;continue}else{const u=Qr(d,zn[c]);c.startsWith("origin")?(l=!0,o[c]=u):i[c]=u}}if(t.transform||(r||n?i.transform=ih(t,e.transform,n):i.transform&&(i.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:u=0}=o;i.transformOrigin=`${c} ${d} ${u}`}}function po(e,{style:t,vars:n},i,a){const o=e.style;let r;for(r in t)o[r]=t[r];a==null||a.applyProjectionStyles(o,i);for(r in n)o.setProperty(r,n[r])}function sa(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const St={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(D.test(e))e=parseFloat(e);else return e;const n=sa(e,t.target.x),i=sa(e,t.target.y);return`${n}% ${i}%`}},ah={correct:(e,{treeScale:t,projectionDelta:n})=>{const i=e,a=Fe.parse(e);if(a.length>5)return i;const o=Fe.createTransformer(e),r=typeof a[0]!="number"?1:0,l=n.x.scale*t.x,c=n.y.scale*t.y;a[0+r]/=l,a[1+r]/=c;const d=Z(l,c,.5);return typeof a[2+r]=="number"&&(a[2+r]/=d),typeof a[3+r]=="number"&&(a[3+r]/=d),o(a)}},mn={borderRadius:{...St,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:St,borderTopRightRadius:St,borderBottomLeftRadius:St,borderBottomRightRadius:St,boxShadow:ah};function fo(e,{layout:t,layoutId:n}){return vt.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!mn[e]||e==="opacity")}function Zn(e,t,n){var r;const i=e.style,a=t==null?void 0:t.style,o={};if(!i)return o;for(const l in i)(pe(i[l])||a&&pe(a[l])||fo(l,e)||((r=n==null?void 0:n.getValue(l))==null?void 0:r.liveStyle)!==void 0)&&(o[l]=i[l]);return o}function rh(e){return window.getComputedStyle(e)}class oh extends oo{constructor(){super(...arguments),this.type="html",this.renderInstance=po}readValueFromInstance(t,n){var i;if(vt.has(n))return(i=this.projection)!=null&&i.isProjecting?en(n):_d(t,n);{const a=rh(t),o=(Sr(n)?a.getPropertyValue(n):a[n])||0;return typeof o=="string"?o.trim():o}}measureInstanceViewportBox(t,{transformPagePoint:n}){return ho(t,n)}build(t,n,i){Xn(t,n,i.transformTemplate)}scrapeMotionValuesFromProps(t,n,i){return Zn(t,n,i)}}const lh={offset:"stroke-dashoffset",array:"stroke-dasharray"},ch={offset:"strokeDashoffset",array:"strokeDasharray"};function dh(e,t,n=1,i=0,a=!0){e.pathLength=1;const o=a?lh:ch;e[o.offset]=`${-i}`,e[o.array]=`${t} ${n}`}const uh=["offsetDistance","offsetPath","offsetRotate","offsetAnchor"];function mo(e,{attrX:t,attrY:n,attrScale:i,pathLength:a,pathSpacing:o=1,pathOffset:r=0,...l},c,d,u){if(Xn(e,l,d),c){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:p,style:h}=e;p.transform&&(h.transform=p.transform,delete p.transform),(h.transform||p.transformOrigin)&&(h.transformOrigin=p.transformOrigin??"50% 50%",delete p.transformOrigin),h.transform&&(h.transformBox=(u==null?void 0:u.transformBox)??"fill-box",delete p.transformBox);for(const f of uh)p[f]!==void 0&&(h[f]=p[f],delete p[f]);t!==void 0&&(p.x=t),n!==void 0&&(p.y=n),i!==void 0&&(p.scale=i),a!==void 0&&dh(p,a,o,r,!1)}const xo=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]),go=e=>typeof e=="string"&&e.toLowerCase()==="svg";function hh(e,t,n,i){po(e,t,void 0,i);for(const a in t.attrs)e.setAttribute(xo.has(a)?a:Wn(a),t.attrs[a])}function bo(e,t,n){const i=Zn(e,t,n);for(const a in e)if(pe(e[a])||pe(t[a])){const o=yt.indexOf(a)!==-1?"attr"+a.charAt(0).toUpperCase()+a.substring(1):a;i[o]=e[a]}return i}class ph extends oo{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ne}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(vt.has(n)){const i=Xr(n);return i&&i.default||0}return n=xo.has(n)?n:Wn(n),t.getAttribute(n)}scrapeMotionValuesFromProps(t,n,i){return bo(t,n,i)}build(t,n,i){mo(t,n,this.isSVGTag,i.transformTemplate,i.style)}renderInstance(t,n,i,a){hh(t,n,i,a)}mount(t){this.isSVGTag=go(t.tagName),super.mount(t)}}const fh=Yn.length;function yo(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent?yo(e.parent)||{}:{};return e.props.initial!==void 0&&(n.initial=e.props.initial),n}const t={};for(let n=0;n<fh;n++){const i=Yn[n],a=e.props[i];(It(a)||a===!1)&&(t[i]=a)}return t}function vo(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let i=0;i<n;i++)if(t[i]!==e[i])return!1;return!0}const mh=[...Kn].reverse(),xh=Kn.length;function gh(e){return t=>Promise.all(t.map(({animation:n,options:i})=>mu(e,n,i)))}function bh(e){let t=gh(e),n=na(),i=!0;const a=c=>(d,u)=>{var h;const p=ht(e,u,c==="exit"?(h=e.presenceContext)==null?void 0:h.custom:void 0);if(p){const{transition:f,transitionEnd:m,...y}=p;d={...d,...y,...m}}return d};function o(c){t=c(e)}function r(c){const{props:d}=e,u=yo(e.parent)||{},p=[],h=new Set;let f={},m=1/0;for(let b=0;b<xh;b++){const w=mh[b],j=n[w],k=d[w]!==void 0?d[w]:u[w],C=It(k),_=w===c?j.isActive:null;_===!1&&(m=b);let g=k===u[w]&&k!==d[w]&&C;if(g&&i&&e.manuallyAnimateOnMount&&(g=!1),j.protectedKeys={...f},!j.isActive&&_===null||!k&&!j.prevProp||ys(k)||typeof k=="boolean")continue;const x=yh(j.prevProp,k);let v=x||w===c&&j.isActive&&!g&&C||b>m&&C,S=!1;const A=Array.isArray(k)?k:[k];let R=A.reduce(a(w),{});_===!1&&(R={});const{prevResolvedValues:P={}}=j,L={...P,...R},T=$=>{v=!0,h.has($)&&(S=!0,h.delete($)),j.needsAnimating[$]=!0;const F=e.getValue($);F&&(F.liveStyle=!1)};for(const $ in L){const F=R[$],K=P[$];if(f.hasOwnProperty($))continue;let be=!1;on(F)&&on(K)?be=!vo(F,K):be=F!==K,be?F!=null?T($):h.add($):F!==void 0&&h.has($)?T($):j.protectedKeys[$]=!0}j.prevProp=k,j.prevResolvedValues=R,j.isActive&&(f={...f,...R}),i&&e.blockInitialAnimation&&(v=!1);const V=g&&x;v&&(!V||S)&&p.push(...A.map($=>{const F={type:w};if(typeof $=="string"&&i&&!V&&e.manuallyAnimateOnMount&&e.parent){const{parent:K}=e,be=ht(K,$);if(K.enteringChildren&&be){const{delayChildren:ve}=be.transition||{};F.delay=Ur(K.enteringChildren,e,ve)}}return{animation:$,options:F}}))}if(h.size){const b={};if(typeof d.initial!="boolean"){const w=ht(e,Array.isArray(d.initial)?d.initial[0]:d.initial);w&&w.transition&&(b.transition=w.transition)}h.forEach(w=>{const j=e.getBaseTarget(w),k=e.getValue(w);k&&(k.liveStyle=!0),b[w]=j??null}),p.push({animation:b})}let y=!!p.length;return i&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(y=!1),i=!1,y?t(p):Promise.resolve()}function l(c,d){var p;if(n[c].isActive===d)return Promise.resolve();(p=e.variantChildren)==null||p.forEach(h=>{var f;return(f=h.animationState)==null?void 0:f.setActive(c,d)}),n[c].isActive=d;const u=r(c);for(const h in n)n[h].protectedKeys={};return u}return{animateChanges:r,setActive:l,setAnimateFunction:o,getState:()=>n,reset:()=>{n=na()}}}function yh(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!vo(t,e):!1}function ze(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function na(){return{animate:ze(!0),whileInView:ze(),whileHover:ze(),whileTap:ze(),whileDrag:ze(),whileFocus:ze(),exit:ze()}}function ia(e,t){e.min=t.min,e.max=t.max}function Se(e,t){ia(e.x,t.x),ia(e.y,t.y)}function aa(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}const wo=1e-4,vh=1-wo,wh=1+wo,jo=.01,jh=0-jo,Nh=0+jo;function ge(e){return e.max-e.min}function Sh(e,t,n){return Math.abs(e-t)<=n}function ra(e,t,n,i=.5){e.origin=i,e.originPoint=Z(t.min,t.max,e.origin),e.scale=ge(n)/ge(t),e.translate=Z(n.min,n.max,e.origin)-e.originPoint,(e.scale>=vh&&e.scale<=wh||isNaN(e.scale))&&(e.scale=1),(e.translate>=jh&&e.translate<=Nh||isNaN(e.translate))&&(e.translate=0)}function At(e,t,n,i){ra(e.x,t.x,n.x,i?i.originX:void 0),ra(e.y,t.y,n.y,i?i.originY:void 0)}function oa(e,t,n){e.min=n.min+t.min,e.max=e.min+ge(t)}function kh(e,t,n){oa(e.x,t.x,n.x),oa(e.y,t.y,n.y)}function la(e,t,n){e.min=t.min-n.min,e.max=e.min+ge(t)}function fs(e,t,n){la(e.x,t.x,n.x),la(e.y,t.y,n.y)}function ca(e,t,n,i,a){return e-=t,e=ps(e,1/n,i),a!==void 0&&(e=ps(e,1/a,i)),e}function _h(e,t=0,n=1,i=.5,a,o=e,r=e){if(Ae.test(t)&&(t=parseFloat(t),t=Z(r.min,r.max,t/100)-r.min),typeof t!="number")return;let l=Z(o.min,o.max,i);e===o&&(l-=t),e.min=ca(e.min,t,n,l,a),e.max=ca(e.max,t,n,l,a)}function da(e,t,[n,i,a],o,r){_h(e,t[n],t[i],t[a],t.scale,o,r)}const Ch=["x","scaleX","originX"],Th=["y","scaleY","originY"];function ua(e,t,n,i){da(e.x,t,Ch,n?n.x:void 0,i?i.x:void 0),da(e.y,t,Th,n?n.y:void 0,i?i.y:void 0)}function ha(e){return e.translate===0&&e.scale===1}function No(e){return ha(e.x)&&ha(e.y)}function pa(e,t){return e.min===t.min&&e.max===t.max}function Ah(e,t){return pa(e.x,t.x)&&pa(e.y,t.y)}function fa(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function So(e,t){return fa(e.x,t.x)&&fa(e.y,t.y)}function ma(e){return ge(e.x)/ge(e.y)}function xa(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}function Ce(e){return[e("x"),e("y")]}function Eh(e,t,n){let i="";const a=e.x.translate/t.x,o=e.y.translate/t.y,r=(n==null?void 0:n.z)||0;if((a||o||r)&&(i=`translate3d(${a}px, ${o}px, ${r}px) `),(t.x!==1||t.y!==1)&&(i+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:d,rotate:u,rotateX:p,rotateY:h,skewX:f,skewY:m}=n;d&&(i=`perspective(${d}px) ${i}`),u&&(i+=`rotate(${u}deg) `),p&&(i+=`rotateX(${p}deg) `),h&&(i+=`rotateY(${h}deg) `),f&&(i+=`skewX(${f}deg) `),m&&(i+=`skewY(${m}deg) `)}const l=e.x.scale*t.x,c=e.y.scale*t.y;return(l!==1||c!==1)&&(i+=`scale(${l}, ${c})`),i||"none"}const ko=["TopLeft","TopRight","BottomLeft","BottomRight"],Dh=ko.length,ga=e=>typeof e=="string"?parseFloat(e):e,ba=e=>typeof e=="number"||D.test(e);function Mh(e,t,n,i,a,o){a?(e.opacity=Z(0,n.opacity??1,Rh(i)),e.opacityExit=Z(t.opacity??1,0,Ph(i))):o&&(e.opacity=Z(t.opacity??1,n.opacity??1,i));for(let r=0;r<Dh;r++){const l=`border${ko[r]}Radius`;let c=ya(t,l),d=ya(n,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||ba(c)===ba(d)?(e[l]=Math.max(Z(ga(c),ga(d),i),0),(Ae.test(d)||Ae.test(c))&&(e[l]+="%")):e[l]=d}(t.rotate||n.rotate)&&(e.rotate=Z(t.rotate||0,n.rotate||0,i))}function ya(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const Rh=_o(0,.5,br),Ph=_o(.5,.95,je);function _o(e,t,n){return i=>i<e?0:i>t?1:n(Mt(e,t,i))}function Ih(e,t,n){const i=pe(e)?e:ft(e);return i.start(Un("",i,t,n)),i.animation}function Lt(e,t,n,i={passive:!0}){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n)}const Lh=(e,t)=>e.depth-t.depth;class Oh{constructor(){this.children=[],this.isDirty=!1}add(t){Sn(this.children,t),this.isDirty=!0}remove(t){kn(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Lh),this.isDirty=!1,this.children.forEach(t)}}function Vh(e,t){const n=xe.now(),i=({timestamp:a})=>{const o=a-n;o>=t&&(Ve(i),e(o-t))};return H.setup(i,!0),()=>Ve(i)}function os(e){return pe(e)?e.get():e}class Fh{constructor(){this.members=[]}add(t){Sn(this.members,t),t.scheduleRender()}remove(t){if(kn(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(a=>t===a);if(n===0)return!1;let i;for(let a=n;a>=0;a--){const o=this.members[a];if(o.isPresent!==!1){i=o;break}}return i?(this.promote(i),!0):!1}promote(t,n){const i=this.lead;if(t!==i&&(this.prevLead=i,this.lead=t,t.show(),i)){i.instance&&i.scheduleRender(),t.scheduleRender();const a=i.options.layoutDependency,o=t.options.layoutDependency;a!==void 0&&o!==void 0&&a===o||(t.resumeFrom=i,n&&(t.resumeFrom.preserveOpacity=!0),i.snapshot&&(t.snapshot=i.snapshot,t.snapshot.latestValues=i.animationValues||i.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0));const{crossfade:l}=t.options;l===!1&&i.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:i}=t;n.onExitComplete&&n.onExitComplete(),i&&i.options.onExitComplete&&i.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}const ls={hasAnimatedSinceResize:!0,hasEverUpdated:!1},Ms=["","X","Y","Z"],Bh=1e3;let Uh=0;function Rs(e,t,n,i){const{latestValues:a}=t;a[e]&&(n[e]=a[e],t.setStaticValue(e,0),i&&(i[e]=0))}function Co(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=qr(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:a,layoutId:o}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",H,!(a||o))}const{parent:i}=e;i&&!i.hasCheckedOptimisedAppear&&Co(i)}function To({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:i,resetTransform:a}){return class{constructor(r={},l=t==null?void 0:t()){this.id=Uh++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(zh),this.nodes.forEach(Kh),this.nodes.forEach(Yh),this.nodes.forEach(Hh)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=r,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new Oh)}addEventListener(r,l){return this.eventHandlers.has(r)||this.eventHandlers.set(r,new Tn),this.eventHandlers.get(r).add(l)}notifyListeners(r,...l){const c=this.eventHandlers.get(r);c&&c.notify(...l)}hasListeners(r){return this.eventHandlers.has(r)}mount(r){if(this.instance)return;this.isSVG=Gn(r)&&!Wu(r),this.instance=r;const{layoutId:l,layout:c,visualElement:d}=this.options;if(d&&!d.current&&d.mount(r),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(c||l)&&(this.isLayoutDirty=!0),e){let u,p=0;const h=()=>this.root.updateBlockedByResize=!1;H.read(()=>{p=window.innerWidth}),e(r,()=>{const f=window.innerWidth;f!==p&&(p=f,this.root.updateBlockedByResize=!0,u&&u(),u=Vh(h,250),ls.hasAnimatedSinceResize&&(ls.hasAnimatedSinceResize=!1,this.nodes.forEach(ja)))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&d&&(l||c)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:p,hasRelativeLayoutChanged:h,layout:f})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||d.getDefaultTransition()||ep,{onLayoutAnimationStart:y,onLayoutAnimationComplete:b}=d.getProps(),w=!this.targetLayout||!So(this.targetLayout,f),j=!p&&h;if(this.options.layoutRoot||this.resumeFrom||j||p&&(w||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const k={...Bn(m,"layout"),onPlay:y,onComplete:b};(d.shouldReduceMotion||this.options.layoutRoot)&&(k.delay=0,k.type=!1),this.startAnimation(k),this.setAnimationOrigin(u,j)}else p||ja(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=f})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const r=this.getStack();r&&r.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Ve(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Xh),this.animationId++)}getTransformTemplate(){const{visualElement:r}=this.options;return r&&r.getProps().transformTemplate}willUpdate(r=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Co(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const p=this.path[u];p.shouldResetTransform=!0,p.updateScroll("snapshot"),p.options.layoutRoot&&p.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),r&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(va);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(wa);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(Gh),this.nodes.forEach($h),this.nodes.forEach(Wh)):this.nodes.forEach(wa),this.clearAllSnapshots();const l=xe.now();le.delta=Ee(0,1e3/60,l-le.timestamp),le.timestamp=l,le.isProcessing=!0,Ss.update.process(le),Ss.preRender.process(le),Ss.render.process(le),le.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Hn.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(qh),this.sharedNodes.forEach(Zh)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,H.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){H.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ge(this.snapshot.measuredBox.x)&&!ge(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const r=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=ne(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,r?r.layoutBox:void 0)}updateScroll(r="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===r&&(l=!1),l&&this.instance){const c=i(this.instance);this.scroll={animationId:this.root.animationId,phase:r,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!a)return;const r=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!No(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;r&&this.instance&&(l||He(this.latestValues)||u)&&(a(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(r=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return r&&(c=this.removeTransform(c)),tp(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var d;const{visualElement:r}=this.options;if(!r)return ne();const l=r.measureViewportBox();if(!(((d=this.scroll)==null?void 0:d.wasRoot)||this.path.some(sp))){const{scroll:u}=this.root;u&&(ct(l.x,u.offset.x),ct(l.y,u.offset.y))}return l}removeElementScroll(r){var c;const l=ne();if(Se(l,r),(c=this.scroll)!=null&&c.wasRoot)return l;for(let d=0;d<this.path.length;d++){const u=this.path[d],{scroll:p,options:h}=u;u!==this.root&&p&&h.layoutScroll&&(p.wasRoot&&Se(l,r),ct(l.x,p.offset.x),ct(l.y,p.offset.y))}return l}applyTransform(r,l=!1){const c=ne();Se(c,r);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&dt(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),He(u.latestValues)&&dt(c,u.latestValues)}return He(this.latestValues)&&dt(c,this.latestValues),c}removeTransform(r){const l=ne();Se(l,r);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!He(d.latestValues))continue;pn(d.latestValues)&&d.updateSnapshot();const u=ne(),p=d.measurePageBox();Se(u,p),ua(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return He(this.latestValues)&&ua(l,this.latestValues),l}setTargetDelta(r){this.targetDelta=r,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(r){this.options={...this.options,...r,crossfade:r.crossfade!==void 0?r.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==le.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(r=!1){var f;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(r||c&&this.isSharedProjectionDirty||this.isProjectionDirty||(f=this.parent)!=null&&f.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:p}=this.options;if(!this.layout||!(u||p))return;this.resolvedRelativeTargetAt=le.timestamp;const h=this.getClosestProjectingParent();h&&this.linkedParentVersion!==h.layoutVersion&&!h.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(h&&h.layout?this.createRelativeTarget(h,this.layout.layoutBox,h.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ne(),this.targetWithTransforms=ne()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),kh(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Se(this.target,this.layout.layoutBox),uo(this.target,this.targetDelta)):Se(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,h&&!!h.resumingFrom==!!this.resumingFrom&&!h.options.layoutScroll&&h.target&&this.animationProgress!==1?this.createRelativeTarget(h,this.target,h.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||pn(this.parent.latestValues)||co(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(r,l,c){this.relativeParent=r,this.linkedParentVersion=r.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ne(),this.relativeTargetOrigin=ne(),fs(this.relativeTargetOrigin,l,c),Se(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var m;const r=this.getLead(),l=!!this.resumingFrom||this!==r;let c=!0;if((this.isProjectionDirty||(m=this.parent)!=null&&m.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===le.timestamp&&(c=!1),c)return;const{layout:d,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(d||u))return;Se(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,h=this.treeScale.y;eh(this.layoutCorrected,this.treeScale,this.path,l),r.layout&&!r.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(r.target=r.layout.layoutBox,r.targetWithTransforms=ne());const{target:f}=r;if(!f){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(aa(this.prevProjectionDelta.x,this.projectionDelta.x),aa(this.prevProjectionDelta.y,this.projectionDelta.y)),At(this.projectionDelta,this.layoutCorrected,f,this.latestValues),(this.treeScale.x!==p||this.treeScale.y!==h||!xa(this.projectionDelta.x,this.prevProjectionDelta.x)||!xa(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",f))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(r=!0){var l;if((l=this.options.visualElement)==null||l.scheduleRender(),r){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=lt(),this.projectionDelta=lt(),this.projectionDeltaWithTransform=lt()}setAnimationOrigin(r,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},p=lt();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const h=ne(),f=c?c.source:void 0,m=this.layout?this.layout.source:void 0,y=f!==m,b=this.getStack(),w=!b||b.members.length<=1,j=!!(y&&!w&&this.options.crossfade===!0&&!this.path.some(Qh));this.animationProgress=0;let k;this.mixTargetDelta=C=>{const _=C/1e3;Na(p.x,r.x,_),Na(p.y,r.y,_),this.setTargetDelta(p),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(fs(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Jh(this.relativeTarget,this.relativeTargetOrigin,h,_),k&&Ah(this.relativeTarget,k)&&(this.isProjectionDirty=!1),k||(k=ne()),Se(k,this.relativeTarget)),y&&(this.animationValues=u,Mh(u,d,this.latestValues,_,j,w)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=_},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(r){var l,c,d;this.notifyListeners("animationStart"),(l=this.currentAnimation)==null||l.stop(),(d=(c=this.resumingFrom)==null?void 0:c.currentAnimation)==null||d.stop(),this.pendingAnimation&&(Ve(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=H.update(()=>{ls.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=ft(0)),this.currentAnimation=Ih(this.motionValue,[0,1e3],{...r,velocity:0,isSync:!0,onUpdate:u=>{this.mixTargetDelta(u),r.onUpdate&&r.onUpdate(u)},onStop:()=>{},onComplete:()=>{r.onComplete&&r.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const r=this.getStack();r&&r.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Bh),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const r=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=r;if(!(!l||!c||!d)){if(this!==r&&this.layout&&d&&Ao(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||ne();const p=ge(this.layout.layoutBox.x);c.x.min=r.target.x.min,c.x.max=c.x.min+p;const h=ge(this.layout.layoutBox.y);c.y.min=r.target.y.min,c.y.max=c.y.min+h}Se(l,c),dt(l,u),At(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(r,l){this.sharedNodes.has(r)||this.sharedNodes.set(r,new Fh),this.sharedNodes.get(r).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const r=this.getStack();return r?r.lead===this:!0}getLead(){var l;const{layoutId:r}=this.options;return r?((l=this.getStack())==null?void 0:l.lead)||this:this}getPrevLead(){var l;const{layoutId:r}=this.options;return r?(l=this.getStack())==null?void 0:l.prevLead:void 0}getStack(){const{layoutId:r}=this.options;if(r)return this.root.sharedNodes.get(r)}promote({needsReset:r,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),r&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const r=this.getStack();return r?r.relegate(this):!1}resetSkewAndRotation(){const{visualElement:r}=this.options;if(!r)return;let l=!1;const{latestValues:c}=r;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&Rs("z",r,d,this.animationValues);for(let u=0;u<Ms.length;u++)Rs(`rotate${Ms[u]}`,r,d,this.animationValues),Rs(`skew${Ms[u]}`,r,d,this.animationValues);r.render();for(const u in d)r.setStaticValue(u,d[u]),this.animationValues&&(this.animationValues[u]=d[u]);r.scheduleRender()}applyProjectionStyles(r,l){if(!this.instance||this.isSVG)return;if(!this.isVisible){r.visibility="hidden";return}const c=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,r.visibility="",r.opacity="",r.pointerEvents=os(l==null?void 0:l.pointerEvents)||"",r.transform=c?c(this.latestValues,""):"none";return}const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){this.options.layoutId&&(r.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,r.pointerEvents=os(l==null?void 0:l.pointerEvents)||""),this.hasProjected&&!He(this.latestValues)&&(r.transform=c?c({},""):"none",this.hasProjected=!1);return}r.visibility="";const u=d.animationValues||d.latestValues;this.applyTransformsToTarget();let p=Eh(this.projectionDeltaWithTransform,this.treeScale,u);c&&(p=c(u,p)),r.transform=p;const{x:h,y:f}=this.projectionDelta;r.transformOrigin=`${h.origin*100}% ${f.origin*100}% 0`,d.animationValues?r.opacity=d===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:r.opacity=d===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const m in mn){if(u[m]===void 0)continue;const{correct:y,applyTo:b,isCSSVariable:w}=mn[m],j=p==="none"?u[m]:y(u[m],d);if(b){const k=b.length;for(let C=0;C<k;C++)r[b[C]]=j}else w?this.options.visualElement.renderState.vars[m]=j:r[m]=j}this.options.layoutId&&(r.pointerEvents=d===this?os(l==null?void 0:l.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(r=>{var l;return(l=r.currentAnimation)==null?void 0:l.stop()}),this.root.nodes.forEach(va),this.root.sharedNodes.clear()}}}function $h(e){e.updateLayout()}function Wh(e){var n;const t=((n=e.resumeFrom)==null?void 0:n.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&t&&e.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:a}=e.layout,{animationType:o}=e.options,r=t.source!==e.layout.source;o==="size"?Ce(p=>{const h=r?t.measuredBox[p]:t.layoutBox[p],f=ge(h);h.min=i[p].min,h.max=h.min+f}):Ao(o,t.layoutBox,i)&&Ce(p=>{const h=r?t.measuredBox[p]:t.layoutBox[p],f=ge(i[p]);h.max=h.min+f,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[p].max=e.relativeTarget[p].min+f)});const l=lt();At(l,i,t.layoutBox);const c=lt();r?At(c,e.applyTransform(a,!0),t.measuredBox):At(c,i,t.layoutBox);const d=!No(l);let u=!1;if(!e.resumeFrom){const p=e.getClosestProjectingParent();if(p&&!p.resumeFrom){const{snapshot:h,layout:f}=p;if(h&&f){const m=ne();fs(m,t.layoutBox,h.layoutBox);const y=ne();fs(y,i,f.layoutBox),So(m,y)||(u=!0),p.options.layoutRoot&&(e.relativeTarget=y,e.relativeTargetOrigin=m,e.relativeParent=p)}}}e.notifyListeners("didUpdate",{layout:i,snapshot:t,delta:c,layoutDelta:l,hasLayoutChanged:d,hasRelativeLayoutChanged:u})}else if(e.isLead()){const{onExitComplete:i}=e.options;i&&i()}e.options.transition=void 0}function zh(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Hh(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function qh(e){e.clearSnapshot()}function va(e){e.clearMeasurements()}function wa(e){e.isLayoutDirty=!1}function Gh(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function ja(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Kh(e){e.resolveTargetDelta()}function Yh(e){e.calcProjection()}function Xh(e){e.resetSkewAndRotation()}function Zh(e){e.removeLeadSnapshot()}function Na(e,t,n){e.translate=Z(t.translate,0,n),e.scale=Z(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function Sa(e,t,n,i){e.min=Z(t.min,n.min,i),e.max=Z(t.max,n.max,i)}function Jh(e,t,n,i){Sa(e.x,t.x,n.x,i),Sa(e.y,t.y,n.y,i)}function Qh(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const ep={duration:.45,ease:[.4,0,.1,1]},ka=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),_a=ka("applewebkit/")&&!ka("chrome/")?Math.round:je;function Ca(e){e.min=_a(e.min),e.max=_a(e.max)}function tp(e){Ca(e.x),Ca(e.y)}function Ao(e,t,n){return e==="position"||e==="preserve-aspect"&&!Sh(ma(t),ma(n),.2)}function sp(e){var t;return e!==e.root&&((t=e.scroll)==null?void 0:t.wasRoot)}const np=To({attachResizeListener:(e,t)=>Lt(e,"resize",t),measureScroll:()=>{var e,t;return{x:document.documentElement.scrollLeft||((e=document.body)==null?void 0:e.scrollLeft)||0,y:document.documentElement.scrollTop||((t=document.body)==null?void 0:t.scrollTop)||0}},checkIsScrollRoot:()=>!0}),Ps={current:void 0},Eo=To({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Ps.current){const e=new np({});e.mount(window),e.setOptions({layoutScroll:!0}),Ps.current=e}return Ps.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Jn=N.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function Ta(e,t){if(typeof e=="function")return e(t);e!=null&&(e.current=t)}function ip(...e){return t=>{let n=!1;const i=e.map(a=>{const o=Ta(a,t);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let a=0;a<i.length;a++){const o=i[a];typeof o=="function"?o():Ta(e[a],null)}}}}function ap(...e){return N.useCallback(ip(...e),e)}class rp extends N.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent&&this.props.pop!==!1){const i=n.offsetParent,a=un(i)&&i.offsetWidth||0,o=un(i)&&i.offsetHeight||0,r=this.props.sizeRef.current;r.height=n.offsetHeight||0,r.width=n.offsetWidth||0,r.top=n.offsetTop,r.left=n.offsetLeft,r.right=a-r.width-r.left,r.bottom=o-r.height-r.top}return null}componentDidUpdate(){}render(){return this.props.children}}function op({children:e,isPresent:t,anchorX:n,anchorY:i,root:a,pop:o}){var h;const r=N.useId(),l=N.useRef(null),c=N.useRef({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:d}=N.useContext(Jn),u=((h=e.props)==null?void 0:h.ref)??(e==null?void 0:e.ref),p=ap(l,u);return N.useInsertionEffect(()=>{const{width:f,height:m,top:y,left:b,right:w,bottom:j}=c.current;if(t||o===!1||!l.current||!f||!m)return;const k=n==="left"?`left: ${b}`:`right: ${w}`,C=i==="bottom"?`bottom: ${j}`:`top: ${y}`;l.current.dataset.motionPopId=r;const _=document.createElement("style");d&&(_.nonce=d);const g=a??document.head;return g.appendChild(_),_.sheet&&_.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${f}px !important;
            height: ${m}px !important;
            ${k}px !important;
            ${C}px !important;
          }
        `),()=>{g.contains(_)&&g.removeChild(_)}},[t]),s.jsx(rp,{isPresent:t,childRef:l,sizeRef:c,pop:o,children:o===!1?e:N.cloneElement(e,{ref:p})})}const lp=({children:e,initial:t,isPresent:n,onExitComplete:i,custom:a,presenceAffectsLayout:o,mode:r,anchorX:l,anchorY:c,root:d})=>{const u=Nn(cp),p=N.useId();let h=!0,f=N.useMemo(()=>(h=!1,{id:p,initial:t,isPresent:n,custom:a,onExitComplete:m=>{u.set(m,!0);for(const y of u.values())if(!y)return;i&&i()},register:m=>(u.set(m,!1),()=>u.delete(m))}),[n,u,i]);return o&&h&&(f={...f}),N.useMemo(()=>{u.forEach((m,y)=>u.set(y,!1))},[n]),N.useEffect(()=>{!n&&!u.size&&i&&i()},[n]),e=s.jsx(op,{pop:r==="popLayout",isPresent:n,anchorX:l,anchorY:c,root:d,children:e}),s.jsx(bs.Provider,{value:f,children:e})};function cp(){return new Map}function Do(e=!0){const t=N.useContext(bs);if(t===null)return[!0,null];const{isPresent:n,onExitComplete:i,register:a}=t,o=N.useId();N.useEffect(()=>{if(e)return a(o)},[e]);const r=N.useCallback(()=>e&&i&&i(o),[o,i,e]);return!n&&i?[!1,r]:[!0]}const Zt=e=>e.key||"";function Aa(e){const t=[];return N.Children.forEach(e,n=>{N.isValidElement(n)&&t.push(n)}),t}const Mo=({children:e,custom:t,initial:n=!0,onExitComplete:i,presenceAffectsLayout:a=!0,mode:o="sync",propagate:r=!1,anchorX:l="left",anchorY:c="top",root:d})=>{const[u,p]=Do(r),h=N.useMemo(()=>Aa(e),[e]),f=r&&!u?[]:h.map(Zt),m=N.useRef(!0),y=N.useRef(h),b=Nn(()=>new Map),w=N.useRef(new Set),[j,k]=N.useState(h),[C,_]=N.useState(h);or(()=>{m.current=!1,y.current=h;for(let v=0;v<C.length;v++){const S=Zt(C[v]);f.includes(S)?(b.delete(S),w.current.delete(S)):b.get(S)!==!0&&b.set(S,!1)}},[C,f.length,f.join("-")]);const g=[];if(h!==j){let v=[...h];for(let S=0;S<C.length;S++){const A=C[S],R=Zt(A);f.includes(R)||(v.splice(S,0,A),g.push(A))}return o==="wait"&&g.length&&(v=g),_(Aa(v)),k(h),null}const{forceRender:x}=N.useContext(jn);return s.jsx(s.Fragment,{children:C.map(v=>{const S=Zt(v),A=r&&!u?!1:h===C||f.includes(S),R=()=>{if(w.current.has(S))return;if(w.current.add(S),b.has(S))b.set(S,!0);else return;let P=!0;b.forEach(L=>{L||(P=!1)}),P&&(x==null||x(),_(y.current),r&&(p==null||p()),i&&i())};return s.jsx(lp,{isPresent:A,initial:!m.current||n?void 0:!1,custom:t,presenceAffectsLayout:a,mode:o,root:d,onExitComplete:A?void 0:R,anchorX:l,anchorY:c,children:v},S)})})},Ro=N.createContext({strict:!1}),Ea={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]};let Da=!1;function dp(){if(Da)return;const e={};for(const t in Ea)e[t]={isEnabled:n=>Ea[t].some(i=>!!n[i])};ro(e),Da=!0}function Po(){return dp(),Xu()}function up(e){const t=Po();for(const n in e)t[n]={...t[n],...e[n]};ro(t)}const hp=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","propagate","ignoreStrict","viewport"]);function ms(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||hp.has(e)}let Io=e=>!ms(e);function pp(e){typeof e=="function"&&(Io=t=>t.startsWith("on")?!ms(t):e(t))}try{pp(require("@emotion/is-prop-valid").default)}catch{}function fp(e,t,n){const i={};for(const a in e)a==="values"&&typeof e.values=="object"||(Io(a)||n===!0&&ms(a)||!t&&!ms(a)||e.draggable&&a.startsWith("onDrag"))&&(i[a]=e[a]);return i}const ws=N.createContext({});function mp(e,t){if(vs(e)){const{initial:n,animate:i}=e;return{initial:n===!1||It(n)?n:void 0,animate:It(i)?i:void 0}}return e.inherit!==!1?t:{}}function xp(e){const{initial:t,animate:n}=mp(e,N.useContext(ws));return N.useMemo(()=>({initial:t,animate:n}),[Ma(t),Ma(n)])}function Ma(e){return Array.isArray(e)?e.join(" "):e}const Qn=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function Lo(e,t,n){for(const i in t)!pe(t[i])&&!fo(i,n)&&(e[i]=t[i])}function gp({transformTemplate:e},t){return N.useMemo(()=>{const n=Qn();return Xn(n,t,e),Object.assign({},n.vars,n.style)},[t])}function bp(e,t){const n=e.style||{},i={};return Lo(i,n,e),Object.assign(i,gp(e,t)),i}function yp(e,t){const n={},i=bp(e,t);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,i.userSelect=i.WebkitUserSelect=i.WebkitTouchCallout="none",i.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=i,n}const Oo=()=>({...Qn(),attrs:{}});function vp(e,t,n,i){const a=N.useMemo(()=>{const o=Oo();return mo(o,t,go(i),e.transformTemplate,e.style),{...o.attrs,style:{...o.style}}},[t]);if(e.style){const o={};Lo(o,e.style,e),a.style={...o,...a.style}}return a}const wp=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function ei(e){return typeof e!="string"||e.includes("-")?!1:!!(wp.indexOf(e)>-1||/[A-Z]/u.test(e))}function jp(e,t,n,{latestValues:i},a,o=!1,r){const c=(r??ei(e)?vp:yp)(t,i,a,e),d=fp(t,typeof e=="string",o),u=e!==N.Fragment?{...d,...c,ref:n}:{},{children:p}=t,h=N.useMemo(()=>pe(p)?p.get():p,[p]);return N.createElement(e,{...u,children:h})}function Np({scrapeMotionValuesFromProps:e,createRenderState:t},n,i,a){return{latestValues:Sp(n,i,a,e),renderState:t()}}function Sp(e,t,n,i){const a={},o=i(e,{});for(const h in o)a[h]=os(o[h]);let{initial:r,animate:l}=e;const c=vs(e),d=ao(e);t&&d&&!c&&e.inherit!==!1&&(r===void 0&&(r=t.initial),l===void 0&&(l=t.animate));let u=n?n.initial===!1:!1;u=u||r===!1;const p=u?l:r;if(p&&typeof p!="boolean"&&!ys(p)){const h=Array.isArray(p)?p:[p];for(let f=0;f<h.length;f++){const m=$n(e,h[f]);if(m){const{transitionEnd:y,transition:b,...w}=m;for(const j in w){let k=w[j];if(Array.isArray(k)){const C=u?k.length-1:0;k=k[C]}k!==null&&(a[j]=k)}for(const j in y)a[j]=y[j]}}}return a}const Vo=e=>(t,n)=>{const i=N.useContext(ws),a=N.useContext(bs),o=()=>Np(e,t,i,a);return n?o():Nn(o)},kp=Vo({scrapeMotionValuesFromProps:Zn,createRenderState:Qn}),_p=Vo({scrapeMotionValuesFromProps:bo,createRenderState:Oo}),Cp=Symbol.for("motionComponentSymbol");function Tp(e,t,n){const i=N.useRef(n);N.useInsertionEffect(()=>{i.current=n});const a=N.useRef(null);return N.useCallback(o=>{var l;o&&((l=e.onMount)==null||l.call(e,o)),t&&(o?t.mount(o):t.unmount());const r=i.current;if(typeof r=="function")if(o){const c=r(o);typeof c=="function"&&(a.current=c)}else a.current?(a.current(),a.current=null):r(o);else r&&(r.current=o)},[t])}const Fo=N.createContext({});function at(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function Ap(e,t,n,i,a,o){var k,C;const{visualElement:r}=N.useContext(ws),l=N.useContext(Ro),c=N.useContext(bs),d=N.useContext(Jn),u=d.reducedMotion,p=d.skipAnimations,h=N.useRef(null),f=N.useRef(!1);i=i||l.renderer,!h.current&&i&&(h.current=i(e,{visualState:t,parent:r,props:n,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:u,skipAnimations:p,isSVG:o}),f.current&&h.current&&(h.current.manuallyAnimateOnMount=!0));const m=h.current,y=N.useContext(Fo);m&&!m.projection&&a&&(m.type==="html"||m.type==="svg")&&Ep(h.current,n,a,y);const b=N.useRef(!1);N.useInsertionEffect(()=>{m&&b.current&&m.update(n,c)});const w=n[Hr],j=N.useRef(!!w&&!((k=window.MotionHandoffIsComplete)!=null&&k.call(window,w))&&((C=window.MotionHasOptimisedAnimation)==null?void 0:C.call(window,w)));return or(()=>{f.current=!0,m&&(b.current=!0,window.MotionIsMounted=!0,m.updateFeatures(),m.scheduleRenderMicrotask(),j.current&&m.animationState&&m.animationState.animateChanges())}),N.useEffect(()=>{m&&(!j.current&&m.animationState&&m.animationState.animateChanges(),j.current&&(queueMicrotask(()=>{var _;(_=window.MotionHandoffMarkAsComplete)==null||_.call(window,w)}),j.current=!1),m.enteringChildren=void 0)}),m}function Ep(e,t,n,i){const{layoutId:a,layout:o,drag:r,dragConstraints:l,layoutScroll:c,layoutRoot:d,layoutCrossfade:u}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:Bo(e.parent)),e.projection.setOptions({layoutId:a,layout:o,alwaysMeasureLayout:!!r||l&&at(l),visualElement:e,animationType:typeof o=="string"?o:"both",initialPromotionConfig:i,crossfade:u,layoutScroll:c,layoutRoot:d})}function Bo(e){if(e)return e.options.allowProjection!==!1?e.projection:Bo(e.parent)}function Is(e,{forwardMotionProps:t=!1,type:n}={},i,a){i&&up(i);const o=n?n==="svg":ei(e),r=o?_p:kp;function l(d,u){let p;const h={...N.useContext(Jn),...d,layoutId:Dp(d)},{isStatic:f}=h,m=xp(d),y=r(d,f);if(!f&&rr){Mp();const b=Rp(h);p=b.MeasureLayout,m.visualElement=Ap(e,y,h,a,b.ProjectionNode,o)}return s.jsxs(ws.Provider,{value:m,children:[p&&m.visualElement?s.jsx(p,{visualElement:m.visualElement,...h}):null,jp(e,d,Tp(y,m.visualElement,u),y,f,t,o)]})}l.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const c=N.forwardRef(l);return c[Cp]=e,c}function Dp({layoutId:e}){const t=N.useContext(jn).id;return t&&e!==void 0?t+"-"+e:e}function Mp(e,t){N.useContext(Ro).strict}function Rp(e){const t=Po(),{drag:n,layout:i}=t;if(!n&&!i)return{};const a={...n,...i};return{MeasureLayout:n!=null&&n.isEnabled(e)||i!=null&&i.isEnabled(e)?a.MeasureLayout:void 0,ProjectionNode:a.ProjectionNode}}function Pp(e,t){if(typeof Proxy>"u")return Is;const n=new Map,i=(o,r)=>Is(o,r,e,t),a=(o,r)=>i(o,r);return new Proxy(a,{get:(o,r)=>r==="create"?i:(n.has(r)||n.set(r,Is(r,void 0,e,t)),n.get(r))})}const Ip=(e,t)=>t.isSVG??ei(e)?new ph(t):new oh(t,{allowProjection:e!==N.Fragment});class Lp extends Be{constructor(t){super(t),t.animationState||(t.animationState=bh(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();ys(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)==null||t.call(this)}}let Op=0;class Vp extends Be{constructor(){super(...arguments),this.id=Op++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:i}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===i)return;const a=this.node.animationState.setActive("exit",!t);n&&!t&&a.then(()=>{n(this.id)})}mount(){const{register:t,onExitComplete:n}=this.node.presenceContext||{};n&&n(this.id),t&&(this.unmount=t(this.id))}unmount(){}}const Fp={animation:{Feature:Lp},exit:{Feature:Vp}};function Ut(e){return{point:{x:e.pageX,y:e.pageY}}}const Bp=e=>t=>qn(t)&&e(t,Ut(t));function Et(e,t,n,i){return Lt(e,t,Bp(n),i)}const Uo=({current:e})=>e?e.ownerDocument.defaultView:null,Ra=(e,t)=>Math.abs(e-t);function Up(e,t){const n=Ra(e.x,t.x),i=Ra(e.y,t.y);return Math.sqrt(n**2+i**2)}const Pa=new Set(["auto","scroll"]);class $o{constructor(t,n,{transformPagePoint:i,contextWindow:a=window,dragSnapToOrigin:o=!1,distanceThreshold:r=3,element:l}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.scrollPositions=new Map,this.removeScrollListeners=null,this.onElementScroll=f=>{this.handleScroll(f.target)},this.onWindowScroll=()=>{this.handleScroll(window)},this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=Os(this.lastMoveEventInfo,this.history),m=this.startEvent!==null,y=Up(f.offset,{x:0,y:0})>=this.distanceThreshold;if(!m&&!y)return;const{point:b}=f,{timestamp:w}=le;this.history.push({...b,timestamp:w});const{onStart:j,onMove:k}=this.handlers;m||(j&&j(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),k&&k(this.lastMoveEvent,f)},this.handlePointerMove=(f,m)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=Ls(m,this.transformPagePoint),H.update(this.updatePoint,!0)},this.handlePointerUp=(f,m)=>{this.end();const{onEnd:y,onSessionEnd:b,resumeAnimation:w}=this.handlers;if((this.dragSnapToOrigin||!this.startEvent)&&w&&w(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const j=Os(f.type==="pointercancel"?this.lastMoveEventInfo:Ls(m,this.transformPagePoint),this.history);this.startEvent&&y&&y(f,j),b&&b(f,j)},!qn(t))return;this.dragSnapToOrigin=o,this.handlers=n,this.transformPagePoint=i,this.distanceThreshold=r,this.contextWindow=a||window;const c=Ut(t),d=Ls(c,this.transformPagePoint),{point:u}=d,{timestamp:p}=le;this.history=[{...u,timestamp:p}];const{onSessionStart:h}=n;h&&h(t,Os(d,this.history)),this.removeListeners=Vt(Et(this.contextWindow,"pointermove",this.handlePointerMove),Et(this.contextWindow,"pointerup",this.handlePointerUp),Et(this.contextWindow,"pointercancel",this.handlePointerUp)),l&&this.startScrollTracking(l)}startScrollTracking(t){let n=t.parentElement;for(;n;){const i=getComputedStyle(n);(Pa.has(i.overflowX)||Pa.has(i.overflowY))&&this.scrollPositions.set(n,{x:n.scrollLeft,y:n.scrollTop}),n=n.parentElement}this.scrollPositions.set(window,{x:window.scrollX,y:window.scrollY}),window.addEventListener("scroll",this.onElementScroll,{capture:!0,passive:!0}),window.addEventListener("scroll",this.onWindowScroll,{passive:!0}),this.removeScrollListeners=()=>{window.removeEventListener("scroll",this.onElementScroll,{capture:!0}),window.removeEventListener("scroll",this.onWindowScroll)}}handleScroll(t){const n=this.scrollPositions.get(t);if(!n)return;const i=t===window,a=i?{x:window.scrollX,y:window.scrollY}:{x:t.scrollLeft,y:t.scrollTop},o={x:a.x-n.x,y:a.y-n.y};o.x===0&&o.y===0||(i?this.lastMoveEventInfo&&(this.lastMoveEventInfo.point.x+=o.x,this.lastMoveEventInfo.point.y+=o.y):this.history.length>0&&(this.history[0].x-=o.x,this.history[0].y-=o.y),this.scrollPositions.set(t,a),H.update(this.updatePoint,!0))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),this.removeScrollListeners&&this.removeScrollListeners(),this.scrollPositions.clear(),Ve(this.updatePoint)}}function Ls(e,t){return t?{point:t(e.point)}:e}function Ia(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Os({point:e},t){return{point:e,delta:Ia(e,Wo(t)),offset:Ia(e,$p(t)),velocity:Wp(t,.1)}}function $p(e){return e[0]}function Wo(e){return e[e.length-1]}function Wp(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,i=null;const a=Wo(e);for(;n>=0&&(i=e[n],!(a.timestamp-i.timestamp>Te(t)));)n--;if(!i)return{x:0,y:0};i===e[0]&&e.length>2&&a.timestamp-i.timestamp>Te(t)*2&&(i=e[1]);const o=we(a.timestamp-i.timestamp);if(o===0)return{x:0,y:0};const r={x:(a.x-i.x)/o,y:(a.y-i.y)/o};return r.x===1/0&&(r.x=0),r.y===1/0&&(r.y=0),r}function zp(e,{min:t,max:n},i){return t!==void 0&&e<t?e=i?Z(t,e,i.min):Math.max(e,t):n!==void 0&&e>n&&(e=i?Z(n,e,i.max):Math.min(e,n)),e}function La(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function Hp(e,{top:t,left:n,bottom:i,right:a}){return{x:La(e.x,n,a),y:La(e.y,t,i)}}function Oa(e,t){let n=t.min-e.min,i=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,i]=[i,n]),{min:n,max:i}}function qp(e,t){return{x:Oa(e.x,t.x),y:Oa(e.y,t.y)}}function Gp(e,t){let n=.5;const i=ge(e),a=ge(t);return a>i?n=Mt(t.min,t.max-i,e.min):i>a&&(n=Mt(e.min,e.max-a,t.min)),Ee(0,1,n)}function Kp(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const xn=.35;function Yp(e=xn){return e===!1?e=0:e===!0&&(e=xn),{x:Va(e,"left","right"),y:Va(e,"top","bottom")}}function Va(e,t,n){return{min:Fa(e,t),max:Fa(e,n)}}function Fa(e,t){return typeof e=="number"?e:e[t]||0}const Xp=new WeakMap;class Zp{constructor(t){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ne(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=t}start(t,{snapToCursor:n=!1,distanceThreshold:i}={}){const{presenceContext:a}=this.visualElement;if(a&&a.isPresent===!1)return;const o=p=>{n&&this.snapToCursor(Ut(p).point),this.stopAnimation()},r=(p,h)=>{const{drag:f,dragPropagation:m,onDragStart:y}=this.getProps();if(f&&!m&&(this.openDragLock&&this.openDragLock(),this.openDragLock=_u(f),!this.openDragLock))return;this.latestPointerEvent=p,this.latestPanInfo=h,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Ce(w=>{let j=this.getAxisMotionValue(w).get()||0;if(Ae.test(j)){const{projection:k}=this.visualElement;if(k&&k.layout){const C=k.layout.layoutBox[w];C&&(j=ge(C)*(parseFloat(j)/100))}}this.originPoint[w]=j}),y&&H.update(()=>y(p,h),!1,!0),ln(this.visualElement,"transform");const{animationState:b}=this.visualElement;b&&b.setActive("whileDrag",!0)},l=(p,h)=>{this.latestPointerEvent=p,this.latestPanInfo=h;const{dragPropagation:f,dragDirectionLock:m,onDirectionLock:y,onDrag:b}=this.getProps();if(!f&&!this.openDragLock)return;const{offset:w}=h;if(m&&this.currentDirection===null){this.currentDirection=Qp(w),this.currentDirection!==null&&y&&y(this.currentDirection);return}this.updateAxis("x",h.point,w),this.updateAxis("y",h.point,w),this.visualElement.render(),b&&H.update(()=>b(p,h),!1,!0)},c=(p,h)=>{this.latestPointerEvent=p,this.latestPanInfo=h,this.stop(p,h),this.latestPointerEvent=null,this.latestPanInfo=null},d=()=>{const{dragSnapToOrigin:p}=this.getProps();(p||this.constraints)&&this.startAnimation({x:0,y:0})},{dragSnapToOrigin:u}=this.getProps();this.panSession=new $o(t,{onSessionStart:o,onStart:r,onMove:l,onSessionEnd:c,resumeAnimation:d},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:i,contextWindow:Uo(this.visualElement),element:this.visualElement.current})}stop(t,n){const i=t||this.latestPointerEvent,a=n||this.latestPanInfo,o=this.isDragging;if(this.cancel(),!o||!a||!i)return;const{velocity:r}=a;this.startAnimation(r);const{onDragEnd:l}=this.getProps();l&&H.postRender(()=>l(i,a))}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.endPanSession();const{dragPropagation:i}=this.getProps();!i&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),n&&n.setActive("whileDrag",!1)}endPanSession(){this.panSession&&this.panSession.end(),this.panSession=void 0}updateAxis(t,n,i){const{drag:a}=this.getProps();if(!i||!Jt(t,a,this.currentDirection))return;const o=this.getAxisMotionValue(t);let r=this.originPoint[t]+i[t];this.constraints&&this.constraints[t]&&(r=zp(r,this.constraints[t],this.elastic[t])),o.set(r)}resolveConstraints(){var o;const{dragConstraints:t,dragElastic:n}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(o=this.visualElement.projection)==null?void 0:o.layout,a=this.constraints;t&&at(t)?this.constraints||(this.constraints=this.resolveRefConstraints()):t&&i?this.constraints=Hp(i.layoutBox,t):this.constraints=!1,this.elastic=Yp(n),a!==this.constraints&&!at(t)&&i&&this.constraints&&!this.hasMutatedConstraints&&Ce(r=>{this.constraints!==!1&&this.getAxisMotionValue(r)&&(this.constraints[r]=Kp(i.layoutBox[r],this.constraints[r]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!at(t))return!1;const i=t.current,{projection:a}=this.visualElement;if(!a||!a.layout)return!1;const o=th(i,a.root,this.visualElement.getTransformPagePoint());let r=qp(a.layout.layoutBox,o);if(n){const l=n(Ju(r));this.hasMutatedConstraints=!!l,l&&(r=lo(l))}return r}startAnimation(t){const{drag:n,dragMomentum:i,dragElastic:a,dragTransition:o,dragSnapToOrigin:r,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=Ce(u=>{if(!Jt(u,n,this.currentDirection))return;let p=c&&c[u]||{};r&&(p={min:0,max:0});const h=a?200:1e6,f=a?40:1e7,m={type:"inertia",velocity:i?t[u]:0,bounceStiffness:h,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...o,...p};return this.startAxisValueAnimation(u,m)});return Promise.all(d).then(l)}startAxisValueAnimation(t,n){const i=this.getAxisMotionValue(t);return ln(this.visualElement,t),i.start(Un(t,i,0,n,this.visualElement,!1))}stopAnimation(){Ce(t=>this.getAxisMotionValue(t).stop())}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,i=this.visualElement.getProps(),a=i[n];return a||this.visualElement.getValue(t,(i.initial?i.initial[t]:void 0)||0)}snapToCursor(t){Ce(n=>{const{drag:i}=this.getProps();if(!Jt(n,i,this.currentDirection))return;const{projection:a}=this.visualElement,o=this.getAxisMotionValue(n);if(a&&a.layout){const{min:r,max:l}=a.layout.layoutBox[n],c=o.get()||0;o.set(t[n]-Z(r,l,.5)+c)}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:i}=this.visualElement;if(!at(n)||!i||!this.constraints)return;this.stopAnimation();const a={x:0,y:0};Ce(r=>{const l=this.getAxisMotionValue(r);if(l&&this.constraints!==!1){const c=l.get();a[r]=Gp({min:c,max:c},this.constraints[r])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",i.root&&i.root.updateScroll(),i.updateLayout(),this.constraints=!1,this.resolveConstraints(),Ce(r=>{if(!Jt(r,t,null))return;const l=this.getAxisMotionValue(r),{min:c,max:d}=this.constraints[r];l.set(Z(c,d,a[r]))}),this.visualElement.render()}addListeners(){if(!this.visualElement.current)return;Xp.set(this.visualElement,this);const t=this.visualElement.current,n=Et(t,"pointerdown",d=>{const{drag:u,dragListener:p=!0}=this.getProps(),h=d.target,f=h!==t&&Mu(h);u&&p&&!f&&this.start(d)});let i;const a=()=>{const{dragConstraints:d}=this.getProps();at(d)&&d.current&&(this.constraints=this.resolveRefConstraints(),i||(i=Jp(t,d.current,()=>this.scalePositionWithinConstraints())))},{projection:o}=this.visualElement,r=o.addEventListener("measure",a);o&&!o.layout&&(o.root&&o.root.updateScroll(),o.updateLayout()),H.read(a);const l=Lt(window,"resize",()=>this.scalePositionWithinConstraints()),c=o.addEventListener("didUpdate",(({delta:d,hasLayoutChanged:u})=>{this.isDragging&&u&&(Ce(p=>{const h=this.getAxisMotionValue(p);h&&(this.originPoint[p]+=d[p].translate,h.set(h.get()+d[p].translate))}),this.visualElement.render())}));return()=>{l(),n(),r(),c&&c(),i&&i()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:i=!1,dragPropagation:a=!1,dragConstraints:o=!1,dragElastic:r=xn,dragMomentum:l=!0}=t;return{...t,drag:n,dragDirectionLock:i,dragPropagation:a,dragConstraints:o,dragElastic:r,dragMomentum:l}}}function Ba(e){let t=!0;return()=>{if(t){t=!1;return}e()}}function Jp(e,t,n){const i=Gi(e,Ba(n)),a=Gi(t,Ba(n));return()=>{i(),a()}}function Jt(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function Qp(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class ef extends Be{constructor(t){super(t),this.removeGroupControls=je,this.removeListeners=je,this.controls=new Zp(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||je}update(){const{dragControls:t}=this.node.getProps(),{dragControls:n}=this.node.prevProps||{};t!==n&&(this.removeGroupControls(),t&&(this.removeGroupControls=t.subscribe(this.controls)))}unmount(){this.removeGroupControls(),this.removeListeners(),this.controls.isDragging||this.controls.endPanSession()}}const Vs=e=>(t,n)=>{e&&H.update(()=>e(t,n),!1,!0)};class tf extends Be{constructor(){super(...arguments),this.removePointerDownListener=je}onPointerDown(t){this.session=new $o(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Uo(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:i,onPanEnd:a}=this.node.getProps();return{onSessionStart:Vs(t),onStart:Vs(n),onMove:Vs(i),onEnd:(o,r)=>{delete this.session,a&&H.postRender(()=>a(o,r))}}}mount(){this.removePointerDownListener=Et(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}let Fs=!1;class sf extends N.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:i,layoutId:a}=this.props,{projection:o}=t;o&&(n.group&&n.group.add(o),i&&i.register&&a&&i.register(o),Fs&&o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,layoutDependency:this.props.layoutDependency,onExitComplete:()=>this.safeToRemove()})),ls.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:i,drag:a,isPresent:o}=this.props,{projection:r}=i;return r&&(r.isPresent=o,t.layoutDependency!==n&&r.setOptions({...r.options,layoutDependency:n}),Fs=!0,a||t.layoutDependency!==n||n===void 0||t.isPresent!==o?r.willUpdate():this.safeToRemove(),t.isPresent!==o&&(o?r.promote():r.relegate()||H.postRender(()=>{const l=r.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),Hn.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:i}=this.props,{projection:a}=t;Fs=!0,a&&(a.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(a),i&&i.deregister&&i.deregister(a))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function zo(e){const[t,n]=Do(),i=N.useContext(jn);return s.jsx(sf,{...e,layoutGroup:i,switchLayoutGroup:N.useContext(Fo),isPresent:t,safeToRemove:n})}const nf={pan:{Feature:tf},drag:{Feature:ef,ProjectionNode:Eo,MeasureLayout:zo}};function Ua(e,t,n){const{props:i}=e;e.animationState&&i.whileHover&&e.animationState.setActive("whileHover",n==="Start");const a="onHover"+n,o=i[a];o&&H.postRender(()=>o(t,Ut(t)))}class af extends Be{mount(){const{current:t}=this.node;t&&(this.unmount=Tu(t,(n,i)=>(Ua(this.node,i,"Start"),a=>Ua(this.node,a,"End"))))}unmount(){}}class rf extends Be{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Vt(Lt(this.node.current,"focus",()=>this.onFocus()),Lt(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function $a(e,t,n){const{props:i}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&i.whileTap&&e.animationState.setActive("whileTap",n==="Start");const a="onTap"+(n==="End"?"":n),o=i[a];o&&H.postRender(()=>o(t,Ut(t)))}class of extends Be{mount(){const{current:t}=this.node;if(!t)return;const{globalTapTarget:n,propagate:i}=this.node.props;this.unmount=Pu(t,(a,o)=>($a(this.node,o,"Start"),(r,{success:l})=>$a(this.node,r,l?"End":"Cancel")),{useGlobalTarget:n,stopPropagation:(i==null?void 0:i.tap)===!1})}unmount(){}}const gn=new WeakMap,Bs=new WeakMap,lf=e=>{const t=gn.get(e.target);t&&t(e)},cf=e=>{e.forEach(lf)};function df({root:e,...t}){const n=e||document;Bs.has(n)||Bs.set(n,{});const i=Bs.get(n),a=JSON.stringify(t);return i[a]||(i[a]=new IntersectionObserver(cf,{root:e,...t})),i[a]}function uf(e,t,n){const i=df(t);return gn.set(e,n),i.observe(e),()=>{gn.delete(e),i.unobserve(e)}}const hf={some:0,all:1};class pf extends Be{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:i,amount:a="some",once:o}=t,r={root:n?n.current:void 0,rootMargin:i,threshold:typeof a=="number"?a:hf[a]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,o&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:p}=this.node.getProps(),h=d?u:p;h&&h(c)};return uf(this.node.current,r,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(ff(t,n))&&this.startObserver()}unmount(){}}function ff({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const mf={inView:{Feature:pf},tap:{Feature:of},focus:{Feature:rf},hover:{Feature:af}},xf={layout:{ProjectionNode:Eo,MeasureLayout:zo}},gf={...Fp,...mf,...nf,...xf},xs=Pp(gf,Ip),he={gradients:{exposed:{from:"#ff0844",to:"rgba(255, 8, 68, 0)"},secured:{from:"#00d9ff",to:"rgba(16, 185, 129, 0)"}},glow:{exposed:"0 0 40px rgba(255, 8, 68, 0.6), 0 0 80px rgba(255, 8, 68, 0.3)",secured:"0 0 40px rgba(0, 217, 255, 0.6), 0 0 80px rgba(0, 217, 255, 0.3)"},spacing:{top:30,right:50,bottom:80,left:100}};function bf({data:e,x:t,y:n}){const i=l=>l>=1e6?`${(l/1e6).toFixed(1)}M‚Ç¨`:l>=1e3?`${Math.round(l/1e3)}k‚Ç¨`:`${Math.round(l)}‚Ç¨`,a=l=>new Date(l).toLocaleDateString("fr-FR",{weekday:"short",day:"2-digit",month:"short",year:"numeric"}).toUpperCase(),o=e.securedCA+e.exposedCA,r=o>0?(e.exposedCA/o*100).toFixed(1):"0.0";return ll.createPortal(s.jsxs(xs.div,{initial:{opacity:0,scale:.8,y:10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:10},transition:{duration:.2,ease:"easeOut"},className:"pointer-events-none fixed z-[9999]",style:{left:t,top:n-20,transform:"translate(-50%, -100%)"},children:[s.jsxs("div",{className:"relative backdrop-blur-2xl bg-slate-900 rounded-2xl border border-white/30 overflow-hidden",style:{boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.9), 0 0 100px rgba(0, 217, 255, 0.3)"},children:[s.jsx("div",{className:"absolute top-0 left-0 right-0 h-[2px] bg-gradient-to-r from-transparent via-cyan-400 to-transparent"}),s.jsxs("div",{className:"p-5 space-y-4 min-w-[280px]",children:[s.jsxs("div",{className:"flex items-center gap-2 pb-3 border-b border-white/10",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-400 animate-pulse",style:{boxShadow:he.glow.secured}}),s.jsx("span",{className:"text-[11px] font-black text-blue-300 uppercase tracking-[0.15em]",children:a(e.date)})]}),s.jsx("div",{className:"bg-gradient-to-br from-white/10 to-transparent p-4 rounded-xl border border-white/20",children:s.jsxs("div",{className:"flex items-baseline justify-between mb-1",children:[s.jsx("span",{className:"text-xs text-white/60 uppercase tracking-wider font-bold",children:"CA Total"}),s.jsx("span",{className:"text-3xl font-black text-white",style:{textShadow:"0 0 20px rgba(255,255,255,0.5)"},children:i(o)})]})}),s.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-cyan-500/30 to-emerald-500/20 p-3 rounded-xl border border-cyan-400/40",style:{boxShadow:"0 0 20px rgba(0, 217, 255, 0.3)"},children:[s.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-cyan-400/20 rounded-full blur-2xl"}),s.jsxs("div",{className:"relative z-10",children:[s.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-cyan-400",style:{boxShadow:he.glow.secured}}),s.jsx("span",{className:"text-[9px] text-cyan-300 font-black uppercase tracking-wider",children:"S√©curis√©"})]}),s.jsx("span",{className:"text-lg font-black text-cyan-100",children:i(e.securedCA)})]})]}),s.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-red-500/30 to-pink-500/20 p-3 rounded-xl border border-red-400/40",style:{boxShadow:"0 0 20px rgba(255, 8, 68, 0.3)"},children:[s.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-red-400/20 rounded-full blur-2xl"}),s.jsxs("div",{className:"relative z-10",children:[s.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-red-400",style:{boxShadow:he.glow.exposed}}),s.jsx("span",{className:"text-[9px] text-red-300 font-black uppercase tracking-wider",children:"√Ä Risque"})]}),s.jsx("span",{className:"text-lg font-black text-red-100",children:i(e.exposedCA)})]})]})]}),s.jsxs("div",{className:"pt-3 border-t border-white/10",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-[9px] text-white/50 uppercase tracking-wider font-bold",children:"Exposition"}),s.jsxs("span",{className:"text-sm text-white/80 font-black",children:[r,"%"]})]}),s.jsx("div",{className:"h-2 bg-white/10 rounded-full overflow-hidden",children:s.jsx(xs.div,{initial:{width:0},animate:{width:`${r}%`},transition:{duration:.5,ease:"easeOut"},className:"h-full bg-gradient-to-r from-red-500 to-pink-500 rounded-full",style:{boxShadow:"0 0 10px rgba(255, 8, 68, 0.5)"}})})]})]})]}),s.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -bottom-2",children:s.jsx("div",{className:"w-4 h-4 bg-slate-900 border-l border-b border-white/30 rotate-45"})})]}),document.body)}function yf({data:e,width:t=1200,height:n=550}){const[i,a]=N.useState(null),o=t-he.spacing.left-he.spacing.right,r=n-he.spacing.top-he.spacing.bottom,l=N.useMemo(()=>e.length===0?Hs({domain:[0,1],range:[0,o]}):Hs({domain:[new Date(e[0].date),new Date(e[e.length-1].date)],range:[0,o]}),[e,o]),c=N.useMemo(()=>e.length===0?1:Math.max(...e.map(b=>b.securedCA+b.exposedCA)),[e]),d=N.useMemo(()=>Me({domain:[0,c*1.1],range:[r,0],nice:!0}),[c,r]),u=b=>new Date(b.date),p=b=>l(u(b)),h=b=>d(b.securedCA),f=b=>d(b.securedCA+b.exposedCA),m=b=>{const w=ss(b);if(!w)return;const j=w.x-he.spacing.left,k=l.invert(j),C=e.reduce((g,x,v)=>{const S=u(x).getTime(),A=u(e[g]).getTime(),R=k.getTime();return Math.abs(S-R)<Math.abs(A-R)?v:g},0),_=e[C];a({data:_,x:p(_)+he.spacing.left,y:f(_)+he.spacing.top})},y=N.useMemo(()=>{if(e.length===0)return[];const b=Math.max(1,Math.ceil(e.length/7));return e.filter((w,j)=>j%b===0||j===e.length-1).map(w=>u(w))},[e]);return e.length===0||t<10||n<10||o<=0||r<=0?null:s.jsxs("div",{className:"relative w-full overflow-visible",children:[s.jsxs("svg",{width:t,height:n,children:[s.jsxs("defs",{children:[s.jsx(fi,{id:"gradient-exposed-tesla",from:he.gradients.exposed.from,to:he.gradients.exposed.to,vertical:!0}),s.jsx(fi,{id:"gradient-secured-tesla",from:he.gradients.secured.from,to:he.gradients.secured.to,vertical:!0}),s.jsxs("filter",{id:"glow-intense",children:[s.jsx("feGaussianBlur",{stdDeviation:"4",result:"coloredBlur"}),s.jsxs("feMerge",{children:[s.jsx("feMergeNode",{in:"coloredBlur"}),s.jsx("feMergeNode",{in:"coloredBlur"}),s.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),s.jsxs("g",{transform:`translate(${he.spacing.left}, ${he.spacing.top})`,children:[s.jsx(wn,{scale:d,width:o,stroke:"rgba(255, 255, 255, 0.05)",strokeWidth:1,numTicks:6}),s.jsx(Dt,{data:e,x:p,y:h,yScale:d,fill:"url(#gradient-secured-tesla)",curve:_e,style:{filter:"url(#glow-intense)"}}),s.jsx(Dt,{data:e,x:p,y0:h,y1:f,yScale:d,fill:"url(#gradient-exposed-tesla)",curve:_e,style:{filter:"url(#glow-intense)"}}),s.jsx(ut,{data:e,x:p,y:h,stroke:"#00d9ff",strokeWidth:3,curve:_e,strokeLinecap:"round",style:{filter:"drop-shadow(0 0 6px #00d9ff)"}}),s.jsx(ut,{data:e,x:p,y:f,stroke:"#ff0844",strokeWidth:3,curve:_e,strokeLinecap:"round",style:{filter:"drop-shadow(0 0 6px #ff0844)"}}),e.map((b,w)=>s.jsxs("g",{children:[s.jsx(gi,{cx:p(b),cy:f(b),r:(i==null?void 0:i.data)===b?6:3,fill:"#ff0844",stroke:"white",strokeWidth:(i==null?void 0:i.data)===b?2:1,style:{filter:(i==null?void 0:i.data)===b?"drop-shadow(0 0 8px #ff0844)":"none",cursor:"pointer",transition:"all 0.2s ease"}}),s.jsx(gi,{cx:p(b),cy:h(b),r:(i==null?void 0:i.data)===b?6:3,fill:"#00d9ff",stroke:"white",strokeWidth:(i==null?void 0:i.data)===b?2:1,style:{filter:(i==null?void 0:i.data)===b?"drop-shadow(0 0 8px #00d9ff)":"none",cursor:"pointer",transition:"all 0.2s ease"}})]},w)),i&&s.jsx("line",{x1:p(i.data),x2:p(i.data),y1:0,y2:r,stroke:"rgba(255, 255, 255, 0.2)",strokeWidth:2,strokeDasharray:"6,6",pointerEvents:"none"}),s.jsx(mt,{top:r,scale:l,stroke:"rgba(255, 255, 255, 0.2)",tickStroke:"rgba(255, 255, 255, 0.2)",tickValues:y,tickLabelProps:()=>({fill:"rgba(255, 255, 255, 0.6)",fontSize:12,fontFamily:"ui-monospace, monospace",textAnchor:"middle",fontWeight:700,dy:10}),tickFormat:b=>b.toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}).replace(".","")}),s.jsx(gs,{scale:d,stroke:"rgba(255, 255, 255, 0.2)",tickStroke:"rgba(255, 255, 255, 0.2)",numTicks:6,tickLabelProps:()=>({fill:"rgba(255, 255, 255, 0.6)",fontSize:13,fontFamily:"ui-monospace, monospace",textAnchor:"end",fontWeight:700,dx:-12}),tickFormat:b=>{const w=b;return w>=1e6?`${(w/1e6).toFixed(1)}M‚Ç¨`:w>=1e3?`${Math.round(w/1e3)}k‚Ç¨`:`${Math.round(w)}‚Ç¨`}}),s.jsx(ol,{width:o,height:r,fill:"transparent",onMouseMove:m,onMouseLeave:()=>a(null),style:{cursor:"crosshair"}})]})]}),s.jsx(Mo,{children:i&&s.jsx(bf,{data:i.data,x:i.x,y:i.y})})]})}const vf={risk:{bg:"bg-gradient-to-br from-red-950/40 to-red-900/10",border:"border-red-500/30",glow:"shadow-[0_0_30px_rgba(239,68,68,0.15)]",dot:"bg-red-500",text:"text-red-400",textMuted:"text-red-300/60"},revenue:{bg:"bg-gradient-to-br from-emerald-950/40 to-emerald-900/10",border:"border-emerald-500/30",glow:"shadow-[0_0_30px_rgba(16,185,129,0.15)]",dot:"bg-emerald-500",text:"text-emerald-400",textMuted:"text-emerald-300/60"},velocity:{bg:"bg-gradient-to-br from-blue-950/40 to-blue-900/10",border:"border-blue-500/30",glow:"shadow-[0_0_30px_rgba(59,130,246,0.15)]",dot:"bg-blue-500",text:"text-blue-400",textMuted:"text-blue-300/60"}},wf={emerald:"text-emerald-400",blue:"text-blue-400",orange:"text-orange-400",red:"text-red-400",slate:"text-slate-400"};function jf({data:e}){if(!e||e.length===0)return null;const t=Math.max(...e),n=Math.min(...e),i=t-n||1,a=e.map((o,r)=>{const l=r/(e.length-1)*100,c=100-(o-n)/i*100;return`${l},${c}`}).join(" ");return s.jsx("svg",{viewBox:"0 0 100 100",className:"w-full h-8 opacity-30",preserveAspectRatio:"none",children:s.jsx("polyline",{points:a,fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}function Nf({trend:e}){const t=e.direction==="up"?dl:e.direction==="down"?ul:Sl,n=e.direction==="up"?"text-emerald-400 bg-emerald-500/10":e.direction==="down"?"text-red-400 bg-red-500/10":"text-slate-400 bg-slate-500/10";return s.jsxs("div",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-lg ${n} text-[10px] font-bold uppercase tracking-wider`,children:[s.jsx(t,{size:12}),s.jsxs("span",{children:[Math.abs(e.percentage),"%"]})]})}function Us({type:e,title:t,icon:n,heroValue:i,heroLabel:a,trend:o,metrics:r,sparklineData:l}){const c=vf[e];return s.jsxs("div",{className:`
        ${c.bg} ${c.border} ${c.glow}
        border rounded-3xl p-8
        transition-all duration-500 ease-out
        hover:scale-[1.02] hover:${c.glow.replace("0.15","0.25")}
        group relative overflow-hidden
      `,children:[s.jsx("div",{className:`absolute inset-0 ${c.dot} opacity-0 group-hover:opacity-5 blur-3xl transition-opacity duration-500`}),s.jsxs("header",{className:"flex items-center justify-between mb-6 relative z-10",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`w-2 h-2 rounded-full ${c.dot} animate-pulse`}),s.jsx("h3",{className:`text-[10px] font-black ${c.text} uppercase tracking-widest`,children:t})]}),s.jsx("div",{className:`${c.textMuted} opacity-50`,children:n})]}),s.jsxs("div",{className:"mb-6 relative z-10",children:[s.jsxs("div",{className:"flex items-baseline gap-3 mb-2",children:[s.jsx("span",{className:"text-5xl font-black text-white tracking-tighter font-mono",children:i}),o&&s.jsx(Nf,{trend:o})]}),s.jsx("p",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:a})]}),l&&l.length>0&&s.jsx("div",{className:`mb-6 ${c.text} relative z-10`,children:s.jsx(jf,{data:l})}),s.jsx("div",{className:"grid grid-cols-2 gap-4 relative z-10",children:r.map((d,u)=>s.jsxs("div",{className:"bg-white/[0.03] backdrop-blur-sm px-4 py-3 rounded-xl border border-white/5 hover:bg-white/[0.06] transition-colors",children:[s.jsx("span",{className:"block text-[9px] uppercase text-slate-500 mb-1 font-bold tracking-widest",children:d.label}),s.jsx("span",{className:`text-xl font-black font-mono ${d.color?wf[d.color]:"text-white"}`,children:d.value})]},u))})]})}function Sf({risk:e,revenue:t,velocity:n,history:i}){var a,o,r;return s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx(Us,{type:"risk",title:"Risque Imm√©diat",icon:s.jsx(_t,{size:20}),heroValue:`${Math.round(e.exposedCA/1e3)}k‚Ç¨`,heroLabel:"CA √† Risque",trend:{value:0,percentage:12,direction:"down"},metrics:[{label:"War Room",value:e.warRoomCount,color:"red"},{label:"Retards Ops",value:e.delayCount,color:"orange"}],sparklineData:(a=i==null?void 0:i.risk)!=null&&a.length?i.risk:[120,100,80,60,40,e.exposedCA/1e3]}),s.jsx(Us,{type:"revenue",title:"Sant√© Revenu",icon:s.jsx(Ke,{size:20}),heroValue:`${Math.round(t.securedCA/1e3)}k‚Ç¨`,heroLabel:"CA S√©curis√©",trend:{value:t.securedCA,percentage:18,direction:"up"},metrics:[{label:"Pipeline",value:t.pipelineCount,color:"emerald"},{label:"Avg Ticket",value:`${Math.round(t.avgTicket/1e3)}k‚Ç¨`,color:"blue"}],sparklineData:(o=i==null?void 0:i.revenue)!=null&&o.length?i.revenue:[150,170,180,200,220,230,t.securedCA/1e3]}),s.jsx(Us,{type:"velocity",title:"V√©locit√© Ops",icon:s.jsx(cl,{size:20}),heroValue:`${n.avgDelayDays.toFixed(1)}j`,heroLabel:"D√©lai Moyen (Depuis Sign√©)",trend:{value:14,percentage:0,direction:"stable"},metrics:[{label:"Actifs",value:n.activeCount,color:"blue"},{label:"Silencieux",value:n.silentCount,color:"orange"}],sparklineData:(r=i==null?void 0:i.velocity)!=null&&r.length?i.velocity:[12,13,14,14,15,14,14]})]})}function kf({events:e}){return s.jsxs("div",{className:"space-y-4 max-h-[400px] overflow-y-auto pr-4 scrollbar-thin scrollbar-thumb-white/10",children:[e.map(t=>s.jsxs("div",{className:"flex gap-4 p-4 bg-black/40 border border-white/10 rounded-xl hover:border-white/20 transition-all group",children:[s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx("div",{className:`w-2 h-2 rounded-full mt-1.5 ${t.type==="email_sent"?"bg-sky-400":t.type==="war_room_entry"?"bg-red-500":t.type==="decision"?"bg-indigo-400":"bg-white/20"}`}),s.jsx("div",{className:"w-[1px] flex-1 bg-white/5 group-last:hidden"})]}),s.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsx("span",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest font-mono",children:t.time}),s.jsx("span",{className:"text-[9px] font-black text-white/20 uppercase tracking-widest",children:t.type.replace("_"," ")})]}),s.jsx("p",{className:"text-sm font-black text-white uppercase tracking-tight",children:t.label}),s.jsx("p",{className:"text-[11px] text-slate-400 italic font-medium",children:t.detail})]})]},t.id)),e.length===0&&s.jsx("div",{className:"py-12 text-center",children:s.jsx("p",{className:"text-[10px] font-black text-white/20 uppercase tracking-[0.4em] italic",children:"En attente de nouveaux signaux..."})})]})}function Ho(e){let t=0;const n=e.days_since_signature??0,i=e.days_since_last_event??0;return e.status==="signed"&&n>14&&!e.deposit_paid&&(t+=60),e.status==="signed"&&n>=8&&n<=14&&!e.deposit_paid&&(t+=40),i>10?t+=25:i>=6&&(t+=15),e.email_optout&&(t+=100),e.deposit_paid&&(t-=40),i<=2&&(t-=15),Math.max(0,Math.min(100,t))}function qo(e){let t=0;if(e.days_since_last_event==null)return 60;const n=e.days_since_last_event;return n>14?t+=50:n>=7?t+=35:n>=4&&(t+=20),n<=2&&(t-=25),Math.max(0,Math.min(100,t))}function _f(e){const t=Ho(e),n=qo(e),a=100-(t*.6+n*.4);return Math.max(0,Math.round(a))}function Cf(e){return{study_id:e.study_id,risk_score_ops:Ho(e),inertia_score:qo(e),ops_health_score:_f(e)}}function Tf(e){return N.useMemo(()=>e.map(Cf),[e])}const Af=14,Ef=7;function Df(e){if(e.status!=="signed")return null;const t=[],n=e.days_since_signature??0,i=e.days_since_last_event??null,a=e.deposit_paid===!0,r=(e.install_cost??0)>0;return n>Af&&!a&&r?(t.push("D√©lai SRU d√©pass√© sans s√©curisation financi√®re"),{studyId:e.study_id,status:"WAR_ROOM",reasons:t,recommendation:"INTERVENTION IMM√âDIATE ‚Äî s√©curiser ou stopper"}):(n>=Ef&&!a&&r&&t.push("Signature ancienne sans acompte"),i!==null&&i>=5&&t.push("Aucune interaction r√©cente apr√®s signature"),t.length>=2?{studyId:e.study_id,status:"WAR_ROOM",reasons:t,recommendation:"S√âCURISER EN URGENCE"}:t.length===1?{studyId:e.study_id,status:"A_SECURISER",reasons:t,recommendation:"Relance cibl√©e pour s√©curisation"}:{studyId:e.study_id,status:"SOUS_CONTROLE",reasons:[],recommendation:"RAS ‚Äî dossier sain"})}function Mf(e){return e.status==="sent"&&!e.signed_at&&!e.deposit_paid}function Rf(e){if(!Mf(e))return null;const t=[],n=e.days_since_last_event??null,i=n!==null&&n>7;let a="NEUTRE";const o=e.interaction_score??0;return o>=60?a="INTERESSE":o>=30?a="AGITE":i&&(a="MUET"),a==="INTERESSE"&&i?(t.push("Client int√©ress√© mais silencieux"),{studyId:e.study_id,status:"A_RELANCER",reasons:t,recommendation:"APPELER_EN_PRIORITE"}):a==="MUET"?(t.push("Client silencieux, risque fatigue"),{studyId:e.study_id,status:"A_SURVEILLER",reasons:t,recommendation:"NE_PAS_RELANCER"}):(t.push("Situation normale"),{studyId:e.study_id,status:"A_SURVEILLER",reasons:t,recommendation:"AUCUNE_ACTION"})}const Pf=30,If=7;function Lf(e){if(e.status==="signed")return null;if(e.email_optout===!0)return{studyId:e.study_id,status:"A_ABANDONNER",reasons:["Client opt-out (RGPD)"],recommendation:"STOP ‚Äî aucun contact autoris√©"};const n=[],i=e.days_since_last_event??null;return i!==null&&i>=Pf?(n.push("Aucune interaction depuis plus de 30 jours"),{studyId:e.study_id,status:"A_ABANDONNER",reasons:n,recommendation:"STOP ‚Äî lead froid, d√©sengager"}):i!==null&&i<=If?(n.push("Interaction r√©cente d√©tect√©e"),{studyId:e.study_id,status:"A_APPELER",reasons:n,recommendation:"APPEL HUMAIN PRIORITAIRE"}):(n.push("Lead passif sans signal fort"),{studyId:e.study_id,status:"A_OBSERVER",reasons:n,recommendation:"Surveiller sans relance agressive"})}function Of(e){const t=Df(e);if(t){if(t.status==="WAR_ROOM")return{studyId:e.study_id,priority:"WAR_ROOM",sourceAxis:"A",reasons:t.reasons,recommendation:t.recommendation};if(t.status==="A_SECURISER")return{studyId:e.study_id,priority:"PRIORITY_ACTION",sourceAxis:"A",reasons:t.reasons,recommendation:t.recommendation}}const n=Rf(e);if(n){if(n.status==="A_RELANCER")return{studyId:e.study_id,priority:"PRIORITY_ACTION",sourceAxis:"B",reasons:n.reasons,recommendation:n.recommendation};if(n.status==="A_SURVEILLER")return{studyId:e.study_id,priority:"WATCH",sourceAxis:"B",reasons:n.reasons,recommendation:n.recommendation}}const i=Lf(e);if(i){if(i.status==="A_APPELER")return{studyId:e.study_id,priority:"PRIORITY_ACTION",sourceAxis:"C",reasons:i.reasons,recommendation:i.recommendation};if(i.status==="A_ABANDONNER")return{studyId:e.study_id,priority:"STOP",sourceAxis:"C",reasons:i.reasons,recommendation:i.recommendation}}const a={studyId:e.study_id,priority:"NONE",sourceAxis:null,reasons:["Aucune action requise"],recommendation:"Aucune"};return a.audit_payload={study_id:e.study_id,action_performed:"NONE",justification:"Situation normale, aucune action",source_axis:null,risk_score:0,health_score:0,created_at:new Date().toISOString()},a}function Vf(e){return N.useMemo(()=>e.map(t=>Of(t)),[e])}function Ff(e,t){return t<e?{severity:"CRITICAL",message:"Rendered value is lower than raw data",recommendation:"Fix scale or clipping in chart renderer",code:"DATA_MISMATCH"}:null}const Bf=["FinancialRiskProofVisx","ProjectionCAVISX","RiskMapVisx","ClientDriftVisx","BehaviorDriftTimelineVisx","KpiCardsLayout"];function Uf(){return{component:"RISQUE FINANCIER",score:100,severity:"OK",issues:[]}}function $f(){return{component:"PROJECTION C.A.",score:100,severity:"OK",issues:[]}}function Wf(){return{component:"CARTOGRAPHIE DES RISQUES",score:100,severity:"OK",issues:[]}}function zf(){return{component:"D√âRIVE CLIENT (DRIFT)",score:100,severity:"OK",issues:[]}}function Hf(){return{component:"TIMELINE COMPORTEMENTALE",score:100,severity:"OK",issues:[]}}function qf(){return{component:"AGENCEMENT CARTES KPI",score:100,severity:"OK",issues:[]}}const Gf={FinancialRiskProofVisx:Uf,ProjectionCAVISX:$f,RiskMapVisx:Wf,ClientDriftVisx:zf,BehaviorDriftTimelineVisx:Hf,KpiCardsLayout:qf};function Go(e){const t=[],n=[];for(const o of Bf){const r=Gf[o];if(!r)throw new Error(`GOVERNANCE BREACH: Component "${o}" is visible in Cockpit but has NO UX auditor.`);let l;try{l=r()}catch(d){throw new Error(`AUDIT CRASHED for ${o}: ${d}`)}if(!l)throw new Error(`AUDIT FAILURE: Auditor for "${o}" returned no result.`);const c={component:o,...l};o.includes("Cards")||o.includes("KPI")?n.push(c):t.push(c)}const i=[...t.map(o=>o.score),...n.map(o=>o.score),e.dataIntegrityIssues.length?40:100],a=i.length>0?i.reduce((o,r)=>o+r,0)/i.length:100;return{globalScore:Math.round(a),charts:t,cards:n,dataIntegrityIssues:e.dataIntegrityIssues}}const Kf="ux_audit_history";function Yf(){return typeof window>"u"?[]:JSON.parse(localStorage.getItem(Kf)||"[]")}const Wa=14,Xf=7,Zf=.6,Jf=3e4,za={DEPOSIT_RECEIVED:-.15,HIGH_INTERACTION:-.1},nt={NO_DEPOSIT_EARLY:.1,NO_DEPOSIT_LATE:.25,SILENCE_LOW:.1,SILENCE_CRITICAL:.2,HIGH_AMOUNT:.08,SRU_DANGER_ZONE:.35};function Qf(e){let t=0;const n=[];e.daysSinceSignature>=Wa-2&&(t+=nt.SRU_DANGER_ZONE,n.push("SRU danger zone")),e.depositReceived?t+=za.DEPOSIT_RECEIVED:(t+=e.daysSinceSignature>Xf?nt.NO_DEPOSIT_LATE:nt.NO_DEPOSIT_EARLY,n.push("Deposit not received")),e.interactionScore<20?(t+=nt.SILENCE_CRITICAL,n.push("Client silent")):e.interactionScore<40?t+=nt.SILENCE_LOW:e.interactionScore>60&&(t+=za.HIGH_INTERACTION),e.amount>Jf&&(t+=nt.HIGH_AMOUNT,n.push("High amount"));const i=t>=Zf;return{riskScore:t,warRoom:i,status:e.depositReceived||e.daysSinceSignature>Wa?"LOCKED":i?"DANGER":"EXPOSED",reasons:n}}function em(e){return Qf(e)}const tm=({system:e,chartsToAudit:t=[]})=>{const[n,i]=N.useState("IDLE"),[a,o]=N.useState(null),r=async()=>{i("RUNNING"),await new Promise(m=>setTimeout(m,1500));const h=Go({dataIntegrityIssues:[]}),f={decisions:[],uxScore:h.globalScore,dataBreaches:0,uxDetails:h};try{const m=await fetch("/api/ops/audit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)});if(m.ok){const y=await m.json();o(y)}else o(mi(f))}catch(m){console.error("Audit History Save Failed",m),o(mi(f))}i("RESULT")},l=()=>{if(a){console.log("üìÑ Generating PDF with result:",a);try{const h=pl(a),f=document.createElement("a");f.href=h,f.download=`EDF_OPS_AUDIT_REPORT_${new Date().toISOString().split("T")[0]}.pdf`,document.body.appendChild(f),f.click(),document.body.removeChild(f)}catch(h){console.error("‚ùå PDF Generation Failed:",h),alert(`Erreur g√©n√©ration PDF: ${h.message}
Voir console pour d√©tails.`)}}};if(n==="IDLE")return s.jsxs("button",{onClick:r,className:"flex items-center gap-2 px-4 py-2 bg-slate-800 hover:bg-slate-700 border border-slate-600 rounded-lg transition-colors group",children:[s.jsx(_l,{size:16,className:"text-slate-400 group-hover:text-white"}),s.jsx("span",{className:"text-xs font-bold text-slate-300 group-hover:text-white uppercase tracking-wider",children:"Run Ops & UX Audit"})]});if(n==="RUNNING")return s.jsxs("button",{disabled:!0,className:"flex items-center gap-2 px-4 py-2 bg-slate-900 border border-slate-700 rounded-lg cursor-wait",children:[s.jsx(hl,{size:16,className:"text-blue-500 animate-spin"}),s.jsx("span",{className:"text-xs font-bold text-blue-400 uppercase tracking-wider",children:"Auditing System..."})]});if(!a)return null;const c=a.comparison,d=(c==null?void 0:c.status)==="REGRESSED"||(c==null?void 0:c.uxDelta)<0,u=a.globalScore<60||a.dataIntegrityBreaches>0||d,p=!u&&a.globalScore>=80&&a.dataIntegrityBreaches===0;return s.jsxs("div",{className:"relative",children:[s.jsxs("button",{onClick:()=>i("IDLE"),className:`flex items-center gap-3 px-4 py-2 rounded-lg border ${u?"bg-red-900/20 border-red-500/50":"bg-emerald-900/20 border-emerald-500/50"}`,children:[u?s.jsx(_t,{size:16,className:"text-red-500"}):s.jsx(Ke,{size:16,className:"text-emerald-500"}),s.jsxs("div",{className:"flex flex-col items-start text-left",children:[s.jsx("span",{className:`text-[10px] font-black uppercase tracking-wider ${u?"text-red-400":"text-emerald-400"}`,children:u?"AUDIT FAILED":"SYSTEM CERTIFIED"}),s.jsxs("span",{className:"text-xs font-bold text-white",children:["Score: ",a.globalScore,"/100"]})]})]}),s.jsxs("div",{className:"absolute top-full right-0 mt-4 w-[400px] bg-[#0F1629] border border-slate-700 rounded-xl shadow-2xl p-6 z-50 animate-in fade-in slide-in-from-top-2",children:[d&&s.jsxs("div",{className:"mb-4 p-3 bg-red-900/30 border border-red-500 rounded flex items-start gap-3",children:[s.jsx(_t,{className:"text-red-500 shrink-0",size:20}),s.jsxs("div",{children:[s.jsx("h4",{className:"text-red-400 font-bold text-xs uppercase tracking-wider",children:"üö´ REGRESSION DETECTED"}),s.jsxs("p",{className:"text-red-300 text-[10px] mt-1",children:["UX Score dropped by ",Math.abs(c==null?void 0:c.uxDelta)," points.",s.jsx("br",{}),"Deployment is blocked until resolved."]})]})]}),s.jsxs("div",{className:"flex justify-between items-start mb-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-black text-white uppercase tracking-widest",children:"OPS SYSTEM RESULT"}),s.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["Generated ",new Date().toLocaleTimeString()]})]}),s.jsx("div",{className:`text-2xl font-black ${u?"text-red-500":"text-emerald-500"}`,children:a.globalScore})]}),s.jsxs("div",{className:"space-y-4 mb-8",children:[s.jsxs("div",{className:"flex justify-between items-center text-sm border-b border-white/5 pb-2",children:[s.jsx("span",{className:"text-slate-400",children:"Data Integrity"}),a.dataIntegrityBreaches>0?s.jsxs("span",{className:"text-red-400 font-bold flex items-center gap-2",children:[s.jsx(_t,{size:12})," ",a.dataIntegrityBreaches," Breach(es)"]}):s.jsxs("span",{className:"text-emerald-400 font-bold flex items-center gap-2",children:[s.jsx(Ke,{size:12})," Secure"]})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm border-b border-white/5 pb-2",children:[s.jsx("span",{className:"text-slate-400",children:"UX Readability"}),a.uxScore>=80?s.jsx("span",{className:"text-emerald-400 font-bold",children:"Excellent"}):s.jsx("span",{className:"text-orange-400 font-bold",children:"Needs Work"})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm border-b border-white/5 pb-2",children:[s.jsx("span",{className:"text-slate-400",children:"War Room Exposure"}),a.warRoomCount>0?s.jsxs("span",{className:"text-red-400 font-bold",children:[a.warRoomCount," Critical"]}):s.jsx("span",{className:"text-slate-500 font-bold",children:"None"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("button",{onClick:l,className:"w-full py-3 bg-white text-black font-bold uppercase text-xs rounded hover:bg-slate-200 transition-colors flex items-center justify-center gap-2",children:[s.jsx(jl,{size:14})," Download Official Report"]}),p&&s.jsx("div",{className:"mt-4 pt-4 border-t border-white/10 text-center",children:s.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 bg-emerald-500/10 text-emerald-400 rounded-full border border-emerald-500/30",children:[s.jsx(Ke,{size:12}),s.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"Dashboard Certified"})]})})]})]})]})},sm=({study:e})=>{const t=N.useMemo(()=>({daysSinceSignature:Math.floor((Date.now()-new Date(e.signed_at||e.created_at).getTime())/864e5),depositReceived:e.deposit_paid||!1,interactionScore:(e.views||0)*10+(e.clicks||0)*20,amount:e.total_price||0}),[e]);return em(t),null};function nm({system:e}){var k,C,_,g;const{studies:t,metrics:n,financialStats:i,logs:a}=e,o=N.useMemo(()=>t.filter(x=>{const v=new Date(x.created_at),S=new Date,A=v.getMonth()===S.getMonth()&&v.getFullYear()===S.getFullYear();return A||console.log(`[Cockpit] Cleaning old study: ${x.id} (${x.created_at})`),x.status==="archived"||x.archived?(console.log(`[Cockpit] Cleaning archived study: ${x.id}`),!1):A}).map(x=>{const v=x.signed_at?Math.floor((new Date().getTime()-new Date(x.signed_at).getTime())/864e5):null;let S="ACTIVE";return x.status==="signed"?x.deposit_paid?S="SECURED":v!==null&&v>14?S="SRU_EXPIRED":S="UNSECURED_DELAY":x.behavioralState==="MUET"||x.views===0&&x.clicks===0?S="SILENT":S="ACTIVE",{study_id:x.id,ops_state:S,days_since_signature:v,days_since_last_event:x.diffDays||0,deposit_paid:x.deposit_paid||!1,signed_at:x.signed_at,last_interaction_at:x.last_view||x.last_click||null,install_cost:x.total_price||0,status:x.status,interaction_score:(x.views||0)*10+(x.clicks||0)*20,email_optout:x.email_optout||!1}}),[t]),r=N.useMemo(()=>o.reduce((x,v)=>{const S=v.ops_state||"UNKNOWN";return x[S]=(x[S]||0)+1,x},{ACTIVE:0,SILENT:0,UNSECURED_DELAY:0,SRU_EXPIRED:0,SECURED:0}),[o]);i.totalCA||t.reduce((x,v)=>x+(v.total_price||0),0);const l=i.cashAtRisk||0,c=N.useMemo(()=>Array.from({length:30}).map((v,S)=>{const A=new Date;return A.setDate(A.getDate()-(29-S)),A.toISOString().split("T")[0]}).map(v=>{const S=t.filter(L=>L.created_at<=v),A=new Date(v);A.setHours(23,59,59,999);let R=0,P=0;return S.forEach(L=>{if(!(L.status==="signed"))return;const V=L.deposit_paid_at?new Date(L.deposit_paid_at):null;L.deposit_paid&&V&&V<=A?R+=L.total_price||0:P+=L.total_price||0}),{date:v,securedCA:R,exposedCA:P}}),[t]),d=N.useMemo(()=>(a||[]).slice(0,10).map(v=>({id:v.id,type:v.event_type==="email_sent"?"email_sent":"decision",label:v.title||"Action Syst√®me",time:new Date(v.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),detail:v.description||""})),[a]),u=Tf(o),p=Vf(o),h=N.useMemo(()=>Go({dataIntegrityIssues:[]}),[]),f=N.useMemo(()=>Ff(5e5,5e5),[]),[m,y]=N.useState([]);[...h.charts,...h.cards].flatMap(x=>x.issues),h.globalScore;const b=N.useMemo(()=>{const x=h.globalScore,v=(f==null?void 0:f.severity)==="CRITICAL";return x<60||v?{blocked:!0,reason:v?"DATA INTEGRITY BREACH":"UX SCORE TOO LOW (<60)"}:{blocked:!1,reason:null}},[h,f]),[w,j]=N.useState([]);return N.useEffect(()=>{j(Yf())},[h.globalScore]),s.jsxs("div",{className:"flex flex-col gap-12 py-8 px-4 w-full h-full pb-40",children:[b.blocked&&s.jsxs("div",{className:"bg-red-600 text-white p-6 rounded-2xl border-4 border-red-800 shadow-2xl animate-bounce",children:[s.jsx("h2",{className:"text-2xl font-bold uppercase tracking-widest flex items-center gap-4",children:s.jsx("span",{children:"üö´ DEPLACEMENT BLOQU√â"})}),s.jsxs("p",{className:"font-mono mt-2 text-sm opacity-90",children:["Reason: ",b.reason,s.jsx("br",{}),"Safe decision-making is not guaranteed."]})]}),s.jsxs("header",{className:"p-10 rounded-3xl border border-white/10 bg-black/40 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-8",children:[s.jsx("div",{className:`w-4 h-4 rounded-full shadow-[0_0_15px_rgba(239,68,68,0.5)] animate-pulse ${r.UNSECURED_DELAY>0?"bg-red-500":"bg-emerald-500"}`}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"√âTAT OPS (DB MIRROR)"}),s.jsx("h1",{className:"text-4xl font-black text-white uppercase tracking-tight",children:r.UNSECURED_DELAY>0?"ATTENTION REQUISE":"SYST√àME NOMINAL"})]})]}),s.jsxs("div",{className:"flex gap-8 text-center items-center",children:[s.jsx(tm,{system:e}),s.jsx("div",{className:"h-8 w-px bg-white/10 mx-2"}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-black text-white font-mono",children:r.ACTIVE}),s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Actifs"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-black text-orange-400 font-mono",children:r.SILENT}),s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Silencieux"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-black text-red-500 font-mono",children:r.UNSECURED_DELAY}),s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Retard"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-2xl font-black text-emerald-400 font-mono",children:r.SECURED}),s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"S√©curis√©s"})]})]})]}),s.jsxs("div",{className:"relative overflow-visible rounded-3xl border border-white/10 shadow-2xl",children:[s.jsx("div",{className:"absolute inset-0 bg-[#0F1629]/80 backdrop-blur-xl z-0"}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-900/20 via-transparent to-purple-900/20 pointer-events-none z-0"}),s.jsxs("div",{className:"relative z-10 p-8 space-y-8",children:[s.jsxs("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-6 border-b border-white/5 pb-8",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white uppercase tracking-tight flex items-center gap-3",children:s.jsx("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-indigo-400",children:"Protection du Chiffre d‚ÄôAffaires"})}),s.jsx("p",{className:"text-slate-500 text-xs font-medium italic mt-2",children:'"V√©rit√© absolue sur la d√©rive entre CA s√©curis√© et CA √† risque (30j)."'})]}),s.jsxs("div",{className:"flex items-center gap-4 bg-white/[0.03] p-2 pr-6 rounded-2xl border border-white/5 shadow-inner backdrop-blur-md",children:[s.jsxs("div",{className:"flex flex-col px-6 py-2 border-r border-white/5",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-400 shadow-[0_0_8px_rgba(52,211,153,0.6)] animate-pulse"}),s.jsx("span",{className:"text-[9px] font-bold text-emerald-400/80 uppercase tracking-widest",children:new Date().toLocaleString("fr-FR",{month:"long"}).toUpperCase()})]}),s.jsxs("span",{className:"text-2xl font-black text-white tracking-tighter font-mono",children:[Math.round(t.filter(x=>x.total_price&&!["cancelled","refused"].includes(x.status)&&x.signed_at&&new Date(x.signed_at).getMonth()===new Date().getMonth()&&new Date(x.signed_at).getFullYear()===new Date().getFullYear()).reduce((x,v)=>x+(v.total_price||0),0)/1e3).toLocaleString("fr-FR")," K‚Ç¨"]})]}),s.jsxs("div",{className:"flex flex-col px-4 py-2 opacity-60",children:[s.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-widest mb-1",children:"Mois Dernier"}),s.jsxs("span",{className:"text-xl font-black text-white/60 tracking-tighter font-mono",children:[Math.round(t.filter(x=>{if(!x.signed_at||["cancelled","refused"].includes(x.status)||!x.total_price)return!1;const v=new Date(x.signed_at),S=new Date,A=S.getMonth()===0?11:S.getMonth()-1,R=S.getMonth()===0?S.getFullYear()-1:S.getFullYear();return v.getMonth()===A&&v.getFullYear()===R}).reduce((x,v)=>x+(v.total_price||0),0)/1e3).toLocaleString("fr-FR")," K‚Ç¨"]})]})]})]}),s.jsx("div",{className:"pt-4 h-[500px] w-full",children:s.jsx(gc,{children:({width:x,height:v})=>s.jsx(yf,{data:c,width:x,height:v})})})]})]}),s.jsx(Sf,{risk:{exposedCA:l,warRoomCount:((k=n==null?void 0:n.warRoom)==null?void 0:k.count)||0,delayCount:r.UNSECURED_DELAY},revenue:{securedCA:(i==null?void 0:i.cashSecured)||0,pipelineCount:(((C=n==null?void 0:n.sent)==null?void 0:C.length)||0)+(((_=n==null?void 0:n.healthy)==null?void 0:_.length)||0),avgTicket:(((g=n==null?void 0:n.signed)==null?void 0:g.length)||0)>0?((i==null?void 0:i.cashSecured)||0)/n.signed.length:0},velocity:{avgDelayDays:(()=>{const x=t.filter(S=>S.status==="signed"&&!S.deposit_paid);return x.length?x.reduce((S,A)=>{const R=A.signed_at?new Date(A.signed_at):new Date(A.created_at),P=Math.floor((new Date().getTime()-R.getTime())/(1e3*3600*24));return S+P},0)/x.length:0})(),activeCount:r.ACTIVE,silentCount:r.SILENT},history:{risk:c.map(x=>x.exposedCA/1e3),revenue:c.map(x=>x.securedCA/1e3),velocity:(e.trafficData||[]).slice(-14).map(x=>x.count+x.opened+x.clicked)}}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 space-y-8",children:[s.jsx("h3",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Preuve d'activit√© (Moteur Brain)"}),s.jsx(kf,{events:d})]}),n.warRoom.count>0&&s.jsx("div",{className:"fixed bottom-12 left-1/2 -translate-x-1/2 z-50",children:s.jsxs("button",{onClick:()=>e.setActiveSection("war_room"),className:"px-12 py-5 bg-red-600 hover:bg-red-500 text-white font-black uppercase tracking-widest text-xs rounded-2xl shadow-[0_20px_50px_rgba(220,38,38,0.4)] transition-all active:scale-95",children:["Entrer en War Room (",n.warRoom.count,")"]})}),s.jsxs("div",{className:"border-t border-white/10 pt-10 mt-10",children:[s.jsx("h4",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest mb-6",children:"Ops Intelligence (Pure Scoring)"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:u.slice(0,12).map(x=>{const v=t.find(A=>A.id===x.study_id),S=((v==null?void 0:v.client_name)||(v==null?void 0:v.name)||x.study_id.substring(0,8)).toUpperCase();return s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-4 rounded-xl border border-white/5 text-xs flex justify-between items-center group hover:border-white/20 transition-all",children:[s.jsx("span",{className:"text-slate-200 font-mono font-black group-hover:text-white transition-colors",children:S}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("span",{className:"text-[8px] uppercase text-slate-500 font-bold",children:"RISK"}),s.jsx("span",{className:`font-black font-mono ${x.risk_score_ops>50?"text-red-400":"text-emerald-400"}`,children:x.risk_score_ops})]}),s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("span",{className:"text-[8px] uppercase text-slate-500 font-bold",children:"HEALTH"}),s.jsx("span",{className:"font-black font-mono text-blue-400",children:x.ops_health_score})]})]})]},x.study_id)})})]}),s.jsxs("div",{className:"mt-12 pt-12 border-t border-white/5",children:[s.jsx("div",{className:"flex items-center justify-between mb-8",children:s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute -left-4 top-1 w-1 h-full bg-gradient-to-b from-red-500 to-transparent opacity-50"}),s.jsxs("h3",{className:"text-2xl font-black uppercase text-white tracking-tight flex items-center gap-4 pl-4",children:[s.jsx("div",{className:"p-2 bg-red-500/10 rounded-full border border-red-500/20 shadow-[0_0_20px_rgba(220,38,38,0.2)]",children:s.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full animate-pulse"})}),"OPS INTELLIGENCE CENTRE"]}),s.jsx("p",{className:"text-white/30 text-xs font-mono mt-1 pl-16 tracking-widest uppercase",children:"Live Priority Matrix ‚Ä¢ Automated Strategy"})]})}),s.jsxs("div",{className:"overflow-hidden rounded-3xl border border-white/10 bg-black/20 backdrop-blur-2xl shadow-2xl ring-1 ring-white/5",children:[s.jsxs("table",{className:"w-full text-left border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-white/10 bg-white/[0.02]",children:[s.jsx("th",{className:"py-6 px-8 text-[9px] uppercase font-bold text-slate-500 tracking-widest w-1/3",children:"Client Identity"}),s.jsx("th",{className:"py-6 px-8 text-[9px] uppercase font-bold text-slate-500 tracking-widest",children:"Operational Status"}),s.jsx("th",{className:"py-6 px-8 text-[9px] uppercase font-bold text-slate-500 tracking-widest",children:"Strategy Axis"}),s.jsx("th",{className:"py-6 px-8 text-[9px] uppercase font-bold text-slate-500 tracking-widest text-right",children:"Recommended Protocol"})]})}),s.jsx("tbody",{className:"divide-y divide-white/[0.03]",children:p.slice(0,12).map(x=>{const v=t.find(P=>P.id===x.studyId),S=((v==null?void 0:v.client_name)||(v==null?void 0:v.name)||x.studyId.slice(0,12)).toUpperCase(),A=((v==null?void 0:v.city)||"N/A").toUpperCase(),R=x.recommendation.replace(/_/g," ").toUpperCase();return s.jsxs("tr",{className:"group hover:bg-white/[0.04] transition-all duration-300 ease-out",children:[s.jsx("td",{className:"py-5 px-8",children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-slate-700 group-hover:bg-blue-400 transition-colors"}),s.jsx("span",{className:"text-sm font-bold text-slate-200 group-hover:text-white transition-colors tracking-wide",children:S})]}),s.jsxs("div",{className:"flex items-center gap-2 pl-4",children:[s.jsx("span",{className:"text-[9px] font-mono text-white/20 px-1.5 rounded border border-white/5",children:x.studyId.slice(0,4)}),s.jsx("span",{className:"text-[9px] font-bold text-white/30 tracking-wider",children:A})]})]})}),s.jsx("td",{className:"py-5 px-8",children:s.jsxs("div",{className:`
                             inline-flex items-center gap-2 px-4 py-2 rounded-lg border text-[10px] font-black uppercase tracking-widest transition-transform group-hover:scale-105
                             ${x.priority==="WAR_ROOM"?"bg-red-500/20 border-red-500/50 text-red-100 shadow-[0_0_20px_rgba(220,38,38,0.3)]":x.priority==="PRIORITY_ACTION"?"bg-orange-500/10 border-orange-500/30 text-orange-200":x.priority==="WATCH"?"bg-blue-500/10 border-blue-500/30 text-blue-200":"bg-slate-500/5 border-slate-500/20 text-slate-500 opacity-50"}
                          `,children:[x.priority==="WAR_ROOM"&&s.jsx("div",{className:"w-1.5 h-1.5 bg-red-400 rounded-full animate-ping"}),x.priority.replace(/_/g," ")]})}),s.jsx("td",{className:"py-5 px-8",children:x.sourceAxis?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-[9px] font-mono text-white/30",children:"AXIS"}),s.jsx("span",{className:"font-bold text-xs text-white/70 bg-white/5 px-2 py-1 rounded border border-white/10 group-hover:border-white/30 transition-colors",children:x.sourceAxis})]}):s.jsx("span",{className:"text-white/10 text-[10px]",children:"‚Äî"})}),s.jsx("td",{className:"py-5 px-8 text-right",children:s.jsx("span",{className:`
                             text-[10px] font-black uppercase tracking-widest py-1 px-3 rounded
                             ${x.recommendation.includes("RELANCER")?"bg-emerald-500/10 text-emerald-300":"text-slate-500 bg-white/[0.02]"}
                          `,children:R})})]},x.studyId)})})]}),p.length===0&&s.jsxs("div",{className:"p-20 text-center flex flex-col items-center gap-4",children:[s.jsx("div",{className:"w-12 h-12 rounded-full bg-white/5 flex items-center justify-center",children:s.jsx("div",{className:"w-4 h-4 bg-emerald-500 rounded-full"})}),s.jsx("div",{className:"text-white/20 text-xs uppercase tracking-widest font-mono",children:"No active priorities detected"})]})]})]}),s.jsxs("section",{className:"bg-slate-900/50 p-8 rounded-xl border border-dashed border-slate-700 mt-12",children:[s.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-[0.2em] mb-6",children:"UX / DATA INTEGRITY AUDIT (PHASE 3)"}),s.jsxs("div",{className:"grid grid-cols-1 gap-8",children:[f&&s.jsxs("div",{className:`p-4 rounded-lg flex items-start gap-4 border ${f.severity==="CRITICAL"?"bg-red-900/20 border-red-500/50":"bg-green-900/10 border-green-500/30"}`,children:[f.severity==="CRITICAL"?s.jsx(_t,{className:"text-red-500 shrink-0"}):s.jsx(Ke,{className:"text-green-500 shrink-0"}),s.jsxs("div",{children:[s.jsxs("h4",{className:`text-xs font-bold uppercase mb-1 ${f.severity==="CRITICAL"?"text-red-400":"text-green-400"}`,children:["DATA INTEGRITY: ",f.severity]}),s.jsx("p",{className:"text-sm text-slate-300",children:f.message}),f.recommendation&&s.jsxs("p",{className:"text-xs text-slate-500 mt-1",children:["‚Üí ",f.recommendation]})]})]}),s.jsx("div",{className:"space-y-4",children:[...h.charts,...h.cards].map((x,v)=>s.jsxs("div",{className:"bg-white/5 p-4 rounded border border-white/10",children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("span",{className:"font-mono text-sm text-white font-bold",children:x.component}),s.jsxs("span",{className:`text-xs px-2 py-1 rounded font-bold ${x.score>=80?"bg-green-500/20 text-green-400":x.score>=60?"bg-orange-500/20 text-orange-400":"bg-red-500/20 text-red-400"}`,children:["SCORE: ",x.score,"/100"]})]}),x.issues.length===0?s.jsxs("div",{className:"text-xs text-slate-500 italic flex items-center gap-2",children:[s.jsx(Ke,{size:12})," Compliant"]}):s.jsx("ul",{className:"space-y-2",children:x.issues.map((S,A)=>s.jsxs("li",{className:"text-xs bg-black/20 p-2 rounded",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsxs("span",{className:S.severity==="CRITICAL"?"text-red-400":"text-orange-400",children:[S.severity==="CRITICAL"?"üö®":"‚ö†Ô∏è"," [",S.severity,"]"]}),s.jsx("span",{className:"text-slate-300",children:S.description})]}),s.jsxs("div",{className:"pl-6 text-slate-500 italic",children:["‚Üí ",S.remediation]})]},A))})]},v))})]})]}),s.jsxs("section",{className:"mt-8 border-t border-white/5 pt-8",children:[s.jsx("h4",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest mb-4",children:"AUDIT HISTORY (LOCAL STORAGE)"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:w.slice(-5).reverse().map((x,v)=>s.jsxs("div",{className:"text-[9px] font-mono text-slate-500 bg-black/20 px-2 py-1 rounded",children:[s.jsxs("span",{className:x.score<60?"text-red-500":"text-emerald-500",children:[x.score,"/100"]}),s.jsx("span",{className:"opacity-50 mx-1",children:"‚Äî"}),x.chartId,s.jsx("span",{className:"opacity-30 ml-2",children:new Date(x.timestamp).toLocaleTimeString()})]},v))})]}),t.map(x=>s.jsx(sm,{study:x},`ops-probe-${x.id}`))]})}const re={colors:{grid:"rgba(255, 255, 255, 0.05)",axis:"rgba(255, 255, 255, 0.15)",text:"rgba(255, 255, 255, 0.3)",textLight:"rgba(255, 255, 255, 0.5)",bubbles:{safe:"rgba(74, 222, 128, 0.6)",warning:"rgba(251, 191, 36, 0.6)",danger:"rgba(248, 113, 113, 0.7)",critical:"rgba(239, 68, 68, 0.8)"}},fonts:{axis:'"Inter", "SF Pro Display", -apple-system, sans-serif'}},im=({studies:e,width:t,height:n,onPointClick:i,highlightedStudyId:a})=>{const o={top:40,right:60,bottom:60,left:60},r=t-o.left-o.right,l=n-o.top-o.bottom;if(t<10||n<10)return null;const{showTooltip:c,hideTooltip:d,tooltipData:u,tooltipLeft:p=0,tooltipTop:h=0}=Ya(),f=N.useMemo(()=>e.length===0?null:e.reduce((g,x)=>g.dangerScore>x.dangerScore?g:x),[e]),m=N.useMemo(()=>e.length===0?null:e.reduce((g,x)=>g.totalPrice>x.totalPrice?g:x),[e]),y=N.useMemo(()=>Me({domain:[14,0],range:[0,r],nice:!0}),[r]),b=Math.max(...e.map(g=>g.totalPrice),2e4),w=N.useMemo(()=>Me({domain:[0,b*1.1],range:[l,0],nice:!0}),[b,l]),j=N.useMemo(()=>{const g=[...e].sort((v,S)=>S.engagementScore-v.engagementScore),x=new Map;return g.map(v=>{const S=Math.round(v.totalPrice/2e3),R=`${Math.round(v.daysBeforeDeadline)}-${S}`,P=x.get(R)||0;x.set(R,P+1);let L=0,T=0;if(P>0){const V=P*(Math.PI*.82),te=25+(P-1)*10;L=Math.cos(V)*te,T=Math.sin(V)*te}return{...v,dx:L,dy:T}})},[e]),k=N.useMemo(()=>Fl({domain:[0,100],range:[6,24]}),[]),C=g=>g<40?re.colors.bubbles.safe:g<60?re.colors.bubbles.warning:g<80?re.colors.bubbles.danger:re.colors.bubbles.critical,_=(g,x,v,S)=>{c({tooltipData:x,tooltipLeft:v+o.left,tooltipTop:S+o.top})};return s.jsxs(s.Fragment,{children:[s.jsx("svg",{width:t,height:n,className:"overflow-visible",children:s.jsxs(ie,{left:o.left,top:o.top,children:[s.jsx("text",{x:15,y:l-15,fill:re.colors.bubbles.safe,fontSize:9,fontWeight:700,letterSpacing:"0.1em",opacity:.3,children:"ZONE S√âCURIS√âE"}),s.jsx("text",{x:r/2,y:l-15,fill:re.colors.bubbles.warning,fontSize:9,fontWeight:700,letterSpacing:"0.1em",textAnchor:"middle",opacity:.3,children:"ZONE DE VIGILANCE"}),s.jsx("text",{x:r-15,y:25,fill:re.colors.bubbles.critical,fontSize:9,fontWeight:700,letterSpacing:"0.1em",textAnchor:"end",opacity:.5,children:"URGENCE CRITIQUE"}),s.jsx("text",{x:r,y:l+40,fill:re.colors.bubbles.critical,fontSize:10,fontWeight:900,textAnchor:"end",letterSpacing:"0.05em",children:"URGENCE ACCRUE ‚Üí"}),s.jsx(wn,{scale:w,width:r,stroke:re.colors.grid,strokeDasharray:"4,4"}),s.jsx(mt,{top:l,scale:y,numTicks:5,stroke:re.colors.axis,tickStroke:re.colors.axis,tickLabelProps:()=>({fill:re.colors.text,fontSize:10,fontFamily:re.fonts.axis,textAnchor:"middle",fontWeight:600})}),s.jsx(gs,{scale:w,numTicks:4,stroke:"transparent",tickStroke:"transparent",tickLabelProps:()=>({fill:re.colors.text,fontSize:10,fontFamily:re.fonts.axis,textAnchor:"end",verticalAnchor:"middle",fontWeight:600,dx:-10}),tickFormat:g=>`${Math.round(g/1e3)}k‚Ç¨`}),s.jsx(Mo,{children:j.map(g=>{const x=a===g.studyId,v=(f==null?void 0:f.studyId)===g.studyId,S=(m==null?void 0:m.studyId)===g.studyId,A=y(g.daysBeforeDeadline),R=w(g.totalPrice),P=A+g.dx,L=R+g.dy;return s.jsxs(ie,{children:[S&&s.jsxs(xs.g,{initial:{opacity:0},animate:{opacity:.6},transition:{delay:1},children:[s.jsx("line",{x1:P,y1:L-k(g.engagementScore)-4,x2:P,y2:L-k(g.engagementScore)-20,stroke:re.colors.textLight,strokeWidth:.5}),s.jsx("text",{x:P,y:L-k(g.engagementScore)-25,fill:re.colors.textLight,fontSize:8,fontWeight:800,textAnchor:"middle",letterSpacing:"0.05em",children:"PLUS GROS ENJEU"})]}),s.jsx(xs.circle,{cx:P,cy:L,r:k(g.engagementScore),initial:{opacity:0,scale:0},animate:{opacity:1,scale:x?1.4:v?1.2:1,strokeOpacity:x||v?1:.2},exit:{opacity:0,scale:0},transition:{duration:.6,ease:[.16,1,.3,1]},fill:C(g.dangerScore),stroke:"white",strokeWidth:x?3:v?2:1,style:{cursor:"pointer",zIndex:x?100:1},whileHover:{scale:1.5,strokeOpacity:1},onMouseEnter:T=>_(T,g,P,L),onMouseLeave:()=>d(),onClick:()=>i&&i(g.studyId)})]},g.studyId)})})]})}),u&&s.jsx(Xa,{top:h-8,left:p,style:{...Za,backgroundColor:"#0F1629",color:"white",border:"none",borderRadius:"4px",padding:"10px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.5)",zIndex:100},children:s.jsxs("div",{className:"flex flex-col gap-0.5",children:[s.jsx("span",{className:"text-[8px] font-bold text-white/30 uppercase tracking-[0.15em] mb-0.5",children:"Focus Dossier"}),s.jsx("p",{className:"text-[11px] font-bold text-white tracking-tight leading-tight",children:u.name}),s.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[7px] text-white/20 uppercase font-black",children:"Potentiel"}),s.jsxs("span",{className:"text-[10px] text-emerald-400 font-mono",children:[Math.round(u.totalPrice).toLocaleString(),"‚Ç¨"]})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[7px] text-white/20 uppercase font-black",children:"Score"}),s.jsxs("span",{className:"text-[10px] text-red-400 font-mono",children:[u.dangerScore,"/100"]})]})]})]})},"tooltip")]})};function am({studies:e,onPointClick:t,highlightedStudyId:n}){return s.jsx("div",{style:{width:"100%",height:"65vh",minHeight:"500px"},children:s.jsx(xt,{children:({width:i,height:a})=>s.jsx(im,{studies:e,width:i,height:a,onPointClick:t,highlightedStudyId:n})})})}function rm({events:e}){return s.jsxs("div",{className:"flex flex-col gap-6",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute left-[3px] top-4 bottom-4 w-px bg-white/10"}),s.jsx("div",{className:"space-y-8",children:e.map((t,n)=>s.jsxs("div",{className:"flex gap-6 items-start relative",children:[s.jsx("div",{className:`w-2 h-2 rounded-full mt-2 z-10 ${t.type==="signature"?"bg-emerald-400":t.type==="opening"?"bg-sky-400":t.type==="click"?"bg-indigo-400":t.type==="email_sent"?"bg-slate-400":"bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.5)]"}`}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex justify-between items-baseline mb-1",children:[s.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest ${t.type==="silence"?"text-red-400":"text-slate-500"}`,children:t.type.replace("_"," ")}),s.jsx("span",{className:"text-[10px] font-mono text-slate-500",children:t.date})]}),s.jsx("p",{className:`text-sm font-black uppercase tracking-tight ${t.type==="silence"?"text-red-200":"text-white"}`,children:t.label})]})]},`${t.type}-${n}`))})]}),e.length===0&&s.jsx("div",{className:"py-8 text-center text-[10px] font-black text-white/10 uppercase tracking-widest",children:"Aucun historique comportemental d√©tect√©"})]})}function om({study:e,recommendation:t,onAction:n}){const i=e.dangerScore>70;return s.jsxs("div",{className:"h-full bg-[#0B0F14] rounded-xl border border-white/5 flex flex-col overflow-hidden backdrop-blur-sm shadow-2xl",children:[s.jsxs("div",{className:"p-6 border-b border-white/5 flex justify-between items-start",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-xl font-bold text-slate-100 tracking-tight mb-1 font-sans",children:e.name}),s.jsxs("div",{className:"flex items-center gap-3 text-sm font-medium font-mono text-slate-500",children:[s.jsxs("span",{className:"text-emerald-400/80",children:[Math.round(e.totalPrice).toLocaleString()," ‚Ç¨"]}),s.jsx("span",{className:"w-1 h-1 rounded-full bg-slate-700"}),s.jsxs("span",{className:i?"text-red-400":"text-amber-400",children:["J-",e.daysBeforeDeadline]})]})]}),s.jsx("div",{className:`
          flex flex-col items-center justify-center w-12 h-12 rounded-lg border 
          ${i?"bg-red-500/5 border-red-500/20 text-red-500":"bg-amber-500/5 border-amber-500/20 text-amber-500"}
        `,children:s.jsx("span",{className:"text-lg font-bold leading-none",children:e.dangerScore})})]}),s.jsxs("div",{className:"flex-1 p-6 space-y-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Analyse Comportementale"}),s.jsxs("p",{className:"text-sm text-slate-300 leading-relaxed border-l-2 border-white/10 pl-3 italic",children:['"',t.reason,'"']})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-white/[0.02] p-3 rounded-lg border border-white/5",children:[s.jsx("span",{className:"text-[9px] font-bold text-slate-500 uppercase block mb-1",children:"Strat√©gie"}),s.jsx("span",{className:"text-xs font-semibold text-slate-200",children:t.type})]}),s.jsxs("div",{className:"bg-white/[0.02] p-3 rounded-lg border border-white/5",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase block mb-1",children:"Urgence"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${i?"bg-red-500 animate-pulse":"bg-amber-500"}`}),s.jsx("span",{className:"text-xs font-semibold text-slate-200 uppercase",children:t.urgency})]})]})]})]}),s.jsx("div",{className:"p-6 border-t border-white/5 bg-white/[0.01]",children:s.jsxs("button",{onClick:()=>n(e.id),className:`
            w-full py-3 px-4 rounded-lg flex items-center justify-center gap-3 transition-all duration-200
            ${i?"bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/20":"bg-white/5 hover:bg-white/10 text-slate-300 border border-white/10"}
          `,children:[s.jsx("span",{className:"text-xs font-bold uppercase tracking-wider",children:i?"D√©clencher Intervention":"Actions de Relance"}),s.jsx("svg",{className:"w-4 h-4 opacity-70",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14 5l7 7m0 0l-7 7m7-7H3"})})]})})]})}function lm({system:e}){const{metrics:t,studies:n,logs:i}=e,a=N.useMemo(()=>t.warRoom.studies.map(g=>({studyId:g.id,name:g.name,daysBeforeDeadline:g.daysLate?14-g.daysLate:14,totalPrice:g.total_price||0,dangerScore:g.dangerScore||50,engagementScore:(g.views||0)*10+(g.clicks||0)*20})),[t.warRoom.studies]),[o,r]=N.useState(a.length>0?a[0].studyId:null),[l,c]=N.useState(null),d=a.length,u=a.reduce((g,x)=>g+x.totalPrice,0),p=N.useMemo(()=>(n||[]).find(g=>{var x;return g.id===(o||((x=a[0])==null?void 0:x.studyId))}),[n,o,a]),h=N.useMemo(()=>{if(!p)return[];const g=[];return p.signed_at&&g.push({type:"signature",date:new Date(p.signed_at).toLocaleDateString(),label:"Signature du contrat"}),p.views>0&&g.push({type:"opening",date:"J+1",label:`${p.views} ouvertures d√©tect√©es`}),p.clicks>0&&g.push({type:"click",date:"J+2",label:`${p.clicks} interactions avec l'√©tude`}),p.send_count>0&&g.push({type:"email_sent",date:"J+3",label:"Relance automatique de r√©assurance"}),p.behavioralState==="MUET"&&g.push({type:"silence",date:"Aujourd'hui",label:"Silence prolong√© - Risque d'annulation √©lev√©"}),g},[p]),f=N.useMemo(()=>(n||[]).filter(g=>g.status==="sent"),[n]),m=N.useMemo(()=>f.filter(g=>g.behavioralState==="INT√âRESS√â"),[f]),y=N.useMemo(()=>f.filter(g=>g.behavioralState==="AGIT√â"),[f]),b=N.useMemo(()=>f.filter(g=>g.behavioralState==="MUET"&&g.diffDays<7),[f]),w=N.useMemo(()=>f.filter(g=>g.behavioralState==="FATIGUE"),[f]),j=N.useMemo(()=>(e.emailLeads||[]).filter(g=>!g.study_id),[e.emailLeads]),k=N.useMemo(()=>j.filter(g=>g.total_clicks>=1),[j]),C=N.useMemo(()=>j.filter(g=>g.total_clicks===0&&g.total_opens>=1),[j]),_=N.useMemo(()=>j.filter(g=>g.total_clicks===0&&g.total_opens===0),[j]);return s.jsxs("div",{className:"flex flex-col gap-12 py-8 px-4 w-full h-full pb-40",children:[s.jsxs("header",{className:"flex flex-col gap-1",children:[s.jsx("h1",{className:"text-3xl font-black text-slate-100 tracking-tight uppercase",children:"War Room Operations"}),s.jsx("p",{className:"text-slate-500 text-[10px] font-bold uppercase tracking-widest",children:"Concentration humaine sur le CA r√©cup√©rable"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8 items-start",children:[s.jsxs("div",{className:"lg:col-span-8 xl:col-span-9 space-y-6",children:[s.jsxs("div",{className:"bg-black/40 backdrop-blur-md rounded-2xl border border-white/10 overflow-hidden shadow-2xl relative",children:[s.jsxs("div",{className:"absolute top-6 left-6 z-10 pointer-events-none",children:[s.jsxs("h2",{className:"text-lg font-black text-white tracking-tight uppercase",children:["Focus D√©cisionnel ‚Äî ",d," Dossiers en Zone de Danger"]}),s.jsxs("p",{className:"text-slate-500 text-[10px] font-bold uppercase tracking-widest mt-1",children:["EXPOSITION TOTALE : ",s.jsxs("span",{className:"font-mono",children:[Math.round(u).toLocaleString("fr-FR")," ‚Ç¨"]})]})]}),s.jsxs("div",{className:"pt-10",children:[" ",s.jsx(am,{studies:a,onPointClick:r,highlightedStudyId:l})]})]}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm rounded-xl border border-white/10 overflow-hidden",children:[s.jsxs("div",{className:"px-6 py-4 border-b border-white/10 flex justify-between items-center bg-white/[0.01]",children:[s.jsxs("h3",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:["Dossiers en Alerte (",a.length,")"]}),s.jsx("span",{className:"text-[9px] text-slate-600 font-mono uppercase tracking-widest",children:"Sync: Active"})]}),s.jsxs("div",{className:"divide-y divide-white/[0.03]",children:[a.slice(0,5).map(g=>s.jsxs("button",{onClick:()=>r(g.studyId),onMouseEnter:()=>c(g.studyId),onMouseLeave:()=>c(null),className:`w-full px-6 py-3 flex justify-between items-center hover:bg-white/[0.02] transition-colors group ${o===g.studyId?"bg-white/[0.04]":""}`,children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${g.dangerScore>70?"bg-red-500":"bg-amber-500"}`}),s.jsx("span",{className:`text-sm font-black uppercase tracking-tight ${o===g.studyId?"text-white":"text-slate-400 group-hover:text-slate-200"}`,children:g.name})]}),s.jsxs("div",{className:"flex items-center gap-1 text-[11px] font-mono text-slate-500",children:[s.jsxs("span",{className:"w-14 text-right inline-block font-black",children:[Math.round(g.totalPrice/1e3),"k‚Ç¨"]}),s.jsxs("span",{className:`w-12 text-right inline-block font-black ${g.daysBeforeDeadline<5?"text-red-400":"text-blue-400"}`,children:["J-",g.daysBeforeDeadline]}),s.jsxs("span",{className:"text-slate-600 w-10 text-right inline-block font-black",children:[g.dangerScore,"%"]})]})]},g.studyId)),a.length>5&&s.jsx("div",{className:"px-6 py-2 text-center border-t border-white/5",children:s.jsxs("span",{className:"text-[10px] text-slate-600 uppercase tracking-widest",children:["+ ",a.length-5," autres dossiers"]})})]})]})]}),s.jsx("div",{className:"lg:col-span-4 xl:col-span-3 space-y-6",children:p?s.jsxs(s.Fragment,{children:[s.jsx(om,{study:{id:p.id,name:p.name,totalPrice:p.total_price||0,dangerScore:p.dangerScore||50,daysBeforeDeadline:p.daysLate?14-p.daysLate:14},recommendation:{type:"Appel T√©l√©phonique",reason:p.behavioralState==="MUET"?"Silence prolong√© post-signature. Suspicion de doute.":"Baisse d'engagement suspecte sur l'√©tude.",urgency:(p.dangerScore||0)>70?"high":"medium"},onAction:g=>console.log("Action human intervention launched for",g)}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-10 rounded-xl border border-white/10 space-y-8",children:[s.jsx("h3",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest",children:"D√©rive Comportementale"}),s.jsx(rm,{events:h})]})]}):s.jsx("div",{className:"h-full flex items-center justify-center p-20 text-center",children:s.jsx("p",{className:"text-[10px] font-black text-white/20 uppercase tracking-[0.4em] italic",children:"S√©lectionnez un dossier pour lancer l'analyse"})})})]}),s.jsxs("div",{className:"border-t border-white/10 pt-12 mt-8",children:[s.jsx("h2",{className:"text-xl font-black text-white uppercase tracking-tight mb-8",children:"AXE A ‚Äî DOSSIERS SIGN√âS (ANTI-ANNULATION)"}),(()=>{const x=(e.studies||[]).filter(T=>T.status==="signed"),v=T=>{const V=T.signed_at?Math.floor((new Date().getTime()-new Date(T.signed_at).getTime())/864e5):0,te=T.dangerScore||0;return T.contract_secured?V>30?"HORS_PERIMETRE":"SOUS_CONTROLE":te>=70||!T.deposit_paid&&V>7?"WAR_ROOM":!T.deposit_paid||T.behavioralState==="AGIT√â"?"A_SECURISER":"SOUS_CONTROLE"},S=T=>T.deposit_paid?"PAY√â ‚úÖ":T.has_deposit&&!T.deposit_paid?"EN ATTENTE ‚ö†Ô∏è":"NON REQUIS ‚ûñ",A=x.filter(T=>v(T)==="WAR_ROOM"),R=x.filter(T=>v(T)==="A_SECURISER"),P=x.filter(T=>v(T)==="SOUS_CONTROLE"),L=x.filter(T=>v(T)==="HORS_PERIMETRE");return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8 mb-12",children:[s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-red-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"War Room"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:A.length})]}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-amber-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"√Ä S√©curiser"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:R.length})]}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-emerald-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Sous Contr√¥le"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:P.length})]}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-8 rounded-xl border border-white/10 opacity-30",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest",children:"Hors P√©rim√®tre"}),s.jsx("p",{className:"text-3xl font-black text-slate-600 mt-1 font-mono",children:L.length})]})]}),s.jsxs("div",{className:"bg-[#0B0F14] rounded-2xl border border-white/5 overflow-hidden",children:[s.jsx("div",{className:"px-8 py-4 border-b border-white/5 bg-white/[0.01]",children:s.jsxs("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:["Dossiers √† S√©curiser (",A.length+R.length,")"]})}),s.jsxs("div",{className:"divide-y divide-white/[0.03]",children:[[...A,...R].length===0&&s.jsx("div",{className:"p-8 text-center text-white/20 text-xs uppercase tracking-widest",children:"Aucun dossier critique"}),[...A,...R].map(T=>{const V=v(T)==="WAR_ROOM",te=T.last_click||T.last_open||T.signed_at,$=T.signed_at?Math.floor((new Date().getTime()-new Date(T.signed_at).getTime())/(1e3*60*60*24)):0;return s.jsxs("div",{className:`p-6 flex items-center justify-between hover:bg-white/[0.02] transition-colors ${V?"bg-red-500/5":""}`,children:[s.jsx("div",{className:"w-[35%]",children:s.jsxs("div",{className:"flex items-center gap-2",children:[V&&s.jsx("span",{className:"text-lg",children:"üö®"}),s.jsxs("div",{children:[s.jsx("p",{className:"text-white font-black text-sm truncate pr-2 uppercase tracking-tight",children:T.name}),s.jsxs("p",{className:"text-slate-500 text-[10px] font-bold uppercase",children:["Sign√© il y a ",s.jsx("span",{className:"font-mono",children:$})," jours"]})]})]})}),s.jsxs("div",{className:"w-[15%]",children:[s.jsx("p",{className:"text-white/40 text-[10px] uppercase tracking-wider mb-1",children:"Acompte"}),(()=>{const F=S(T);return s.jsx("span",{className:`text-xs font-bold uppercase ${F.includes("PAY√â")?"text-emerald-400":F.includes("EN COURS")?"text-blue-400":"text-orange-400"}`,children:F})})()]}),s.jsxs("div",{className:"w-[20%] flex flex-col items-end",children:[s.jsxs("p",{className:"text-white font-bold text-sm",children:[Math.round(T.total_price).toLocaleString("fr-FR")," ‚Ç¨"]}),s.jsx("p",{className:"text-white/40 text-[10px] uppercase tracking-wider mt-1 text-right",children:te?s.jsxs(s.Fragment,{children:["Interaction il y a ",Math.floor((new Date().getTime()-new Date(te).getTime())/(1e3*60*60*24))," j"]}):"Aucune interaction"})]}),s.jsx("div",{className:"w-[30%] flex justify-end pl-4",children:s.jsx("div",{className:`px-4 py-2 rounded-lg border ${V?"bg-red-500/5 border-red-500/10":"bg-amber-500/5 border-white/5"} whitespace-nowrap`,children:s.jsx("p",{className:`${V?"text-red-400":"text-slate-400"} text-[10px] font-bold uppercase tracking-widest`,children:V?"URGENCE : S√âCURISER":"ACTION : S√âCURISER"})})})]},T.id)})]})]})]})})()]}),s.jsxs("div",{className:"border-t border-white/5 pt-16 mt-16",children:[s.jsxs("header",{className:"mb-10",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Retention Strategy"}),s.jsx("h2",{className:"text-2xl font-black text-slate-100 tracking-tight mt-1 uppercase",children:"AXE B ‚Äî Post-Pr√©sentation sans Signature"}),s.jsxs("p",{className:"text-amber-500/60 text-[10px] font-bold uppercase tracking-widest mt-2",children:["Impact : ",s.jsx("span",{className:"font-mono",children:m.length})," Relances Prioritaires en attente"]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8 mb-12",children:[s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-red-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Priorit√© Relance"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:m.length})]}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-amber-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"√Ä Surveiller"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:y.length})]}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-blue-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"R√©veil N√©cessaire"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:b.length})]}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-8 rounded-xl border border-white/10 opacity-30",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest",children:"Interruption (Stop)"}),s.jsx("p",{className:"text-3xl font-black text-slate-600 mt-1 font-mono",children:w.length})]})]}),s.jsxs("div",{className:"overflow-hidden rounded-xl border border-white/10 bg-black/20 backdrop-blur-sm shadow-2xl",children:[s.jsx("div",{className:"px-6 py-4 border-b border-white/10 bg-white/[0.01]",children:s.jsxs("h3",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest flex items-center gap-3",children:[s.jsx("div",{className:"w-1.5 h-1.5 bg-amber-500 rounded-full animate-pulse shadow-[0_0_8px_rgba(245,158,11,0.5)]"}),"Priorit√© Relance (",m.length,")"]})}),s.jsxs("table",{className:"w-full text-left border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:"border-b border-white/10 bg-white/[0.02]",children:[s.jsx("th",{className:"py-4 px-6 text-[9px] uppercase font-bold text-slate-500 tracking-widest",children:"Client Identity"}),s.jsx("th",{className:"py-4 px-6 text-[9px] uppercase font-bold text-slate-500 tracking-widest",children:"Potentiel"}),s.jsx("th",{className:"py-4 px-6 text-[9px] uppercase font-bold text-slate-500 tracking-widest text-right",children:"Last Interaction"}),s.jsx("th",{className:"py-4 px-6 text-[9px] uppercase font-bold text-slate-500 tracking-widest text-right",children:"Action"})]})}),s.jsx("tbody",{className:"divide-y divide-white/[0.03]",children:m.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:4,className:"p-8 text-center text-white/20 text-xs uppercase tracking-widest font-mono",children:"Aucun dossier √† relancer"})}):m.map(g=>{var A;const x=g.last_click||g.last_open||g.created_at,v=((A=g.clients)==null?void 0:A.phone)||g.phone||"N/A",S=(g.client_name||g.name||"CLIENT INCONNU").toUpperCase();return s.jsxs("tr",{className:"group hover:bg-white/[0.04] transition-all duration-300 ease-out",children:[s.jsx("td",{className:"py-4 px-6",children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("span",{className:"text-sm font-black text-slate-200 group-hover:text-white transition-colors tracking-wide uppercase",children:S}),s.jsx("span",{className:"text-[10px] font-mono text-white/30",children:v})]})}),s.jsx("td",{className:"py-4 px-6",children:s.jsxs("span",{className:"text-emerald-400 font-bold font-mono text-xs bg-emerald-500/10 px-2 py-1 rounded border border-emerald-500/20",children:[Math.round(g.total_price).toLocaleString("fr-FR")," ‚Ç¨"]})}),s.jsx("td",{className:"py-4 px-6 text-right",children:s.jsx("span",{className:"text-white/40 text-[10px] font-mono uppercase",children:(()=>{if(!x)return"N/A";const R=Math.floor((new Date().getTime()-new Date(x).getTime())/(1e3*60*60*24));return R===0?"Aujourd'hui":`il y a ${R}j`})()})}),s.jsx("td",{className:"py-4 px-6 text-right",children:s.jsx("button",{className:"bg-white/5 hover:bg-white/10 text-slate-300 text-[10px] font-bold uppercase tracking-widest px-4 py-2 rounded-lg border border-white/10 transition-all",children:"Lancer Appel"})})]},g.id)})})]})]})]}),s.jsxs("div",{className:"border-t border-white/5 pt-16 mt-16",children:[s.jsxs("header",{className:"mb-10",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Acquisition Control"}),s.jsx("h2",{className:"text-2xl font-black text-slate-100 tracking-tight mt-1 uppercase",children:"AXE C ‚Äî Leads Qualifi√©s jamais joints"}),s.jsxs("p",{className:"text-red-500/60 text-[10px] font-bold uppercase tracking-widest mt-2",children:["Priorit√© : ",s.jsx("span",{className:"font-mono",children:k.length})," Appels Recommand√©s"]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 mb-12",children:[s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-red-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Priorit√© Appel"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:k.length})]}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-sm p-8 rounded-xl border border-amber-500/20",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"Observation Active"}),s.jsx("p",{className:"text-3xl font-black text-white mt-1 font-mono",children:C.length})]}),s.jsxs("div",{className:"bg-black/20 backdrop-blur-sm p-8 rounded-xl border border-white/10 opacity-30",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-600 uppercase tracking-widest",children:"Interruption (Abandon)"}),s.jsx("p",{className:"text-3xl font-black text-slate-600 mt-1 font-mono",children:_.length})]})]}),s.jsxs("div",{className:"bg-[#0B0F14] rounded-xl border border-white/5 overflow-hidden shadow-2xl",children:[s.jsx("div",{className:"px-6 py-4 border-b border-white/5 bg-white/[0.01]",children:s.jsxs("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:["Priorit√© Appel (",k.length,")"]})}),s.jsx("div",{className:"divide-y divide-white/[0.03]",children:k.length===0?s.jsx("div",{className:"p-8 text-center text-slate-500 text-xs uppercase tracking-widest",children:"Aucun lead √† rappeler"}):k.map(g=>s.jsxs("div",{className:"p-6 flex items-center justify-between hover:bg-white/[0.02] transition-colors",children:[s.jsxs("div",{className:"w-[40%]",children:[s.jsx("p",{className:"text-white font-bold text-sm tracking-tight",children:g.client_name.toUpperCase()}),s.jsx("p",{className:"text-slate-500 text-xs mt-0.5",children:g.client_email})]}),s.jsxs("div",{className:"w-[30%] text-right",children:[s.jsx("p",{className:"text-slate-500 text-[9px] uppercase tracking-wider mb-1",children:"Derni√®re interaction"}),s.jsx("p",{className:"text-slate-300 font-mono text-xs",children:(()=>{if(!g.last_clicked_at)return"N/A";const x=Math.floor((new Date().getTime()-new Date(g.last_clicked_at).getTime())/(1e3*60*60*24));return x===0?"Aujourd'hui":`il y a ${x}j`})()})]}),s.jsx("div",{className:"w-[30%] flex justify-end",children:s.jsx("div",{className:"px-4 py-2 bg-red-500/5 rounded-lg border border-red-500/20",children:s.jsx("p",{className:"text-red-400 text-[10px] font-bold uppercase tracking-widest italic",children:"Intervention Recommand√©e"})})})]},g.id))})]})]})]})}function cm({data:e}){const t=e.securedCA+e.exposedCA+e.cancelledCA,n=t>0?e.securedCA/t*100:0,i=t>0?e.exposedCA/t*100:0,a=t>0?e.cancelledCA/t*100:0;return s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{className:"w-full h-10 bg-white/5 rounded-lg overflow-hidden flex border border-white/10 shadow-lg",children:[s.jsx("div",{style:{width:`${n}%`},className:"h-full bg-[#4ADE80] opacity-80 shadow-[inset_0_1px_2px_rgba(255,255,255,0.1)] transition-all duration-700",title:`S√©curis√©: ${e.securedCA.toLocaleString()}‚Ç¨`}),s.jsx("div",{style:{width:`${i}%`},className:"h-full bg-[#F59E0B] opacity-70 shadow-[inset_0_1px_2px_rgba(255,255,255,0.1)] transition-all duration-700",title:`Expos√©: ${e.exposedCA.toLocaleString()}‚Ç¨`}),s.jsx("div",{style:{width:`${a}%`},className:"h-full bg-[#F87171] opacity-60 shadow-[inset_0_1px_2px_rgba(255,255,255,0.1)] transition-all duration-700",title:`Annul√©: ${e.cancelledCA.toLocaleString()}‚Ç¨`})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-8 px-2",children:[s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-[#4ADE80]"}),s.jsx("span",{className:"text-xs font-bold text-white/40 uppercase tracking-[0.2em]",children:"S√©curis√©"})]}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsxs("span",{className:"text-2xl font-bold text-white/90 tabular-nums",children:[Math.round(n),"%"]}),s.jsxs("span",{className:"text-sm font-bold text-white/20 tracking-tight",children:["(",Math.round(e.securedCA/1e3),"k‚Ç¨)"]})]})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-[#F59E0B]"}),s.jsx("span",{className:"text-xs font-bold text-white/40 uppercase tracking-[0.2em]",children:"Expos√©"})]}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsxs("span",{className:"text-2xl font-bold text-white/90 tabular-nums",children:[Math.round(i),"%"]}),s.jsxs("span",{className:"text-sm font-bold text-white/20 tracking-tight",children:["(",Math.round(e.exposedCA/1e3),"k‚Ç¨)"]})]})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-[#F87171]"}),s.jsx("span",{className:"text-xs font-bold text-white/40 uppercase tracking-[0.2em]",children:"Annul√©"})]}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsxs("span",{className:"text-2xl font-bold text-white/90 tabular-nums",children:[Math.round(a),"%"]}),s.jsxs("span",{className:"text-sm font-bold text-white/20 tracking-tight",children:["(",Math.round(e.cancelledCA/1e3),"k‚Ç¨)"]})]})]})]})]})}const Qt={line:"#38BDF8",area:"#38BDF8",axis:"#ffffff20"},dm=({data:e,width:t,height:n})=>{if(t<10||n<10)return null;const i={top:20,right:30,bottom:50,left:60},a=Math.max(0,t-i.left-i.right),o=Math.max(0,n-i.top-i.bottom),r=N.useMemo(()=>Me({domain:[0,14],range:[0,a]}),[a]),l=N.useMemo(()=>Me({domain:[0,100],range:[o,0],nice:!0}),[o]),c=N.useMemo(()=>!e||!e.length?null:e.reduce((d,u)=>d.activeRate>u.activeRate?d:u),[e]);return s.jsx("svg",{width:t,height:n,children:s.jsxs(ie,{left:i.left,top:i.top,children:[s.jsx("rect",{x:r(7),y:0,width:Math.max(0,r(14)-r(7)),height:o,fill:"#F59E0B",fillOpacity:.04}),s.jsx("line",{x1:r(7),y1:0,x2:r(7),y2:o,stroke:"#F59E0B",strokeWidth:1,strokeDasharray:"4,4",opacity:.3}),s.jsx("line",{x1:r(14),y1:0,x2:r(14),y2:o,stroke:"#F87171",strokeWidth:1,strokeDasharray:"4,4",opacity:.3}),s.jsx("text",{x:r(10.5),y:20,fill:"#F59E0B",fontSize:10,fontWeight:"700",textAnchor:"middle",className:"uppercase tracking-[0.2em] opacity-40 hover:opacity-100 transition-opacity",children:"Zone critique churn"}),s.jsx(Dt,{data:e,x:d=>r(d.day),y:d=>l(d.activeRate),yScale:l,fill:Qt.area,fillOpacity:.05,curve:_e}),s.jsx(ut,{data:e,x:d=>r(d.day),y:d=>l(d.activeRate),stroke:Qt.line,strokeWidth:4,strokeOpacity:.9,curve:_e}),c&&s.jsxs(ie,{children:[s.jsx("circle",{cx:r(c.day),cy:l(c.activeRate),r:5,fill:"#F87171",className:"animate-pulse"}),s.jsx("text",{x:r(c.day),y:l(c.activeRate)-15,fill:"#F87171",fontSize:10,fontWeight:"bold",textAnchor:"middle",className:"font-sans uppercase tracking-widest",children:"Pic d√©crochage"})]}),s.jsx(mt,{top:o,scale:r,stroke:"transparent",tickStroke:Qt.axis,tickLabelProps:()=>({fill:"#ffffff20",fontSize:10,fontWeight:"bold",className:"font-sans",textAnchor:"middle"}),tickValues:[0,2,4,6,8,10,12,14],tickFormat:d=>`J+${d}`}),s.jsx(gs,{scale:l,stroke:"transparent",tickStroke:Qt.axis,tickLabelProps:()=>({fill:"#ffffff20",fontSize:10,fontWeight:"bold",className:"font-sans",textAnchor:"end",verticalAnchor:"middle",dx:-4}),tickValues:[0,25,50,75,100],tickFormat:d=>`${d}%`})]})})};function um({data:e}){return s.jsx("div",{style:{width:"100%",height:"350px"},children:s.jsx(xt,{children:({width:t,height:n})=>s.jsx(dm,{data:e,width:t,height:n})})})}const hm=({leads:e,visited:t,signed:n,waitingSignatureStudies:i=[],waitingDepositStudies:a=[],secured:o,securedAmount:r=0})=>{const l=Math.max(e,1),c=t?Math.round(n/t*100):0,d=e?Math.round(t/e*100):0,u=e?Math.round(n/e*100):0,p=Math.max(0,e-t),h=i.length,f=a.length,m=o,y=e>0,b=e?t/e*100:0,w=t?n/t*100:0,j=n?o/n*100:0,k=Math.min(b,w,j)===b?"Qualification":Math.min(b,w,j)===w?"Closing":"Administratif";return s.jsxs("div",{className:"w-full space-y-12",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-end gap-6 border-l-4 border-emerald-500 pl-8 py-2",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-[9px] tracking-[0.4em] text-emerald-400 font-black uppercase",children:"S03 ‚Äî Pipeline Momentum"}),s.jsx("h1",{className:"text-4xl font-black text-white tracking-tight uppercase",children:"Trajectoire Dossiers"}),s.jsx("p",{className:"text-white/40 text-[10px] uppercase font-bold tracking-widest",children:"Donn√©es d√©doublonn√©es par email ¬∑ 1 Email = 1 Dossier"})]}),s.jsxs("div",{className:"flex gap-12",children:[s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-4xl font-black text-white font-mono tracking-tighter tabular-nums",children:e}),s.jsx("div",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-widest",children:"Leads Entrants"})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-4xl font-black text-emerald-400 font-mono tracking-tighter tabular-nums",children:r>0?`${Math.round(r/1e3)}k‚Ç¨`:o}),s.jsx("div",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-widest",children:"Valeur Encaiss√©e"})]})]})]}),s.jsx("div",{className:"relative bg-black/60 rounded-[2.5rem] p-12 border border-white/5 shadow-2xl backdrop-blur-xl overflow-hidden",children:y?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"relative h-6 mb-2 flex",children:[s.jsx("div",{style:{width:`${m/l*100}%`},className:"relative",children:s.jsx("span",{className:"absolute right-0 bottom-0 text-[10px] font-black text-emerald-400 uppercase translate-x-1/2",children:m})}),s.jsx("div",{style:{width:`${f/l*100}%`},className:"relative",children:s.jsx("span",{className:"absolute right-0 bottom-0 text-[10px] font-black text-white/40 uppercase translate-x-1/2",children:n})}),s.jsx("div",{style:{width:`${h/l*100}%`},className:"relative",children:s.jsx("span",{className:"absolute right-0 bottom-0 text-[10px] font-black text-white/30 uppercase translate-x-1/2",children:t})}),s.jsx("div",{style:{width:`${p/l*100}%`},className:"relative",children:s.jsx("span",{className:"absolute right-0 bottom-0 text-[10px] font-black text-white/20 uppercase",children:e})})]}),s.jsxs("div",{className:"relative h-20 mb-12 flex gap-1 items-center",children:[s.jsxs("div",{className:"h-full bg-gradient-to-br from-emerald-400 to-emerald-600 rounded-l-2xl relative group transition-all duration-700",style:{width:`${Math.max(m/l*100,2)}%`},children:[s.jsx("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"}),s.jsx("div",{className:"absolute -top-8 left-0 text-[8px] font-black text-emerald-400 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all",children:"S√âCURIS√â"})]}),s.jsxs("div",{className:"h-2/3 bg-white/10 border border-white/10 relative group transition-all duration-700",style:{width:`${f/l*100}%`},children:[s.jsx("div",{className:"absolute inset-0 bg-orange-500/10 opacity-0 group-hover:opacity-100 transition-opacity"}),f>0&&s.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-black text-white/20",children:["-",f]}),s.jsx("div",{className:"absolute -top-8 left-0 text-[8px] font-black text-white/40 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all whitespace-nowrap",children:"ATTENTE ACOMPTE"})]}),s.jsxs("div",{className:"h-1/2 bg-white/5 border border-white/5 relative group transition-all duration-700",style:{width:`${h/l*100}%`},children:[s.jsx("div",{className:"absolute inset-0 bg-blue-500/5 opacity-0 group-hover:opacity-100 transition-opacity"}),h>0&&s.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-black text-white/10",children:["-",h]}),s.jsx("div",{className:"absolute -top-8 left-0 text-[8px] font-black text-white/30 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all whitespace-nowrap",children:"VISIT√â ¬∑ SANS CONTRAT"})]}),s.jsxs("div",{className:"h-1/4 bg-white/[0.02] border border-white/[0.02] rounded-r-2xl relative group transition-all duration-700",style:{width:`${p/l*100}%`},children:[s.jsx("div",{className:"absolute inset-0 bg-slate-500/[0.02] opacity-0 group-hover:opacity-100 transition-opacity"}),p>0&&s.jsxs("div",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-black text-white/[0.05]",children:["-",p]}),s.jsx("div",{className:"absolute -top-8 right-0 text-[8px] font-black text-white/20 uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-all whitespace-nowrap",children:"LEADS BRUTS"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-12",children:[s.jsx($s,{label:"Qualit√© Commerciale",rate:c,lostLabel:"Visites sans contrat",loss:h,color:"text-emerald-400",subLabel:"Sign√©s / Total Visites"}),s.jsx($s,{label:"P√©n√©tration Prospect",rate:d,lostLabel:"Leads sans Dossier",loss:p,color:"text-cyan-400",subLabel:"Dossiers / Total Leads"}),s.jsx($s,{label:"Conversion Totale",rate:u,lostLabel:"Dossiers non sign√©s",loss:p+h,color:"text-white",subLabel:"Sign√©s / Total Leads"})]})]}):s.jsx("div",{className:"h-32 flex items-center justify-center text-white/20 uppercase font-black tracking-widest italic",children:"Aucune donn√©e de pipeline disponible"})}),s.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:[s.jsx(es,{label:"Conversion Vente",value:`${c}%`,color:"text-emerald-400",sub:"Sign√©s vs Visit√©s"}),s.jsx(es,{label:"Taux P√©n√©tration",value:`${d}%`,color:"text-sky-400",sub:"Visit√©s vs Leads"}),s.jsx(es,{label:"Bottleneck",value:k,color:"text-orange-400",sub:"Point critique",isTextValue:!0}),s.jsx(es,{label:"En Attente",value:h+f,color:"text-white",sub:"Dossiers √† d√©bloquer",hoverList:[...i,...a]})]})]})},$s=({label:e,rate:t,loss:n,lostLabel:i,color:a,subLabel:o})=>s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-baseline",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[10px] font-black text-white uppercase tracking-[0.2em]",children:e}),s.jsx("span",{className:"text-[9px] font-bold text-white/40 uppercase",children:o})]}),s.jsxs("span",{className:`text-3xl font-black font-mono tracking-tighter ${a}`,children:[t,"%"]})]}),s.jsx("div",{className:"h-1 bg-white/5 rounded-full overflow-hidden",children:s.jsx("div",{className:`h-full ${a.replace("text-","bg-")} opacity-60 transition-all duration-1000`,style:{width:`${t}%`}})}),s.jsx("div",{className:"flex flex-col gap-1",children:s.jsxs("span",{className:"text-[10px] font-mono text-red-500/60 font-bold uppercase tracking-wider tabular-nums",children:["-",n," ",i]})})]}),es=({label:e,value:t,color:n,sub:i,isTextValue:a=!1,hoverList:o})=>s.jsxs("div",{className:"bg-black/40 rounded-3xl p-6 border border-white/5 hover:border-white/20 transition-all duration-300 shadow-lg group relative",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("div",{className:"text-[10px] text-white/30 uppercase font-black tracking-widest mb-1",children:e}),s.jsx("div",{className:"text-[9px] text-white/20 uppercase font-bold tracking-widest mb-4",children:i})]}),s.jsx("div",{className:`${a?"text-xl":"text-3xl"} font-black font-mono tracking-tighter ${n} truncate transition-transform duration-300 group-hover:scale-105 origin-left`,children:t}),o&&o.length>0&&s.jsxs("div",{className:"absolute bottom-full left-0 mb-4 w-64 bg-[#0a0e27] border border-white/10 rounded-2xl p-4 shadow-2xl opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity z-50",children:[s.jsx("div",{className:"text-[8px] font-black text-white/30 uppercase tracking-[0.2em] mb-4 border-b border-white/5 pb-2",children:"D√©tail des dossiers"}),s.jsx("div",{className:"max-h-48 overflow-y-auto space-y-2 pr-2 custom-scrollbar",children:o.map((r,l)=>s.jsxs("div",{className:"flex justify-between items-center gap-4",children:[s.jsx("span",{className:"text-[10px] font-black text-white truncate uppercase",children:r.name||"Inconnu"}),s.jsx("span",{className:"text-[8px] font-bold text-white/20 uppercase px-2 py-0.5 bg-white/5 rounded-full",children:r.status==="signed"?"Attente ‚Ç¨":"Attente Signature"})]},l))})]})]}),De={secured:"#4ADE80",projected:"#38BDF8",target:"#ffffff",axis:"#ffffff10"},pm=({data:e,width:t,height:n})=>{if(t<10||n<10)return null;const i={top:40,right:30,bottom:50,left:70},a=Math.max(0,t-i.left-i.right),o=Math.max(0,n-i.top-i.bottom),r=N.useMemo(()=>Hs({domain:fl(e,d=>d.date),range:[0,a]}),[e,a]),l=N.useMemo(()=>Me({domain:[0,ml(e,d=>Math.max(d.projected,d.target))||1e6],nice:!0,range:[o,0]}),[e,o]),c=e[e.length-1];return s.jsx("svg",{width:t,height:n,children:s.jsxs(ie,{left:i.left,top:i.top,children:[s.jsx(Dt,{data:e,x:d=>r(d.date),y:d=>l(d.secured),yScale:l,fill:De.secured,fillOpacity:.05,curve:_e}),s.jsx(Dt,{data:e,x:d=>r(d.date),y0:d=>l(d.secured),y1:d=>l(d.projected),yScale:l,fill:De.projected,fillOpacity:.03,curve:_e}),s.jsx(ut,{data:e,x:d=>r(d.date),y:d=>l(d.projected),stroke:De.projected,strokeWidth:1,strokeDasharray:"4 4",strokeOpacity:.2,curve:_e}),s.jsx(ut,{data:e,x:d=>r(d.date),y:d=>l(d.target),stroke:De.target,strokeWidth:2,strokeDasharray:"6,4",strokeOpacity:.6,curve:_e}),s.jsx(ut,{data:e,x:d=>r(d.date),y:d=>l((d.secured+d.projected)/2),stroke:De.projected,strokeWidth:4,strokeOpacity:.9,curve:_e}),c&&s.jsxs(ie,{children:[s.jsx("circle",{cx:r(c.date),cy:l((c.secured+c.projected)/2),r:6,fill:De.projected,className:"animate-pulse"}),s.jsx("text",{x:r(c.date),y:l((c.secured+c.projected)/2)-15,fill:De.projected,fontSize:10,fontWeight:"black",textAnchor:"end",className:"font-mono uppercase tracking-widest",children:"Atterrissage projet√©"})]}),c&&s.jsx("text",{x:a,y:l(c.target)-12,fill:"white",fontSize:10,fontWeight:"black",textAnchor:"end",className:"uppercase tracking-widest opacity-40 font-sans",children:"Objectif Board Q2"}),s.jsx(mt,{top:o,scale:r,stroke:"transparent",tickStroke:De.axis,tickLabelProps:()=>({fill:"#64748b",fontSize:10,fontWeight:"bold",className:"font-mono",textAnchor:"middle"})}),s.jsx(gs,{scale:l,stroke:"transparent",tickStroke:De.axis,tickLabelProps:()=>({fill:"#64748b",fontSize:10,fontWeight:"bold",className:"font-mono",textAnchor:"end",verticalAnchor:"middle",dx:-5}),tickFormat:d=>`${Math.round(d/1e3)}k`,tickValues:[0,25e4,5e5,75e4,1e6]})]})})};function fm({data:e}){return!e||e.length===0?null:s.jsx("div",{style:{width:"100%",height:"350px"},children:s.jsx(xt,{children:({width:t,height:n})=>s.jsx(pm,{data:e,width:t,height:n})})})}function mm({system:e}){const{studies:t,financialStats:n,emailLeads:i,metrics:a}=e,o=N.useMemo(()=>({securedCA:n.cashSecured||0,exposedCA:n.cashAtRisk||0,cancelledCA:n.cashLost||n.totalPotentialCA*.1||5e4}),[n]),r=N.useMemo(()=>{if(!i||i.length===0)return Array.from({length:15}).map((h,f)=>({day:f,activeRate:0}));const d=new Date,u=new Array(15).fill(0);i.forEach(h=>{const f=[h.last_opened_at,h.last_clicked_at,h.created_at].filter(Boolean).map(m=>new Date(m)).sort((m,y)=>y.getTime()-m.getTime())[0];if(f){const m=Math.floor((d.getTime()-f.getTime())/864e5);m<15&&u[m]++}});const p=i.length;return u.map((h,f)=>({day:f,activeRate:Math.round(h/p*100)}))},[i]),l=N.useMemo(()=>{const d=new Map;t.forEach(j=>{if(!d.has(j.email))d.set(j.email,j);else{const k=d.get(j.email);(j.status==="signed"||j.deposit_paid)&&!(k.status==="signed"||k.deposit_paid)&&d.set(j.email,j)}});const p=Array.from(d.values()).filter(j=>j.status!=="cancelled"),h=p.length,f=p.filter(j=>j.status==="signed"||j.deposit_paid),m=f.length,y=p.filter(j=>j.status!=="signed"&&!j.deposit_paid),b=f.filter(j=>!j.deposit_paid&&(j.payment_mode==="cash"||j.financing_mode==="with_deposit"||j.financing_mode==="partial_financing")),w=f.filter(j=>j.deposit_paid||j.financing_mode==="full_financing").length;return{leads:(i==null?void 0:i.length)||0,visited:h,signed:m,waitingSignatureStudies:y,waitingDepositStudies:b,secured:w,securedAmount:(n==null?void 0:n.cashSecured)||0}},[i,t,n]),c=N.useMemo(()=>{const d=[],u=new Date,p=n.cashSecured||0,h=(n.cashAtRisk||0)*.5+(n.totalPotentialCA||0)*.2,f=p+h*1.2;for(let m=0;m<=90;m+=10){const y=new Date(u);y.setDate(y.getDate()+m);const b=m/90;d.push({date:y,secured:p,projected:p+h*b,target:f})}return d},[n]);return s.jsxs("div",{className:"flex flex-col gap-12 py-8 px-4 w-full h-full pb-40",children:[s.jsxs("header",{className:"flex flex-col gap-2",children:[s.jsx("h1",{className:"text-4xl font-black text-white tracking-tight uppercase",children:"Salle de Navigation"}),s.jsx("p",{className:"text-slate-500 text-[10px] font-bold uppercase tracking-widest",children:"Vision Dirigeant & Trajectoire Strat√©gique"})]}),s.jsxs("section",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 space-y-12 shadow-2xl",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-12",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"S01 ‚Äî ANALYSE DE TR√âSORERIE"}),s.jsx("h2",{className:"text-4xl font-black text-white uppercase tracking-tight",children:"Niveau de s√©curisation du CA"}),s.jsxs("div",{className:"flex items-center gap-6 mt-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.3)] animate-pulse"}),s.jsx("span",{className:"text-lg font-bold text-white/70",children:"60% S√©curis√©"}),s.jsx("span",{className:"text-sm font-bold text-emerald-400",children:"(+3.2 pts)"})]}),s.jsx("div",{className:"h-6 w-[2px] bg-white/5"}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("span",{className:"text-lg font-bold text-slate-500",children:"Objectif : 70%"})})]})]}),s.jsxs("div",{className:"text-left md:text-right",children:[s.jsxs("div",{className:"flex items-baseline md:justify-end gap-3",children:[s.jsx("span",{className:"text-6xl font-black text-white tracking-tighter tabular-nums font-mono drop-shadow-2xl",children:(n.cashSecured||0).toLocaleString()}),s.jsx("span",{className:"text-2xl font-bold text-white/10",children:"‚Ç¨"})]}),s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest block mt-2",children:"CASH NET S√âCURIS√â"})]})]}),s.jsx("div",{className:"pt-6",children:s.jsx(cm,{data:o})}),s.jsxs("div",{className:"bg-black/40 backdrop-blur-xl border border-white/10 p-8 rounded-2xl flex items-start gap-6 transition-all hover:border-white/20",children:[s.jsx("div",{className:"w-1.5 h-full bg-blue-500 rounded-full shadow-[0_0_15px_rgba(59,130,246,0.3)] min-h-[50px]"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[10px] font-bold text-blue-400 uppercase tracking-widest",children:"Insight Strat√©gique"}),s.jsxs("p",{className:"text-sm text-slate-300 font-medium leading-relaxed max-w-3xl",children:[s.jsx("span",{className:"text-white font-bold text-base",children:"ALERTE SEGMENT :"})," 28% de l'exposition r√©side dans le segment ",s.jsx("span",{className:"text-orange-400 font-bold",children:"√âtudes Complexes"}),". Une s√©curisation des acomptes sur ce p√©rim√®tre permettrait d'atteindre l'objectif de 70% d'ici 14 jours."]})]})]})]}),s.jsxs("div",{className:"flex flex-col gap-12",children:[s.jsxs("section",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 space-y-10 shadow-xl",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start gap-8",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"S02 ‚Äî MOMENT CRITIQUE CHURN"}),s.jsx("h2",{className:"text-3xl font-black text-white uppercase tracking-tight",children:"Moment critique de d√©crochage"}),s.jsx("p",{className:"text-[10px] font-bold text-orange-400 uppercase tracking-widest",children:"70% des annulations se pr√©parent apr√®s J+7"})]}),s.jsxs("div",{className:"flex flex-col md:items-end gap-1",children:[s.jsx("span",{className:"text-3xl font-black text-white font-mono tabular-nums tracking-tighter uppercase",children:"8.2 JOURS"}),s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"D√âLAI MOYEN AVANT D√âCROCHAGE"})]})]}),s.jsx("div",{className:"py-4",children:s.jsx(um,{data:r})}),s.jsxs("div",{className:"bg-black/40 border border-orange-500/20 p-6 rounded-2xl flex items-start gap-4",children:[s.jsx("div",{className:"w-1 h-full bg-orange-500 rounded-full opacity-40 min-h-[40px]"}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("span",{className:"text-[10px] font-bold text-orange-400 uppercase tracking-widest",children:"Action Recommand√©e"}),s.jsxs("p",{className:"text-sm text-slate-300 leading-relaxed",children:[s.jsx("span",{className:"text-white font-bold",children:"INTERVENTION PROACTIVE :"})," Le pic de d√©crochage se situe √† ",s.jsx("span",{className:"text-white font-bold font-mono",children:"J+8"}),". D√©clenchement automatique d'un call de courtoisie √† ",s.jsx("span",{className:"text-white font-bold font-mono",children:"J+4"})," pour valider l'onboarding."]})]})]})]}),s.jsx("section",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 shadow-xl",children:s.jsx(hm,{leads:l.leads,visited:l.visited,signed:l.signed,waitingSignatureStudies:l.waitingSignatureStudies,waitingDepositStudies:l.waitingDepositStudies,secured:l.secured,securedAmount:l.securedAmount})})]}),s.jsxs("section",{className:"bg-black/20 backdrop-blur-sm p-12 rounded-3xl border border-white/5 space-y-12 shadow-2xl",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-12",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest",children:"S04 ‚Äî TRAJECTOIRE FINANCI√àRE"}),s.jsx("h2",{className:"text-4xl font-black text-white uppercase tracking-tight",children:"Atterrissage √† 90 Jours"}),s.jsxs("div",{className:"flex flex-wrap items-center gap-6 mt-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-full bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.3)] animate-pulse"}),s.jsx("span",{className:"text-lg font-bold text-white/70",children:"Probabilit√© d'atteinte"}),s.jsx("span",{className:"text-lg font-black text-red-500 font-mono tracking-tighter",children:"38%"})]}),s.jsx("div",{className:"h-6 w-[2px] bg-white/5"}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("span",{className:"text-lg font-bold text-slate-500 italic",children:'"Objectif manqu√© fin avril"'})})]})]}),s.jsxs("div",{className:"text-left md:text-right",children:[s.jsx("div",{className:"flex items-baseline md:justify-end gap-3",children:s.jsx("span",{className:"text-7xl font-black text-red-500 font-mono tracking-tighter tabular-nums drop-shadow-2xl font-mono",children:"-122k‚Ç¨"})}),s.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-widest block mt-2",children:"D√âFICIT PROJET√â vs BOARD"})]})]}),s.jsx("div",{className:"py-2",children:s.jsx(fm,{data:c})}),s.jsxs("div",{className:"bg-black/40 border border-red-500/20 p-8 rounded-2xl flex items-start gap-6 transition-all hover:border-red-500/30",children:[s.jsx("div",{className:"w-1.5 h-full bg-red-500 rounded-full opacity-40 min-h-[50px]"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[10px] font-bold text-red-400 uppercase tracking-widest",children:"Alerte Gouvernance"}),s.jsxs("p",{className:"text-sm text-slate-300 leading-relaxed max-w-3xl",children:[s.jsx("span",{className:"text-white font-bold text-base uppercase tracking-tight",children:"Action Corrective :"})," L'objectif Board est atteignable avec ",s.jsx("span",{className:"text-white font-bold font-mono",children:"+12 signatures"})," ou une am√©lioration de ",s.jsx("span",{className:"text-emerald-400 font-bold font-mono",children:"+6%"})," de la conversion du pipeline. Priorit√© absolue sur les dossiers √† ",">","50k‚Ç¨."]})]})]})]})]})}const xm=({data:e,width:t,height:n,benchmarkPercentage:i=42})=>{const[a,o]=N.useState(null),r={top:60,right:30,bottom:80,left:30},l=Math.max(0,t-r.left-r.right),c=Math.max(0,n-r.top-r.bottom),d=N.useMemo(()=>vn({domain:e.map(h=>h.label),range:[0,l],padding:.25}),[e,l]),u=Math.max(...e.map(h=>h.value),1),p=N.useMemo(()=>Me({domain:[0,u],range:[c,10]}),[u,c]);return s.jsxs("div",{className:"relative group/funnel",children:[s.jsx("svg",{width:t,height:n,className:"overflow-visible",children:s.jsxs(ie,{left:r.left,top:r.top,children:[i&&s.jsxs(ie,{top:c*(1-i/100),children:[s.jsx("line",{x1:0,x2:l,stroke:"#4ECDC4",strokeWidth:1,strokeDasharray:"4,4",opacity:.15}),s.jsxs("text",{x:l,y:-5,fill:"#4ECDC4",fontSize:9,fontWeight:"black",textAnchor:"end",className:"uppercase tracking-widest opacity-40",children:["Target ",i,"%"]})]}),e.map((h,f)=>{const m=d.bandwidth(),y=d(h.label)||0,b=Math.max(50,c-p(h.value)),w=c-b,j=h.isFriction,k=f>0?e[f-1].value:null,C=k?Math.round(h.value/k*100):null;return s.jsxs(ie,{onMouseEnter:()=>o(f),onMouseLeave:()=>o(null),className:"cursor-pointer",children:[C!==null&&s.jsxs(ie,{left:y-d.step()*d.padding()/2,children:[s.jsxs("text",{y:c-20,textAnchor:"middle",fill:j?"#FF6B6B":"white",opacity:j?1:.6,fontSize:14,fontWeight:"900",fontFamily:"IBM Plex Mono",children:[C,"%"]}),s.jsx("path",{d:"M -5 10 L 0 15 L 5 10",fill:"none",stroke:j?"#FF6B6B":"white",strokeWidth:2,opacity:j?1:.3,transform:`translate(0, ${c-45})`})]}),s.jsx("rect",{x:y,y:w,width:m,height:b,fill:j?"url(#frictionGradient)":h.color,fillOpacity:a===f?.9:.7,stroke:j?"#FF6B6B":"white",strokeOpacity:a===f?1:.4,strokeWidth:j?3:1,rx:6,className:"transition-all duration-300"}),s.jsx("text",{x:y+m/2,y:w-8,fill:"white",fontSize:11,fontWeight:"bold",fontFamily:"IBM Plex Mono",textAnchor:"middle",opacity:.4,children:h.value}),s.jsxs("text",{x:y+m/2,y:w+b/2+6,fill:"white",opacity:.95,fontSize:b>80?18:16,fontWeight:"black",fontFamily:"IBM Plex Mono",textAnchor:"middle",style:{filter:"drop-shadow(0px 2px 8px rgba(0,0,0,0.95))"},children:[Math.round(h.revenue/1e3),"k‚Ç¨"]}),h.avgDelay!==void 0&&h.avgDelay>0&&s.jsx(ie,{top:c+16,left:y+m/2,children:s.jsxs("text",{fill:h.avgDelay>7?"#FF6B6B":"white",opacity:.6,fontSize:11,fontWeight:"black",textAnchor:"middle",children:[h.avgDelay,"j"]})}),s.jsx("text",{x:y+m/2,y:c+48,fill:"white",opacity:a===f?1:.3,fontSize:12,fontWeight:"900",className:"uppercase tracking-[0.2em]",textAnchor:"middle",children:h.label})]},`step-${f}`)}),s.jsx("defs",{children:s.jsxs("linearGradient",{id:"frictionGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[s.jsx("stop",{offset:"0%",stopColor:"#FF6B6B",stopOpacity:.8}),s.jsx("stop",{offset:"100%",stopColor:"#E63946",stopOpacity:.3})]})})]})}),a!==null&&s.jsx("div",{className:"absolute z-50 pointer-events-none bg-[#1a1c23] border border-white/20 p-4 rounded-xl shadow-2xl backdrop-blur-xl animate-in fade-in zoom-in duration-200",style:{left:d(e[a].label)+r.left+d.bandwidth()/2,top:r.top+(c-Math.max(25,c-p(e[a].value)))-100,transform:"translateX(-50%)"},children:s.jsxs("div",{className:"flex flex-col gap-1 min-w-[140px]",children:[s.jsx("div",{className:"text-[10px] font-black text-white/30 uppercase tracking-widest",children:e[a].label}),s.jsxs("div",{className:"flex justify-between items-baseline gap-4 mt-2",children:[s.jsx("span",{className:"text-2xl font-black text-white font-mono",children:e[a].value}),s.jsx("span",{className:"text-xs font-bold text-white/40 uppercase",children:"Dossiers"})]}),s.jsxs("div",{className:"text-lg font-black text-emerald-400 font-mono",children:[Math.round(e[a].revenue/1e3),"k‚Ç¨ ",s.jsx("span",{className:"text-[10px] text-white/20 uppercase tracking-tighter",children:"Volume"})]}),a>0&&s.jsxs("div",{className:"mt-2 pt-2 border-t border-white/5 flex justify-between items-center",children:[s.jsx("span",{className:"text-[9px] font-bold text-white/30 uppercase",children:"Efficience"}),s.jsxs("span",{className:"text-sm font-black text-white",children:[Math.round(e[a].value/e[a-1].value*100),"%"]})]})]})})]})};function gm({data:e,benchmarkPercentage:t}){return!e||e.length===0?null:s.jsx("div",{style:{width:"100%",height:"320px"},className:"relative",children:s.jsx(xt,{children:({width:n,height:i})=>s.jsx(xm,{data:e,width:n,height:i,benchmarkPercentage:t})})})}const bm=({data:e,autopilotIndex:t,width:n,height:i})=>{const a={top:40,right:30,bottom:40,left:30},o=Math.max(0,n-a.left-a.right),r=Math.max(0,i-a.top-a.bottom),l=N.useMemo(()=>vn({domain:e.map(u=>u.label),range:[0,o],padding:.3}),[e,o]),c=Math.max(...e.map(u=>Math.max(u.value,u.target||0)),1),d=N.useMemo(()=>Me({domain:[0,c*1.1],range:[r,0]}),[c,r]);return s.jsxs("svg",{width:n,height:i,className:"overflow-visible",children:[s.jsx("defs",{children:s.jsxs("linearGradient",{id:"emeraldGradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[s.jsx("stop",{offset:"0%",stopColor:"#10B981",stopOpacity:.8}),s.jsx("stop",{offset:"100%",stopColor:"#059669",stopOpacity:.3})]})}),s.jsxs(ie,{left:a.left,top:a.top,children:[s.jsx(ie,{children:e.map((u,p)=>{if(p===0||!u.target)return null;const h=e[p-1];return h.target?s.jsx("line",{x1:(l(h.label)||0)+l.bandwidth()/2,y1:d(h.target),x2:(l(u.label)||0)+l.bandwidth()/2,y2:d(u.target),stroke:"white",strokeOpacity:.15,strokeWidth:1,strokeDasharray:"4,4"},`target-line-${p}`):null})}),t<e.length&&s.jsxs(ie,{left:l(e[t].label)||0,children:[s.jsx("line",{y1:-20,y2:r,stroke:"white",strokeOpacity:.2,strokeWidth:1,strokeDasharray:"4,2"}),s.jsx("text",{y:-25,fill:"white",opacity:.3,fontSize:8,fontWeight:"black",className:"uppercase tracking-widest text-[7px]",children:"D√©marrage Autopilote"})]}),e.map((u,p)=>{const h=l.bandwidth(),f=l(u.label)||0,m=d(u.value),y=Math.max(2,r-m),b=p>=t;return s.jsxs(ie,{children:[s.jsx("rect",{x:f,y:m,width:h,height:y,fill:b?"url(#emeraldGradient)":"white",fillOpacity:b?.9:.15,rx:4,className:"transition-all duration-500"}),s.jsxs("text",{x:f+h/2,y:m-8,fill:"white",opacity:b?1:.3,fontSize:9,fontWeight:"black",fontFamily:"IBM Plex Mono",textAnchor:"middle",children:[Math.round(u.value/1e3),"k"]})]},`revenue-bar-${p}`)}),s.jsx(mt,{top:r,scale:l,stroke:"transparent",tickStroke:"transparent",tickLabelProps:()=>({fill:"#ffffff20",fontSize:9,fontFamily:"IBM Plex Mono",textAnchor:"middle",fontWeight:"bold",className:"uppercase tracking-[0.2em]"})})]})]})};function ym({data:e,autopilotIndex:t}){return!e||e.length===0?null:s.jsx("div",{style:{width:"100%",height:"280px"},children:s.jsx(xt,{children:({width:n,height:i})=>s.jsx(bm,{data:e,autopilotIndex:t,width:n,height:i})})})}function vm({system:e}){const{studies:t,metrics:n,financialStats:i,emailLeads:a}=e,o=N.useMemo(()=>{const h=new Map;return t.forEach(f=>{if(!h.has(f.email))h.set(f.email,f);else{const m=h.get(f.email);(f.status==="signed"||f.deposit_paid)&&!(m.status==="signed"||m.deposit_paid)&&h.set(f.email,f)}}),Array.from(h.values()).filter(f=>f.status!=="cancelled")},[t]),r=N.useMemo(()=>o.filter(h=>h.status==="signed"||h.deposit_paid).length,[o]),l=N.useMemo(()=>{const h=(a==null?void 0:a.length)||1,f=o.length,m=o.filter(F=>F.views>0).length,y=o.filter(F=>(F.clicks||0)>0).length,b=r,w=h>0?f/h*100:0,j=f>0?m/f*100:0,k=m>0?y/m*100:0,C=y>0?b/y*100:0,_=f>0?b/f*100:0,g=42,x=-6,v=[{label:"QUALIF",rate:w,actual:w,from:"Leads",to:"Dossiers",target:90,input:h},{label:"OUVERTURE",rate:j,actual:j,from:"Dossiers",to:"Ouvertures",target:85,input:f},{label:"CLIC",rate:k,actual:k,from:"Ouvertures",to:"Clics",target:50,input:m},{label:"CLOSING",rate:C,actual:C,from:"Clics",to:"Sign√©s",target:50,input:y}],S=v.reduce((F,K)=>K.rate/K.target<F.rate/F.target?K:F,v[0]),A=S.rate<S.target*.7,R=r>0?i.caTotal/r:28e3,P=S.target-S.actual,L=Math.round(S.input*(P/100));let T=1;S.label==="QUALIF"?T=(m/f||0)*(y/m||0)*(b/y||0):S.label==="OUVERTURE"?T=(y/m||0)*(b/y||0):S.label==="CLIC"&&(T=b/y||0);const V=Math.round(L*T*R),te=V>15e3?`Potentiel de ${Math.round(V/1e3)}k‚Ç¨/mois en optimisant ${S.from} ‚Üí ${S.to}.`:"Pipeline performant. Focus sur l'optimisation continue.",$=()=>S.label==="QUALIF"?"Augmenter la qualification des leads entrants.":S.label==="OUVERTURE"?"Optimiser l'objet des emails et les horaires d'envoi.":S.label==="CLIC"?"Simplifier le CTA et r√©duire la longueur de l'√©tude.":S.label==="CLOSING"?"Renforcer le social proof et automatiser la relance post-clic.":"Augmenter la qualification des leads entrants.";return{globalConversion:_,benchmark:g,diff:_-g,evolution:x,executiveLine:te,monthlyRecoveryPotential:V,recommendation:$(),worst:S,isCritical:A,avgBasket:R,metrics:{qualificationRate:w,openRate:j,clickRate:k,closeRate:C,totalLeads:h,totalDossiers:f,totalOpens:m,totalClicks:y,totalSigned:b}}},[a,o,r,i]),c=N.useMemo(()=>[{label:"LEADS",value:l.metrics.totalLeads,revenue:l.metrics.totalLeads*l.avgBasket,color:"#475569"},{label:"DOSSIERS",value:l.metrics.totalDossiers,revenue:l.metrics.totalDossiers*l.avgBasket,color:"#334155"},{label:"OUVERTS",value:l.metrics.totalOpens,revenue:l.metrics.totalOpens*l.avgBasket,color:"#1e293b",isFriction:l.worst.label==="OUVERTURE",avgDelay:2},{label:"CLIQU√âS",value:l.metrics.totalClicks,revenue:l.metrics.totalClicks*l.avgBasket,color:"#0f172a",isFriction:l.worst.label==="CLIC",avgDelay:9},{label:"SIGN√âS",value:l.metrics.totalSigned,revenue:l.metrics.totalSigned*l.avgBasket,color:"#10B981",isFriction:l.worst.label==="CLOSING"}],[l]),d=N.useMemo(()=>{var h;return o.filter(f=>f.was_war_room&&(f.status==="signed"||f.deposit_paid)).reduce((f,m)=>f+(m.total_price||0),0)||((h=n.warRoom)==null?void 0:h.ca)||0},[o,n]),u=l.metrics.totalLeads*.25,p=N.useMemo(()=>{const h=[],f=new Date;for(let m=5;m>=0;m--){const y=new Date(f.getFullYear(),f.getMonth()-m,1),b=y.toLocaleDateString("fr-FR",{month:"short"});h.push({label:b.charAt(0).toUpperCase()+b.slice(1).replace(".",""),m:y.getMonth(),y:y.getFullYear(),value:0,target:1e5+(5-m)*25e3})}return o.forEach(m=>{if(!(m.status==="signed"||m.deposit_paid))return;const b=m.signed_at||m.created_at;if(!b)return;const w=new Date(b),j=w.getMonth(),k=w.getFullYear(),C=h.find(_=>_.m===j&&_.y===k);C&&(C.value+=m.total_price||0)}),h.map(({label:m,value:y,target:b})=>({label:m,value:y,target:b}))},[o]);return s.jsxs("div",{className:"flex flex-col gap-12 py-12 px-8 w-full h-full pb-40",children:[s.jsx("section",{className:"bg-[#0F1115] p-10 rounded-3xl border border-white/[0.08] shadow-[0_20px_50px_rgba(0,0,0,0.5)]",children:s.jsxs("div",{className:"flex flex-col gap-8",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"text-[10px] font-black text-white/20 uppercase tracking-[0.4em]",children:"Executive Summary"}),s.jsx("h1",{className:"text-3xl md:text-4xl font-black text-white leading-tight uppercase tracking-tighter",children:l.executiveLine}),s.jsxs("div",{className:"flex items-baseline gap-4",children:[s.jsx("span",{className:"text-sm font-bold text-white/30 uppercase tracking-widest",children:"Impact:"}),s.jsxs("span",{className:"text-5xl font-black text-[#FF6B6B] font-mono tracking-tighter",children:[Math.round(l.monthlyRecoveryPotential/1e3),"k‚Ç¨"]}),s.jsx("span",{className:"text-xs font-bold text-white/20 uppercase tracking-widest",children:"/ mois non capt√©s"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[s.jsxs("div",{className:`p-6 rounded-2xl border-2 backdrop-blur-md ${l.isCritical?"bg-red-500/10 border-red-500/30":"bg-white/5 border-white/10"}`,children:[s.jsx("div",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"Status Audit"}),s.jsx("div",{className:`text-sm font-black uppercase ${l.isCritical?"text-red-500":"text-emerald-500"}`,children:l.isCritical?"Friction Critique":"Friction D√©tect√©e"})]}),s.jsxs("div",{className:"p-6 rounded-2xl bg-white/5 border border-white/10 backdrop-blur-md",children:[s.jsx("div",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"Conversion R√©elle"}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsxs("div",{className:"text-2xl font-black text-white font-mono",children:[Math.round(l.globalConversion),"%"]}),s.jsxs("div",{className:`text-[10px] font-black ${l.evolution<0?"text-red-500":"text-emerald-500"}`,children:[l.evolution<0?"‚Üò":"‚Üó"," ",Math.abs(l.evolution),"pts"]})]})]}),s.jsxs("div",{className:`p-6 rounded-2xl border-2 backdrop-blur-md ${l.diff<0?"bg-orange-500/10 border-orange-500/30":"bg-emerald-500/10 border-emerald-500/30"}`,children:[s.jsx("div",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"vs Benchmark"}),s.jsxs("div",{className:`text-2xl font-black font-mono ${l.diff<0?"text-orange-500":"text-emerald-400"}`,children:[l.diff>0?"+":"",Math.round(l.diff),"pts"]})]}),s.jsxs("div",{className:"p-6 rounded-2xl bg-indigo-500/10 border border-indigo-500/20 backdrop-blur-md",children:[s.jsx("div",{className:"text-[9px] font-black text-indigo-400/60 uppercase tracking-widest mb-1",children:"Panier Moyen"}),s.jsxs("div",{className:"text-2xl font-black text-white font-mono",children:[Math.round(l.avgBasket/1e3),"k‚Ç¨"]})]})]})]})}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[s.jsxs("section",{className:"lg:col-span-12 bg-black/40 backdrop-blur-xl p-10 rounded-[2.5rem] border border-white/5 space-y-10 shadow-2xl relative overflow-hidden",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-8 relative z-10",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsxs("h2",{className:"text-xl font-black text-white uppercase tracking-tight",children:["Flux Commercial ¬∑ ",c[0].label," ‚Üí ",c[c.length-1].label]}),s.jsx("p",{className:"text-xs text-white/20 font-bold uppercase tracking-widest",children:"Analyse d√©doublon√©e 1:1 avec tension visuelle sur frictions."})]}),s.jsxs("div",{className:"bg-emerald-500/10 border-l-4 border-emerald-500 p-4 rounded-r-xl max-w-sm",children:[s.jsx("div",{className:"text-[9px] font-black text-emerald-400 uppercase tracking-widest mb-1",children:"Priorit√© Imm√©diate"}),s.jsxs("div",{className:"text-sm font-bold text-white uppercase leading-tight",children:[l.worst.from," ‚Üí ",l.worst.to," : ",l.recommendation]})]})]}),s.jsx("div",{className:"pt-6",children:s.jsx(gm,{data:c,benchmarkPercentage:l.benchmark})}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 pt-10 border-t border-white/5",children:[s.jsx(ts,{label:"CA G√©n√©r√©",value:`${Math.round(i.caTotal/1e3)}k‚Ç¨`}),s.jsx(ts,{label:"Potentiel R√©cup√©rable",value:`+${Math.round(l.monthlyRecoveryPotential/1e3)}k‚Ç¨`,color:"text-emerald-400"}),s.jsx(ts,{label:"D√©lai Moyen",value:"11.2 j"}),s.jsx(ts,{label:"Unit√©s Perdues",value:Math.max(0,Math.round(o.length*.42-r)),color:"text-red-500"})]})]}),s.jsxs("section",{className:"lg:col-span-8 bg-[#0b0f17] p-10 rounded-[2.5rem] border border-white/5 space-y-10 shadow-2xl",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-[9px] tracking-[0.35em] text-white/30 uppercase",children:"Trajectoire Business"}),s.jsx("h2",{className:"text-2xl font-black text-white uppercase tracking-tight",children:"Acc√©l√©ration du Chiffre d‚ÄôAffaires"})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("div",{className:"text-3xl font-black text-emerald-400 font-mono tracking-tighter",children:[Math.round(d/1e3),"k‚Ç¨"]}),s.jsx("p",{className:"text-[9px] text-white/20 font-black uppercase tracking-widest",children:"CA S√©curis√©"})]})]}),s.jsx(ym,{data:p,autopilotIndex:3}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-10",children:[s.jsxs("div",{className:"bg-white/5 rounded-2xl p-6 border border-white/10 backdrop-blur-md",children:[s.jsx("p",{className:"text-[9px] font-black text-white/30 uppercase tracking-widest mb-1",children:"Temps Lib√©r√© Cumulativement"}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsx("span",{className:"text-3xl font-black text-white font-mono",children:Math.round(u)}),s.jsx("span",{className:"text-sm font-bold text-white/30 uppercase tracking-widest",children:"heures"})]})]}),s.jsxs("div",{className:"bg-emerald-500/10 rounded-2xl p-6 border border-emerald-500/20 backdrop-blur-md",children:[s.jsx("p",{className:"text-[9px] font-black text-emerald-400/60 uppercase tracking-widest mb-1",children:"Impact Business Direct"}),s.jsxs("div",{className:"flex items-baseline gap-2",children:[s.jsxs("span",{className:"text-3xl font-black text-emerald-400 font-mono",children:["+",Math.round(d/1e3)]}),s.jsx("span",{className:"text-sm font-bold text-emerald-400/40 uppercase tracking-widest",children:"k‚Ç¨ s√©curis√©s"})]})]})]})]}),s.jsx("section",{className:"lg:col-span-4 flex flex-col gap-6",children:s.jsxs("div",{className:"bg-gradient-to-br from-indigo-950/40 via-black to-black p-12 rounded-[3.5rem] border border-indigo-500/10 flex-1 flex flex-col justify-between shadow-2xl relative overflow-hidden group",children:[s.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-indigo-500/5 blur-[80px] rounded-full group-hover:scale-150 transition-transform duration-1000"}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[10px] font-black text-indigo-400/60 uppercase tracking-[0.4em]",children:"Brain Autopilote"}),s.jsx("div",{className:"h-1 w-12 bg-indigo-500 rounded-full"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("span",{className:"text-[9px] font-black text-white/20 uppercase tracking-widest",children:"Efficience Flux"}),s.jsxs("div",{className:"text-5xl font-black text-white font-mono tracking-tighter",children:["98.4",s.jsx("span",{className:"text-sm text-white/20",children:"%"})]})]})]}),s.jsxs("div",{className:"space-y-4 pt-12 border-t border-white/5",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-[9px] font-black text-white/30 uppercase tracking-[0.2em]",children:"Protection CA"}),s.jsx("span",{className:"text-xs font-black text-emerald-500",children:"ACTIF"})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-[9px] font-black text-white/30 uppercase tracking-[0.2em]",children:"Relance √âtudes"}),s.jsx("span",{className:"text-xs font-black text-emerald-500",children:"ACTIF"})]}),s.jsxs("div",{className:"flex justify-between items-center opacity-30",children:[s.jsx("span",{className:"text-[9px] font-black text-white/30 uppercase tracking-[0.2em]",children:"Smart Closing"}),s.jsx("span",{className:"text-xs font-black text-white/40",children:"BETA"})]})]})]})})]})]})}const ts=({label:e,value:t,color:n="text-white"})=>s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"text-[9px] font-black text-white/20 uppercase tracking-[0.2em]",children:e}),s.jsx("div",{className:`text-xl font-black font-mono tracking-tighter ${n}`,children:t})]});function wm({data:e,securedRevenue:t,cycleBefore:n,cycleNow:i,savedHours:a}){const[o,r]=N.useState(null),l=N.useMemo(()=>Math.max(...e.map(x=>x.creation),1),[e]),c=N.useMemo(()=>Math.max(...e.map(x=>x.protection),1),[e]),d=n&&i?Math.round((i-n)/n*100):null,u={top:40,right:80,bottom:60,left:80},p=800,h=300,f=p-u.left-u.right,m=h-u.top-u.bottom,y=x=>m-x/l*m,b=x=>m-x/c*m,w=x=>{const v=x==="creation"?y:b;return e.map((S,A)=>{const R=A/(e.length-1)*f,P=v(S[x]);return`${A===0?"M":"L"}${R},${P}`}).join(" ")},j=w("creation"),k=w("protection"),C=N.useMemo(()=>{const x=e[e.length-1];return x?x.protection>x.creation?"Le syst√®me prot√®ge d√©sormais plus de chiffre d'affaires qu'il n'en g√©n√®re : effet d√©fensif confirm√©.":x.protection>x.creation*.7?"La protection du CA devient un levier strat√©gique majeur.":"Le syst√®me agit surtout en acquisition : potentiel d√©fensif encore sous‚Äëexploit√©.":""},[e]),_=N.useMemo(()=>{const v=[];for(let S=0;S<=5;S++){const A=l/5*S;v.push(A)}return v},[l]),g=N.useMemo(()=>{const v=[];for(let S=0;S<=5;S++){const A=c/5*S;v.push(A)}return v},[c]);return s.jsxs("section",{className:"w-full rounded-2xl bg-[#0b0e14] border border-white/10 p-8 text-white shadow-[0_20px_60px_rgba(0,0,0,0.45)]",children:[s.jsxs("header",{className:"mb-10",children:[s.jsx("div",{className:"text-xs uppercase tracking-[0.35em] text-white/30 mb-3",children:"Performance commerciale autonome"}),s.jsxs("div",{className:"flex items-end gap-6 flex-wrap",children:[s.jsxs("h1",{className:"text-7xl font-bold leading-none",children:[(t/1e3).toFixed(0),"k‚Ç¨"]}),s.jsx("p",{className:"text-white/50 max-w-sm pb-2",children:"Chiffre d'affaires s√©curis√© automatiquement"})]})]}),s.jsxs("div",{className:"mb-10 bg-[#0f141f] rounded-xl p-6 border border-white/5 relative",children:[s.jsxs("div",{className:"flex gap-6 mb-4 text-xs",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-3 h-0.5 bg-[#3ecfff]"}),s.jsx("span",{className:"text-white/60",children:"Cr√©ation (Clients uniques)"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-3 h-0.5 bg-[#7cffb2]"}),s.jsx("span",{className:"text-white/60",children:"Protection (CA S√©curis√©)"})]})]}),s.jsx("svg",{viewBox:`0 0 ${p} ${h}`,className:"w-full",children:s.jsxs("g",{transform:`translate(${u.left},${u.top})`,children:[g.map((x,v)=>s.jsx("line",{x1:0,y1:b(x),x2:f,y2:b(x),stroke:"rgba(255,255,255,0.05)",strokeDasharray:"2,4"},v)),s.jsx("line",{x1:0,y1:0,x2:0,y2:m,stroke:"rgba(62,207,255,0.3)",strokeWidth:1}),_.map((x,v)=>s.jsx("g",{children:s.jsx("text",{x:-10,y:y(x),fill:"rgba(62,207,255,0.6)",fontSize:10,textAnchor:"end",dominantBaseline:"middle",fontFamily:"IBM Plex Mono",children:Math.round(x)})},v)),s.jsx("text",{x:-60,y:m/2,fill:"rgba(62,207,255,0.6)",fontSize:11,textAnchor:"middle",transform:`rotate(-90, -60, ${m/2})`,fontFamily:"IBM Plex Mono",children:"CLIENTS"}),s.jsx("line",{x1:f,y1:0,x2:f,y2:m,stroke:"rgba(124,255,178,0.3)",strokeWidth:1}),g.map((x,v)=>s.jsxs("text",{x:f+10,y:b(x),fill:"rgba(124,255,178,0.6)",fontSize:10,textAnchor:"start",dominantBaseline:"middle",fontFamily:"IBM Plex Mono",children:[Math.round(x/1e3),"k‚Ç¨"]},v)),s.jsx("text",{x:f+60,y:m/2,fill:"rgba(124,255,178,0.6)",fontSize:11,textAnchor:"middle",transform:`rotate(90, ${f+60}, ${m/2})`,fontFamily:"IBM Plex Mono",children:"CA PROT√âG√â"}),s.jsx("line",{x1:0,y1:m,x2:f,y2:m,stroke:"rgba(255,255,255,0.2)",strokeWidth:1}),e.map((x,v)=>{const S=v/(e.length-1)*f;return s.jsx("text",{x:S,y:m+20,fill:"rgba(255,255,255,0.4)",fontSize:10,textAnchor:"middle",fontFamily:"IBM Plex Mono",children:x.label},v)}),s.jsx("path",{d:j,fill:"none",stroke:"#3ecfff",strokeWidth:"3",opacity:"0.85"}),s.jsx("path",{d:k,fill:"none",stroke:"#7cffb2",strokeWidth:"3",opacity:"0.9"}),e.map((x,v)=>{const S=v/(e.length-1)*f,A=b(x.protection),R=y(x.creation);return s.jsxs("g",{children:[s.jsx("circle",{cx:S,cy:R,r:o===v?5:3,fill:"#3ecfff",onMouseEnter:()=>r(v),onMouseLeave:()=>r(null),style:{cursor:"pointer"}}),s.jsx("circle",{cx:S,cy:A,r:o===v?6:4,fill:"#7cffb2",onMouseEnter:()=>r(v),onMouseLeave:()=>r(null),style:{cursor:"pointer"}})]},v)})]})}),o!==null&&s.jsxs("div",{className:"absolute bottom-4 left-6 text-xs bg-black/90 px-4 py-3 rounded-lg border border-white/20",children:[s.jsx("div",{className:"font-bold mb-1",children:e[o].label}),s.jsxs("div",{className:"text-[#3ecfff]",children:["Leads: ",e[o].creation]}),s.jsxs("div",{className:"text-[#7cffb2]",children:["CA Prot√©g√©: ",(e[o].protection/1e3).toFixed(0),"k‚Ç¨"]})]})]}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-10",children:[i!==void 0&&s.jsxs("div",{className:"bg-white/[0.04] p-6 rounded-xl border border-white/10",children:[s.jsx("div",{className:"text-xs text-white/40 uppercase mb-1",children:"Cycle commercial"}),s.jsxs("div",{className:"text-4xl font-bold",children:[i," jours"]}),d!==null&&d!==0&&s.jsxs("div",{className:`text-sm mt-1 ${d<0?"text-emerald-400":"text-red-400"}`,children:[d>0?"+":"",d,"% vs avant"]})]}),a!==void 0&&a>0&&s.jsxs("div",{className:"bg-white/[0.04] p-6 rounded-xl border border-white/10",children:[s.jsx("div",{className:"text-xs text-white/40 uppercase mb-1",children:"Temps lib√©r√©"}),s.jsxs("div",{className:"text-4xl font-bold",children:[a,"h"]}),s.jsx("div",{className:"text-white/40 text-sm",children:"Capacit√© commerciale r√©cup√©r√©e"})]}),s.jsxs("div",{className:"bg-white/[0.04] p-6 rounded-xl border border-white/10",children:[s.jsx("div",{className:"text-xs text-white/40 uppercase mb-1",children:"Lecture strat√©gique"}),s.jsx("p",{className:"text-white/80 text-sm leading-relaxed",children:C})]})]}),s.jsx("footer",{className:"border-t border-white/10 pt-6",children:s.jsx("p",{className:"text-sm text-white/70",children:"üëâ Priorit√© : renforcer la protection du CA existant avant d'augmenter l'acquisition."})})]})}function jm({system:e}){var u;const{studies:t,metrics:n,emailLeads:i}=e,a=N.useMemo(()=>{const p=new Date,h=new Date(p.getFullYear(),p.getMonth(),1);return t.filter(f=>{if(!f.signed_at||f.status!=="signed"&&!f.deposit_paid)return!1;const m=new Date(f.signed_at);return m>=h&&m<=p}).reduce((f,m)=>f+(m.total_price||0),0)},[t]),o=14.5,r=11.2,l=((u=n.stats)==null?void 0:u.totalEmailsSent)||0,c=Math.max(10,Math.round(l*.25)),d=N.useMemo(()=>{const p=new Date,h=new Date(p.getFullYear(),p.getMonth(),1),f=[];for(let m=0;m<=6;m++){const y=m/6,b=h.getTime()+(p.getTime()-h.getTime())*y,w=new Date(b),j=t.filter(_=>{if(!_.created_at)return!1;const g=new Date(_.created_at);return g>=h&&g<=w}),k=new Set(j.map(_=>_.email).filter(_=>_)),C=t.filter(_=>{if(!_.signed_at||_.status!=="signed"&&!_.deposit_paid)return!1;const g=new Date(_.signed_at);return g>=h&&g<=w}).reduce((_,g)=>_+(g.total_price||0),0);f.push({label:w.toLocaleDateString("fr-FR",{day:"numeric",month:"short"}),creation:k.size,protection:C})}return f},[t]);return s.jsx("div",{className:"flex flex-col gap-8 py-12 px-6 w-full h-full pb-40",children:s.jsx(wm,{data:d,securedRevenue:a,cycleBefore:o,cycleNow:r,savedHours:c})})}const Nm=({filters:e,onFilterChange:t})=>s.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-6",children:[s.jsx("input",{type:"text",placeholder:"üîç Rechercher un client...",value:e.search,onChange:n=>t({...e,search:n.target.value}),className:"flex-1 min-w-[200px] px-4 py-2 bg-slate-800/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:outline-none"}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsx("button",{onClick:()=>t({...e,views:e.views==="5+"?null:"5+"}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${e.views==="5+"?"bg-orange-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üëÅÔ∏è Vues 5+"}),s.jsx("button",{onClick:()=>t({...e,clicks:e.clicks==="1+"?null:"1+"}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${e.clicks==="1+"?"bg-green-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üñ±Ô∏è Clics 1+"}),s.jsx("button",{onClick:()=>t({...e,status:e.status==="sent"?null:"sent"}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${e.status==="sent"?"bg-blue-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üìß Envoy√©s"}),s.jsx("button",{onClick:()=>t({...e,optout:!e.optout}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${e.optout?"bg-red-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üö´ Opt-out"})]}),(e.search||e.views||e.clicks||e.status||e.optout)&&s.jsx("button",{onClick:()=>t({search:"",views:null,clicks:null,status:null,optout:!1}),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-bold text-sm transition-colors",children:"üîÑ Reset"})]});function Sm(e){const t=Math.floor((new Date().getTime()-new Date(e).getTime())/1e3);return t<60?"√Ä l'instant":t<3600?`Il y a ${Math.floor(t/60)}min`:t<86400?`Il y a ${Math.floor(t/3600)}h`:t<604800?`Il y a ${Math.floor(t/86400)}j`:new Date(e).toLocaleDateString("fr-FR")}function Ws(e){return e.toLocaleString("fr-FR")+" ‚Ç¨"}function km(e){if(!e.last_email_sent)return"Imm√©diat";const t=new Date(e.created_at),n=new Date(e.last_email_sent),a=Math.floor((new Date().getTime()-t.getTime())/864e5);if(a>120)return"Termin√©";const o=a<=60?3:7,r=new Date(n);return r.setDate(r.getDate()+o),r.toLocaleDateString("fr-FR")}const Ha={MUET:{label:"SILENCE",class:"bg-zinc-800/50 text-zinc-400 border border-zinc-700/50",description:"Client inactif"},CAS_LIMITE:{label:"CONTACT EXCESSIF",class:"bg-amber-900/20 text-amber-200/80 border border-amber-800/30",description:"Sur-engagement"},AGIT√â:{label:"AGIT√â",class:"bg-orange-900/20 text-orange-200/80 border border-orange-800/30",description:"Risque annulation"},INT√âRESS√â:{label:"INT√âRESS√â",class:"bg-emerald-900/20 text-emerald-200/80 border border-emerald-800/30",description:"Opportunit√©"},STABLE:{label:"STABLE",class:"bg-zinc-900 text-zinc-500 border border-zinc-800",description:"Sous surveillance"},FATIGUE:{label:"INACTIF",class:"bg-red-900/10 text-red-300 border border-red-900/20",description:"Lead dormant"}},Ko=({study:e,antiAnnulationByStudy:t,postRefusByStudy:n,onSignStudy:i,onCancelStudy:a,onDeleteStudy:o,onMarkDepositPaid:r,onMarkRibSent:l,showActions:c=!0,leads:d=[]})=>{var R,P,L;const u=ar(e),p=Ha[u.state]||Ha.STABLE,h=T=>T&&T.sent&&T.sent.length>0,f=t?t[String(e.id)]||t[String(e.client_id)]:null,m=n?n[String(e.id)]||n[String(e.client_id)]:null,y=(d||[]).find(T=>!!(T.study_id&&T.study_id===e.id||T.client_id&&T.client_id===e.client_id||T.client_email&&e.email&&T.client_email.toLowerCase().trim()===e.email.toLowerCase().trim()&&T.client_email!=="Pas d'email")),b=y?{total_opens:y.total_opens||0,sent:y.last_email_sent?[{sent_at:y.last_email_sent,opened_at:y.last_opened_at}]:[],next:y.next_email_date?{scheduled_for:y.next_email_date}:null}:null;let w=null,j=null;e.status==="signed"?h(f)?(w="anti-annulation",j=f):h(m)&&(w="post-refus",j=m):h(m)?(w="post-refus",j=m):h(f)?(w="anti-annulation",j=f):h(b)&&(w="prospection",j=b),w||(e.status==="signed"?f!=null&&f.next?(w="anti-annulation",j=f):m!=null&&m.next?(w="post-refus",j=m):(w="anti-annulation",j=f):m!=null&&m.next?(w="post-refus",j=m):f!=null&&f.next?(w="anti-annulation",j=f):b!=null&&b.next?(w="prospection",j=b):(w="post-refus",j=m));let k=Math.max(((R=j==null?void 0:j.sent)==null?void 0:R.length)||0,(y==null?void 0:y.email_sequence_step)||0,e.send_count||0);e.views>0&&k===0&&(k=1),(P=e.name)!=null&&P.toUpperCase().includes("GUYOT")&&console.log("üéØ GUYOT SELECTED FLOW:",{flowType:w,sentLength:(L=j==null?void 0:j.sent)==null?void 0:L.length,leadStep:y==null?void 0:y.email_sequence_step,studySendCount:e.send_count,finalStep:k});const C=5,_=j!=null&&j.sent&&j.sent.length>0?j.sent[j.sent.length-1]:null,g=(j==null?void 0:j.next)||null;!w&&(e.views>0||e.last_view)&&(w=e.status==="signed"?"anti-annulation":"post-refus",j={total_opens:e.views||0,sent:e.last_view?[{sent_at:e.last_view,opened_at:e.last_view}]:[],next:null,is_fallback:!0},k=Math.min(5,Math.max(1,Math.floor((e.views||0)/2))));const x=Math.min(100,Math.max(0,e.cancellationRisk||e.dangerScore||0)),v=x>80,S=e.payment_mode==="cash"||e.financing_mode==="cash_payment"||e.financing_mode==="cash",A=w==="anti-annulation"||w==="post-refus"?S?"cash":"financement":"prospection";return s.jsxs("div",{className:"group relative mb-4",children:[s.jsx("div",{className:`absolute -inset-0.5 rounded-2xl bg-gradient-to-r from-blue-500/50 to-indigo-600/50 opacity-0 blur-sm group-hover:opacity-30 transition duration-500 ${v?"from-orange-600/50 to-red-600/50 group-hover:opacity-40":""}`}),s.jsxs("div",{className:"relative backdrop-blur-xl rounded-2xl bg-slate-950/40 border border-white/5 p-6 flex flex-col lg:grid lg:grid-cols-[220px_1fr_200px_120px_auto] lg:items-center gap-6 transition-all hover:bg-slate-900/40 hover:border-white/10 shadow-lg",children:[s.jsxs("div",{className:"flex flex-col gap-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("div",{className:"w-1.5 h-1.5 flex-shrink-0 rounded-full bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.8)]"}),s.jsx(xl,{status:e.status}),e.status==="signed"&&s.jsx(Ke,{className:"w-3.5 h-3.5 text-emerald-400"})]}),s.jsxs("h3",{className:"text-white font-black tracking-tight text-base lg:text-lg uppercase leading-none mb-1",children:[e.name.split(" ")[0],s.jsx("br",{}),s.jsx("span",{className:"text-blue-400",children:e.name.split(" ").slice(1).join(" ")})]}),s.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 font-mono truncate",children:[s.jsx("span",{className:"opacity-60 text-[10px] flex-shrink-0",children:"üìß"}),s.jsx("span",{className:"truncate",children:e.email})]}),S&&s.jsx("div",{className:"flex items-center gap-2 mt-1",children:s.jsxs("span",{className:"px-2 py-0.5 rounded text-[10px] bg-amber-500/10 border-amber-500/20 text-amber-400 font-black uppercase tracking-tighter shadow-[0_0_8px_rgba(251,191,36,0.2)]",children:["CASH ",e.has_deposit?"+ ACOMPTE":""]})}),s.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[s.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-black uppercase border ${p.class}`,children:p.label.replace(/^[^\s]+\s/,"")}),e.contract_secured&&s.jsx("span",{className:"px-2 py-0.5 bg-emerald-500/20 text-emerald-400 border border-emerald-500/30 rounded text-[10px] font-black uppercase flex items-center gap-1",children:"üõ°Ô∏è S√âCURIS√â"}),e.rib_sent&&s.jsx("span",{className:"px-2 py-0.5 bg-blue-500/20 text-blue-400 border border-blue-500/30 rounded text-[10px] font-black uppercase",children:"üìÑ RIB OK"}),s.jsxs("span",{className:"px-2 py-0.5 rounded bg-slate-800/50 border border-white/5 text-[10px] font-bold text-slate-400 font-mono flex items-center gap-1",children:["üóìÔ∏è J+",e.daysSinceSigned||e.diffDays||0]})]})]}),s.jsx("div",{className:"hidden lg:flex flex-col gap-3 px-8 border-x border-white/5 min-h-[100px] justify-center",children:w?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex justify-between items-center text-[10px] text-slate-500 font-black uppercase tracking-[0.2em]",children:[s.jsxs("span",{className:"flex items-center gap-1.5",children:[s.jsx(xi,{className:"w-3 h-3 text-blue-400"}),"Engagement Flow"]}),s.jsxs("span",{className:"bg-blue-500/10 text-blue-400 px-2 py-0.5 rounded-full border border-blue-500/20",children:[e.views||0," VUES"]})]}),s.jsx("div",{className:"h-2 w-full bg-slate-800/50 rounded-full overflow-hidden flex gap-1.5 p-[2px] border border-white/5",children:[1,2,3,4,5].map(T=>s.jsx("div",{className:`h-full flex-1 rounded-sm transition-all duration-700 ${T<=k?"bg-gradient-to-r from-blue-600 to-indigo-500 shadow-[0_0_12px_rgba(59,130,246,0.4)]":"bg-slate-700/50"}`},T))}),s.jsxs("div",{className:"flex justify-between text-[9px] font-bold text-slate-600 tracking-widest uppercase",children:[s.jsx("span",{children:"S√©quence Auto"}),s.jsxs("span",{children:[k,"/",C," Envoy√©s"]})]}),s.jsxs("div",{className:`flex flex-col gap-2 p-3 rounded-lg border mt-1 ${w==="anti-annulation"?"bg-emerald-500/5 border-emerald-500/20 shadow-[0_4px_12px_rgba(16,185,129,0.1)]":w==="post-refus"?"bg-red-500/5 border-red-500/20 shadow-[0_4px_12px_rgba(239,68,68,0.1)]":"bg-blue-500/5 border-blue-500/20 shadow-[0_4px_12px_rgba(59,130,246,0.1)]"}`,children:[s.jsx("div",{className:`flex items-center gap-2 text-[10px] font-black uppercase tracking-widest ${w==="anti-annulation"?"text-emerald-400":w==="post-refus"?"text-red-400":"text-blue-400"}`,children:w==="anti-annulation"?`üõ°Ô∏è ANTI-ANNULATION ${A.toUpperCase()}`:w==="post-refus"?`‚ùå POST-REFUS ${A.toUpperCase()}`:"üöÄ PROSPECTION"}),_?s.jsxs("div",{className:"flex flex-col gap-1.5",children:[s.jsxs("div",{className:"flex justify-between items-center text-[9px]",children:[s.jsx("span",{className:"text-slate-600 font-bold",children:"Dernier :"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:`font-mono font-bold ${w==="anti-annulation"?"text-emerald-400":w==="post-refus"?"text-red-400":"text-blue-400"}`,children:["j",[0,1,3,7,14][k-1]||0," ",A]}),s.jsxs("span",{className:"text-slate-500 font-mono",children:["(",new Date(_.sent_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"}),")"]})]})]}),s.jsxs("div",{className:"flex justify-between items-center text-[9px]",children:[s.jsx("span",{className:"text-slate-700 font-bold",children:"Ouvertures :"}),s.jsxs("div",{className:"flex items-center gap-2",children:[_.opened_at&&s.jsxs("span",{className:"text-[8px] text-slate-500 font-mono",children:["Lu le: ",new Date(_.opened_at).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})," √† ",new Date(_.opened_at).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})]}),s.jsxs("span",{className:`font-mono font-bold px-1.5 py-0.5 rounded ${j.total_opens>0?w==="anti-annulation"?"bg-emerald-500/10 text-emerald-400":w==="post-refus"?"bg-red-500/10 text-red-400":"bg-blue-500/10 text-blue-400":"bg-slate-800 text-slate-600"}`,children:[j.total_opens||0,"x"]})]})]})]}):s.jsx("div",{className:"text-[10px] text-slate-500 italic py-1",children:"‚åõ En attente du premier envoi..."}),k<C&&s.jsx("div",{className:"flex flex-col gap-1.5 border-t border-white/5 pt-2 mt-1",children:s.jsxs("div",{className:"flex justify-between items-center text-[9px]",children:[s.jsx("span",{className:"text-slate-600 font-bold",children:"Prochain :"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs("span",{className:"text-orange-400 font-mono font-bold",children:["j",[0,1,3,7,14][k]||"?"," ",A]}),g?s.jsxs("span",{className:"text-orange-400/60 font-mono",children:["‚Üí ",new Date(g.scheduled_for).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})]}):s.jsx("span",{className:"text-slate-500/50 font-mono text-[8px] uppercase tracking-wider border border-slate-700/30 px-1.5 py-0.5 rounded",children:"Non planifi√©"})]})]})}),k>=C&&s.jsx("div",{className:`flex items-center justify-center gap-1 rounded-md px-2 py-1.5 border mt-1 font-black text-[8px] uppercase tracking-widest ${w==="anti-annulation"?"bg-emerald-500/10 border-emerald-500/30 text-emerald-400":w==="post-refus"?"bg-red-500/10 border-red-500/30 text-red-400":"bg-blue-500/10 border-blue-500/30 text-blue-400"}`,children:"‚úÖ S√âQUENCE TERMIN√âE"})]})]}):s.jsxs("div",{className:"text-center py-4",children:[s.jsx("div",{className:"text-[10px] text-slate-600 font-black uppercase tracking-widest mb-1 opacity-50",children:"Engagement Flow"}),s.jsx("div",{className:"text-xs text-slate-500 italic",children:"Aucune s√©quence active d√©tect√©e"})]})}),s.jsxs("div",{className:"flex flex-col items-end justify-center h-full min-w-[180px] gap-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[s.jsx("span",{className:"text-[10px] text-slate-500 font-bold uppercase tracking-[0.2em]",children:"VALEUR DOSSIER"}),e.financing_mode&&s.jsx("span",{className:`text-[8px] px-1.5 py-0.5 rounded-md border font-black tracking-widest ${e.financing_mode==="cash_payment"?"bg-indigo-500/10 border-indigo-500/30 text-indigo-400":"bg-blue-500/10 border-blue-500/30 text-blue-400"}`,children:e.financing_mode==="cash_payment"?"COMPTANT":"FINANC√â"})]}),s.jsx("div",{className:"text-3xl font-black text-white tracking-tighter mb-1 select-none",children:Ws(e.total_price)}),s.jsxs("div",{className:"flex flex-col items-end gap-1.5 w-full",children:[e.cash_apport>0&&s.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-yellow-500/5 border border-yellow-500/10 w-full justify-end",children:[s.jsx(vl,{className:"w-3 h-3 text-yellow-500/70"}),s.jsxs("span",{className:"text-[9px] font-black text-yellow-500/90 font-mono tracking-tight uppercase",children:["APPORT: ",Ws(e.cash_apport)]})]}),e.status==="signed"&&e.has_deposit&&s.jsx("div",{className:`flex items-center gap-2 px-3 py-1.5 rounded-lg border text-[9px] font-black uppercase w-full justify-end
                ${e.deposit_paid?"bg-emerald-500/5 border-emerald-500/10 text-emerald-400/80":"bg-orange-500/5 border-orange-500/10 text-orange-400/80"}`,children:e.deposit_paid?"‚úÖ R√®glement Acompte":`‚è≥ Acompte: ${Ws(e.deposit_amount||1500)}`})]})]}),s.jsxs("div",{className:"flex flex-col items-center justify-center gap-4 px-8 border-l border-white/5 h-full min-w-[160px]",children:[s.jsxs("div",{className:"relative w-16 h-16 flex-shrink-0 group/gauge",children:[s.jsxs("svg",{className:"w-full h-full -rotate-90 transform",viewBox:"0 0 36 36",children:[s.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",className:"stroke-slate-800/60",strokeWidth:"2"}),s.jsx("circle",{cx:"18",cy:"18",r:"16",fill:"none",className:`${v?"stroke-orange-500":"stroke-blue-500"} transition-all duration-1000 ease-out`,strokeWidth:"2",strokeDasharray:`${x}, 100`,strokeLinecap:"round",stroke:"currentColor"})]}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsxs("span",{className:"text-sm font-black text-white font-mono tracking-tighter",children:[x,"%"]})})]}),s.jsxs("div",{className:"flex flex-col items-center gap-1.5",children:[s.jsx("span",{className:"text-[8px] text-slate-600 font-black uppercase tracking-[0.3em]",children:"RISQUE"}),s.jsx("div",{className:`px-4 py-1 rounded-lg border ${p.class} uppercase text-[10px] font-black tracking-[0.15em] shadow-lg whitespace-nowrap`,children:p.label.replace(/^[^\s]+\s/,"")})]})]}),c&&s.jsxs("div",{className:"flex flex-row lg:flex-col gap-2 border-l border-white/5 pl-4 ml-4",children:[s.jsx("button",{onClick:()=>{const T=typeof window<"u"?window.location.origin:"";T?window.open(`${T}/guest/${e.id}`,"_blank"):console.error("‚ùå Impossible d'ouvrir l'√©tude : URL de base introuvable")},className:"p-2.5 rounded-xl bg-white/5 border border-white/10 text-slate-400 hover:text-white hover:bg-white/10 transition-all active:scale-95",title:"Voir Document",children:s.jsx(xi,{className:"w-4 h-4"})}),s.jsxs("button",{onClick:()=>{e.phone?window.location.href=`tel:${e.phone}`:alert("Num√©ro de t√©l√©phone non renseign√©")},className:"flex items-center gap-2 px-3 py-2 rounded-xl bg-blue-600/20 border border-blue-500/30 text-blue-400 hover:bg-blue-600/30 hover:text-blue-300 transition-all active:scale-95 shadow-lg shadow-blue-900/20",title:"Appeler Client",children:[s.jsx("span",{className:"text-sm",children:"üìû"}),s.jsx("span",{className:"text-[10px] font-black uppercase tracking-tight",children:"Appeler"})]}),e.status!=="signed"&&e.status!=="cancelled"&&i&&s.jsxs("button",{onClick:()=>i(e.id,e.name),className:"group/sign relative p-2.5 rounded-xl bg-gradient-to-br from-emerald-600/20 to-emerald-500/10 border border-emerald-500/40 text-emerald-400 hover:from-emerald-600/30 hover:to-emerald-500/20 hover:text-emerald-300 hover:border-emerald-400/60 transition-all active:scale-95 shadow-lg shadow-emerald-900/30 hover:shadow-emerald-900/50",title:"Signer le Dossier",children:[s.jsx("div",{className:"absolute inset-0 rounded-xl bg-emerald-500/20 blur-md opacity-0 group-hover/sign:opacity-100 transition-opacity duration-300"}),s.jsx("span",{className:"relative text-base",children:"‚úçÔ∏è"})]}),e.status!=="cancelled"&&a&&s.jsxs("button",{onClick:()=>a(e.id,e.name),className:"group/cancel relative p-2.5 rounded-xl bg-gradient-to-br from-red-600/20 to-red-500/10 border border-red-500/40 text-red-400 hover:from-red-600/30 hover:to-red-500/20 hover:text-red-300 hover:border-red-400/60 transition-all active:scale-95 shadow-lg shadow-red-900/30 hover:shadow-red-900/50",title:"Annuler l'√âtude",children:[s.jsx("div",{className:"absolute inset-0 rounded-xl bg-red-500/20 blur-md opacity-0 group-hover/cancel:opacity-100 transition-opacity duration-300"}),s.jsx("span",{className:"relative text-base",children:"‚ùå"})]}),e.status==="signed"&&e.has_deposit&&!e.deposit_paid&&r&&s.jsxs("button",{onClick:()=>r(e.id,e.name),className:"group/deposit relative p-2.5 rounded-xl bg-gradient-to-br from-green-600/20 to-green-500/10 border border-green-500/40 text-green-400 hover:from-green-600/30 hover:to-green-500/20 hover:text-green-300 hover:border-green-400/60 transition-all active:scale-95 shadow-lg shadow-green-900/30 hover:shadow-green-900/50",title:"Marquer Acompte Pay√©",children:[s.jsx("div",{className:"absolute inset-0 rounded-xl bg-green-500/20 blur-md opacity-0 group-hover/deposit:opacity-100 transition-opacity duration-300"}),s.jsx("span",{className:"relative text-base",children:"üí∞"})]})]})]})]})},_m=({studies:e,filters:t,emailFlowByClient:n,antiAnnulationByStudy:i,postRefusByStudy:a,leads:o,onSignStudy:r,onCancelStudy:l,onDeleteStudy:c})=>{let d=e.filter(u=>{var p,h;if(u.status==="signed")return!1;if(t.search){const f=t.search.toLowerCase(),m=((p=u.name)==null?void 0:p.toLowerCase())||"",y=((h=u.email)==null?void 0:h.toLowerCase())||"";if(!m.includes(f)&&!y.includes(f))return!1}return!(t.views==="5+"&&u.views<5||t.clicks==="1+"&&u.clicks<1||t.status&&u.status!==t.status||t.optout&&!u.email_optout)});return d=d.sort((u,p)=>{const h={hot:0,warm:1,cold:2,signed:3},f=ji(u),m=ji(p);return h[f]-h[m]}),s.jsx("div",{className:"mb-8",children:d.length===0?s.jsxs("div",{className:"p-8 bg-slate-800/30 border border-slate-700/50 rounded-2xl text-center",children:[s.jsx("div",{className:"text-4xl mb-3",children:"üîç"}),s.jsx("div",{className:"text-lg font-bold text-slate-400",children:"Aucun dossier trouv√©"}),s.jsx("div",{className:"text-sm text-slate-500 mt-2",children:"Ajustez vos filtres ou crit√®res de recherche"})]}):s.jsx("div",{className:"space-y-3",children:d.map(u=>s.jsx(Ko,{study:u,antiAnnulationByStudy:i,postRefusByStudy:a,leads:o,onSignStudy:r,onCancelStudy:l,onDeleteStudy:c},u.id))})})},Cm=({studies:e,metrics:t,filters:n,antiAnnulationByStudy:i,postRefusByStudy:a,leads:o,onSignStudy:r,onMarkDepositPaid:l,onMarkRibSent:c,onCancelStudy:d,onDeleteStudy:u})=>{const f=t.signed.filter(y=>{if(n.search){const b=n.search.toLowerCase();if(!y.name.toLowerCase().includes(b)&&!y.email.toLowerCase().includes(b))return!1}return!(n.views==="5+"&&(y.views||0)<5||n.clicks==="1+"&&(y.clicks||0)<1||n.optout&&!y.email_optout)}).sort((y,b)=>{var k,C;if((k=y.name)!=null&&k.toUpperCase().includes("GUYOT"))return-1;if((C=b.name)!=null&&C.toUpperCase().includes("GUYOT"))return 1;const w=y.daysLate||0;return(b.daysLate||0)-w}),m=f.filter(y=>y.requiresDeposit&&!y.deposit_paid&&y.financing_mode!=="full_financing").length;return s.jsxs("div",{id:"late-deposits-section",className:"mb-8",children:[s.jsx("div",{className:"flex items-center justify-between mb-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-3xl",children:"‚úÖ"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white",children:"AXE A ‚Äî DOSSIERS SIGN√âS (HISTORIQUE)"}),s.jsxs("div",{className:"text-sm text-slate-400",children:[f.length," dossiers au total ‚Ä¢"," ",s.jsxs("span",{className:`${m>0?"text-red-400":"text-emerald-400"} font-bold`,children:[m," en attente d'acompte"]})]})]})]})}),f.length===0?s.jsxs("div",{className:"p-8 bg-slate-800/30 border border-slate-700/50 rounded-2xl text-center",children:[s.jsx("div",{className:"text-4xl mb-3",children:"üéâ"}),s.jsx("div",{className:"text-lg font-bold text-emerald-400",children:"Tous les acomptes sont √† jour !"}),s.jsx("div",{className:"text-sm text-slate-500 mt-2",children:"Aucun retard hors War Room"})]}):s.jsx("div",{className:"space-y-3",children:f.map(y=>s.jsx(Ko,{study:y,antiAnnulationByStudy:i,postRefusByStudy:a,leads:o,onMarkDepositPaid:l,onMarkRibSent:c,onCancelStudy:d,onDeleteStudy:u},y.id))})]})},pt={clicked:"#3DDC97",opened:"#7CA3BA",sentNeg:"#2A3142"},Tm=({data:e,width:t,height:n})=>{const{showTooltip:i,hideTooltip:a,tooltipData:o,tooltipLeft:r,tooltipTop:l}=Ya(),c={top:15,bottom:25,left:10,right:10},d=t-c.left-c.right,u=n-c.top-c.bottom,p=e.map(m=>({date:m.date,originalTotal:m.count,originalOpened:m.opened||0,originalClicked:m.clicked||0})),h=vn({range:[0,d],round:!0,domain:p.map(m=>m.date),padding:.4}),f=Me({range:[u,0],round:!0,domain:[0,Math.max(...e.flatMap(m=>[m.count,m.opened||0,m.clicked||0]))||10]});return s.jsxs("div",{className:"relative",children:[s.jsx("svg",{width:t,height:n,children:s.jsxs(ie,{top:c.top,left:c.left,children:[p.map(m=>{const y=h.bandwidth(),b=h(m.date)||0,w=1,j=(y-w*2)/3,k=u-f(m.originalTotal),C=u-f(m.originalOpened),_=u-f(m.originalClicked);return s.jsxs(ie,{left:b,children:[s.jsx("rect",{x:0,y:u-k,width:j,height:k,fill:pt.sentNeg,rx:2,opacity:.8,onMouseMove:g=>{const x=ss(g)||{x:0,y:0};i({tooltipData:m,tooltipLeft:x.x,tooltipTop:x.y})},onMouseLeave:()=>a(),style:{cursor:"pointer"}}),s.jsx("rect",{x:j+w,y:u-C,width:j,height:C,fill:pt.opened,rx:2,opacity:.9,style:{filter:"drop-shadow(0 0 3px rgba(124,163,186,0.3))",cursor:"pointer"},onMouseMove:g=>{const x=ss(g)||{x:0,y:0};i({tooltipData:m,tooltipLeft:x.x,tooltipTop:x.y})},onMouseLeave:()=>a()}),s.jsx("rect",{x:(j+w)*2,y:u-_,width:j,height:_,fill:pt.clicked,rx:2,opacity:1,style:{filter:"drop-shadow(0 0 4px rgba(61,220,151,0.4))",cursor:"pointer"},onMouseMove:g=>{const x=ss(g)||{x:0,y:0};i({tooltipData:m,tooltipLeft:x.x,tooltipTop:x.y})},onMouseLeave:()=>a()})]},`bar-group-${m.date}`)}),s.jsx(mt,{top:u,scale:h,stroke:"rgba(255,255,255,0.1)",tickStroke:"rgba(255,255,255,0.1)",tickLabelProps:()=>({fill:"#ffffff",fontSize:10,opacity:.5,textAnchor:"middle",fontFamily:"sans-serif",fontWeight:500}),tickFormat:m=>new Date(m).toLocaleDateString("fr-FR",{day:"numeric",month:"numeric"})})]})}),o&&s.jsx(Xa,{top:l,left:r,style:{...Za,background:"rgba(15, 23, 42, 0.95)",border:"1px solid rgba(255, 255, 255, 0.1)",padding:"12px",color:"white",borderRadius:"12px",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.5)",fontSize:"11px",backdropFilter:"blur(8px)",pointerEvents:"none"},children:s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("div",{className:"font-bold text-slate-400 uppercase tracking-widest text-[9px] mb-1",children:new Date(o.date).toLocaleDateString("fr-FR",{day:"numeric",month:"long"})}),s.jsxs("div",{className:"flex justify-between gap-4",children:[s.jsx("span",{className:"text-slate-500 font-bold uppercase",children:"Emails Envoy√©s"}),s.jsx("span",{className:"font-mono text-white",children:o.originalTotal})]}),s.jsxs("div",{className:"flex justify-between gap-4",children:[s.jsx("span",{className:"text-indigo-400 font-bold uppercase",children:"Emails Ouverts"}),s.jsx("span",{className:"font-mono text-white",children:o.originalOpened})]}),s.jsxs("div",{className:"flex justify-between gap-4",children:[s.jsx("span",{className:"text-[#3DDC97] font-bold uppercase",children:"Emails Cliqu√©s"}),s.jsx("span",{className:"font-mono text-white font-bold",children:o.originalClicked})]})]})},Math.random())]})},Am=({data:e})=>!e||e.length===0?null:s.jsxs("div",{className:"w-full h-48 rounded-2xl p-6 border flex flex-col justify-between backdrop-blur-xl",style:{background:"rgba(255,255,255,0.03)",borderColor:"rgba(255,255,255,0.08)",boxShadow:"0 8px 32px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.03)"},children:[s.jsxs("div",{className:"flex justify-between items-start mb-2",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-[11px] uppercase tracking-widest text-white/50 font-black mb-1",children:"Pression d'envoi (14 jours)"}),s.jsx("div",{className:"flex items-center gap-3",children:s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("div",{className:"w-2 h-2 rounded-full bg-indigo-500"}),s.jsx("span",{className:"text-[10px] text-indigo-200 font-bold uppercase",children:"Activit√© Totale"})]})})]}),s.jsxs("div",{className:"flex items-center gap-4 bg-white/5 px-3 py-1.5 rounded-lg border border-white/5",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{background:pt.sentNeg,opacity:.8}}),s.jsx("span",{className:"text-[9px] text-white/40 font-bold uppercase tracking-wider",children:"Envoy√©s"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{background:pt.opened,opacity:.9}}),s.jsx("span",{className:"text-[9px] text-white/50 font-bold uppercase tracking-wider",children:"Ouverts"})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2.5 h-2.5 rounded-sm",style:{background:pt.clicked,opacity:.95}}),s.jsx("span",{className:"text-[9px] text-[#3DDC97] font-bold uppercase tracking-wider",children:"Cliqu√©s"})]})]})]}),s.jsx("div",{className:"w-full h-32 relative",children:s.jsx(xt,{children:({width:t,height:n})=>s.jsx(Tm,{data:e,width:t,height:n})})})]}),Em=({leads:e,trafficData:t,globalFilters:n,onSetOptOut:i,onDeleteLead:a})=>{const[o,r]=N.useState({search:"",today:!1,optedOut:!1});let l=e.filter(c=>{const d=((n==null?void 0:n.search)||o.search).toLowerCase();if(d&&!c.client_name.toLowerCase().includes(d)&&!c.client_email.toLowerCase().includes(d))return!1;if(o.today&&c.next_email_date){const u=new Date().toDateString(),p=new Date(c.next_email_date).toDateString();if(u!==p)return!1}return!(o.optedOut&&!c.opted_out)});return l=l.sort((c,d)=>c.next_email_date?d.next_email_date?new Date(c.next_email_date).getTime()-new Date(d.next_email_date).getTime():-1:1),s.jsxs("div",{className:"mb-8",children:[s.jsx("div",{className:"flex items-center justify-between mb-6",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-3xl",children:"üìß"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white",children:"AXE C ‚Äî LEADS EMAIL (AUTOMATISATION)"}),s.jsxs("div",{className:"text-sm text-slate-400",children:[l.length," lead",l.length>1?"s":""," en nurturing"]})]})]})}),s.jsx("div",{className:"mb-8",children:s.jsx(Am,{data:t})}),s.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-6",children:[s.jsx("input",{type:"text",placeholder:"üîç Rechercher un lead...",value:o.search,onChange:c=>r({...o,search:c.target.value}),className:"flex-1 min-w-[200px] px-4 py-2 bg-slate-800/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:border-blue-500 focus:outline-none"}),s.jsx("button",{onClick:()=>r({...o,today:!o.today}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${o.today?"bg-green-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üìÖ Aujourd'hui"}),s.jsx("button",{onClick:()=>r({...o,optedOut:!o.optedOut}),className:`px-4 py-2 rounded-lg font-bold text-sm transition-all ${o.optedOut?"bg-red-600 text-white shadow-lg":"bg-slate-800/50 text-slate-400 hover:bg-slate-700 border border-slate-700/30"}`,children:"üö´ D√©sabonn√©s"}),(o.search||o.today||o.optedOut)&&s.jsx("button",{onClick:()=>r({search:"",today:!1,optedOut:!1}),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-bold text-sm transition-colors",children:"üîÑ Reset"})]}),l.length===0?s.jsxs("div",{className:"p-8 bg-slate-800/30 border border-slate-700/50 rounded-2xl text-center",children:[s.jsx("div",{className:"text-4xl mb-3",children:"üîç"}),s.jsx("div",{className:"text-lg font-bold text-slate-400",children:"Aucun lead trouv√©"})]}):s.jsx("div",{className:"space-y-3",children:l.map(c=>{const d=km(c),u=c.next_email_date&&new Date(c.next_email_date).toDateString()===new Date().toDateString();return s.jsx("div",{className:`rounded-xl p-5 border-2 transition-all ${c.opted_out?"bg-red-500/10 border-red-500/50":u?"bg-green-500/10 border-green-500/50":"bg-slate-800/50 border-slate-700/50 hover:bg-slate-800/70"}`,children:s.jsxs("div",{className:"grid grid-cols-[2fr_minmax(180px,1.2fr)_1.2fr_auto] gap-4 items-center",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"mb-3",children:[s.jsx("div",{className:"flex items-center gap-3 mb-1",children:s.jsx("div",{className:"text-2xl font-black text-white uppercase tracking-tight leading-none",children:c.client_name})}),s.jsx("div",{className:"text-sm text-slate-400 font-medium ml-0.5",children:c.client_email})]}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.jsxs("span",{className:"px-2 py-0.5 bg-blue-900/40 border border-blue-500/30 text-blue-300 rounded text-[10px] font-bold uppercase flex items-center gap-1",children:[s.jsx("span",{children:"üîÑ"})," √âTAPE ",c.email_sequence_step]}),c.opted_out&&s.jsx("span",{className:"px-2 py-0.5 bg-red-500/20 text-red-400 border border-red-500/30 rounded text-[10px] font-bold uppercase",children:"üö´ D√âSABONN√â"})]})]}),s.jsx("div",{children:s.jsxs("div",{className:"pl-4 border-l border-white/5",children:[s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1",children:"Engagement"}),s.jsxs("div",{className:"flex items-end gap-3 mb-2",children:[s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-2xl font-black text-white leading-none",children:c.total_opens}),s.jsx("span",{className:"text-[10px] text-slate-500 uppercase font-bold",children:"Ouvertures"})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-2xl font-black text-white leading-none",children:c.total_clicks}),s.jsx("span",{className:"text-[10px] text-slate-500 uppercase font-bold",children:"Clics"})]})]})]})}),s.jsx("div",{children:s.jsxs("div",{className:"pl-4 border-l border-white/5 space-y-2",children:[s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("div",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider",children:"Prochaine relance"}),(()=>{let p=!1;if(d!=="Imm√©diat"&&d!=="Termin√©"){const[h,f,m]=d.split("/");if(h&&f&&m){const y=new Date(parseInt(m),parseInt(f)-1,parseInt(h)),b=new Date;b.setHours(0,0,0,0),y<b&&(p=!0)}}return s.jsx("div",{className:`text-sm font-bold ${p?"text-red-400 animate-pulse":d==="Imm√©diat"||u?"text-green-400":"text-white"}`,children:p?`üî• RETARD (${d})`:d==="Imm√©diat"?"üî• Imm√©diat":d})})()]}),c.last_email_sent?s.jsxs("div",{className:"text-xs font-bold text-slate-400 flex items-center gap-1.5 mt-1",children:[s.jsx("span",{children:"üìß"})," Email envoy√© le"," ",new Date(c.last_email_sent).toLocaleDateString("fr-FR")]}):s.jsx("div",{className:"text-[10px] font-medium text-slate-600 italic mt-1",children:"üí§ Aucun envoi"})]})}),s.jsxs("div",{className:"flex flex-col gap-2 pl-4 border-l border-transparent",children:[!c.opted_out&&s.jsx("button",{onClick:()=>{confirm(`D√©sabonner ${c.client_name} ?`)&&i(c.client_email)},className:"w-full h-10 bg-red-600/20 hover:bg-red-600 text-red-500 hover:text-white border border-red-500/30 rounded-lg font-bold text-xs uppercase tracking-wide transition-all flex items-center justify-center gap-2",children:"üö´ Opt-out"}),s.jsx("button",{onClick:()=>{confirm(`Supprimer d√©finitivement ${c.client_name} ?`)&&a(c.client_id,c.client_email,c.client_name)},className:"w-full h-9 bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white border border-slate-700 rounded-lg font-bold text-[10px] uppercase tracking-wide transition-all flex items-center justify-center gap-2",children:"üóëÔ∏è Supprimer"})]})]})},c.id)})})]})},Dm=({system:e})=>{const{studies:t,metrics:n,emailLeads:i,trafficData:a,antiAnnulationByStudy:o,postRefusByStudy:r,emailFlowByClient:l,actions:{signStudy:c,cancelStudy:d,deleteStudy:u,markDepositPaid:p,markRibSent:h,setOptOut:f,deleteLeadPermanently:m}}=e,[y,b]=N.useState({search:"",views:null,clicks:null,status:null,optout:!1});return s.jsxs("div",{className:"space-y-12",children:[s.jsx("div",{className:"flex items-center justify-between mb-8",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-3xl",children:"üóÑÔ∏è"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white uppercase tracking-wider",children:"Registres & Data"}),s.jsx("div",{className:"text-sm text-emerald-400 font-medium",children:"Historique complet et gestion du pipeline"})]})]})}),s.jsx(Nm,{filters:y,onFilterChange:b}),s.jsx(Cm,{studies:t,metrics:n,filters:y,antiAnnulationByStudy:o,postRefusByStudy:r,leads:i,onSignStudy:c,onMarkDepositPaid:p,onMarkRibSent:h,onCancelStudy:d,onDeleteStudy:u}),s.jsxs("div",{className:"mt-16",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("span",{className:"text-3xl",children:"üöÄ"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white",children:"AXE B ‚Äî PIPELINE (WARM & HOT)"}),s.jsx("div",{className:"text-sm text-slate-400",children:"Focus: Conversion & Momentum"})]})]}),s.jsx(_m,{studies:t,filters:y,emailFlowByClient:l,antiAnnulationByStudy:o,postRefusByStudy:r,leads:i,onSignStudy:c,onCancelStudy:d,onDeleteStudy:u})]}),s.jsx("div",{className:"mt-16",children:s.jsx(Em,{leads:i.filter(w=>!t.some(j=>j.client_id===w.client_id)),trafficData:a,globalFilters:y,onSetOptOut:f,onDeleteLead:m})})]})},Mm=({logs:e,zenMode:t})=>{if(t)return null;const[n,i]=N.useState(!1),a=n?e:e.slice(0,10);return s.jsxs("div",{className:"mb-8",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-3xl",children:"üìú"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white",children:"LOGS DE D√âCISIONS"}),s.jsxs("div",{className:"text-sm text-slate-400",children:[e.length," action",e.length>1?"s":""," enregistr√©e",e.length>1?"s":""]})]})]}),e.length>10&&s.jsx("button",{onClick:()=>i(!n),className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-bold text-sm transition-colors",children:n?"‚¨ÜÔ∏è R√©duire":`‚¨áÔ∏è Voir tous (${e.length})`})]}),e.length===0?s.jsxs("div",{className:"p-8 bg-slate-800/30 border border-slate-700/50 rounded-2xl text-center",children:[s.jsx("div",{className:"text-4xl mb-3",children:"üìù"}),s.jsx("div",{className:"text-lg font-bold text-slate-400",children:"Aucune action enregistr√©e"}),s.jsx("div",{className:"text-sm text-slate-500 mt-2",children:"Les d√©cisions appara√Ætront ici"})]}):s.jsx("div",{className:"space-y-2",children:a.map(o=>{const r=new Date().getTime()-new Date(o.created_at).getTime()<36e5;return s.jsx("div",{className:`p-4 rounded-xl border transition-all ${r?"glass-panel bg-blue-500/10 border-blue-500/30 shadow-[0_0_15px_rgba(59,130,246,0.1)]":"glass-panel border-white/5 hover:border-white/10"}`,children:s.jsx("div",{className:"flex items-start justify-between gap-4",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("span",{className:"text-lg font-bold text-white",children:o.client_name}),s.jsx("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-400 border border-blue-500/30 rounded text-xs font-bold",children:o.action_performed})]}),s.jsx("p",{className:"text-sm text-slate-400 mb-1",children:o.justification}),s.jsx("div",{className:"text-xs text-slate-500",children:Sm(o.created_at)})]})})},o.id)})})]})},Rm=({system:e})=>{const{logs:t,zenMode:n}=e;return s.jsxs("div",{className:"space-y-12",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("span",{className:"text-3xl",children:"‚öôÔ∏è"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-black text-white uppercase tracking-wider",children:"Syst√®me & Logs"}),s.jsx("div",{className:"text-sm text-slate-400 font-medium",children:"Diagnostic, activit√©s en temps r√©el et √©tat du Brain"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[s.jsx("div",{className:"lg:col-span-2",children:s.jsx(Mm,{logs:t,zenMode:n})}),s.jsx("div",{className:"space-y-6",children:s.jsxs("div",{className:"glass-panel p-6 rounded-2xl border border-white/5",children:[s.jsx("h3",{className:"text-blue-400 font-bold mb-4 uppercase text-xs tracking-widest",children:"√âtat du Cerveau"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-slate-400",children:"Version Architecture"}),s.jsx("span",{className:"text-white font-mono",children:"v2.0 (Cockpit)"})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-slate-400",children:"Mode Synchronisation"}),s.jsx("span",{className:"text-emerald-400 font-mono",children:"Real-time"})]}),s.jsxs("div",{className:"flex justify-between items-center text-sm",children:[s.jsx("span",{className:"text-slate-400",children:"Latence Brain"}),s.jsx("span",{className:"text-white font-mono",children:"12ms"})]})]})]})})]})]})},it=({active:e,onClick:t,icon:n,label:i})=>s.jsxs("button",{onClick:t,className:`
      flex items-center gap-2 px-3 py-2 rounded-lg text-xs font-bold uppercase tracking-wider transition-all
      ${e?"bg-blue-600 text-white shadow-lg shadow-blue-500/25":"text-slate-400 hover:text-white hover:bg-white/5"}
    `,children:[s.jsx("span",{children:n}),s.jsx("span",{className:"hidden md:inline",children:i})]}),Pm=({zenMode:e,priorityMode:t,onToggleZenMode:n,onTogglePriorityMode:i,onRefresh:a,lastRefresh:o,systemStatus:r="normal",totalStudies:l=0,totalClients:c=0,signedClients:d=0,unsubscribedCount:u=0,unsubscribeRate:p=0,activeSection:h,setActiveSection:f,globalDateFilter:m="current_month",onSetDateFilter:y})=>{const b=c>0?Math.round(d/c*100):0,w={normal:"bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]",active:"bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]",warning:"bg-orange-500 shadow-[0_0_8px_rgba(245,158,11,0.5)] animate-pulse",critical:"bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.5)] animate-ping"},j=gl();return s.jsx("header",{className:"fixed top-2 left-2 right-2 z-50",children:s.jsxs("div",{className:"glass-panel rounded-2xl px-2 md:px-4 py-2 border border-white/10 shadow-2xl relative overflow-visible min-h-16 h-auto flex flex-wrap xl:grid xl:grid-cols-[1.2fr_auto_1fr] items-center gap-2 md:gap-4 justify-between",children:[s.jsx("div",{className:"absolute top-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-blue-500/30 to-transparent"}),s.jsxs("div",{className:"flex items-center gap-4 overflow-hidden",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-shrink-0",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/20 ring-1 ring-white/10",children:s.jsx("span",{className:"text-xl",children:"‚ö°"})}),s.jsxs("div",{className:"hidden xl:block",children:[s.jsxs("h1",{className:"text-base font-black text-white tracking-widest leading-none",children:["AUTOPILOTE ",s.jsx("span",{className:"text-blue-400",children:"SOLAIRE"})]}),s.jsxs("div",{className:"text-[9px] text-zinc-500 font-bold uppercase tracking-tight mt-1 truncate",children:["Clients: ",c," ",s.jsx("span",{className:"mx-0.5 opacity-30",children:"‚Ä¢"})," Dossiers: ",l]})]})]}),s.jsxs("div",{className:"hidden lg:flex items-center gap-3 pl-4 border-l border-white/5 overflow-hidden whitespace-nowrap",children:[s.jsx("div",{className:"flex flex-col",children:s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsxs("span",{className:"text-sm font-black text-white",children:[b,"%"]}),s.jsx("div",{className:"w-8 h-1 bg-white/5 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-emerald-500",style:{width:`${b}%`}})})]})}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[9px] text-emerald-500/70 font-black uppercase leading-none",children:"Sign√©s"}),s.jsx("span",{className:"text-sm font-black text-emerald-400",children:d})]}),s.jsxs("div",{className:"flex flex-col",children:[s.jsx("span",{className:"text-[9px] text-red-500/70 font-black uppercase leading-none",children:"D√©sab."}),s.jsxs("div",{className:"flex items-baseline gap-1",children:[s.jsx("span",{className:"text-sm font-black text-red-400",children:u}),s.jsxs("span",{className:"text-[8px] text-red-500/40 font-bold",children:[p.toFixed(0),"%"]})]})]})]})]}),s.jsx("div",{className:"flex justify-center px-0 md:px-2 overflow-x-auto no-scrollbar",children:s.jsxs("div",{className:"flex items-center gap-1 bg-black/40 p-1 rounded-xl border border-white/5 shadow-inner backdrop-blur-md",children:[s.jsx(it,{active:h==="cockpit"||h==="dashboard",onClick:()=>f("cockpit"),icon:"üõ∞Ô∏è",label:"Cockpit"}),s.jsx(it,{active:h==="war_room",onClick:()=>f("war_room"),icon:"‚öîÔ∏è",label:"War Room"}),s.jsx(it,{active:h==="pilotage",onClick:()=>f("pilotage"),icon:"üß≠",label:"Pilotage"}),s.jsx(it,{active:h==="sales",onClick:()=>f("sales"),icon:"üìà",label:"Vente"}),s.jsx(it,{active:h==="roi",onClick:()=>f("roi"),icon:"üíé",label:"ROI"}),s.jsx(it,{active:h==="registry",onClick:()=>f("registry"),icon:"üóÇÔ∏è",label:"Registre"})]})}),s.jsx("div",{className:"h-4 w-px bg-white/10 mx-1"}),s.jsxs("div",{className:"flex items-center justify-end gap-2",children:[o&&s.jsxs("div",{className:"hidden min-[1600px]:flex items-center gap-2 px-2 py-1 rounded-lg bg-black/20 border border-white/5 whitespace-nowrap",children:[s.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${w[r]||w.normal}`}),s.jsxs("div",{className:"text-[9px] text-slate-500 font-mono font-bold",children:["SYNC: ",o.toLocaleTimeString("fr-FR")]})]}),s.jsxs("div",{className:"flex bg-black/40 p-0.5 rounded-lg border border-white/10",children:[s.jsx("button",{onClick:()=>y==null?void 0:y("current_month"),className:`px-3 py-1.5 rounded-md text-[9px] font-black uppercase tracking-wider transition-all ${m==="current_month"?"bg-emerald-500 text-white shadow-lg shadow-emerald-500/20":"text-slate-500 hover:text-slate-300"}`,children:"Mois en Cours"}),s.jsx("button",{onClick:()=>y==null?void 0:y("all_time"),className:`px-3 py-1.5 rounded-md text-[9px] font-black uppercase tracking-wider transition-all ${m==="all_time"?"bg-violet-600 text-white shadow-lg shadow-violet-600/20":"text-slate-500 hover:text-slate-300"}`,children:"Historique"})]}),s.jsx("div",{className:"h-4 w-px bg-white/10 mx-1"}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsxs("button",{onClick:i,className:`h-8 px-2.5 rounded-lg font-black text-[9px] uppercase tracking-wider transition-all flex items-center gap-1.5 ${t?"bg-orange-600 text-white shadow-lg shadow-orange-600/20":"bg-white/5 text-slate-500 hover:text-slate-300"}`,children:[s.jsx("span",{children:"üî•"}),s.jsx("span",{className:"hidden sm:inline",children:"Priorit√©"})]}),s.jsxs("button",{onClick:n,className:`h-8 px-2.5 rounded-lg font-black text-[9px] uppercase tracking-wider transition-all flex items-center gap-1.5 ${e?"bg-violet-600 text-white shadow-lg shadow-violet-600/20":"bg-white/5 text-slate-500 hover:text-slate-300"}`,children:[s.jsx("span",{children:"üßò"}),s.jsx("span",{className:"hidden sm:inline",children:"Zen"})]})]}),s.jsx("button",{onClick:()=>j("/admin"),className:"w-auto h-8 px-3 rounded-full border border-white/10 flex items-center justify-center bg-slate-900 ml-1 flex-shrink-0 hover:bg-slate-800 hover:border-orange-500/50 hover:text-orange-500 transition-all cursor-pointer group",children:s.jsx("span",{className:"text-[10px] font-black text-slate-400 group-hover:text-orange-500 transition-colors",children:"ADMIN"})})]})]})})},Im=({progress:e,step:t})=>{const n=[{id:1,label:"Connexion",threshold:15},{id:2,label:"Chargement",threshold:35},{id:3,label:"Analyse",threshold:60},{id:4,label:"Calcul",threshold:85}];return s.jsxs("div",{className:"fixed inset-0 z-50 bg-[#020617] flex items-center justify-center overflow-hidden",children:[s.jsx("style",{children:`
  @keyframes scan-line {
    0% { transform: translateY(-100%); }
    100% { transform: translateY(100%); }
  }
  .scan-overlay {
    background: linear-gradient(to bottom, transparent, rgba(59, 130, 246, 0.1), transparent);
    animation: scan-line 3s linear infinite;
  }
`}),s.jsx("div",{className:"absolute inset-0 scan-overlay pointer-events-none"}),s.jsxs("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden",children:[s.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-blue-600/10 rounded-full blur-[120px] animate-pulse-soft"}),s.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-purple-600/10 rounded-full blur-[120px] animate-pulse-soft",style:{animationDelay:"1s"}})]}),s.jsxs("div",{className:"relative z-10 flex flex-col items-center gap-10 p-12 w-full max-w-3xl",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"w-32 h-32 glass-panel rounded-3xl flex items-center justify-center shadow-[0_0_40px_rgba(59,130,246,0.3)]",children:s.jsx("span",{className:"text-6xl filter drop-shadow-[0_0_15px_rgba(255,255,255,0.5)]",children:"‚ö°"})}),s.jsx("div",{className:"absolute inset-0 rounded-3xl border border-blue-500/30 animate-ping",style:{animationDuration:"3s"}})]}),s.jsxs("div",{className:"text-center space-y-2",children:[s.jsx("h1",{className:"text-4xl font-black text-white tracking-tight neon-text-blue",children:"AUTOPILOTE SOLAIRE"}),s.jsx("div",{className:"text-sm text-slate-400 uppercase tracking-[0.3em] font-mono",children:"Initialisation du Syst√®me"})]}),s.jsxs("div",{className:"w-full max-w-md space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-end",children:[s.jsx("span",{className:"text-blue-400 font-mono text-xs",children:t}),s.jsxs("span",{className:"text-2xl font-bold font-mono text-white",children:[e,"%"]})]}),s.jsx("div",{className:"h-1.5 w-full bg-slate-800/50 rounded-full overflow-hidden backdrop-blur-sm border border-white/5",children:s.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500 transition-all duration-300 ease-out shadow-[0_0_15px_rgba(59,130,246,0.6)]",style:{width:`${e}%`}})})]}),s.jsx("div",{className:"grid grid-cols-4 gap-4 w-full",children:n.map(i=>{const a=e>=i.threshold;return s.jsxs("div",{className:`
                  relative flex flex-col items-center gap-3 p-4 rounded-xl border transition-all duration-500
                  ${a?"bg-blue-900/20 border-blue-500/30 shadow-[0_0_20px_rgba(59,130,246,0.1)]":"bg-slate-900/20 border-white/5 text-slate-600"}
                `,children:[s.jsx("div",{className:`
                  w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold font-mono border
                  ${a?"bg-blue-500 border-blue-400 text-white shadow-[0_0_10px_rgba(59,130,246,0.5)]":"bg-slate-800 border-slate-700 text-slate-500"}
                `,children:a?"‚úì":i.id}),s.jsx("div",{className:`
                  text-xs font-bold uppercase tracking-wider
                  ${a?"text-blue-300":"text-slate-600"}
                `,children:i.label})]},i.id)})})]})]})},Lm=({isOpen:e,title:t,message:n,studyName:i,actionType:a,onConfirm:o,onCancel:r})=>{const[l,c]=N.useState(""),[d,u]=N.useState(!1);if(!e)return null;const p=a==="force_sign"?"green":a==="delete"?"red":a==="override"?"orange":"blue",h={green:{border:"border-green-500/50",btn:"bg-green-600 hover:bg-green-500 shadow-green-500/20",icon:"‚úÖ"},red:{border:"border-red-500/50",btn:"bg-red-600 hover:bg-red-500 shadow-red-500/20",icon:"üóëÔ∏è"},orange:{border:"border-orange-500/50",btn:"bg-orange-600 hover:bg-orange-500 shadow-orange-500/20",icon:"‚ö†Ô∏è"},blue:{border:"border-blue-500/50",btn:"bg-blue-600 hover:bg-blue-500 shadow-blue-500/20",icon:"‚ÑπÔ∏è"}}[p],f=["Contact t√©l√©phonique confirm√©","Accord oral en attente","Erreur de tracking connue","Client en d√©placement","Paiement en cours de validation"],m=async()=>{if(!l.trim()){alert("‚ö†Ô∏è Veuillez fournir une justification");return}if(l.trim().length<10){alert("‚ö†Ô∏è La justification doit contenir au moins 10 caract√®res");return}u(!0);try{await o(l.trim()),c("")}catch(b){console.error("Error confirming override:",b),alert("‚ùå Erreur lors de la confirmation")}finally{u(!1)}},y=()=>{c(""),r()};return s.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/80 backdrop-blur-md animate-fadeIn",children:s.jsxs("div",{className:`
          glass-panel w-full max-w-lg rounded-2xl overflow-hidden border-2 ${h.border} 
          shadow-[0_0_50px_rgba(0,0,0,0.5)] transform transition-all animate-slideUp
        `,children:[s.jsx("div",{className:"p-6 border-b border-white/5 bg-white/5",children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{children:[s.jsxs("h3",{className:"text-xl font-bold text-white mb-1 flex items-center gap-2",children:[s.jsx("span",{className:"text-2xl",children:h.icon}),t]}),i&&s.jsxs("div",{className:"text-sm text-slate-300 ml-9",children:["Dossier :"," ",s.jsx("span",{className:"font-bold text-white",children:i})]})]}),s.jsx("button",{onClick:y,disabled:d,className:"text-slate-400 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-full",children:"‚úï"})]})}),s.jsxs("div",{className:"p-6 space-y-6",children:[n&&s.jsx("div",{className:"bg-slate-900/50 border border-slate-700/50 rounded-xl p-4",children:s.jsx("p",{className:"text-slate-300 leading-relaxed text-sm",children:n})}),s.jsx("div",{className:`rounded-xl p-4 ${p==="red"?"bg-red-500/10 border border-red-500/20":"bg-orange-500/10 border border-orange-500/20"}`,children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("span",{className:"text-xl",children:"üõ°Ô∏è"}),s.jsxs("div",{children:[s.jsx("div",{className:`font-bold text-sm mb-0.5 ${p==="red"?"text-red-400":"text-orange-400"}`,children:"Action critique - Justification requise"}),s.jsx("div",{className:"text-xs text-slate-400",children:"Cette action sera enregistr√©e de mani√®re immuable dans les logs de s√©curit√©."})]})]})}),s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("label",{className:"block text-xs font-bold text-slate-400 uppercase tracking-wider",children:"Justification"}),s.jsx("span",{className:"text-[10px] text-slate-500",children:"Requis pour valider"})]}),s.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:f.map(b=>s.jsx("button",{onClick:()=>c(b),className:"px-2.5 py-1 bg-slate-800 hover:bg-slate-700 border border-slate-700 hover:border-slate-600 rounded-md text-[10px] text-slate-300 transition-colors",children:b},b))}),s.jsx("textarea",{value:l,onChange:b=>c(b.target.value),rows:3,disabled:d,placeholder:"Expliquez la raison de cette action exceptionnelle...",className:"w-full bg-black/40 border border-white/10 rounded-xl px-4 py-3 text-white placeholder-slate-600 focus:border-white/20 focus:ring-1 focus:ring-white/20 focus:outline-none resize-none text-sm transition-all"}),s.jsx("div",{className:"flex justify-end mt-1",children:s.jsxs("span",{className:`text-[10px] ${l.trim().length<10?"text-orange-400":"text-emerald-400"}`,children:[l.trim().length,"/10 caract√®res"]})})]})]}),s.jsxs("div",{className:"p-4 bg-black/20 border-t border-white/5 flex items-center justify-end gap-3",children:[s.jsx("button",{onClick:y,disabled:d,className:"px-4 py-2 hover:bg-white/5 text-slate-400 hover:text-white rounded-lg font-bold text-sm transition-colors",children:"Annuler"}),s.jsx("button",{onClick:m,disabled:d||l.trim().length<10,className:`px-4 py-2 text-white rounded-lg font-bold text-sm transition-all shadow-lg hover:shadow-xl hover:scale-[1.02] active:scale-95 ${h.btn} disabled:opacity-50 disabled:cursor-not-allowed`,children:"Confirmer Action"})]})]})})};function Fm(){const{studies:e,emailLeads:t,logs:n,metrics:i,financialStats:a,loading:o,loadingProgress:r,loadingStep:l,error:c,trafficData:d,emailFlowByClient:u,antiAnnulationByStudy:p,postRefusByStudy:h,actions:{refresh:f,signStudy:m,cancelStudy:y,deleteStudy:b,markDepositPaid:w,markRibSent:j,deleteLeadPermanently:k,setOptOut:C,logForceAction:_}}=hc(),[g,x]=N.useState("cockpit"),[v,S]=N.useState(new Date),[A,R]=N.useState({search:"",views:null,clicks:null,status:null,optout:!1}),[P,L]=N.useState(!1),[T,V]=N.useState(!1),[te,$]=N.useState("performance"),[F,K]=N.useState({isOpen:!1,title:"",onConfirm:async()=>{}}),be=N.useCallback(()=>{f(),S(new Date)},[f]),ve=N.useMemo(()=>pc(e,t,i),[e,t,i]);N.useCallback(()=>{x("war_room")},[]);const Ze=()=>{K(I=>({...I,isOpen:!1}))},Je=async(I,q)=>{K({isOpen:!0,title:"Forcer la signature ?",message:"Cette action va contourner les v√©rifications automatiques.",studyName:q,actionType:"force_sign",onConfirm:async se=>{await m(I,q),K(me=>({...me,isOpen:!1}))}})},Qe=async(I,q)=>{K({isOpen:!0,title:"Confirmer l'annulation",message:"Le dossier sera marqu√© comme annul√©. Irr√©versible.",studyName:q,actionType:"delete",onConfirm:async se=>{await y(I,q),K(me=>({...me,isOpen:!1}))}})},Ue=async(I,q)=>{K({isOpen:!0,title:"Supprimer d√©finitivement ?",message:"Toutes les donn√©es associ√©es seront perdues.",studyName:q,actionType:"delete",onConfirm:async se=>{await b(I,q),K(me=>({...me,isOpen:!1}))}})},et=async(I,q)=>{await w(I,q)},M=async(I,q)=>{await j(I,q)},O=async I=>{await C(I)},U=async(I,q,se)=>{await k(I,q,se)},[Y,X]=N.useState("current_month"),{filteredStudies:ce,filteredLeads:fe,filteredMetrics:de,filteredFinancialStats:ye}=N.useMemo(()=>{if(Y==="all_time")return{filteredStudies:e,filteredLeads:t,filteredMetrics:i,filteredFinancialStats:a};const I=new Date,q=I.getMonth(),se=I.getFullYear(),me=ue=>{if(!ue)return!1;const jt=new Date(ue);return jt.getMonth()===q&&jt.getFullYear()===se},wt=e.filter(ue=>me(ue.created_at)||ue.signed_at&&me(ue.signed_at)||ue.deposit_paid_at&&me(ue.deposit_paid_at)),$t=t.filter(ue=>me(ue.created_at)),$e=ir(wt);return{filteredStudies:wt,filteredLeads:$t,filteredMetrics:$e,filteredFinancialStats:$e.financialStats}},[e,t,i,a,Y]),ae=N.useMemo(()=>({studies:ce,emailLeads:fe,logs:n,metrics:de,financialStats:ye,loading:o,systemInitialized:!0,loadingProgress:100,loadingStep:"Ready",error:null,emailFlowByClient:u,antiAnnulationByStudy:p,postRefusByStudy:h,trafficData:d,zenMode:P,setActiveSection:x,actions:{refresh:f,signStudy:Je,cancelStudy:Qe,deleteStudy:Ue,markDepositPaid:et,markRibSent:M,setOptOut:O,deleteLeadPermanently:U,logForceAction:_||(async(I,q)=>console.warn(`Agent Log System inactive: ${q} on ${I}`)),updateStudyStatus:async()=>console.warn("Update Study Status: Not connected to Agent yet")}}),[ce,fe,n,de,ye,o,u,p,h,d,P,f,_]);return o?s.jsx(Im,{progress:r,step:l}):c?s.jsxs("div",{className:"text-red-500 p-10 text-center text-xl font-bold bg-slate-900 h-screen flex items-center justify-center",children:["üõë ",c]}):s.jsxs("div",{className:"min-h-screen bg-[#020617] text-slate-200 font-sans selection:bg-blue-500/30",children:[s.jsx(Lm,{isOpen:F.isOpen,title:F.title,message:F.message,studyName:F.studyName,actionType:F.actionType,onConfirm:F.onConfirm,onCancel:Ze}),s.jsx(Pm,{zenMode:P,priorityMode:T,onToggleZenMode:()=>L(!P),onTogglePriorityMode:()=>V(!T),onRefresh:be,lastRefresh:v,systemStatus:(i==null?void 0:i.systemState)==="stable"?"normal":i==null?void 0:i.systemState,activeSection:g,setActiveSection:x,unsubscribedCount:ve.unsubscribedCount,unsubscribeRate:ve.unsubscribeRate,totalStudies:ve.totalStudies,totalClients:ve.totalStudies,signedClients:ve.signedStudies,globalDateFilter:Y,onSetDateFilter:X}),s.jsxs("main",{className:"max-w-[1600px] mx-auto px-6 py-8 space-y-12 mt-20",children:[g==="cockpit"&&s.jsx(nm,{system:ae}),g==="war_room"&&s.jsx(lm,{system:ae}),g==="pilotage"&&s.jsx(mm,{system:ae}),g==="sales"&&s.jsx(vm,{system:ae}),g==="roi"&&s.jsx(jm,{system:ae}),g==="registry"&&s.jsx(Dm,{system:ae}),g==="system"&&s.jsx(Rm,{system:ae}),g==="dashboard"&&s.jsxs("div",{className:"text-center py-20",children:[s.jsx("h2",{className:"text-2xl font-bold text-slate-500",children:"Le Monolithe a √©t√© d√©mantel√©."}),s.jsx("p",{className:"text-slate-600 mt-2",children:"Veuillez utiliser le Cockpit comme point d'entr√©e."}),s.jsx("button",{onClick:()=>x("cockpit"),className:"mt-6 px-6 py-2 bg-blue-600 text-white rounded-lg font-bold",children:"Retour au Cockpit"})]})]})]})}export{Fm as default};
